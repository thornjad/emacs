<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-03-05 Wed 00:45 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Thornjad's Emacs Configuration</title>
<meta name="author" content="Jade Michael Thornton &lt;thornjad&gt;" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" href="static/styles.css" type="text/css" />
</head>
<body>
<div id="content" class="content">
<h1 class="title">Thornjad's Emacs Configuration</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org9d88533">Introduction</a>
<ul>
<li><a href="#org6e271da">Installation</a>
<ul>
<li><a href="#orgd0f7968">Emacs installation using included build scripts</a></li>
</ul>
</li>
<li><a href="#orgb750b35">Local configuration</a></li>
<li><a href="#org13493cd">Credits and acknowledgements</a></li>
<li><a href="#orgf0ebd41">Copyright Notice</a></li>
</ul>
</li>
<li><a href="#org28d60eb">How this file is loaded</a></li>
<li><a href="#org7d33b87">Lexical binding</a></li>
<li><a href="#org07306f7">Directory constants</a></li>
<li><a href="#orga5796bf">Builtin requires</a></li>
<li><a href="#org23b983a">Define Library functions</a>
<ul>
<li><a href="#org068d86a">Advice helpers</a></li>
<li><a href="#org80c20c7">Utilities</a></li>
<li><a href="#org64af2be">System and logging</a>
<ul>
<li><a href="#org2f4c36f">Change font size (zoom in and out)</a></li>
</ul>
</li>
<li><a href="#org07572f7">Buffers, windows, frames, tabs</a></li>
<li><a href="#orgf279caf">Files</a>
<ul>
<li><a href="#org9caaa69">Reopen file at buffer</a></li>
<li><a href="#org2303898">Other file helpers</a></li>
</ul>
</li>
<li><a href="#org1802aae">Et cetera</a></li>
</ul>
</li>
<li><a href="#orge789a63">Packaging setup</a>
<ul>
<li><a href="#org90ec5e8">GnuTLS</a></li>
<li><a href="#orgbdf603b">Straight.el</a></li>
<li><a href="#org062496f">Custom package macro</a></li>
<li><a href="#org69a5689">Fetch arbitrary MELPA recipe</a></li>
</ul>
</li>
<li><a href="#org1132931">Core setup (prelude)</a>
<ul>
<li><a href="#org5eb6fa9">Treesitter initialization</a></li>
<li><a href="#org968e3c9">Compile angel</a></li>
<li><a href="#org85d7443">Fix GNU ELPA Keyring</a></li>
<li><a href="#org254b715">Library requirements</a></li>
<li><a href="#org1f20e1a">PATH from shell</a></li>
</ul>
</li>
<li><a href="#orgb93b512">Foundational functionality</a>
<ul>
<li><a href="#orgad7952b">Keybindings</a>
<ul>
<li><a href="#orge119ef7">Which-key</a></li>
<li><a href="#org2401222">General</a></li>
<li><a href="#orgee8fac9">Casual</a></li>
</ul>
</li>
<li><a href="#org38e0b10">Evil</a>
<ul>
<li><a href="#orgac02690">Evil collection</a></li>
<li><a href="#org2e9a451">Evil-matchit</a></li>
</ul>
</li>
<li><a href="#org183c914">Treesitter</a>
<ul>
<li><a href="#org498246c">Treesit-auto</a></li>
<li><a href="#orgabdc177">Evil textobj with treesitter</a></li>
</ul>
</li>
<li><a href="#org68a4533">Completion and navigation</a>
<ul>
<li><a href="#orgc8807c5">Vertico</a></li>
<li><a href="#orga4d94b0">Marginalia</a></li>
<li><a href="#org2a5dcae">Orderless</a></li>
<li><a href="#orgd8bf7fc">Consult</a></li>
<li><a href="#org47f481d">Amx</a></li>
<li><a href="#org1bada67">Yasnippet</a></li>
<li><a href="#org442084c">Recentf (builtin)</a></li>
<li><a href="#orge1eebd8">All-the-icons</a></li>
<li><a href="#org4c78ed6">Avy</a></li>
<li><a href="#orgab456d2">Smartscan</a></li>
<li><a href="#orgda4d708">Undo-tree</a></li>
<li><a href="#orgc9b5cb1">Winner</a></li>
</ul>
</li>
<li><a href="#orge836184">Winum</a></li>
<li><a href="#org893239f">Company completions</a>
<ul>
<li><a href="#org93593c7">Company-prescient</a></li>
<li><a href="#org05dfc79">Company-box</a></li>
</ul>
</li>
<li><a href="#org0505c0a">Tramp</a></li>
<li><a href="#orge414098">Dired</a></li>
<li><a href="#orgf140039">Language server</a>
<ul>
<li><a href="#orgf6734c7">Eglot</a></li>
<li><a href="#orged02e29">Eldoc-box</a></li>
</ul>
</li>
<li><a href="#org9170ee8">System-specific setup</a></li>
<li><a href="#orgd6ccda5">Editor setup</a></li>
</ul>
</li>
<li><a href="#org1a0f0c8">UI</a>
<ul>
<li><a href="#orgc6f265f">Aero modeline</a></li>
<li><a href="#org5b42013">Theme (Aero theme)</a></li>
<li><a href="#orgc1531b7">Default frame setup</a></li>
<li><a href="#org4f9eb48">General UI</a></li>
<li><a href="#orgb3eacfa">Good scroll</a></li>
<li><a href="#org935425d">Formfeeder</a></li>
<li><a href="#org3985aad">Highlight-thing</a></li>
<li><a href="#org3630000">Selection highlight</a></li>
<li><a href="#org9df4139">Todo-light</a></li>
<li><a href="#org3c166bb">Evil-terminal-cursor-changer</a></li>
</ul>
</li>
<li><a href="#org90814de">Breadcrumbs in the headerline</a></li>
<li><a href="#orgefeaef7">Project management</a></li>
<li><a href="#org96d9f7a">Magit</a>
<ul>
<li><a href="#org0123ebd">git-gutter</a>
<ul>
<li><a href="#org7cb3909">git-gutter-fringe</a></li>
</ul>
</li>
<li><a href="#org9b9da89">Ediff</a></li>
<li><a href="#org563c434">Git-link</a></li>
</ul>
</li>
<li><a href="#org62e776f">Org mode and org agenda</a>
<ul>
<li><a href="#orgb344c69">Org package</a></li>
<li><a href="#org71774ce">Org-appear</a></li>
<li><a href="#org25f2e2b">Org-modern</a></li>
<li><a href="#org40a627f">Evil-org-mode</a></li>
<li><a href="#org20d59c8">Org-fancy-priorities</a></li>
<li><a href="#orga0f58bd">Org-super-agenda</a></li>
<li><a href="#org726bbd9">Org-download</a></li>
<li><a href="#org80c0ddf">Functions for the org agenda</a></li>
<li><a href="#orgdd3c55d">Org-roam</a>
<ul>
<li><a href="#orged3b9d9">Thornlog</a></li>
<li><a href="#org0e78da3">Update and created timestamps in Org-roam</a></li>
<li><a href="#org9c6b95d">Consult-org-roam</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgaa164b4">Writing</a>
<ul>
<li><a href="#org011863c">Writegood</a></li>
<li><a href="#org87d164d">Eprime</a></li>
</ul>
</li>
<li><a href="#org22c3022">Applications</a>
<ul>
<li><a href="#orgeed07e5">Pomp (pomodoro)</a></li>
<li><a href="#org187d1c4">Restclient (HTTP requests)</a></li>
<li><a href="#org244f9d9">ESUP</a></li>
<li><a href="#org555881e">Virtual-comment</a></li>
</ul>
</li>
<li><a href="#org60efdd0">Prog modes</a>
<ul>
<li><a href="#org0ee629e">Auto-mode settings</a></li>
<li><a href="#org22fa5ac">C Language</a></li>
<li><a href="#org0493a3e">Sh-script</a></li>
<li><a href="#org5b0f5f6">Markdown</a>
<ul>
<li><a href="#org90c80e7">Markdown-toc</a></li>
</ul>
</li>
<li><a href="#org17f220c">Yaml</a></li>
<li><a href="#orgef4fc0b">Ocaml (Tuareg)</a></li>
<li><a href="#orgfcff0f7">Web mode (HTML, CSS, JS)</a>
<ul>
<li><a href="#org218f177">Emmet</a></li>
</ul>
</li>
<li><a href="#org8ba8226">Jest</a></li>
<li><a href="#org14eeacc">SQL</a></li>
<li><a href="#org110c5d8">Lisp editing environment</a>
<ul>
<li><a href="#orgacf0807">Common Lisp</a></li>
<li><a href="#orgbd0144d">Redefine the Lisp indent function</a></li>
</ul>
</li>
<li><a href="#org3395732">Clojure</a>
<ul>
<li><a href="#orgb80dd1c">Cider</a></li>
</ul>
</li>
<li><a href="#orgcd8ea82">Emacs Lisp</a>
<ul>
<li><a href="#orgc05eca8">Package-lint</a></li>
<li><a href="#org9382893">Elisp-autofmt</a></li>
<li><a href="#orgff4dfff">El2md</a></li>
</ul>
</li>
<li><a href="#org0ee3bb9">Python</a>
<ul>
<li><a href="#orgc02526c">Elpy</a></li>
<li><a href="#orge6d462d">Flymake-mypy</a></li>
<li><a href="#org1d63dc7">Flymake-ruff</a></li>
</ul>
</li>
<li><a href="#org5bca374">Rust</a>
<ul>
<li><a href="#orge84baa8">Cargo</a></li>
</ul>
</li>
<li><a href="#org10bd1cd">TOML</a></li>
<li><a href="#org0d590a1">Docker</a></li>
<li><a href="#org3243d65">Lua</a></li>
<li><a href="#orgdb7166b">AppleScript</a></li>
<li><a href="#orga1f6f8e">Nhexl</a></li>
<li><a href="#org9c50586">Terraform</a></li>
<li><a href="#org18ca632">GraphQL</a></li>
<li><a href="#org80c8e6a">Groovy</a></li>
<li><a href="#org2d57fcb">CSV</a></li>
<li><a href="#org0df5e52">Orson (WIP)</a></li>
<li><a href="#orgba0b72e">Elm</a></li>
<li><a href="#org553a216">TCL</a></li>
<li><a href="#org83cfd20">Rivet</a></li>
</ul>
</li>
<li><a href="#orgbdbf1de">Parentheses</a>
<ul>
<li><a href="#org9c30b80">Smartparens</a></li>
<li><a href="#orgdadae27">Rainbow delimiters</a></li>
</ul>
</li>
<li><a href="#org84c4deb">Flymake &amp; Flyspell</a>
<ul>
<li><a href="#orgd90e76a">Flymake</a>
<ul>
<li><a href="#org9ad57c6">Flymake-diagnostic-at-point</a></li>
<li><a href="#orgf54088b">Flymake-eslint</a></li>
</ul>
</li>
<li><a href="#org549f8a1">Flyspell</a>
<ul>
<li><a href="#org20e95fe">Flyspell-lazy</a></li>
<li><a href="#org12e8b6a">Flyspell-correct</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org84863ed">Formatting (Apheleia)</a></li>
<li><a href="#org10f916c">Debugging with Dape</a></li>
<li><a href="#org999b8e8">Whitespace and indentation</a></li>
<li><a href="#org7b927cc">EWW: the Emacs Web Wowser</a>
<ul>
<li><a href="#orgee0276f">Shrface</a></li>
<li><a href="#org15053d5">Shr-tag-pre-highlight</a></li>
</ul>
</li>
<li><a href="#org0223c8e">Devdocs</a></li>
<li><a href="#org5db0f1e">Elfeed</a>
<ul>
<li><a href="#org5a52502">Elfeed-org</a></li>
</ul>
</li>
<li><a href="#org36bf286">AI</a>
<ul>
<li><a href="#orgad599e2">Gptel</a>
<ul>
<li><a href="#org96c45a8">Gptel-quick</a></li>
</ul>
</li>
<li><a href="#orgeddb3dc">Copilot</a></li>
</ul>
</li>
<li><a href="#org5edb2f3">Shell</a>
<ul>
<li><a href="#org18f38e4">Xterm-color</a></li>
<li><a href="#org4faf5b9">Eshell</a>
<ul>
<li><a href="#org6ffb228">Eshell-prompt-extras</a></li>
<li><a href="#org71c61c5">Eshell-syntax-highlighting</a></li>
<li><a href="#org12ac71d">Capf-autosuggest</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org0014582">Yarn-lock derived mode</a></li>
<li><a href="#orgcf9b317">General variable configuration</a>
<ul>
<li><a href="#orgec63817">Disable custom system</a></li>
</ul>
</li>
<li><a href="#org751419a">Idle garbage collection</a></li>
<li><a href="#org355ff21">Load local file</a></li>
</ul>
</div>
</div>
<div id="outline-container-org9d88533" class="outline-2">
<h2 id="org9d88533">Introduction</h2>
<div class="outline-text-2" id="text-org9d88533">
<p>
Here lives my own configuration for GNU Emacs, blending all the best shit I can find, making a conscious effort for speed, robustness and above all, skillfulness. There are many like it, but this one is mine.
</p>

<blockquote>
<p>
"Configuring Emacs is more of a lifestyle choice than a task that one completes." — Stephen Ramsey
</p>
</blockquote>

<p>
This is most definitely not a general distribution Emacs configuration system. It undergoes constant evolution; bindings, settings and packages change with no warning and little to no documentation. This project is open source as a reference or source of ideas. Use at your own risk.
</p>

<p>
To get started with Emacs, I highly recommend the distribution responsible for hooking me in: <a href="https://spacemacs.org">Spacemacs</a>.
</p>

<blockquote>
<p>
"An infinite number of monkeys typing into GNU Emacs would never make a good program." — Linus Torvalds
</p>
</blockquote>

<p>
When I first started using Emacs, I took full advantage of Spacemacs, so the architecture of that project has shaped the way I think about editing. As such, the majority of the config revolves around a single leader key, <code>SPC</code>. For example, <code>SPC SPC</code> is the same as <code>M-x</code>, <code>SPC f w</code> (for file write) saves the buffer to disk.
</p>

<blockquote>
<p>
"Emacs is a great operating system, lacking only a decent editor." — ancient Vi proverb
</p>
</blockquote>

<p>
For everything else, this config makes extensive use of <a href="https://github.com/emacs-evil/evil">Evil</a>, providing the user with modifier-key-free modal editing, though the majority of Emacs bindings remain available. Emacs keybindings belong in the dark ages where they originated. They might work for RMS, but I can only hold <code>CTRL</code> for so long.
</p>

<p>
My config uses my <code>aero-theme</code>, which pulls loose inspiration from the <a href="https://github.com/11111000000/tao-theme-emacs">Tao themes</a> and colors inspired by northern Minnesota in Autumn. The theme package also contains <code>aero-dark</code>, which incorporates further inspiration from my own <a href="https://github.com/ClearNight/clearnight-retro-syntax">ClearNight Retro</a> theme for <a href="https://atom.io">Atom</a> (may it rest in peace).
</p>

<p>
Within this config, you'll also find a custom improved mode line which works with any theme (though it looks great with <code>aero-light</code> and <code>aero-dark</code>). Rather than getting cluttered with info from every mode under the sun, the Aero mode line displays the current editing mode, file status (changed, saved, locked), filename, file size, line number at point, progression through the file (percentage), the remote hostname (if using TRAMP) and the current major mode.
</p>
</div>
<div id="outline-container-org6e271da" class="outline-3">
<h3 id="org6e271da">Installation</h3>
<div class="outline-text-3" id="text-org6e271da">
<p>
Clone this repo into your <code>~/.config/emacs</code> and run <code>make init</code>. The make command will install dependencies needed for LSP servers, using any tools already available on the system (e.g. it will not error if <code>opam</code> isn't installed), as well as dependencies like <code>graphviz</code> and <code>lsp-booster</code>. It will also set up and update some submodules.
</p>

<p>
Upon starting up Emacs for the first time, further third-party packages will automatically download and install via <code>straight.el</code>. Subsequent startups should take one or two seconds. If you encounter any errors at this stage, try restarting Emacs and/or opening a bug.
</p>
</div>
<div id="outline-container-orgd0f7968" class="outline-4">
<h4 id="orgd0f7968">Emacs installation using included build scripts</h4>
<div class="outline-text-4" id="text-orgd0f7968">
<p>
My configuration includes some convenient scripting to install Emacs on Linux and Mac, with both a stable and cutting-edge version supported for Mac.
</p>
</div>
<ul class="org-ul">
<li><a id="org472b207"></a>Installing Emacs on Linux<br />
<div class="outline-text-5" id="text-org472b207">
<p>
The <code>make linux</code> target will call <code>linux.zsh</code>, which installs requirements, configures, builds and installs the latest version of Emacs.
</p>
</div>
</li>
<li><a id="orgff56e5f"></a>Installing Emacs on MacOS<br />
<div class="outline-text-5" id="text-orgff56e5f">
<p>
Unlike Linux, installing and running Emacs on MacOS can be flaky, so several installation options are provided. Use the one that works best on your machine.
</p>

<ul class="org-ul">
<li><code>make build-emacs-macos</code>: This is the preferred option, installing the development version of Emacs with native compilation and XWidgets support.</li>
<li><code>make build-emacs-macos-stable</code>: A fallback option, installing the mainline release version of Emacs, with native compilation and XWidgets support.</li>
<li><code>make build-emacs-macos-minimal</code>: Same as <code>build-emacs-macos</code> but without native compilation.</li>
<li><code>make build-emacs-macos-stable-minimal</code>: Same as <code>build-emacs-macos-stable</code> but without native compilation.</li>
<li><code>make build-emacs-cask</code>: Install the standard Homebrew Cask <code>emacs-nightly</code> package, still cutting-edge but should be more stable than the previous options.</li>
<li><code>make build-emacs-cask-stable</code>: The final fallback, the standard Homebrew Cask <code>emacs</code> package.</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-orgb750b35" class="outline-3">
<h3 id="orgb750b35">Local configuration</h3>
<div class="outline-text-3" id="text-orgb750b35">
<p>
Your environment may require specific configuration, such as secret keys, environment variables, or work-specific functions, which should not appear in a git repository. My config features the ability to read an <code>init.local.el</code> when it exists in the same directory as the <code>init.el</code>. This local file may contain arbitrary Elisp, which is executed after everything else.
</p>
</div>
</div>
<div id="outline-container-org13493cd" class="outline-3">
<h3 id="org13493cd">Credits and acknowledgements</h3>
<div class="outline-text-3" id="text-org13493cd">
<p>
Like the Borg, my config amalgamates macros, functions, bindings and packages modified from or inspired by a plethora of developers. Special thanks to these fantastic people, with links to the invaluable resource they provide:
</p>

<ul class="org-ul">
<li><a href="https://github.com/sachac/.emacs.d">Sacha Chua</a></li>
<li><a href="https://svn.red-bean.com/repos/kfogel/trunk/.emacs">Karl Fogel</a></li>
<li><a href="https://github.com/Wilfred/.emacs.d">Wilfred Hughes</a></li>
<li><a href="https://github.com/jwiegley/dot-emacs">John Wiegley</a></li>
<li><a href="https://github.com/purcell/emacs.d">Steve Purcell</a></li>
<li><a href="https://github.com/sam217pa/emacs-config">Samuel Barreto</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgf0ebd41" class="outline-3">
<h3 id="orgf0ebd41">Copyright Notice</h3>
<div class="outline-text-3" id="text-orgf0ebd41">
<p>
Copyright (c) 2016-2025 Jade Michael Thornton
</p>

<p>
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted, provided that the above
copyright notice and this permission notice appear in all copies.
</p>

<p>
The software is provided "as is" and the author disclaims all warranties with
regard to this software including all implied warranties of merchantability
and fitness. In no event shall the author be liable for any special, direct,
indirect, or consequential damages or any damages whatsoever resulting from
loss of use, data or profits, whether in an action of contract, negligence or
other tortious action, arising out of or in connection with the use or
performance of this software.
</p>
</div>
</div>
</div>
<div id="outline-container-org28d60eb" class="outline-2">
<h2 id="org28d60eb">How this file is loaded</h2>
<div class="outline-text-2" id="text-org28d60eb">
<p>
Obviously you're reading an org file right now, not Emacs Lisp, so <code>org-babel</code> converts (tangles) all the source block in this file into a <code>config.el</code> file, which is then actually executed to configure Emacs.
</p>

<p>
This conversion kicks off from <code>init.el</code>, which also sets up some critical early functionality such as determining if treesitter is available and messing with garbage collection (a controversial practice). Then <code>org-babel-load-file</code> is called on this org file and whole configuration journey is launched. The rest of this file is executed in order, with everything that is not inside a source block stripped out.
</p>
</div>
</div>
<div id="outline-container-org7d33b87" class="outline-2">
<h2 id="org7d33b87">Lexical binding</h2>
<div class="outline-text-2" id="text-org7d33b87">
<p>
Before any other code, we have to make sure the tangled <code>config.el</code> has lexical binding, or else we're in for a world of pain. I cannot understand why this isn't the default. Emacs should at least have an option to make everything lexical by default, forcing old code to opt-out.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">-*- lexical-binding: t -*-</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org07306f7" class="outline-2">
<h2 id="org07306f7">Directory constants</h2>
<div class="outline-text-2" id="text-org07306f7">
<p>
These define some locations that we can reference later
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defconst</span> <span style="color: #5C7B52;">aero-lib-dir</span> (expand-file-name <span style="color: #8B887D; font-style: italic;">"lib/"</span> user-emacs-directory))
(<span style="color: #737063; font-weight: bold;">defconst</span> <span style="color: #5C7B52;">aero-etc-dir</span> (expand-file-name <span style="color: #8B887D; font-style: italic;">"etc/"</span> user-emacs-directory))
(<span style="color: #737063; font-weight: bold;">defconst</span> <span style="color: #5C7B52;">aero-snippets-dir</span> (expand-file-name <span style="color: #8B887D; font-style: italic;">"snippets/"</span> user-emacs-directory))
(<span style="color: #737063; font-weight: bold;">defconst</span> <span style="color: #5C7B52;">aero-cache-dir</span> (expand-file-name <span style="color: #8B887D; font-style: italic;">"cache/"</span> aero-etc-dir))
(<span style="color: #737063; font-weight: bold;">defconst</span> <span style="color: #5C7B52;">pcache-directory</span> (expand-file-name <span style="color: #8B887D; font-style: italic;">"pcache/"</span> aero-cache-dir))
(<span style="color: #737063; font-weight: bold;">unless</span> (file-exists-p aero-cache-dir) (make-directory aero-cache-dir))
</pre>
</div>

<p>
We also need to set up locations for org-roam and thornlog. Thornlog is a custom daily logging and note-taking system, using org-roam. Check out the <a href="#orged3b9d9">Thornlog</a> section for more.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defconst</span> <span style="color: #5C7B52;">aero/documents-path</span> (expand-file-name <span style="color: #8B887D; font-style: italic;">"~/Documents/"</span>))
(<span style="color: #737063; font-weight: bold;">defconst</span> <span style="color: #5C7B52;">aero/thornlog-path</span> (expand-file-name <span style="color: #8B887D; font-style: italic;">"thornlog/"</span> aero/documents-path))
(<span style="color: #737063; font-weight: bold;">defconst</span> <span style="color: #5C7B52;">aero/roam-path</span> (expand-file-name <span style="color: #8B887D; font-style: italic;">"roam/"</span> aero/thornlog-path))
(<span style="color: #737063; font-weight: bold;">defconst</span> <span style="color: #5C7B52;">aero/thornlog-archive-file</span> (expand-file-name <span style="color: #8B887D; font-style: italic;">"archive/archive.org"</span> aero/thornlog-path))
(<span style="color: #737063; font-weight: bold;">defconst</span> <span style="color: #5C7B52;">aero/thornlog-elfeed-directory</span> (expand-file-name <span style="color: #8B887D; font-style: italic;">"elfeed/"</span> aero/documents-path)
  <span style="color: #96a7a9; font-weight: bold;">"The directory where elfeed will store its database and other files."</span>)
(<span style="color: #737063; font-weight: bold;">defconst</span> <span style="color: #5C7B52;">aero/thornlog-elfeed-org-file</span> (expand-file-name <span style="color: #8B887D; font-style: italic;">"rss_feeds.org"</span> aero/roam-path))
</pre>
</div>
</div>
</div>
<div id="outline-container-orga5796bf" class="outline-2">
<h2 id="orga5796bf">Builtin requires</h2>
<div class="outline-text-2" id="text-orga5796bf">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">require</span> '<span style="color: #655370; font-weight: bold;">cl-lib</span>)
(<span style="color: #737063; font-weight: bold;">require</span> '<span style="color: #655370; font-weight: bold;">subr-x</span>)
(<span style="color: #737063; font-weight: bold;">require</span> '<span style="color: #655370; font-weight: bold;">imenu</span>)
</pre>
</div>

<p>
These are mostly used by Org, not sure if they're still needed.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">require</span> '<span style="color: #655370; font-weight: bold;">outline</span>)
(<span style="color: #737063; font-weight: bold;">require</span> '<span style="color: #655370; font-weight: bold;">notifications</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org23b983a" class="outline-2">
<h2 id="org23b983a">Define Library functions</h2>
<div class="outline-text-2" id="text-org23b983a">
<p>
Some general helpers, not used much
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">rand-nth</span> (coll)
  <span style="color: #96a7a9; font-weight: bold;">"Return a random element of the list COLL."</span>
  (nth (random (length coll)) coll))

<span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Help debugging hidden errors</span>
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/reraise-error</span> (func <span style="color: #387780; font-style: italic;">&amp;rest</span> args)
  <span style="color: #96a7a9; font-weight: bold;">"Call function FUNC with ARGS and re-raise any error which occurs.</span>
<span style="color: #96a7a9; font-weight: bold;">Useful for debugging post-command hooks and filter functions, which</span>
<span style="color: #96a7a9; font-weight: bold;">normally have their errors suppressed."</span>
  (<span style="color: #737063; font-weight: bold;">condition-case</span> err
      (apply func args)
    ((debug error) (<span style="color: #d7af00; font-weight: bold;">signal</span> (car err) (cdr err)))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/toggle-debug-on-hidden-errors</span> (func)
  <span style="color: #96a7a9; font-weight: bold;">"Toggle hidden error debugging for function FUNC."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span> <span style="color: #8B887D; font-style: italic;">"a"</span>)
  (<span style="color: #737063; font-weight: bold;">cond</span>
   ((advice-member-p #'aero/reraise-error func)
    (advice-remove func #'aero/reraise-error)
    (message <span style="color: #8B887D; font-style: italic;">"Debug on hidden errors disabled for %s"</span> func))
   (t
    (advice-add func <span style="color: #403D2E; font-style: italic;">:around</span> #'aero/reraise-error)
    (message <span style="color: #8B887D; font-style: italic;">"Debug on hidden errors enabled for %s"</span> func))))
</pre>
</div>
</div>
<div id="outline-container-org068d86a" class="outline-3">
<h3 id="org068d86a">Advice helpers</h3>
<div class="outline-text-3" id="text-org068d86a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/advice-disable-subword</span> (orig-fun <span style="color: #387780; font-style: italic;">&amp;rest</span> args)
  <span style="color: #96a7a9; font-weight: bold;">"Disable `</span><span style="color: #655370; font-weight: bold;">subword-mode</span><span style="color: #96a7a9; font-weight: bold;">' around the given function."</span>
  (<span style="color: #737063; font-weight: bold;">let</span> ((original-mode subword-mode))
    (subword-mode -1)
    (apply orig-fun args)
    (subword-mode original-mode)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/advice-no-message</span> (fn <span style="color: #387780; font-style: italic;">&amp;rest</span> args)
  <span style="color: #96a7a9; font-weight: bold;">"Advise function FN with ARGS not to message at all."</span>
  (<span style="color: #737063; font-weight: bold;">let</span> ((message-log-max nil)
        (inhibit-message t))
    (apply fn args)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defadvice</span> <span style="color: #83684C; font-weight: bold;">kill-line</span> (before kill-line-autoreindent activate)
  <span style="color: #96a7a9; font-weight: bold;">"Kill excess whitespace when joining lines.</span>
<span style="color: #96a7a9; font-weight: bold;">If the next line is joined to the current line, kill the extra indent whitespace in front of the next line."</span>
  (<span style="color: #737063; font-weight: bold;">when</span> (<span style="color: #737063; font-weight: bold;">and</span> (eolp) (not (bolp)))
    (<span style="color: #737063; font-weight: bold;">save-excursion</span>
      (forward-char 1)
      (just-one-space 1))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/advice-elisp-get-fnsym-args-string</span> (fn sym <span style="color: #387780; font-style: italic;">&amp;rest</span> args)
  <span style="color: #96a7a9; font-weight: bold;">"If SYM is a function, append its docstring."</span>
  (concat
   (apply fn sym args)
   (<span style="color: #737063; font-weight: bold;">let</span> ((doc (<span style="color: #737063; font-weight: bold;">and</span> (fboundp sym) (documentation sym 'raw))))
     (<span style="color: #737063; font-weight: bold;">and</span> doc
          (stringp doc)
          (not (string= <span style="color: #8B887D; font-style: italic;">""</span> doc))
          (concat <span style="color: #8B887D; font-style: italic;">"\n\n"</span> (propertize doc 'face 'italic))))))
(advice-add 'elisp-get-fnsym-args-string <span style="color: #403D2E; font-style: italic;">:around</span> #'aero/advice-elisp-get-fnsym-args-string)

(<span style="color: #737063; font-weight: bold;">define-advice</span> <span style="color: #83684C; font-weight: bold;">comment-indent-new-line</span> (<span style="color: #403D2E; font-style: italic;">:after</span> (<span style="color: #387780; font-style: italic;">&amp;optional</span> soft) at-least-one-space)
  <span style="color: #96a7a9; font-weight: bold;">"Ensure that at least one space is added after the comment-start."</span>
  (<span style="color: #737063; font-weight: bold;">let</span> ((start (regexp-quote comment-start)))
    (<span style="color: #737063; font-weight: bold;">when</span> (<span style="color: #737063; font-weight: bold;">and</span> (nth 4 (syntax-ppss))
               (looking-back start (+ (point) (length start)))
               (not (looking-back <span style="color: #8B887D; font-style: italic;">" "</span>  (+ (point) 1))))
      (insert <span style="color: #8B887D; font-style: italic;">" "</span>))))

<span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Don't kill scratch buffer, just bury it if something tries to</span>
(<span style="color: #737063; font-weight: bold;">defadvice</span> <span style="color: #83684C; font-weight: bold;">kill-buffer</span> (around kill-buffer-around-advice activate)
  <span style="color: #96a7a9; font-weight: bold;">"Don't kill my scratch!"</span>
  (<span style="color: #737063; font-weight: bold;">let</span> ((buffer-to-kill (ad-get-arg 0)))
    (<span style="color: #737063; font-weight: bold;">if</span> (equal buffer-to-kill <span style="color: #8B887D; font-style: italic;">"*scratch*"</span>)
        (bury-buffer)
      ad-do-it)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org80c20c7" class="outline-3">
<h3 id="org80c20c7">Utilities</h3>
<div class="outline-text-3" id="text-org80c20c7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/keyboard-quit-context</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Quit current context.</span>

<span style="color: #96a7a9; font-weight: bold;">This function is a combination of `</span><span style="color: #655370; font-weight: bold;">keyboard-quit</span><span style="color: #96a7a9; font-weight: bold;">' and `</span><span style="color: #655370; font-weight: bold;">keyboard-escape-quit</span><span style="color: #96a7a9; font-weight: bold;">'</span>
<span style="color: #96a7a9; font-weight: bold;">with some parts omitted and some custom behavior added."</span>
  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Adapted from https://with-emacs.com/posts/tips/quit-current-context/</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">cond</span>
   ((region-active-p)
    <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Avoid adding the region to the window selection.</span>
    (<span style="color: #737063; font-weight: bold;">setq</span> saved-region-selection nil)
    (<span style="color: #737063; font-weight: bold;">let</span> (select-active-regions)
      (deactivate-mark)))

   ((eq last-command 'mode-exited)
    nil)

   (current-prefix-arg
    nil)

   (defining-kbd-macro
     (message
      (substitute-command-keys
       <span style="color: #8B887D; font-style: italic;">"Quit is ignored during macro defintion, use \\[</span><span style="color: #655370; font-weight: bold; font-style: italic;">kmacro-end-macro</span><span style="color: #8B887D; font-style: italic;">] if you want to stop macro definition"</span>))
     (cancel-kbd-macro-events))

   ((active-minibuffer-window)
    (<span style="color: #737063; font-weight: bold;">when</span> (get-buffer-window <span style="color: #8B887D; font-style: italic;">"*Completions*"</span>)
      <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">hide completions first so point stays in active window when</span>
      <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">outside the minibuffer</span>
      (minibuffer-hide-completions))
    (abort-recursive-edit))

   (t
    (keyboard-quit))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/comment-dwim</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Comment region if active, else comment line.</span>

<span style="color: #96a7a9; font-weight: bold;">This avoids the excess region commenting of `</span><span style="color: #655370; font-weight: bold;">comment-line</span><span style="color: #96a7a9; font-weight: bold;">' while also avoiding the weird single-line</span>
<span style="color: #96a7a9; font-weight: bold;">behavior of `</span><span style="color: #655370; font-weight: bold;">comment-dwim</span><span style="color: #96a7a9; font-weight: bold;">'."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">save-excursion</span>
    (<span style="color: #737063; font-weight: bold;">if</span> (use-region-p)
        (call-interactively #'comment-or-uncomment-region)
      (call-interactively #'comment-line))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/applescript-escape</span> (str)
  <span style="color: #96a7a9; font-weight: bold;">"Escape STR to make it suitable for using is applescripts."</span>
  (replace-regexp-in-string <span style="color: #8B887D; font-style: italic;">"\""</span> <span style="color: #8B887D; font-style: italic;">"\\\\\""</span> str))

(<span style="color: #737063; font-weight: bold;">defmacro</span> <span style="color: #83684C; font-weight: bold;">aero/local!</span> (<span style="color: #387780; font-style: italic;">&amp;rest</span> body)
  <span style="color: #96a7a9; font-weight: bold;">"Execute BODY in local directory instead of TRAMP."</span>
  `(<span style="color: #737063; font-weight: bold;">let</span> ((default-directory user-emacs-directory))
     ,@body))

(<span style="color: #737063; font-weight: bold;">defmacro</span> <span style="color: #83684C; font-weight: bold;">aero/voidvar!</span> (<span style="color: #387780; font-style: italic;">&amp;rest</span> body)
  <span style="color: #96a7a9; font-weight: bold;">"Appease the compiler by pretending to use variables in BODY.</span>

<span style="color: #96a7a9; font-weight: bold;">Similar to C++'s void var construct."</span>
  `(<span style="color: #737063; font-weight: bold;">and</span> ,@body))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/sort-words</span> (reverse beg end)
  <span style="color: #96a7a9; font-weight: bold;">"Sort words in region alphabetically, in REVERSE if negative.</span>
<span style="color: #96a7a9; font-weight: bold;">Prefixed with negative \\[</span><span style="color: #655370; font-weight: bold;">universal-argument</span><span style="color: #96a7a9; font-weight: bold;">], sorts in reverse.</span>

<span style="color: #96a7a9; font-weight: bold;">The variable `</span><span style="color: #655370; font-weight: bold;">sort-fold-case</span><span style="color: #96a7a9; font-weight: bold;">' determines whether alphabetic case affects the</span>
<span style="color: #96a7a9; font-weight: bold;">sort order.</span>

<span style="color: #96a7a9; font-weight: bold;">See `</span><span style="color: #655370; font-weight: bold;">sort-regexp-fields</span><span style="color: #96a7a9; font-weight: bold;">'."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span> <span style="color: #8B887D; font-style: italic;">"*P\nr"</span>)
  (sort-regexp-fields reverse <span style="color: #8B887D; font-style: italic;">"\\w+"</span> <span style="color: #8B887D; font-style: italic;">"\\&amp;"</span> beg end))
</pre>
</div>
</div>
</div>
<div id="outline-container-org64af2be" class="outline-3">
<h3 id="org64af2be">System and logging</h3>
<div class="outline-text-3" id="text-org64af2be">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">system-is-mac</span> () (string= system-type 'darwin))
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">system-is-linux</span> () (string= system-type 'gnu/linux))
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">system-is-mswindows</span> () (string= system-type 'windows-nt))
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">window-system-is-mac</span> () (memq (window-system) '(mac ns)))
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">in-nix-shell-p</span> () (string-equal (getenv <span style="color: #8B887D; font-style: italic;">"IN_NIX_SHELL"</span>) <span style="color: #8B887D; font-style: italic;">"1"</span>))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/has-modules-p</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Return true when Emacs has been compiled with modules support."</span>
  (<span style="color: #737063; font-weight: bold;">and</span> (functionp 'module-load) (<span style="color: #737063; font-weight: bold;">bound-and-true-p</span> module-file-suffix)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">treesitterp</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Evaluate whether Emacs has treesitter support."</span>
  (<span style="color: #737063; font-weight: bold;">and</span> (functionp 'treesit-available-p) (treesit-available-p)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">node-repl</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Launch a Node.js comint REPL."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (setenv <span style="color: #8B887D; font-style: italic;">"NODE_NO_READLINE"</span> <span style="color: #8B887D; font-style: italic;">"1"</span>)  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">avoid fancy terminal codes</span>
  (pop-to-buffer (make-comint <span style="color: #8B887D; font-style: italic;">"node-repl"</span> <span style="color: #8B887D; font-style: italic;">"node"</span> nil <span style="color: #8B887D; font-style: italic;">"--interactive"</span>)))
</pre>
</div>
</div>
<div id="outline-container-org2f4c36f" class="outline-4">
<h4 id="org2f4c36f">Change font size (zoom in and out)</h4>
<div class="outline-text-4" id="text-org2f4c36f">
<p>
Especially useful when screen sharing, Google Meet in particular really makes things blurry.
</p>

<p>
Based on <a href="https://sachachua.com/blog/2006/09/emacs-changing-the-font-size-on-the-fly/">https://sachachua.com/blog/2006/09/emacs-changing-the-font-size-on-the-fly/</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/increase-font-size</span> ()
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (set-face-attribute 'default nil <span style="color: #403D2E; font-style: italic;">:height</span> (ceiling (* 1.10 (face-attribute 'default <span style="color: #403D2E; font-style: italic;">:height</span>)))))
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/decrease-font-size</span> ()
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (set-face-attribute 'default nil <span style="color: #403D2E; font-style: italic;">:height</span> (floor (* 0.9 (face-attribute 'default <span style="color: #403D2E; font-style: italic;">:height</span>)))))
(global-set-key (kbd <span style="color: #8B887D; font-style: italic;">"C-+"</span>) 'aero/increase-font-size)
(global-set-key (kbd <span style="color: #8B887D; font-style: italic;">"C--"</span>) 'aero/decrease-font-size)
</pre>
</div>

<p>
Also allow <code>C-=</code>, just to be less annoying since that's just + without shift
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="color: #8B887D; font-style: italic;">"C-="</span>) 'aero/increase-font-size)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org07572f7" class="outline-3">
<h3 id="org07572f7">Buffers, windows, frames, tabs</h3>
<div class="outline-text-3" id="text-org07572f7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/switch-to-minibuffer-window</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"switch to minibuffer window (if active)"</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">when</span> (active-minibuffer-window)
    (select-window (active-minibuffer-window))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">switch-to-messages-buffer</span> ()
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (switch-to-buffer <span style="color: #8B887D; font-style: italic;">"*Messages*"</span>))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">switch-to-scratch-buffer</span> ()
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (switch-to-buffer <span style="color: #8B887D; font-style: italic;">"*scratch*"</span>))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">switch-to-new-scratch-buffer</span> ()
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (switch-to-buffer (generate-new-buffer <span style="color: #8B887D; font-style: italic;">"*scratch*"</span>)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/bury-buffer-kill-window</span> (<span style="color: #387780; font-style: italic;">&amp;optional</span> window)
  <span style="color: #96a7a9; font-weight: bold;">"Bury the current buffer and kill its window, or use WINDOW."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">let*</span> ((buf (window-buffer window))
         (win (get-buffer-window buf)))
    (bury-buffer buf)
    (delete-window win)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/alternate-buffer</span> (<span style="color: #387780; font-style: italic;">&amp;optional</span> window)
  <span style="color: #96a7a9; font-weight: bold;">"Switch back and forth between current and last buffer in the current window."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">cl-destructuring-bind</span>
      (buf start pos)
      (<span style="color: #737063; font-weight: bold;">or</span> (cl-find (window-buffer window) (window-prev-buffers) <span style="color: #403D2E; font-style: italic;">:key</span> #'car <span style="color: #403D2E; font-style: italic;">:test-not</span> #'eq)
          (list (other-buffer) nil nil))
    (<span style="color: #737063; font-weight: bold;">if</span> (not buf)
        (message <span style="color: #8B887D; font-style: italic;">"Last buffer not found"</span>)
      (set-window-buffer-start-and-point window buf start pos))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/alternate-window</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Switch back and forth between current and last window in the current frame."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">let</span> ( <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">switch to first window previously shown in this frame</span>
        (prev-window (get-mru-window nil t t)))
    <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Check window was not found successfully</span>
    (<span style="color: #737063; font-weight: bold;">unless</span> prev-window
      (<span style="color: #d7af00; font-weight: bold;">user-error</span> <span style="color: #8B887D; font-style: italic;">"Last window not found."</span>))
    (select-window prev-window)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/layout-two-columns</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Switch to two column window layout."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (delete-other-windows)
  (split-window-right))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/layout-three-columns</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Switch to three column window layout."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (delete-other-windows)
  (<span style="color: #737063; font-weight: bold;">dotimes</span> (_ 2)
    (split-window-right))
  (balance-windows))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/tail-compilation-buffer</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Reset tailing the compilation buffer."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">let*</span> ((buf-name (aero/get-compilation-buffer-name))
         (window (get-buffer-window buf-name))
         (pos (<span style="color: #737063; font-weight: bold;">with-current-buffer</span> buf-name (point-max))))
    (set-window-point window pos)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/project-compile-popup</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Run `</span><span style="color: #655370; font-weight: bold;">project-compile</span><span style="color: #96a7a9; font-weight: bold;">' and pop up the compilation buffer."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">let</span> ((buf (get-buffer-create (aero/get-compilation-buffer-name))))
    (aero/toggle-compilation-buffer)
    (project-compile)
    (aero/tail-compilation-buffer)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/get-compilation-buffer-name</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Return the compilation buffer name for the current project."</span>
  (<span style="color: #737063; font-weight: bold;">if</span> (project-current nil)
      (project-prefixed-buffer-name <span style="color: #8B887D; font-style: italic;">"compilation"</span>)
    <span style="color: #8B887D; font-style: italic;">"*compilation*"</span>))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/toggle-compilation-buffer</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Pop-up the compilation buffer."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (aero/toggle-popup-buffer (aero/get-compilation-buffer-name))
  (aero/tail-compilation-buffer))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/toggle-popup-buffer</span> (buf)
  <span style="color: #96a7a9; font-weight: bold;">"Pop-up BUF in a buffer below."</span>
  (<span style="color: #737063; font-weight: bold;">let</span> ((win (get-buffer-window buf 0)))
    (<span style="color: #737063; font-weight: bold;">if</span> win
        <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">found, so close it</span>
        (aero/bury-buffer-kill-window win)

      <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">else we need to pop it up</span>
      (<span style="color: #737063; font-weight: bold;">progn</span>
        (display-buffer buf
                        '((display-buffer-below-selected)
                          (reusable-frames . nil) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">only search this frame</span>
                          (window-height . 20)))
        (set-window-dedicated-p (get-buffer-window buf) t)))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/incr-compilation-buffer</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Renames existing compilation buffer so you can create more."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">let</span> ((cbuf (get-buffer <span style="color: #8B887D; font-style: italic;">"*compilation*"</span>))
        (more-cbufs t)
        (n 1)
        (new-cbuf-name <span style="color: #8B887D; font-style: italic;">""</span>))
    (<span style="color: #737063; font-weight: bold;">when</span> cbuf
      (<span style="color: #737063; font-weight: bold;">while</span> more-cbufs
        (<span style="color: #737063; font-weight: bold;">setq</span> new-cbuf-name (format <span style="color: #8B887D; font-style: italic;">"*compilation%d*"</span> n))
        (<span style="color: #737063; font-weight: bold;">setq</span> n (1+ n))
        (<span style="color: #737063; font-weight: bold;">setq</span> more-cbufs (get-buffer new-cbuf-name)))
      (<span style="color: #737063; font-weight: bold;">with-current-buffer</span> cbuf
        (rename-buffer new-cbuf-name)))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/eshell-new</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Open a new Eshell window."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (eshell t))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/project-eshell-new</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Open a new project Eshell."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">let</span> ((current-prefix-arg t))
    (project-eshell)))

(<span style="color: #737063; font-weight: bold;">defmacro</span> <span style="color: #83684C; font-weight: bold;">aero/async-shell-command-with-path</span> (command <span style="color: #387780; font-style: italic;">&amp;optional</span> buffer error-buffer)
  <span style="color: #96a7a9; font-weight: bold;">"Run COMMAND asynchronously like `</span><span style="color: #655370; font-weight: bold;">async-shell-command</span><span style="color: #96a7a9; font-weight: bold;">' but with PATH loaded."</span>
  `(<span style="color: #737063; font-weight: bold;">let</span> ((shell-command-switch <span style="color: #8B887D; font-style: italic;">"-ic"</span>))
     (async-shell-command ,command ,buffer ,error-buffer)))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf279caf" class="outline-3">
<h3 id="orgf279caf">Files</h3>
<div class="outline-text-3" id="text-orgf279caf">
</div>
<div id="outline-container-org9caaa69" class="outline-4">
<h4 id="org9caaa69">Reopen file at buffer</h4>
<div class="outline-text-4" id="text-org9caaa69">
<p>
It's occasionally useful to "restart" the current buffer. To my current knowledge this isn't a builtin functionality, so I have my own function.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/reopen-file-at-buffer</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Re-open the file at buffer, replacing buffer.</span>

<span style="color: #96a7a9; font-weight: bold;">After reopening, cursor will attempt to return to the point it was previously</span>
<span style="color: #96a7a9; font-weight: bold;">on. This may cause a jump if the file has changed significantly. Finally, the</span>
<span style="color: #96a7a9; font-weight: bold;">buffer will be recentered to the line at point."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">let</span> ((initial-line (line-beginning-position))
        (initial-point (point))
        (initial-total-lines (count-lines (point-min) (point-max))))
    (find-alternate-file (buffer-file-name))
    (<span style="color: #737063; font-weight: bold;">if</span> (= initial-total-lines (count-lines (point-min) (point-max)))
        <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">If total lines have not changed, we can reasonably guess that the</span>
        <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">content has not changed significantly (if at all), so we can jump</span>
        <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">right back to the initial point.</span>
        (goto-char initial-point)
      <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">If total lines /have/ changed, we can reasonably guess that the initial</span>
      <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">point is contextually not where we were before. The best thing we can</span>
      <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">do now is return to the same line number, and hope it's close. Getting</span>
      <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">closer than this would require text parsing, which is more complex than</span>
      <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">we need for a simple file replacement.</span>
      (goto-char initial-line))
    <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Finally, recenter the line. We may not have been centered before, but this is more often than</span>
    <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">not what we want.</span>
    (recenter)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org2303898" class="outline-4">
<h4 id="org2303898">Other file helpers</h4>
<div class="outline-text-4" id="text-org2303898">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/insert-date</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Insert current date."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (insert (format-time-string <span style="color: #8B887D; font-style: italic;">"%Y-%m-%d"</span>)))
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/insert-timestamp</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Insert current timestamp."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (insert (format-time-string <span style="color: #8B887D; font-style: italic;">"%Y-%m-%dT%H:%M:%S"</span>)))
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/insert-unix-time-seconds</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Insert current Unix timestamp."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (insert (format-time-string <span style="color: #8B887D; font-style: italic;">"%s"</span>)))
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/insert-unix-time-milliseconds</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Insert current Unix timestamp."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (insert (number-to-string (truncate (* 1000 (float-time))))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/filename-relative-to-project</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Return the path of the current buffer relative to the project root."</span>
  (file-relative-name (buffer-file-name) (project-root (project-current))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/copy-file-relative-to-project</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Copy the path of current buffer relative to the project."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (kill-new (aero/filename-relative-to-project)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/delete-this-file</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Delete the current file, and kill the buffer."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">or</span> (buffer-file-name) (<span style="color: #d7af00; font-weight: bold;">error</span> <span style="color: #8B887D; font-style: italic;">"No file is currently being edited"</span>))
  (<span style="color: #737063; font-weight: bold;">when</span> (yes-or-no-p (format <span style="color: #8B887D; font-style: italic;">"Really delete '</span><span style="color: #655370; font-weight: bold; font-style: italic;">%s</span><span style="color: #8B887D; font-style: italic;">'?"</span> (file-name-nondirectory buffer-file-name)))
    (delete-file (buffer-file-name))
    (kill-this-buffer)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/rename-this-file-and-buffer</span> (new-name)
  <span style="color: #96a7a9; font-weight: bold;">"Renames both current buffer and file it's visiting to NEW-NAME."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span> <span style="color: #8B887D; font-style: italic;">"sNew name: "</span>)
  (<span style="color: #737063; font-weight: bold;">let</span> ((name (buffer-name))
        (filename (buffer-file-name)))
    (<span style="color: #737063; font-weight: bold;">unless</span> filename
      (<span style="color: #d7af00; font-weight: bold;">error</span> <span style="color: #8B887D; font-style: italic;">"Buffer '</span><span style="color: #655370; font-weight: bold; font-style: italic;">%s</span><span style="color: #8B887D; font-style: italic;">' is not visiting a file!"</span> name))
    (<span style="color: #737063; font-weight: bold;">if</span> (get-buffer new-name)
        (message <span style="color: #8B887D; font-style: italic;">"A buffer named '</span><span style="color: #655370; font-weight: bold; font-style: italic;">%s</span><span style="color: #8B887D; font-style: italic;">' already exists!"</span> new-name)
      (<span style="color: #737063; font-weight: bold;">progn</span>
        (rename-file filename new-name 1)
        (rename-buffer new-name)
        (set-visited-file-name new-name)
        (set-buffer-modified-p nil)))))

<span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">adapted from http://emacs.stackexchange.com/questions/202/close-all-dired-buffers</span>
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/kill-diff-buffers</span> ()
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (mapc
   (<span style="color: #737063; font-weight: bold;">lambda</span> (buffer)
     (<span style="color: #737063; font-weight: bold;">when</span> (member
            (buffer-local-value 'major-mode buffer) '(diff-mode magit-diff-mode magit-process-mode))
       (kill-buffer buffer)))
   (buffer-list)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/fill-to-80</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"`</span><span style="color: #655370; font-weight: bold;">fill-paragraph</span><span style="color: #96a7a9; font-weight: bold;">' to 80 columns, regardless of the default."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">let</span> ((fill-column 80))
    (fill-paragraph)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/dos2unix</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Converts the current buffer to UNIX file format."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (set-buffer-file-coding-system 'undecided-unix nil))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/unix2dos</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Converts the current buffer to DOS file format."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (set-buffer-file-coding-system 'undecided-dos nil))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/run-osascript</span> (script-content)
  <span style="color: #96a7a9; font-weight: bold;">"Run an SCRIPT-CONTENT as AppleScript/osascipt."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span> <span style="color: #8B887D; font-style: italic;">"sContent of AppleScript/osascript:"</span>)
  (<span style="color: #737063; font-weight: bold;">let</span> ((file (make-temp-file <span style="color: #8B887D; font-style: italic;">"aero-temp-osa-"</span> nil <span style="color: #8B887D; font-style: italic;">".applescript"</span>)))
    (<span style="color: #737063; font-weight: bold;">with-temp-file</span> file
      (insert script-content)
      (insert <span style="color: #8B887D; font-style: italic;">"\ndo shell script \"rm -rf \" &amp; the quoted form of POSIX path of (path to me)"</span>))
    (aero/run-osascript-file file)))
(<span style="color: #737063; font-weight: bold;">defalias</span> '<span style="color: #83684C; font-weight: bold;">aero/run-applescript</span> #'aero/run-osascript)

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/run-osascript-file</span> (file)
  <span style="color: #96a7a9; font-weight: bold;">"Run an AppleScript/osascipt FILE."</span>
  (<span style="color: #737063; font-weight: bold;">with-current-buffer</span> (get-buffer-create <span style="color: #8B887D; font-style: italic;">"*OsaScript*"</span>)
    (insert <span style="color: #8B887D; font-style: italic;">"Going to run file: "</span> file))
  (start-process <span style="color: #8B887D; font-style: italic;">"OsaScript"</span> <span style="color: #8B887D; font-style: italic;">"*OsaScript*"</span> <span style="color: #8B887D; font-style: italic;">"osascript"</span> file))
(<span style="color: #737063; font-weight: bold;">defalias</span> '<span style="color: #83684C; font-weight: bold;">aero/run-applescript-file</span> #'aero/run-osascript-file)

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/reveal-in-finder-as</span> (file)
  <span style="color: #96a7a9; font-weight: bold;">"Reveal the supplied file FILE in Finder.</span>

<span style="color: #96a7a9; font-weight: bold;">To call interactively, use [aero/open-in-finder]."</span>
  (<span style="color: #737063; font-weight: bold;">let</span> ((script
         (concat
          <span style="color: #8B887D; font-style: italic;">"set thePath to POSIX file \""</span>
          (shell-quote-argument file)
          <span style="color: #8B887D; font-style: italic;">"\"\n"</span>
          <span style="color: #8B887D; font-style: italic;">"tell application \"Finder\"\n"</span>
          <span style="color: #8B887D; font-style: italic;">" set frontmost to true\n"</span>
          <span style="color: #8B887D; font-style: italic;">" reveal thePath \n"</span>
          <span style="color: #8B887D; font-style: italic;">"end tell\n"</span>)))
    (aero/run-osascript script)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/open-in-finder</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Reveal the file associated with the current buffer in the OSX Finder.</span>
<span style="color: #96a7a9; font-weight: bold;">In a dired buffer, it will open the current file."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">declare-function</span> dired-file-name-at-point <span style="color: #8B887D; font-style: italic;">"dired.el"</span>)
  (aero/reveal-in-finder-as
   (<span style="color: #737063; font-weight: bold;">or</span> (buffer-file-name) (expand-file-name (<span style="color: #737063; font-weight: bold;">or</span> (dired-file-name-at-point) <span style="color: #8B887D; font-style: italic;">"."</span>)))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/sudo-edit</span> (<span style="color: #387780; font-style: italic;">&amp;optional</span> arg)
  (<span style="color: #737063; font-weight: bold;">interactive</span> <span style="color: #8B887D; font-style: italic;">"P"</span>)
  (<span style="color: #737063; font-weight: bold;">let</span> ((fname
         (<span style="color: #737063; font-weight: bold;">if</span> (<span style="color: #737063; font-weight: bold;">or</span> arg (not buffer-file-name))
             (read-file-name <span style="color: #8B887D; font-style: italic;">"File: "</span>)
           buffer-file-name)))
    (find-file
     (<span style="color: #737063; font-weight: bold;">cond</span>
      ((string-match-p <span style="color: #8B887D; font-style: italic;">"^/ssh:"</span> fname)
       (<span style="color: #737063; font-weight: bold;">with-temp-buffer</span>
         (insert fname)
         (search-backward <span style="color: #8B887D; font-style: italic;">":"</span>)
         (<span style="color: #737063; font-weight: bold;">let</span> ((last-match-end nil)
               (last-ssh-hostname nil))
           (<span style="color: #737063; font-weight: bold;">while</span> (string-match <span style="color: #8B887D; font-style: italic;">"@\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\</span><span style="color: #d7af00; font-weight: bold; font-style: italic;">\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">(</span><span style="color: #8B887D; font-style: italic;">[</span><span style="color: #8B887D; font-style: italic;">^</span><span style="color: #8B887D; font-style: italic;">:|]+\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\</span><span style="color: #d7af00; font-weight: bold; font-style: italic;">\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">)</span><span style="color: #8B887D; font-style: italic;">"</span> fname last-match-end)
             (<span style="color: #737063; font-weight: bold;">setq</span> last-ssh-hostname (<span style="color: #737063; font-weight: bold;">or</span> (match-string 1 fname) last-ssh-hostname))
             (<span style="color: #737063; font-weight: bold;">setq</span> last-match-end (match-end 0)))
           (insert (format <span style="color: #8B887D; font-style: italic;">"|sudo:%s"</span> (<span style="color: #737063; font-weight: bold;">or</span> last-ssh-hostname <span style="color: #8B887D; font-style: italic;">"localhost"</span>))))
         (buffer-string)))
      (t
       (concat <span style="color: #8B887D; font-style: italic;">"/sudo:root@localhost:"</span> fname))))))

(<span style="color: #737063; font-weight: bold;">declare-function</span> tramp-cleanup-all-connections <span style="color: #8B887D; font-style: italic;">"tramp.el"</span>)
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/tramp-buffer-p</span> (buffer)
  (<span style="color: #737063; font-weight: bold;">let</span> ((name (buffer-name buffer)))
    (string-match <span style="color: #8B887D; font-style: italic;">"^\\*tramp"</span> name)))
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/kill-tramp</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Kill all Tramp connections. Useful for stale connections.</span>
<span style="color: #96a7a9; font-weight: bold;">This function does NOT remove remote buffers, only their connections."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">when</span> (<span style="color: #737063; font-weight: bold;">require</span> '<span style="color: #655370; font-weight: bold;">tramp</span> nil t)
    (<span style="color: #737063; font-weight: bold;">declare-function</span> password-reset <span style="color: #8B887D; font-style: italic;">"password-cache.el"</span>)
    (password-reset)
    (cancel-function-timers 'tramp-timeout-session)
    (<span style="color: #737063; font-weight: bold;">declare-function</span> tramp-list-tramp-buffers <span style="color: #8B887D; font-style: italic;">"tramp.el"</span>)
    (<span style="color: #737063; font-weight: bold;">dolist</span> (name (tramp-list-tramp-buffers))
      (<span style="color: #737063; font-weight: bold;">when</span> (processp (get-buffer-process name))
        (delete-process name)))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/kill-tags</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Kill the currently-loaded TAGS file."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">when</span> (get-buffer <span style="color: #8B887D; font-style: italic;">"TAGS"</span>)
    (kill-buffer <span style="color: #8B887D; font-style: italic;">"TAGS"</span>)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/open-local-init</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Open local init file for editing."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (find-file (concat user-emacs-directory <span style="color: #8B887D; font-style: italic;">"init-local.el"</span>)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/open-emacs-problems</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Open Emacs PROBLEMS file from GitHub mirror."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (eww <span style="color: #8B887D; font-style: italic;">"https://github.com/emacs-mirror/emacs/blob/master/etc/PROBLEMS"</span>))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/xdg-open</span> (arg)
  <span style="color: #96a7a9; font-weight: bold;">"Pass the specified ARG to \"xdg-open\".</span>

<span style="color: #96a7a9; font-weight: bold;">This can be used to open Nautilus/Finder, the default browser, etc. See \"man</span>
<span style="color: #96a7a9; font-weight: bold;">xdg-open\" for more."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span> (list (read-string <span style="color: #8B887D; font-style: italic;">"Open: "</span>)))
  (<span style="color: #737063; font-weight: bold;">let</span> ((proc
         (<span style="color: #737063; font-weight: bold;">cond</span>
          ((system-is-linux)
           <span style="color: #8B887D; font-style: italic;">"xdg-open"</span>)
          ((system-is-mac)
           <span style="color: #8B887D; font-style: italic;">"open"</span>)
          (t
           (<span style="color: #d7af00; font-weight: bold;">user-error</span> <span style="color: #8B887D; font-style: italic;">"No system process to use on this OS"</span>)))))
    (call-process proc nil 0 nil arg)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/browse-url-open</span> (url <span style="color: #387780; font-style: italic;">&amp;optional</span> _ignored)
  <span style="color: #96a7a9; font-weight: bold;">"Pass the specified URL to `</span><span style="color: #655370; font-weight: bold;">aero/xdg-open</span><span style="color: #96a7a9; font-weight: bold;">'.</span>

<span style="color: #96a7a9; font-weight: bold;">Ignored arg is due to the way `</span><span style="color: #655370; font-weight: bold;">funcall-interactively</span><span style="color: #96a7a9; font-weight: bold;">' calls stuff."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>
   (<span style="color: #737063; font-weight: bold;">let</span> ((link (<span style="color: #737063; font-weight: bold;">and</span> (derived-mode-p 'org-mode)
                    (org-element-context))))
     (<span style="color: #737063; font-weight: bold;">if</span> (<span style="color: #737063; font-weight: bold;">and</span> link (eq (car link) 'link))
         (list (org-element-property <span style="color: #403D2E; font-style: italic;">:raw-link</span> link))
       (browse-url-interactive-arg <span style="color: #8B887D; font-style: italic;">"URL: "</span>))))
  (aero/xdg-open url))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org1802aae" class="outline-3">
<h3 id="org1802aae">Et cetera</h3>
<div class="outline-text-3" id="text-org1802aae">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">written by github user rompy</span>
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/smarter-backward-kill-word</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Deletes the previous word, respecting:</span>
<span style="color: #96a7a9; font-weight: bold;">1. If the cursor is at the beginning of line, delete the '</span><span style="color: #655370; font-weight: bold;">\n</span><span style="color: #96a7a9; font-weight: bold;">'.</span>
<span style="color: #96a7a9; font-weight: bold;">2. If there is only whitespace, delete only to beginning of line.</span>
<span style="color: #96a7a9; font-weight: bold;">3. If there is whitespace, delete whitespace and check 4-5.</span>
<span style="color: #96a7a9; font-weight: bold;">4. If there are other characters instead of words, delete one only char.</span>
<span style="color: #96a7a9; font-weight: bold;">5. If it's a word at point, delete it."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">if</span> (bolp)
      (delete-char -1)
    (<span style="color: #737063; font-weight: bold;">if</span> (string-match-p
         <span style="color: #8B887D; font-style: italic;">"^[[:space:]]+$"</span> (buffer-substring-no-properties (line-beginning-position) (point)))
        (delete-horizontal-space)
      (<span style="color: #737063; font-weight: bold;">when</span> (thing-at-point 'whitespace)
        (delete-horizontal-space))
      (<span style="color: #737063; font-weight: bold;">if</span> (thing-at-point 'word)
          (<span style="color: #737063; font-weight: bold;">let</span> ((start (car (bounds-of-thing-at-point 'word)))
                (end (point)))
            (<span style="color: #737063; font-weight: bold;">if</span> (&gt; end start)
                (delete-region start end)
              (delete-char -1)))
        (delete-char -1)))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/go-to-tag</span> (arg)
  <span style="color: #96a7a9; font-weight: bold;">"Go to tag under point.</span>
<span style="color: #96a7a9; font-weight: bold;">If called with prefix argument, or with nothing under point, prompt for tag."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span> <span style="color: #8B887D; font-style: italic;">"P"</span>)
  (<span style="color: #737063; font-weight: bold;">when</span> (fboundp 'xref-find-definitions)
    (<span style="color: #737063; font-weight: bold;">let</span> ((xref-prompt-for-identifier arg))
      (aero/voidvar! xref-prompt-for-identifier)
      (call-interactively #'xref-find-definitions))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/native-compile-file-at-buffer</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Native compile the file in the current buffer."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">let</span> ((warning-minimum-level <span style="color: #403D2E; font-style: italic;">:warning</span>))
    (<span style="color: #737063; font-weight: bold;">save-excursion</span> (native-compile-async buffer-file-name nil t))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/byte-compile-file-at-buffer</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Byte compile the file open in the current buffer."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">save-excursion</span> (byte-compile-file buffer-file-name)))
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/byte-recompile-file-at-buffer</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Byte recompile the file open in the current buffer."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">save-excursion</span> (byte-recompile-file buffer-file-name)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">shrug</span> ()
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (insert <span style="color: #8B887D; font-style: italic;">"&#175;\\_(&#12484;)_/&#175;"</span>))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">untabify-buffer</span> ()
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (untabify (point-min) (point-max)))
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">tabify-buffer</span> ()
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (tabify (point-min) (point-max)))
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">indent-buffer</span> ()
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (indent-region (point-min) (point-max)))

(<span style="color: #737063; font-weight: bold;">defmacro</span> <span style="color: #83684C; font-weight: bold;">aero/insert-text-at-point</span> (text)
  `(<span style="color: #737063; font-weight: bold;">progn</span>
     (<span style="color: #737063; font-weight: bold;">save-excursion</span>
       (<span style="color: #737063; font-weight: bold;">unless</span> (eobp)
         (right-char))
       (insert ,text))
     (forward-sexp 1)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">alter-number-at-point</span> (offset)
  (<span style="color: #737063; font-weight: bold;">save-excursion</span>
    (skip-chars-backward <span style="color: #8B887D; font-style: italic;">"0-9"</span>)
    (<span style="color: #737063; font-weight: bold;">or</span> (looking-at <span style="color: #8B887D; font-style: italic;">"[0-9]+"</span>) (message <span style="color: #8B887D; font-style: italic;">"No number at point"</span>))
    (replace-match (number-to-string (+ offset (string-to-number (match-string 0)))))))
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">increment-number-at-point</span> ()
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (alter-number-at-point 1))
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">decrement-number-at-point</span> ()
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (alter-number-at-point -1))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">human-date</span> (human-string <span style="color: #387780; font-style: italic;">&amp;optional</span> epoch)
  <span style="color: #96a7a9; font-weight: bold;">"Convert HUMAN-STRING to a date string or if EPOCH, seconds.</span>
<span style="color: #96a7a9; font-weight: bold;">Requires the utility date to be installed."</span>
  (<span style="color: #737063; font-weight: bold;">with-temp-buffer</span>
    (<span style="color: #737063; font-weight: bold;">let</span> ((dateProc
           (<span style="color: #737063; font-weight: bold;">if</span> (system-is-mac)
               <span style="color: #8B887D; font-style: italic;">"gdate"</span>
             <span style="color: #8B887D; font-style: italic;">"date"</span>)))
      (<span style="color: #737063; font-weight: bold;">if</span> epoch
          (call-process dateProc nil t nil <span style="color: #8B887D; font-style: italic;">"-d"</span> human-string <span style="color: #8B887D; font-style: italic;">"+%s"</span>)
        (call-process dateProc nil t nil <span style="color: #8B887D; font-style: italic;">"-d"</span> human-string)))
    (replace-regexp-in-string <span style="color: #8B887D; font-style: italic;">"\n\\'"</span> <span style="color: #8B887D; font-style: italic;">""</span> (buffer-string))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">day-of-week</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Return the current day of the week."</span>
  (format-time-string <span style="color: #8B887D; font-style: italic;">"%A"</span>))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">day-after</span> (day-name)
  <span style="color: #96a7a9; font-weight: bold;">"Return the name of the day following the day given by '</span><span style="color: #655370; font-weight: bold;">day-name</span><span style="color: #96a7a9; font-weight: bold;">'."</span>
  (format-time-string <span style="color: #8B887D; font-style: italic;">"%A"</span> (time-add (date-to-time (concat day-name <span style="color: #8B887D; font-style: italic;">" 00:00"</span>)) (* 24 60 60))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/frame-recenter</span> (<span style="color: #387780; font-style: italic;">&amp;optional</span> frame)
  <span style="color: #96a7a9; font-weight: bold;">"Center FRAME on the screen.</span>

<span style="color: #96a7a9; font-weight: bold;">FRAME can specify a frame name, a terminal name, or a frame.</span>
<span style="color: #96a7a9; font-weight: bold;">If FRAME is omitted or nil, use currently selected frame."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">unless</span> (eq 'maximised (frame-parameter nil 'fullscreen))
    (<span style="color: #737063; font-weight: bold;">let*</span> ((frame (<span style="color: #737063; font-weight: bold;">or</span> (<span style="color: #737063; font-weight: bold;">and</span> (boundp 'frame) frame) (selected-frame)))
           (frame-w (frame-pixel-width frame))
           (frame-h (frame-pixel-height frame))
           (display (frame-parameter frame 'display))
           (monitor-w (display-pixel-width display))
           (monitor-h (display-pixel-height display))
           <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">NS doesn't report menu bar as outside monitor</span>
           (monitor-h
            (<span style="color: #737063; font-weight: bold;">if</span> (eq window-system 'ns)
                (- monitor-h 22)
              monitor-h))
           (center (list (/ (- monitor-w frame-w) 2) (/ (- monitor-h frame-h) 2))))
      (apply 'set-frame-position (flatten-list (list frame center))))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/ctags-create-tags</span> (rootdir <span style="color: #387780; font-style: italic;">&amp;optional</span> ctags-cmd)
  <span style="color: #96a7a9; font-weight: bold;">"Generate tags database in ROOTDIR.</span>
<span style="color: #96a7a9; font-weight: bold;">NOTE this requires Universal Ctags. It may work with Exuberant Ctags, but no guarantees. Definitely</span>
<span style="color: #96a7a9; font-weight: bold;">does not work with GNU Ctags. If your installation of Ctags does not use the `</span><span style="color: #655370; font-weight: bold;">ctags</span><span style="color: #96a7a9; font-weight: bold;">' command,</span>
<span style="color: #96a7a9; font-weight: bold;">specify it with CTAGS-CMD."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span> (list (read-directory-name <span style="color: #8B887D; font-style: italic;">"Root Directory: "</span> nil nil t)))
  (<span style="color: #737063; font-weight: bold;">let</span> ((default-directory rootdir)
        (cmd (<span style="color: #737063; font-weight: bold;">or</span> ctags-cmd <span style="color: #8B887D; font-style: italic;">"ctags"</span>))
        (buf (get-buffer-create <span style="color: #8B887D; font-style: italic;">" *aero/ctags-create-tags*"</span>)))
    (async-shell-command (concat
                          cmd
                          <span style="color: #8B887D; font-style: italic;">" --kinds-all='</span><span style="color: #655370; font-weight: bold; font-style: italic;">*</span><span style="color: #8B887D; font-style: italic;">' --fields='</span><span style="color: #655370; font-weight: bold; font-style: italic;">*</span><span style="color: #8B887D; font-style: italic;">' --extras='</span><span style="color: #655370; font-weight: bold; font-style: italic;">*</span><span style="color: #8B887D; font-style: italic;">' --langmap=TCL:.tcl.rvt -R"</span>)
                         buf)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/open-with</span> (arg)
  <span style="color: #96a7a9; font-weight: bold;">"Open visited file in default external program.</span>
<span style="color: #96a7a9; font-weight: bold;">When in dired mode, open file under the cursor.</span>
<span style="color: #96a7a9; font-weight: bold;">With a prefix ARG always prompt for command to use."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span> <span style="color: #8B887D; font-style: italic;">"P"</span>)
  (<span style="color: #737063; font-weight: bold;">let*</span> ((current-file-name
          (<span style="color: #737063; font-weight: bold;">if</span> (eq major-mode 'dired-mode)
              (dired-get-file-for-visit)
            buffer-file-name))
         (open
          (<span style="color: #737063; font-weight: bold;">pcase</span> system-type
            (`darwin <span style="color: #8B887D; font-style: italic;">"open"</span>)
            ((<span style="color: #737063; font-weight: bold;">or</span> `gnu `gnu/linux `gnu/kfreebsd) <span style="color: #8B887D; font-style: italic;">"xdg-open"</span>)))
         (program
          (<span style="color: #737063; font-weight: bold;">if</span> (<span style="color: #737063; font-weight: bold;">or</span> arg (not open))
              (read-shell-command <span style="color: #8B887D; font-style: italic;">"Open current file with: "</span>)
            open)))
    (call-process program nil 0 nil current-file-name)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">pulse-line</span> (<span style="color: #387780; font-style: italic;">&amp;rest</span> _)
  <span style="color: #96a7a9; font-weight: bold;">"Briefly pulse a highlight of the line at point.</span>
<span style="color: #96a7a9; font-weight: bold;">This function, when bound to certain commands like scrolling, acts as a native</span>
<span style="color: #96a7a9; font-weight: bold;">alternative to the beacon package."</span>
  (pulse-momentary-highlight-one-line (point)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/ssh-refresh</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Reset the environment variable SSH_AUTH_SOCK"</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">let</span> (ssh-auth-sock-old
        (getenv <span style="color: #8B887D; font-style: italic;">"SSH_AUTH_SOCK"</span>))
    (setenv <span style="color: #8B887D; font-style: italic;">"SSH_AUTH_SOCK"</span>
            (car
             (split-string
              (shell-command-to-string
               <span style="color: #8B887D; font-style: italic;">"ls -t $(find /tmp/ssh-* -user $USER -name '</span><span style="color: #655370; font-weight: bold; font-style: italic;">agent.*</span><span style="color: #8B887D; font-style: italic;">' 2&gt; /dev/null)"</span>))))
    (message (format <span style="color: #8B887D; font-style: italic;">"SSH_AUTH_SOCK %s --&gt; %s"</span> ssh-auth-sock-old (getenv <span style="color: #8B887D; font-style: italic;">"SSH_AUTH_SOCK"</span>)))))

(<span style="color: #737063; font-weight: bold;">defmacro</span> <span style="color: #83684C; font-weight: bold;">aero/with-buffer-excursion</span> (buffer-name <span style="color: #387780; font-style: italic;">&amp;rest</span> body)
  (<span style="color: #737063; font-weight: bold;">declare</span> (indent 1))
  `(<span style="color: #737063; font-weight: bold;">with-current-buffer</span> (get-buffer ,buffer-name)
     (<span style="color: #737063; font-weight: bold;">save-excursion</span>
       ,@body)))

(<span style="color: #737063; font-weight: bold;">defmacro</span> <span style="color: #83684C; font-weight: bold;">aero/with-buffer-max-excursion</span> (buffer-name <span style="color: #387780; font-style: italic;">&amp;rest</span> body)
  (<span style="color: #737063; font-weight: bold;">declare</span> (indent 1))
  `(aero/with-buffer-excursion ,buffer-name
     (goto-char (point-max))
     ,@body))

(<span style="color: #737063; font-weight: bold;">defmacro</span> <span style="color: #83684C; font-weight: bold;">aero/without-readonly</span> (<span style="color: #387780; font-style: italic;">&amp;rest</span> body)
  (<span style="color: #737063; font-weight: bold;">declare</span> (indent 0))
  `(<span style="color: #737063; font-weight: bold;">let</span> ((inhibit-read-only t))
     ,@body))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/plist-merge</span> (<span style="color: #387780; font-style: italic;">&amp;rest</span> plists)
  <span style="color: #96a7a9; font-weight: bold;">"Merge PLISTS into a single plist."</span>
  (<span style="color: #737063; font-weight: bold;">let</span> ((result (copy-sequence (car plists))))
    (<span style="color: #737063; font-weight: bold;">dolist</span> (plist plists)
      (<span style="color: #737063; font-weight: bold;">cl-loop</span> for (key value) on plist by #'cddr
               do (plist-put result key value)))
    result))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/unix-timestamp-to-human</span> (timestamp)
  <span style="color: #96a7a9; font-weight: bold;">"Convert a UNIX TIMESTAMP to a human-readable string."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span> (list (read-string <span style="color: #8B887D; font-style: italic;">"Timestamp: "</span> (thing-at-point 'word))))
  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">convert from milliseconds if it looks like milliseconds</span>
  (<span style="color: #737063; font-weight: bold;">let</span> ((timestamp (<span style="color: #737063; font-weight: bold;">if</span> (&gt;= (string-to-number timestamp) 10000000000)
                       (/ (string-to-number timestamp) 1000)
                     (string-to-number timestamp))))
    (message (format-time-string <span style="color: #8B887D; font-style: italic;">"%Y-%m-%d %H:%M:%S"</span> (seconds-to-time timestamp)))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/toggle-angular-component-file</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Toggle between an Angular component's Typescript and HTML files."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">let</span> ((current-file buffer-file-name))
    (<span style="color: #737063; font-weight: bold;">when</span> current-file
      (<span style="color: #737063; font-weight: bold;">let*</span> ((file-ext (file-name-extension current-file))
             (base-name (file-name-sans-extension current-file))
             (toggle-ext (<span style="color: #737063; font-weight: bold;">cond</span> ((string-equal file-ext <span style="color: #8B887D; font-style: italic;">"html"</span>) <span style="color: #8B887D; font-style: italic;">"ts"</span>)
                               ((string-equal file-ext <span style="color: #8B887D; font-style: italic;">"ts"</span>) <span style="color: #8B887D; font-style: italic;">"html"</span>)
                               (t nil)))
             (prefered-filename (concat base-name (<span style="color: #737063; font-weight: bold;">when</span> (string-equal toggle-ext <span style="color: #8B887D; font-style: italic;">"ts"</span>) <span style="color: #8B887D; font-style: italic;">".component"</span>) <span style="color: #8B887D; font-style: italic;">"."</span> toggle-ext)))
        (<span style="color: #737063; font-weight: bold;">if</span> (<span style="color: #737063; font-weight: bold;">and</span> prefered-filename (file-exists-p prefered-filename))
            (find-file prefered-filename)
          (<span style="color: #737063; font-weight: bold;">let</span> ((alternative-filename (concat base-name <span style="color: #8B887D; font-style: italic;">"."</span> toggle-ext)))
            (<span style="color: #737063; font-weight: bold;">if</span> (<span style="color: #737063; font-weight: bold;">and</span> toggle-ext (file-exists-p alternative-filename))
                (find-file alternative-filename)
              (message <span style="color: #8B887D; font-style: italic;">"No corresponding file found for %s"</span> current-file))))))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/org-convert-region-from-markdown</span> (beg end)
  (<span style="color: #737063; font-weight: bold;">interactive</span> <span style="color: #8B887D; font-style: italic;">"r"</span>)
  (shell-command-on-region beg end <span style="color: #8B887D; font-style: italic;">"pandoc -t org"</span> nil t))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">find-latest-time</span> (times)
  <span style="color: #96a7a9; font-weight: bold;">"Find the latest time in TIMES, which is a list of time values."</span>
  (<span style="color: #737063; font-weight: bold;">let</span> ((latest (car times)))
    (<span style="color: #737063; font-weight: bold;">dolist</span> (time times latest)
      (<span style="color: #737063; font-weight: bold;">when</span> (&gt; (float-time time) (float-time latest))
        (<span style="color: #737063; font-weight: bold;">setq</span> latest time)))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">find-latest-time-before-today</span> (times)
  <span style="color: #96a7a9; font-weight: bold;">"Find the latest time in TIMES that is before today."</span>
  (<span style="color: #737063; font-weight: bold;">let</span> ((latest (car times))
        (today (org-today)))
    (<span style="color: #737063; font-weight: bold;">dolist</span> (time times latest)
      (<span style="color: #737063; font-weight: bold;">let</span> ((time-date (org-time-string-to-time (format-time-string <span style="color: #8B887D; font-style: italic;">"%Y-%m-%d"</span> time))))
        (<span style="color: #737063; font-weight: bold;">when</span> (<span style="color: #737063; font-weight: bold;">and</span> (&gt; (float-time time) (float-time latest))
                   (&lt; (time-to-days time-date) today))
          (<span style="color: #737063; font-weight: bold;">setq</span> latest time))))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/open-agenda-file</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Open an org-agenda file from a list of all agenda files."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">let</span> ((file (completing-read <span style="color: #8B887D; font-style: italic;">"Select agenda file: "</span> (org-agenda-files))))
    (<span style="color: #737063; font-weight: bold;">when</span> file
      (find-file file))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/eslint-fix-file</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Run eslint --fix on the current buffer's file."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)

  (<span style="color: #737063; font-weight: bold;">when</span> (buffer-modified-p)
    (<span style="color: #737063; font-weight: bold;">if</span> (y-or-n-p (format <span style="color: #8B887D; font-style: italic;">"Save file %s? "</span> buffer-file-name))
        (save-buffer)
      (<span style="color: #d7af00; font-weight: bold;">user-error</span> <span style="color: #8B887D; font-style: italic;">"ESLint refusing to run on a modified buffer"</span>)))

  (message <span style="color: #8B887D; font-style: italic;">"Running ESLint fix..."</span>)

  (<span style="color: #737063; font-weight: bold;">let*</span> ((default-directory (project-root (project-current)))
         (filename (aero/filename-relative-to-project))
         (error-buffer (get-buffer-create <span style="color: #8B887D; font-style: italic;">"*ESLint Fix Errors*"</span>))
         (exit-code (call-process <span style="color: #8B887D; font-style: italic;">"npx"</span> nil error-buffer nil
                                  <span style="color: #8B887D; font-style: italic;">"eslint"</span> <span style="color: #8B887D; font-style: italic;">"--fix"</span> buffer-file-name)))
    (<span style="color: #737063; font-weight: bold;">if</span> (zerop exit-code)
        (<span style="color: #737063; font-weight: bold;">progn</span>
          (message <span style="color: #8B887D; font-style: italic;">"ESLint fix complete"</span>)
          (revert-buffer t t t))
      (message <span style="color: #8B887D; font-style: italic;">"ESLint fix failed with error code %d"</span> exit-code)
      (pop-to-buffer error-buffer))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/prettier-fix-file</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Run prettier --write on the current buffer's file."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">when</span> (buffer-modified-p)
    (<span style="color: #737063; font-weight: bold;">if</span> (y-or-n-p (format <span style="color: #8B887D; font-style: italic;">"Save file %s? "</span> buffer-file-name))
        (save-buffer)
      (<span style="color: #d7af00; font-weight: bold;">user-error</span> <span style="color: #8B887D; font-style: italic;">"Prettier refusing to run on a modified buffer"</span>)))
  (message <span style="color: #8B887D; font-style: italic;">"Running Prettier fix..."</span>)
  (<span style="color: #737063; font-weight: bold;">let*</span> ((default-directory (project-root (project-current)))
         (filename (aero/filename-relative-to-project))
         (error-buffer (get-buffer-create <span style="color: #8B887D; font-style: italic;">"*Prettier Fix Errors*"</span>))
         (exit-code (call-process <span style="color: #8B887D; font-style: italic;">"npx"</span> nil error-buffer nil
                                  <span style="color: #8B887D; font-style: italic;">"prettier"</span> <span style="color: #8B887D; font-style: italic;">"--write"</span> buffer-file-name)))
    (<span style="color: #737063; font-weight: bold;">if</span> (zerop exit-code)
        (<span style="color: #737063; font-weight: bold;">progn</span>
          (message <span style="color: #8B887D; font-style: italic;">"Prettier fix complete"</span>)
          (revert-buffer t t t))
      (message <span style="color: #8B887D; font-style: italic;">"Prettier fix failed with error code %d"</span> exit-code)
      (pop-to-buffer error-buffer))))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orge789a63" class="outline-2">
<h2 id="orge789a63">Packaging setup</h2>
<div class="outline-text-2" id="text-orge789a63">
</div>
<div id="outline-container-org90ec5e8" class="outline-3">
<h3 id="org90ec5e8">GnuTLS</h3>
<div class="outline-text-3" id="text-org90ec5e8">
<p>
Evaluate <code>gnutls</code> and disallow TLS connections
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">with-eval-after-load</span> 'gnutls
  (<span style="color: #737063; font-weight: bold;">eval-when-compile</span> (<span style="color: #737063; font-weight: bold;">require</span> '<span style="color: #655370; font-weight: bold;">gnutls</span>))
  (<span style="color: #737063; font-weight: bold;">setq</span> gnutls-verify-error t)) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Do not allow insecure TLS connections.</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbdf603b" class="outline-3">
<h3 id="orgbdf603b">Straight.el</h3>
<div class="outline-text-3" id="text-orgbdf603b">
<p>
We want to use the <code>develop</code> branch of <code>straight.el</code>, I don't remember why but this fixed a problem once and I never went back.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Use the more-cutting-edge develop branch of straight</span>
(<span style="color: #737063; font-weight: bold;">eval-when-compile</span>
  (<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">straight-repository-branch</span>)
  (<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">straight-check-for-modifications</span>))
(<span style="color: #737063; font-weight: bold;">setq</span> straight-repository-branch <span style="color: #8B887D; font-style: italic;">"develop"</span>)
</pre>
</div>

<p>
Don't allow straight to check for modifications in every repo on Emacs init, saving some startup time
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">setq</span> straight-check-for-modifications nil)
</pre>
</div>

<p>
Tell straight that let-alist is a built-in package now, so it doesn't need to be checked if we (or more likely any dependency) try to pull it in.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">with-eval-after-load</span> 'straight
  (add-to-list 'straight-built-in-pseudo-packages 'let-alist))
</pre>
</div>

<p>
Bootstrapping for <code>straight.el</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">bootstrap-version</span>)
(<span style="color: #737063; font-weight: bold;">let</span> ((bootstrap-file
       (expand-file-name <span style="color: #8B887D; font-style: italic;">"straight/repos/straight.el/bootstrap.el"</span> user-emacs-directory))
      (bootstrap-version 5))
  (<span style="color: #737063; font-weight: bold;">unless</span> (file-exists-p bootstrap-file)
    (<span style="color: #737063; font-weight: bold;">with-current-buffer</span>
        (url-retrieve-synchronously
         <span style="color: #8B887D; font-style: italic;">"https://raw.githubusercontent.com/radian-software/straight.el/develop/install.el"</span>
         'silent 'inhibit-cookies)
      (goto-char (point-max))
      (eval-print-last-sexp)))
  (load bootstrap-file nil 'nomessage))
</pre>
</div>

<p>
I'm not certain straight needs to be set up before use-package, but before use-package was built in to Emacs something got messed up when use-package was loaded first.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">require</span> '<span style="color: #655370; font-weight: bold;">use-package</span>)
</pre>
</div>

<p>
If we're byte-compiling something, only expand minimally
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">eval-when-compile</span>
  (<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">use-package-expand-minimally</span>)
  (<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">use-package-compute-statistics</span>)
  (<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">use-package-minimum-reported-time</span>)
  (<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">use-package-verbose</span>))
(<span style="color: #737063; font-weight: bold;">setq</span> use-package-expand-minimally byte-compile-current-file
      use-package-compute-statistics nil <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">t then `</span><span style="color: #655370; background-color: #ecf3ec; font-weight: bold; font-style: italic;">use-package-report</span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">' to find packages not used</span>
      package-native-compile t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">compile when installing (not sure if this works)</span>
      use-package-minimum-reported-time 0.1)
</pre>
</div>

<p>
If we're using <code>--debug-init</code>, make package loading verbose.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">setq</span> use-package-verbose init-file-debug)
</pre>
</div>
</div>
</div>
<div id="outline-container-org062496f" class="outline-3">
<h3 id="org062496f">Custom package macro</h3>
<div class="outline-text-3" id="text-org062496f">
<p>
The rest of the config uses this custom <code>package!</code> macro to abstract away some internals that have changed in the past and may change again (such as using <code>straight.el</code>).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defmacro</span> <span style="color: #83684C; font-weight: bold;">package!</span> (package recipe <span style="color: #387780; font-style: italic;">&amp;rest</span> body)
  <span style="color: #96a7a9; font-weight: bold;">"Get PACKAGE using RECIPE, then evaluate PACKAGE &amp; BODY with `</span><span style="color: #655370; font-weight: bold;">use-package</span><span style="color: #96a7a9; font-weight: bold;">'.</span>

<span style="color: #96a7a9; font-weight: bold;">Example:</span>

<span style="color: #96a7a9; font-weight: bold;">    (package! foo (:host gitlab :repo \"thornjad/foo\" :branch \"main\")</span>
<span style="color: #96a7a9; font-weight: bold;">     :commands (foo-bar foo-spam))</span>

<span style="color: #96a7a9; font-weight: bold;">If the RECIPE is :builtin or :local, do not search [M]ELPA, only pass BODY to `</span><span style="color: #655370; font-weight: bold;">use-package</span><span style="color: #96a7a9; font-weight: bold;">'. While</span>
<span style="color: #96a7a9; font-weight: bold;">there is no functional difference between these two keywords, :builtin should be used for packages</span>
<span style="color: #96a7a9; font-weight: bold;">within Emacs while :local should be used for user packages which exist locally. :local packages may</span>
<span style="color: #96a7a9; font-weight: bold;">require a :load-path for `</span><span style="color: #655370; font-weight: bold;">use-package</span><span style="color: #96a7a9; font-weight: bold;">' to load properly.</span>

<span style="color: #96a7a9; font-weight: bold;">If the BODY contains the keyword :disabled, the package is completely ignored, with an expansion</span>
<span style="color: #96a7a9; font-weight: bold;">indicating the package has been disabled.</span>

<span style="color: #96a7a9; font-weight: bold;">If the recipe does not contain a :host, it default to 'github.</span>

<span style="color: #96a7a9; font-weight: bold;">If the recipe is only a string, it is considered a github repo.</span>

<span style="color: #96a7a9; font-weight: bold;">DEPRECATED: If the RECIPE is :auto, use the recipe provided by [M]ELPA. This is deprecated in favor of providing an explicit recipe. A recipe allows greater control over packages while also providing an easier path to cutting-edge updates.</span>

<span style="color: #96a7a9; font-weight: bold;">Usage of this macro allows simplified refactoring when changing packaging systems, as Aero is wont</span>
<span style="color: #96a7a9; font-weight: bold;">to do every few years."</span>
  (<span style="color: #737063; font-weight: bold;">declare</span> (indent defun)) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">indent like use-package</span>

  (<span style="color: #737063; font-weight: bold;">when</span> (stringp recipe)
    (<span style="color: #737063; font-weight: bold;">setq</span> recipe (list <span style="color: #403D2E; font-style: italic;">:repo</span> recipe)))

  (<span style="color: #737063; font-weight: bold;">when</span> (memq <span style="color: #403D2E; font-style: italic;">:auto</span> body)
    (display-warning
     'aero
     (format <span style="color: #8B887D; font-style: italic;">"Package %s uses :auto, which is deprecated. Specify recipe instead"</span> package)
     <span style="color: #403D2E; font-style: italic;">:warning</span>))

  (<span style="color: #737063; font-weight: bold;">cond</span>
   ((memq <span style="color: #403D2E; font-style: italic;">:disabled</span> body)
    (format <span style="color: #8B887D; font-style: italic;">"%s :disabled by Aero package!"</span> package))

   ((equal recipe <span style="color: #403D2E; font-style: italic;">:builtin</span>)
    `(<span style="color: #737063; font-weight: bold;">use-package</span> ,package <span style="color: #403D2E; font-style: italic;">:straight</span> (<span style="color: #403D2E; font-style: italic;">:type</span> built-in) ,@body))

   ((equal recipe <span style="color: #403D2E; font-style: italic;">:local</span>)
    `(<span style="color: #737063; font-weight: bold;">use-package</span> ,package <span style="color: #403D2E; font-style: italic;">:straight</span> nil ,@body))

   ((equal recipe <span style="color: #403D2E; font-style: italic;">:localpackage</span>)
    `(<span style="color: #737063; font-weight: bold;">use-package</span> ,package <span style="color: #403D2E; font-style: italic;">:straight</span> nil <span style="color: #403D2E; font-style: italic;">:load-path</span> <span style="color: #8B887D; font-style: italic;">"lib/localpackages"</span> ,@body))

   <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Use straight</span>
   (t
    (<span style="color: #737063; font-weight: bold;">progn</span>
      (<span style="color: #737063; font-weight: bold;">when</span> (<span style="color: #737063; font-weight: bold;">and</span> (not (equal recipe <span style="color: #403D2E; font-style: italic;">:auto</span>))
                 (<span style="color: #737063; font-weight: bold;">and</span> (not (memq <span style="color: #403D2E; font-style: italic;">:host</span> recipe))
                      (not (memq <span style="color: #403D2E; font-style: italic;">:source</span> recipe))))
        (<span style="color: #737063; font-weight: bold;">setq</span> recipe (plist-put recipe <span style="color: #403D2E; font-style: italic;">:host</span> 'github)))

      `(<span style="color: #737063; font-weight: bold;">use-package</span> ,package <span style="color: #403D2E; font-style: italic;">:straight</span> ,(<span style="color: #737063; font-weight: bold;">or</span> (equal recipe <span style="color: #403D2E; font-style: italic;">:auto</span>) recipe) ,@body)))))

</pre>
</div>
</div>
</div>
<div id="outline-container-org69a5689" class="outline-3">
<h3 id="org69a5689">Fetch arbitrary MELPA recipe</h3>
<div class="outline-text-3" id="text-org69a5689">
<p>
And a helper that lets us check the MELPA recipe for a package, which is useful to setting up new packages sometimes, and slightly faster than searching on a browser.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/fetch-melpa-recipe</span> (package-name)
  <span style="color: #96a7a9; font-weight: bold;">"Fetch the MELPA recipe for the given PACKAGE-NAME and display it in a buffer."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span> <span style="color: #8B887D; font-style: italic;">"sPackage Name: "</span>)
  (<span style="color: #737063; font-weight: bold;">let</span> ((url (format <span style="color: #8B887D; font-style: italic;">"https://raw.githubusercontent.com/melpa/melpa/master/recipes/%s"</span> package-name)))
    (<span style="color: #737063; font-weight: bold;">with-current-buffer</span> (url-retrieve-synchronously url)
      (goto-char (point-min))
      (re-search-forward <span style="color: #8B887D; font-style: italic;">"\n\n"</span>)
      (delete-region (point-min) (point))
      (<span style="color: #737063; font-weight: bold;">let</span> ((content (buffer-string)))
        (kill-buffer)
        (<span style="color: #737063; font-weight: bold;">with-current-buffer</span> (get-buffer-create <span style="color: #8B887D; font-style: italic;">"*MELPA Recipe*"</span>)
          (erase-buffer)
          (insert content)
          (goto-char (point-min))
          (emacs-lisp-mode)
          (display-buffer (current-buffer)))))))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org1132931" class="outline-2">
<h2 id="org1132931">Core setup (prelude)</h2>
<div class="outline-text-2" id="text-org1132931">
<p>
I use "prelude" here as a nod to earlier iterations of this configuration, where the core setup lived in a prelude file, meaning it was required to setup important functionality. The name is only tangentially related to the Prelude configuration distribution.
</p>
</div>
<div id="outline-container-org5eb6fa9" class="outline-3">
<h3 id="org5eb6fa9">Treesitter initialization</h3>
<div class="outline-text-3" id="text-org5eb6fa9">
<p>
To ensure we can use this easily later, require treesitter as long as it's available and wanted. See <a href="#org183c914">Treesitter</a> section for the full config.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">and</span> (<span style="color: #737063; font-weight: bold;">and</span> (treesitterp)
          (functionp 'module-load)
          (<span style="color: #737063; font-weight: bold;">bound-and-true-p</span> module-file-suffix))
     (<span style="color: #737063; font-weight: bold;">require</span> '<span style="color: #655370; font-weight: bold;">treesit</span> nil t))
</pre>
</div>
</div>
</div>
<div id="outline-container-org968e3c9" class="outline-3">
<h3 id="org968e3c9">Compile angel</h3>
<div class="outline-text-3" id="text-org968e3c9">
<p>
Set up automatic compilation for everything past this point
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! compile-angel <span style="color: #8B887D; font-style: italic;">"jamescherti/compile-angel.el"</span>
  <span style="color: #403D2E; font-style: italic;">:demand</span> t
  <span style="color: #403D2E; font-style: italic;">:hook</span> (emacs-lisp-mode-hook . compile-angel-on-save-local-mode)

  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (compile-angel-verbose t)
  (compile-angel-enable-byte-compile nil) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">only native compile</span>

  <span style="color: #403D2E; font-style: italic;">:config</span>
  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Exclude these files</span>
  (<span style="color: #737063; font-weight: bold;">with-eval-after-load</span> <span style="color: #8B887D; font-style: italic;">"savehist"</span> (<span style="color: #737063; font-weight: bold;">push</span> (concat <span style="color: #8B887D; font-style: italic;">"/"</span> (file-name-nondirectory savehist-file))
                                         compile-angel-excluded-files))
  (<span style="color: #737063; font-weight: bold;">with-eval-after-load</span> <span style="color: #8B887D; font-style: italic;">"recentf"</span> (<span style="color: #737063; font-weight: bold;">push</span> (concat <span style="color: #8B887D; font-style: italic;">"/"</span> (file-name-nondirectory recentf-save-file))
                                        compile-angel-excluded-files))
  (<span style="color: #737063; font-weight: bold;">with-eval-after-load</span> <span style="color: #8B887D; font-style: italic;">"cus-edit"</span> (<span style="color: #737063; font-weight: bold;">push</span> (concat <span style="color: #8B887D; font-style: italic;">"/"</span> (file-name-nondirectory custom-file))
                                         compile-angel-excluded-files))

  (compile-angel-on-load-mode))
</pre>
</div>
</div>
</div>
<div id="outline-container-org85d7443" class="outline-3">
<h3 id="org85d7443">Fix GNU ELPA Keyring</h3>
<div class="outline-text-3" id="text-org85d7443">
<p>
The ELPA keyring sometimes gets screwed up, this fixes it
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! gnu-elpa-keyring-update <span style="color: #403D2E; font-style: italic;">:auto</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org254b715" class="outline-3">
<h3 id="org254b715">Library requirements</h3>
<div class="outline-text-3" id="text-org254b715">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! dash <span style="color: #8B887D; font-style: italic;">"magnars/dash.el"</span>)
(package! memo (<span style="color: #403D2E; font-style: italic;">:host</span> gitlab <span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"thornjad/emacs-memo"</span> <span style="color: #403D2E; font-style: italic;">:branch</span> <span style="color: #8B887D; font-style: italic;">"main"</span>))
(package! async <span style="color: #8B887D; font-style: italic;">"jwiegley/emacs-async"</span> <span style="color: #403D2E; font-style: italic;">:commands</span> (async-save))
(package! popup <span style="color: #8B887D; font-style: italic;">"auto-complete/popup-el"</span>)
(package! spinner <span style="color: #8B887D; font-style: italic;">"Malabarba/spinner.el"</span>)
(package! ripgrep <span style="color: #8B887D; font-style: italic;">"nlamirault/ripgrep.el"</span> <span style="color: #403D2E; font-style: italic;">:defer</span> 3)
</pre>
</div>

<p>
Posframe is used by gptel-quick and maybe some other stuff. I've tried using consult-posframe and others like it and can't really get used to it, so we only need the basic library in here.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! posframe <span style="color: #8B887D; font-style: italic;">"tumashu/posframe"</span> <span style="color: #403D2E; font-style: italic;">:defer</span> 1)
</pre>
</div>

<p>
JSONRPC is used by Eglot, Dape, Copilot and others. It is builtin, but we want to stop logging everything as a performance optimization.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! jsonrpc <span style="color: #403D2E; font-style: italic;">:builtin</span>
  <span style="color: #403D2E; font-style: italic;">:config</span>
  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Don't waste time logging events</span>
  (fset #'jsonrpc--log-event #'ignore))
</pre>
</div>
</div>
</div>
<div id="outline-container-org1f20e1a" class="outline-3">
<h3 id="org1f20e1a">PATH from shell</h3>
<div class="outline-text-3" id="text-org1f20e1a">
<p>
We only really need this in MacOS, grabbing environment variables from the default shell
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! exec-path-from-shell <span style="color: #8B887D; font-style: italic;">"purcell/exec-path-from-shell"</span>
  <span style="color: #403D2E; font-style: italic;">:when</span> (<span style="color: #737063; font-weight: bold;">or</span> (memq window-system '(mac ns x)) (daemonp))
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (<span style="color: #737063; font-weight: bold;">dolist</span> (var '(<span style="color: #8B887D; font-style: italic;">"PATH"</span> <span style="color: #8B887D; font-style: italic;">"SSH_AUTH_SOCK"</span> <span style="color: #8B887D; font-style: italic;">"SSH_AGENT_PID"</span> <span style="color: #8B887D; font-style: italic;">"GPG_AGENT_INFO"</span> <span style="color: #8B887D; font-style: italic;">"LANG"</span> <span style="color: #8B887D; font-style: italic;">"LC_CTYPE"</span> <span style="color: #8B887D; font-style: italic;">"NIX_SSL_CERT_FILE"</span> <span style="color: #8B887D; font-style: italic;">"NIX_PATH"</span> <span style="color: #8B887D; font-style: italic;">"PATH"</span> <span style="color: #8B887D; font-style: italic;">"MANPATH"</span> <span style="color: #8B887D; font-style: italic;">"INFOPATH"</span> <span style="color: #8B887D; font-style: italic;">"LSP_USE_PLISTS"</span> <span style="color: #8B887D; font-style: italic;">"HOMEBREW_PREFIX"</span> <span style="color: #8B887D; font-style: italic;">"HOMEBREW_CELLAR"</span> <span style="color: #8B887D; font-style: italic;">"HOMEBREW_REPOSITORY"</span>))
    (add-to-list 'exec-path-from-shell-variables var))
  (exec-path-from-shell-initialize))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb93b512" class="outline-2">
<h2 id="orgb93b512">Foundational functionality</h2>
<div class="outline-text-2" id="text-orgb93b512">
</div>
<div id="outline-container-orgad7952b" class="outline-3">
<h3 id="orgad7952b">Keybindings</h3>
<div class="outline-text-3" id="text-orgad7952b">
</div>
<div id="outline-container-orge119ef7" class="outline-4">
<h4 id="orge119ef7">Which-key</h4>
<div class="outline-text-4" id="text-orge119ef7">
<p>
Gives us a variety of menus for keybindings, and integrates nicely with General
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! which-key <span style="color: #403D2E; font-style: italic;">:builtin</span>
  <span style="color: #403D2E; font-style: italic;">:defines</span> which-key-mode
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (which-key-mode)
  (<span style="color: #737063; font-weight: bold;">setq</span> which-key-special-keys '(<span style="color: #8B887D; font-style: italic;">"SPC"</span> <span style="color: #8B887D; font-style: italic;">"TAB"</span> <span style="color: #8B887D; font-style: italic;">"RET"</span> <span style="color: #8B887D; font-style: italic;">"ESC"</span> <span style="color: #8B887D; font-style: italic;">"DEL"</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org2401222" class="outline-4">
<h4 id="org2401222">General</h4>
<div class="outline-text-4" id="text-org2401222">
<p>
The vast majority of keybindings are set up with General. A lot of this could be done almost as easily with regular keybinding, but General gives us an easier time setting up a leader key and better which-key integration.
</p>

<p>
Most bindings will fall under the <code>SPC</code> leader key, so we generate a macro called <code>aero-leader-def</code> to make it easier for other packages to add their own bindings under this leader. For mode-specific keybindings, we use <code>SPC ,</code> as the leader, and a corresponding <code>aero-mode-leader-def</code> to suit.
</p>

<p>
From there, we set up all the main keybindings.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! general <span style="color: #8B887D; font-style: italic;">"noctuid/general.el"</span>
  <span style="color: #403D2E; font-style: italic;">:functions</span> (general-define-key aero-leader-def aero-mode-leader-def)
  <span style="color: #403D2E; font-style: italic;">:init</span>
  (<span style="color: #737063; font-weight: bold;">setq-default</span> general-override-states
                '(insert hybrid normal visual motion operator replace))

  (general-create-definer aero-leader-def
    <span style="color: #403D2E; font-style: italic;">:states</span> '(normal visual emacs motion)
    <span style="color: #403D2E; font-style: italic;">:prefix</span> <span style="color: #8B887D; font-style: italic;">"SPC"</span>
    <span style="color: #403D2E; font-style: italic;">:non-normal-prefix</span> <span style="color: #8B887D; font-style: italic;">"C-SPC"</span>)

  (general-create-definer aero-mode-leader-def
    <span style="color: #403D2E; font-style: italic;">:states</span> '(normal visual emacs motion)
    <span style="color: #403D2E; font-style: italic;">:prefix</span> <span style="color: #8B887D; font-style: italic;">"SPC ,"</span>)

  <span style="color: #403D2E; font-style: italic;">:config</span>
  (general-define-key
   <span style="color: #403D2E; font-style: italic;">:states</span> '(normal visual motion)
   <span style="color: #403D2E; font-style: italic;">:keymaps</span> 'override
   <span style="color: #403D2E; font-style: italic;">:prefix</span> <span style="color: #8B887D; font-style: italic;">"SPC"</span>
   <span style="color: #403D2E; font-style: italic;">:non-normal-prefix</span> <span style="color: #8B887D; font-style: italic;">"C-SPC"</span>
   <span style="color: #8B887D; font-style: italic;">""</span> nil)

  (general-def
    (kbd <span style="color: #8B887D; font-style: italic;">"C-h"</span>) 'delete-backward-char
    (kbd <span style="color: #8B887D; font-style: italic;">"C-w"</span>) 'aero/smarter-backward-kill-word
    (kbd <span style="color: #8B887D; font-style: italic;">"C-TAB"</span>) 'insert-tab
    (kbd <span style="color: #8B887D; font-style: italic;">"M-TAB"</span>) 'aero/alternate-buffer
    (kbd <span style="color: #8B887D; font-style: italic;">"C-RET"</span>) 'aero/browse-url-open)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Ensure keyboard quit does what we want</span>
  (global-set-key [remap keyboard-quit] #'aero/keyboard-quit-context)

  (general-define-key
   <span style="color: #403D2E; font-style: italic;">:states</span> 'normal
   <span style="color: #403D2E; font-style: italic;">:prefix</span> <span style="color: #8B887D; font-style: italic;">"SPC"</span>
   <span style="color: #8B887D; font-style: italic;">"fW"</span> 'evil-write-all
   <span style="color: #8B887D; font-style: italic;">"w/"</span> '(evil-window-vsplit <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"split vertical"</span>)
   <span style="color: #8B887D; font-style: italic;">"w-"</span> '(evil-window-split <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"split horizontal"</span>)
   <span style="color: #8B887D; font-style: italic;">"w2"</span> 'aero/layout-two-columns
   <span style="color: #8B887D; font-style: italic;">"w3"</span> 'aero/layout-three-columns
   <span style="color: #8B887D; font-style: italic;">"cm"</span> 'evil-make)

  (general-define-key
   <span style="color: #403D2E; font-style: italic;">:states</span> '(normal insert motion)
   <span style="color: #403D2E; font-style: italic;">:keymaps</span> 'override
   <span style="color: #403D2E; font-style: italic;">:prefix</span> <span style="color: #8B887D; font-style: italic;">","</span>
   <span style="color: #8B887D; font-style: italic;">""</span> nil)

  (general-define-key
   <span style="color: #403D2E; font-style: italic;">:states</span> '(normal insert motion)
   <span style="color: #403D2E; font-style: italic;">:keymaps</span> 'override
   <span style="color: #403D2E; font-style: italic;">:prefix</span> <span style="color: #8B887D; font-style: italic;">"SPC"</span>
   <span style="color: #403D2E; font-style: italic;">:non-normal-prefix</span> <span style="color: #8B887D; font-style: italic;">"C-SPC"</span>
   <span style="color: #8B887D; font-style: italic;">""</span> nil

   <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">independent keys</span>
   <span style="color: #8B887D; font-style: italic;">"SPC"</span> 'execute-extended-command
   <span style="color: #8B887D; font-style: italic;">"TAB"</span> '(aero/alternate-buffer <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"alternate buffer"</span>)
   (kbd <span style="color: #8B887D; font-style: italic;">"ESC"</span>) 'keyboard-quit
   (kbd <span style="color: #8B887D; font-style: italic;">"C-g"</span>) 'keyboard-quit
   (kbd <span style="color: #8B887D; font-style: italic;">"&lt;pause&gt;"</span>) 'keyboard-quit
   <span style="color: #8B887D; font-style: italic;">"'"</span> 'eshell
   <span style="color: #8B887D; font-style: italic;">"\""</span> '(aero/eshell-new <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"eshell-new"</span>)
   <span style="color: #8B887D; font-style: italic;">":"</span> 'eval-expression
   <span style="color: #8B887D; font-style: italic;">";"</span> 'aero/comment-dwim
   <span style="color: #8B887D; font-style: italic;">"!"</span> 'shell-command
   <span style="color: #8B887D; font-style: italic;">"="</span> 'quick-calc

   <span style="color: #8B887D; font-style: italic;">","</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"mode"</span>) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">reserved for mode-specific</span>

   <span style="color: #8B887D; font-style: italic;">"e"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"errors"</span>)
   <span style="color: #8B887D; font-style: italic;">"ed"</span> 'toggle-debug-on-error
   <span style="color: #8B887D; font-style: italic;">"eq"</span> 'toggle-debug-on-quit

   <span style="color: #8B887D; font-style: italic;">"T TAB"</span> 'tab-recent
   <span style="color: #8B887D; font-style: italic;">"T"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"tab"</span>)
   <span style="color: #8B887D; font-style: italic;">"Tn"</span> 'tab-next
   <span style="color: #8B887D; font-style: italic;">"Tp"</span> 'tab-previous
   <span style="color: #8B887D; font-style: italic;">"Tk"</span> 'tab-close
   <span style="color: #8B887D; font-style: italic;">"T,"</span> 'tab-rename
   <span style="color: #8B887D; font-style: italic;">"Tc"</span> '(tab-new <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"create tab"</span>)
   <span style="color: #8B887D; font-style: italic;">"Tb"</span> 'switch-to-buffer-other-tab
   <span style="color: #8B887D; font-style: italic;">"Tf"</span> 'find-file-other-tab
   <span style="color: #8B887D; font-style: italic;">"Ts"</span> '(tab-duplicate <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"tab duplicate split"</span>)
   <span style="color: #8B887D; font-style: italic;">"Tu"</span> 'tab-undo

   <span style="color: #8B887D; font-style: italic;">"U"</span> 'universal-argument

   <span style="color: #8B887D; font-style: italic;">"a"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"applications"</span>)
   <span style="color: #8B887D; font-style: italic;">"ai"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"AI functions"</span>)

   <span style="color: #8B887D; font-style: italic;">"b"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"buffers"</span>)
   <span style="color: #8B887D; font-style: italic;">"bs"</span> 'switch-to-scratch-buffer
   <span style="color: #8B887D; font-style: italic;">"bS"</span> 'switch-to-new-scratch-buffer
   <span style="color: #8B887D; font-style: italic;">"bd"</span> 'kill-current-buffer
   <span style="color: #8B887D; font-style: italic;">"bi"</span> 'indent-buffer
   <span style="color: #8B887D; font-style: italic;">"bl"</span> 'ibuffer
   <span style="color: #8B887D; font-style: italic;">"bm"</span> 'switch-to-messages-buffer
   <span style="color: #8B887D; font-style: italic;">"bn"</span> 'next-buffer
   <span style="color: #8B887D; font-style: italic;">"bp"</span> 'previous-buffer
   <span style="color: #8B887D; font-style: italic;">"br"</span> '(aero/reopen-file-at-buffer <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"buffer replace"</span>)
   <span style="color: #8B887D; font-style: italic;">"bR"</span> '(revert-buffer-quick <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"buffer revert"</span>)
   <span style="color: #8B887D; font-style: italic;">"bw"</span> '(whitespace-mode <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"whitespace"</span>)
   <span style="color: #8B887D; font-style: italic;">"bx"</span> 'kill-buffer-and-window

   <span style="color: #8B887D; font-style: italic;">"n"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"narrow"</span>)
   <span style="color: #8B887D; font-style: italic;">"nn"</span> 'narrow-to-region
   <span style="color: #8B887D; font-style: italic;">"np"</span> 'narrow-to-page
   <span style="color: #8B887D; font-style: italic;">"nw"</span> 'widen
   <span style="color: #8B887D; font-style: italic;">"nd"</span> 'narrow-to-defun

   <span style="color: #8B887D; font-style: italic;">"c"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"compile"</span>)
   <span style="color: #8B887D; font-style: italic;">"ct"</span> 'aero/tail-compilation-buffer
   <span style="color: #8B887D; font-style: italic;">"ci"</span> '(ielm <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"ielm repl"</span>)
   <span style="color: #8B887D; font-style: italic;">"cc"</span> 'compile
   <span style="color: #8B887D; font-style: italic;">"ce"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"elisp"</span>)
   <span style="color: #8B887D; font-style: italic;">"ceb"</span> 'eval-buffer
   <span style="color: #8B887D; font-style: italic;">"ced"</span> 'eval-defun
   <span style="color: #8B887D; font-style: italic;">"cer"</span> 'eval-region
   <span style="color: #8B887D; font-style: italic;">"ck"</span> 'kill-compilation
   <span style="color: #8B887D; font-style: italic;">"cr"</span> 'recompile

   <span style="color: #8B887D; font-style: italic;">"f"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"files"</span>)
   <span style="color: #8B887D; font-style: italic;">"ff"</span> 'find-file
   <span style="color: #8B887D; font-style: italic;">"fc"</span> 'aero/copy-file-relative-to-project
   <span style="color: #8B887D; font-style: italic;">"fD"</span> '(aero/delete-this-file <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"delete this file"</span>)
   <span style="color: #8B887D; font-style: italic;">"fR"</span> '(aero/rename-this-file-and-buffer <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"rename this file"</span>)
   <span style="color: #8B887D; font-style: italic;">"fo"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"open special files"</span>)
   <span style="color: #8B887D; font-style: italic;">"fot"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"thornlog"</span>)
   <span style="color: #8B887D; font-style: italic;">"fota"</span> 'aero/open-agenda-file
   <span style="color: #8B887D; font-style: italic;">"fott"</span> '(aero/thornlog-todo <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"thornlog todo"</span>)
   <span style="color: #8B887D; font-style: italic;">"fotl"</span> '(aero/thornlog-log <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"thornlog log"</span>)
   <span style="color: #8B887D; font-style: italic;">"fotd"</span> '(aero/thornlog-dir <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"thornlog all"</span>)
   <span style="color: #8B887D; font-style: italic;">"fw"</span> '(save-buffer <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"write buffer"</span>)
   <span style="color: #8B887D; font-style: italic;">"fh"</span> '(aero/toggle-angular-component-file <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"toggle angular component file"</span>)

   <span style="color: #8B887D; font-style: italic;">"g"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"git"</span>)
   <span style="color: #8B887D; font-style: italic;">"gf"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"files"</span>)

   <span style="color: #8B887D; font-style: italic;">"h"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"help/manual"</span>)
   <span style="color: #8B887D; font-style: italic;">"hI"</span> 'info-apropos
   <span style="color: #8B887D; font-style: italic;">"hM"</span> 'woman
   <span style="color: #8B887D; font-style: italic;">"hd"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"describe"</span>)
   <span style="color: #8B887D; font-style: italic;">"hdF"</span> 'describe-face
   <span style="color: #8B887D; font-style: italic;">"hdb"</span> 'describe-bindings
   <span style="color: #8B887D; font-style: italic;">"hdM"</span> 'describe-mode
   <span style="color: #8B887D; font-style: italic;">"hdK"</span> 'describe-keymap
   <span style="color: #8B887D; font-style: italic;">"hdC"</span> 'describe-char
   <span style="color: #8B887D; font-style: italic;">"hdp"</span> 'describe-package
   <span style="color: #8B887D; font-style: italic;">"hdi"</span> '(emacs-index-search <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"search emacs manual"</span>)
   <span style="color: #8B887D; font-style: italic;">"hdl"</span> '(find-library <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"describe library"</span>)
   <span style="color: #8B887D; font-style: italic;">"hi"</span> 'info
   <span style="color: #8B887D; font-style: italic;">"hm"</span> 'man
   <span style="color: #8B887D; font-style: italic;">"hw"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"which-key"</span>)
   <span style="color: #8B887D; font-style: italic;">"hwm"</span> '(which-key-show-major-mode <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"major mode map"</span>)

   <span style="color: #8B887D; font-style: italic;">"j"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"jump"</span>)
   <span style="color: #8B887D; font-style: italic;">"l"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"lsp"</span>)

   <span style="color: #8B887D; font-style: italic;">"m"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"mode"</span>)
   <span style="color: #8B887D; font-style: italic;">"m"</span> '(tmm-menubar <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"Context menu"</span>)

   <span style="color: #8B887D; font-style: italic;">"o"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"org / outline"</span>)
   <span style="color: #8B887D; font-style: italic;">"oh"</span> '(outline-hide-body <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"hide all"</span>)
   <span style="color: #8B887D; font-style: italic;">"oS"</span> '(outline-show-all <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"show all"</span>)

   <span style="color: #8B887D; font-style: italic;">"p"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"project"</span>)
   <span style="color: #8B887D; font-style: italic;">"pr"</span> '(xref-find-definitions <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"find ref"</span>)
   <span style="color: #8B887D; font-style: italic;">"ps"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"spelling"</span>)

   <span style="color: #8B887D; font-style: italic;">"r"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"xref"</span>)
   <span style="color: #8B887D; font-style: italic;">"rf"</span> 'xref-find-definitions
   <span style="color: #8B887D; font-style: italic;">"rF"</span> 'xref-find-definitions-other-window
   <span style="color: #8B887D; font-style: italic;">"rp"</span> 'xref-go-back
   <span style="color: #8B887D; font-style: italic;">"rn"</span> 'xref-go-forward
   <span style="color: #8B887D; font-style: italic;">"ra"</span> 'xref-find-apropos
   <span style="color: #8B887D; font-style: italic;">"rr"</span> 'xref-find-references

   <span style="color: #8B887D; font-style: italic;">"q"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"quoted insert"</span>)
   <span style="color: #8B887D; font-style: italic;">"ql"</span> 'insert-lambda
   <span style="color: #8B887D; font-style: italic;">"qq"</span> 'quoted-insert
   <span style="color: #8B887D; font-style: italic;">"qp"</span> 'aero/insert-pdb
   <span style="color: #8B887D; font-style: italic;">"qu"</span> 'insert-char

   <span style="color: #8B887D; font-style: italic;">"s"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"sexp"</span>)

   <span style="color: #8B887D; font-style: italic;">"t"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"tabs/text"</span>)
   <span style="color: #8B887D; font-style: italic;">"td"</span> 'dictionary-lookup-definition
   <span style="color: #8B887D; font-style: italic;">"tD"</span> 'downcase-dwim
   <span style="color: #8B887D; font-style: italic;">"tU"</span> 'upcase-dwim
   <span style="color: #8B887D; font-style: italic;">"tf"</span> 'fill-paragraph
   <span style="color: #8B887D; font-style: italic;">"tF"</span> 'aero/fill-to-80
   <span style="color: #8B887D; font-style: italic;">"tn"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"number"</span>)
   <span style="color: #8B887D; font-style: italic;">"tnd"</span> 'decrement-number-at-point
   <span style="color: #8B887D; font-style: italic;">"tni"</span> 'increment-number-at-point
   <span style="color: #8B887D; font-style: italic;">"ts"</span> 'sort-lines

   <span style="color: #8B887D; font-style: italic;">"u"</span> 'undo-tree-visualize

   <span style="color: #8B887D; font-style: italic;">"w"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"window/web"</span>)
   <span style="color: #8B887D; font-style: italic;">"w="</span> 'balance-windows
   <span style="color: #8B887D; font-style: italic;">"wB"</span> '(aero/switch-to-minibuffer-window <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"switch to minibuffer"</span>)
   <span style="color: #8B887D; font-style: italic;">"ws"</span> '(eww-search-words <span style="color: #403D2E; font-style: italic;">:which-key</span> <span style="color: #8B887D; font-style: italic;">"web search"</span>)
   <span style="color: #8B887D; font-style: italic;">"ww"</span> 'eww
   <span style="color: #8B887D; font-style: italic;">"wb"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"browse"</span>)
   <span style="color: #8B887D; font-style: italic;">"wbb"</span> 'eww-list-buffers
   <span style="color: #8B887D; font-style: italic;">"wbh"</span> 'eww-list-histories
   <span style="color: #8B887D; font-style: italic;">"wbm"</span> 'eww-list-bookmarks
   <span style="color: #8B887D; font-style: italic;">"wbp"</span> 'browse-url-at-point
   <span style="color: #8B887D; font-style: italic;">"wp"</span> 'browse-url-at-point
   <span style="color: #8B887D; font-style: italic;">"wc"</span> 'aero/toggle-compilation-buffer
   <span style="color: #8B887D; font-style: italic;">"wd"</span> 'delete-window
   <span style="color: #8B887D; font-style: italic;">"wh"</span> 'windmove-left
   <span style="color: #8B887D; font-style: italic;">"wi"</span> 'minimize-window
   <span style="color: #8B887D; font-style: italic;">"wj"</span> 'windmove-down
   <span style="color: #8B887D; font-style: italic;">"wk"</span> 'windmove-up
   <span style="color: #8B887D; font-style: italic;">"wl"</span> 'windmove-right
   <span style="color: #8B887D; font-style: italic;">"wm"</span> 'maximize-window
   <span style="color: #8B887D; font-style: italic;">"wo"</span> 'aero/browse-url-open
   <span style="color: #8B887D; font-style: italic;">"w{"</span> 'shrink-window
   <span style="color: #8B887D; font-style: italic;">"w}"</span> 'enlarge-window

   <span style="color: #8B887D; font-style: italic;">"z"</span> 'repeat))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgee8fac9" class="outline-4">
<h4 id="orgee8fac9">Casual</h4>
<div class="outline-text-4" id="text-orgee8fac9">
<p>
Casual provides a magit-like interface to some functionality.
</p>

<p>
TODO 2025-02-25: I haven't actually used this at all yet, does it really matter?
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! casual <span style="color: #8B887D; font-style: italic;">"kickingvegas/casual"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (dired)
  <span style="color: #403D2E; font-style: italic;">:defines</span> (casual-editkit-main-tmenu
            casual-dired-tmenu
            casual-dired-sort-by-tmenu
            casual-dired-search-replace-tmenu)
  <span style="color: #403D2E; font-style: italic;">:bind</span> ((<span style="color: #8B887D; font-style: italic;">"C-o"</span> . #'casual-editkit-main-tmenu)

         <span style="color: #403D2E; font-style: italic;">:map</span> dired-mode-map
         (<span style="color: #8B887D; font-style: italic;">"C-o"</span> . #'casual-dired-tmenu)
         (<span style="color: #8B887D; font-style: italic;">"s"</span> . #'casual-dired-sort-by-tmenu)
         (<span style="color: #8B887D; font-style: italic;">"/"</span> . #'casual-dired-search-replace-tmenu)))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org38e0b10" class="outline-3">
<h3 id="org38e0b10">Evil</h3>
<div class="outline-text-3" id="text-org38e0b10">
<blockquote>
<p>
"Emacs is a great operating system, lacking only a decent editor." — ancient Vi proverb
</p>
</blockquote>

<p>
I'm going to say it, Vi has a better navigation scheme than default Emacs. Even with a thumb-cluster keyboard, I don't want to hold Ctrl basically at all. Evil provides the best of Vi with the power of Emacs, but it needs some heavy configuration to work well.
</p>

<p>
The "wants" setup <i>must</i> be in <code>:init</code> because Evil needs these set prior to setting up everything else.
</p>

<p>
Note that <code>evil-want-keybinding</code> is set to <code>nil</code> because <code>evil-collection</code> will handle that for us.
</p>

<p>
To change the <code>undo-system</code> without restarting Emacs, run <code>(evil-set-undo-system)</code>.
</p>

<p>
In visual mode, use <code>&lt;</code> and <code>&gt;</code> to indent/unindent the line(s)
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! evil
  (<span style="color: #403D2E; font-style: italic;">:host</span> github
   <span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"emacs-evil/evil"</span>
   <span style="color: #403D2E; font-style: italic;">:files</span> (<span style="color: #403D2E; font-style: italic;">:defaults</span>
                 <span style="color: #8B887D; font-style: italic;">"doc/build/texinfo/evil.texi"</span>
                 (<span style="color: #403D2E; font-style: italic;">:exclude</span> <span style="color: #8B887D; font-style: italic;">"evil-test-helpers.el"</span>)))

  <span style="color: #403D2E; font-style: italic;">:init</span>
  (<span style="color: #737063; font-weight: bold;">setq</span> evil-want-keybinding nil
        evil-undo-system 'undo-tree
        evil-want-fine-undo t
        evil-want-C-i-jump nil
        evil-want-C-u-scroll t
        evil-search-module 'isearch)

  <span style="color: #403D2E; font-style: italic;">:config</span>
  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Free up some non-useful bindings for other uses.</span>
  (define-key evil-motion-state-map <span style="color: #8B887D; font-style: italic;">" "</span> nil)
  (define-key evil-motion-state-map (kbd <span style="color: #8B887D; font-style: italic;">"RET"</span>) nil)
  (define-key evil-motion-state-map (kbd <span style="color: #8B887D; font-style: italic;">"C-o"</span>) nil)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Set up default states. It's Normal for almost everything, but Evil doesn't handle Dired very well, so we fall back on Emacs mode for that.</span>
  (<span style="color: #737063; font-weight: bold;">setq</span> evil-default-state 'normal)
  (evil-set-initial-state 'dired-mode 'emacs)
  (evil-set-initial-state 'message-mode 'motion)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Make movement keys work visually, just like other kinds of movement, by remapping.</span>
  (define-key evil-normal-state-map (kbd <span style="color: #8B887D; font-style: italic;">"&lt;remap&gt; &lt;evil-next-line&gt;"</span>)
    'evil-next-visual-line)
  (define-key evil-normal-state-map (kbd <span style="color: #8B887D; font-style: italic;">"&lt;remap&gt; &lt;evil-previous-line&gt;"</span>)
    'evil-previous-visual-line)
  (define-key evil-motion-state-map (kbd <span style="color: #8B887D; font-style: italic;">"&lt;remap&gt; &lt;evil-next-line&gt;"</span>)
    'evil-next-visual-line)
  (define-key evil-motion-state-map (kbd <span style="color: #8B887D; font-style: italic;">"&lt;remap&gt; &lt;evil-previous-line&gt;"</span>)
    'evil-previous-visual-line)

  (<span style="color: #737063; font-weight: bold;">setq-default</span> evil-cross-lines nil)
  (define-key evil-visual-state-map (kbd <span style="color: #8B887D; font-style: italic;">"u"</span>) 'undo)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">By default, these two operate on half pages, but I prefer the smaller jump</span>
  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/scroll-quarter-page-down</span> ()
    (<span style="color: #737063; font-weight: bold;">interactive</span>)
    (evil-scroll-down (/ (window-body-height) 4)))
  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/scroll-quarter-page</span> ()
    (<span style="color: #737063; font-weight: bold;">interactive</span>)
    (evil-scroll-up (/ (window-body-height) 4)))
  (evil-define-key nil global-map (kbd <span style="color: #8B887D; font-style: italic;">"C-u"</span>) #'aero/scroll-quarter-page-up)
  (evil-define-key nil global-map (kbd <span style="color: #8B887D; font-style: italic;">"C-d"</span>) #'aero/scroll-quarter-page-down)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Define =vig= and =vag= to look for all paren types</span>
  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/evil-paren-range</span> (count beg end type inclusive)
    <span style="color: #96a7a9; font-weight: bold;">"Get minimum range of paren text object.</span>
<span style="color: #96a7a9; font-weight: bold;">    COUNT, BEG, END, TYPE is used.  If INCLUSIVE is t, the text object is inclusive."</span>
    (<span style="color: #737063; font-weight: bold;">let*</span> ((parens '(<span style="color: #8B887D; font-style: italic;">"()"</span> <span style="color: #8B887D; font-style: italic;">"[]"</span> <span style="color: #8B887D; font-style: italic;">"{}"</span> <span style="color: #8B887D; font-style: italic;">"&lt;&gt;"</span>))
           range
           found-range)
      (<span style="color: #737063; font-weight: bold;">dolist</span> (p parens)
        (<span style="color: #737063; font-weight: bold;">condition-case</span> nil
            (<span style="color: #737063; font-weight: bold;">setq</span> range (evil-select-paren (aref p 0) (aref p 1) beg end type count inclusive))
          (<span style="color: #d7af00; font-weight: bold;">error</span> nil))
        (<span style="color: #737063; font-weight: bold;">when</span> range
          (<span style="color: #737063; font-weight: bold;">cond</span>
           (found-range
            (<span style="color: #737063; font-weight: bold;">when</span> (&lt; (- (nth 1 range) (nth 0 range))
                     (- (nth 1 found-range) (nth 0 found-range)))
              (<span style="color: #737063; font-weight: bold;">setf</span> (nth 0 found-range) (nth 0 range))
              (<span style="color: #737063; font-weight: bold;">setf</span> (nth 1 found-range) (nth 1 range))))
           (t
            (<span style="color: #737063; font-weight: bold;">setq</span> found-range range)))))
      found-range))
  (evil-define-text-object aero/evil-a-paren (count <span style="color: #387780; font-style: italic;">&amp;optional</span> beg end type)
    <span style="color: #8B887D; font-style: italic;">"Select a paren."</span>
    <span style="color: #403D2E; font-style: italic;">:extend-selection</span> t
    (aero/evil-paren-range count beg end type t))
  (evil-define-text-object aero/evil-inner-paren (count <span style="color: #387780; font-style: italic;">&amp;optional</span> beg end type)
    <span style="color: #8B887D; font-style: italic;">"Select '</span><span style="color: #655370; font-weight: bold; font-style: italic;">inner</span><span style="color: #8B887D; font-style: italic;">' paren."</span>
    <span style="color: #403D2E; font-style: italic;">:extend-selection</span> nil
    (aero/evil-paren-range count beg end type nil))
  (define-key evil-inner-text-objects-map <span style="color: #8B887D; font-style: italic;">"g"</span> #'aero/evil-inner-paren)
  (define-key evil-outer-text-objects-map <span style="color: #8B887D; font-style: italic;">"g"</span> #'aero/evil-a-paren)

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/evil-shift-right</span> ()
    (<span style="color: #737063; font-weight: bold;">interactive</span>)
    (evil-shift-right evil-visual-beginning evil-visual-end)
    (evil-normal-state)
    (evil-visual-restore))
  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/evil-shift-left</span> ()
    (<span style="color: #737063; font-weight: bold;">interactive</span>)
    (evil-shift-left evil-visual-beginning evil-visual-end)
    (evil-normal-state)
    (evil-visual-restore))
  (evil-define-key 'visual global-map (kbd <span style="color: #8B887D; font-style: italic;">"&gt;"</span>) 'aero/evil-shift-right)
  (evil-define-key 'visual global-map (kbd <span style="color: #8B887D; font-style: italic;">"&lt;"</span>) 'aero/evil-shift-left)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Make =:q= kill the buffer instead of Emacs itself</span>
  (evil-ex-define-cmd <span style="color: #8B887D; font-style: italic;">"q"</span> 'kill-current-buffer)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">AFAIK there's no "backward" equivalent to "e", so we set it to backward word</span>
  (evil-define-key '(normal visual motion) global-map
    (kbd <span style="color: #8B887D; font-style: italic;">"C-e"</span>) #'evil-backward-word-end)
  (evil-define-key '(normal visual motion) global-map
    (kbd <span style="color: #8B887D; font-style: italic;">"C-M-e"</span>) #'evil-backward-WORD-end)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Useful for pasting into the minibuffer, since Evil doesn't properly function there</span>
  (evil-define-key '(insert) global-map (kbd <span style="color: #8B887D; font-style: italic;">"C-y"</span>) #'evil-paste-after)
  (evil-define-key '(insert) global-map (kbd <span style="color: #8B887D; font-style: italic;">"C-S-y"</span>) #'evil-paste-before)

  (evil-mode +1))
</pre>
</div>
</div>
<div id="outline-container-orgac02690" class="outline-4">
<h4 id="orgac02690">Evil collection</h4>
<div class="outline-text-4" id="text-orgac02690">
<p>
Provides Evil defaults for many modes which Evil proper overlooks
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! evil-collection (<span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"emacs-evil/evil-collection"</span> <span style="color: #403D2E; font-style: italic;">:files</span> (<span style="color: #403D2E; font-style: italic;">:defaults</span> <span style="color: #8B887D; font-style: italic;">"modes"</span>))
  <span style="color: #403D2E; font-style: italic;">:after</span> evil
  <span style="color: #403D2E; font-style: italic;">:config</span> (evil-collection-init))
</pre>
</div>
</div>
</div>
<div id="outline-container-org2e9a451" class="outline-4">
<h4 id="org2e9a451">Evil-matchit</h4>
<div class="outline-text-4" id="text-org2e9a451">
<p>
Allows % to jump matching tags
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! evil-matchit <span style="color: #8B887D; font-style: italic;">"redguardtoo/evil-matchit"</span>
  <span style="color: #403D2E; font-style: italic;">:defer</span> 5
  <span style="color: #403D2E; font-style: italic;">:after</span> evil
  <span style="color: #403D2E; font-style: italic;">:defines</span> global-evil-matchit-mode
  <span style="color: #403D2E; font-style: italic;">:config</span> (global-evil-matchit-mode 1))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org183c914" class="outline-3">
<h3 id="org183c914">Treesitter</h3>
<div class="outline-text-3" id="text-org183c914">
</div>
<div id="outline-container-org498246c" class="outline-4">
<h4 id="org498246c">Treesit-auto</h4>
<div class="outline-text-4" id="text-org498246c">
<p>
Automatically installs treesitter grammars when they're missing, because for some reason Emacs doesn't do this already.
</p>

<p>
The call to <code>treesit-auto-add-to-auto-mode-alist</code> adds all treesitter modes to auto-mode-alist as long as they're <code>treesit-ready-p</code>. I previously had this set to <code>'all</code> but this started installing some grammars which are in-progress and thus error when you try to use them.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! treesit-auto <span style="color: #8B887D; font-style: italic;">"renzmann/treesit-auto"</span>
  <span style="color: #403D2E; font-style: italic;">:when</span> (treesitterp)
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (treesit-auto-install 'prompt)

  <span style="color: #403D2E; font-style: italic;">:config</span>
  (treesit-auto-add-to-auto-mode-alist)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Python does not play nice with treesitter, as of 2024, so we pin to a working version.</span>
  (<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">aero/python-treesit-auto-recipe</span>
    (make-treesit-auto-recipe
     <span style="color: #403D2E; font-style: italic;">:lang</span> 'python
     <span style="color: #403D2E; font-style: italic;">:ts-mode</span> 'python-ts-mode
     <span style="color: #403D2E; font-style: italic;">:remap</span> 'python-mode
     <span style="color: #403D2E; font-style: italic;">:url</span> <span style="color: #8B887D; font-style: italic;">"https://github.com/tree-sitter/tree-sitter-python"</span>
     <span style="color: #403D2E; font-style: italic;">:ext</span> <span style="color: #8B887D; font-style: italic;">"\\.py[iw]?\\'"</span>
     <span style="color: #403D2E; font-style: italic;">:revision</span> <span style="color: #8B887D; font-style: italic;">"v0.21.0"</span>)
    <span style="color: #96a7a9; font-weight: bold;">"Recipe for libtree-sitter-python.dylib"</span>)
  (add-to-list 'treesit-auto-recipe-list aero/python-treesit-auto-recipe)

  (global-treesit-auto-mode +1))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgabdc177" class="outline-4">
<h4 id="orgabdc177">Evil textobj with treesitter</h4>
<div class="outline-text-4" id="text-orgabdc177">
<p>
Allows selecting functions via Evil in treesitter major modes.
</p>

<p>
This defines <code>vaf</code> and <code>vif</code> to select the outer and inner (respectively) functions.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! evil-textobj-tree-sitter
  (<span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"meain/evil-textobj-tree-sitter"</span> <span style="color: #403D2E; font-style: italic;">:files</span> (<span style="color: #403D2E; font-style: italic;">:defaults</span> <span style="color: #8B887D; font-style: italic;">"queries"</span> <span style="color: #8B887D; font-style: italic;">"treesit-queries"</span>))
  <span style="color: #403D2E; font-style: italic;">:when</span> (treesitterp)
  <span style="color: #403D2E; font-style: italic;">:after</span> (evil)
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (define-key evil-outer-text-objects-map
    <span style="color: #8B887D; font-style: italic;">"f"</span> (evil-textobj-tree-sitter-get-textobj <span style="color: #8B887D; font-style: italic;">"function.outer"</span>))
  (define-key evil-inner-text-objects-map
    <span style="color: #8B887D; font-style: italic;">"f"</span> (evil-textobj-tree-sitter-get-textobj <span style="color: #8B887D; font-style: italic;">"function.inner"</span>)))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org68a4533" class="outline-3">
<h3 id="org68a4533">Completion and navigation</h3>
<div class="outline-text-3" id="text-org68a4533">
</div>
<div id="outline-container-orgc8807c5" class="outline-4">
<h4 id="orgc8807c5">Vertico</h4>
<div class="outline-text-4" id="text-orgc8807c5">
<p>
Provides a completion system similar to Ivy, but it's faster and more lightweight. Also make sure selections can wrap around the top and bottom of the menu.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! vertico <span style="color: #8B887D; font-style: italic;">"minad/vertico"</span>
  <span style="color: #403D2E; font-style: italic;">:init</span> (vertico-mode)
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (vertico-cycle t)

  <span style="color: #403D2E; font-style: italic;">:config</span>
  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/vertico-directory-up-maybe</span> ()
    <span style="color: #96a7a9; font-weight: bold;">"Go up a directory if completing a file name, otherwise delete char."</span>
    (<span style="color: #737063; font-weight: bold;">interactive</span>)
    (<span style="color: #737063; font-weight: bold;">if</span> (<span style="color: #737063; font-weight: bold;">and</span> (eq (char-before) ?/)
             (minibufferp)
             minibuffer-completing-file-name)
        (vertico-directory-up)
      (delete-char -1)))
  (define-key vertico-map (kbd <span style="color: #8B887D; font-style: italic;">"DEL"</span>) #'aero/vertico-directory-up-maybe))
</pre>
</div>
</div>
</div>
<div id="outline-container-orga4d94b0" class="outline-4">
<h4 id="orga4d94b0">Marginalia</h4>
<div class="outline-text-4" id="text-orga4d94b0">
<p>
This provides a more informative completion system, showing more information about the candidates.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! marginalia <span style="color: #8B887D; font-style: italic;">"minad/marginalia"</span>
  <span style="color: #403D2E; font-style: italic;">:init</span> (marginalia-mode))
</pre>
</div>
</div>
</div>
<div id="outline-container-org2a5dcae" class="outline-4">
<h4 id="org2a5dcae">Orderless</h4>
<div class="outline-text-4" id="text-org2a5dcae">
<p>
This provides a more flexible completion system where we can use spaces to separate search terms, inputting them in any order.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! orderless <span style="color: #8B887D; font-style: italic;">"oantolin/orderless"</span>
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (completion-styles '(substring orderless basic))
  (completion-category-defaults nil)
  (completion-category-overrides '((file (styles partial-completion))))
  (read-file-name-completion-ignore-case t)
  (read-buffer-completion-ignore-case t)
  (completion-ignore-case t))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd8bf7fc" class="outline-4">
<h4 id="orgd8bf7fc">Consult</h4>
<div class="outline-text-4" id="text-orgd8bf7fc">
<p>
Super useful package, providing a variety of wrappers that provide a powerful and consistent completing-read interface. I also hook it into Xref for more seamless integration.
</p>

<p>
Buffer previews are debounced, since I often don't want them.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! consult <span style="color: #8B887D; font-style: italic;">"minad/consult"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (general evil orderless)
  <span style="color: #403D2E; font-style: italic;">:commands</span> (consult-line
             consult-buffer
             consult-outline
             consult-imenu
             consult-flymake
             consult-theme
             consult-ripgrep)
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (xref-show-xrefs-function #'consult-xref)
  (xref-show-definitions-function #'consult-xref)
  (consult-preview-key '(<span style="color: #403D2E; font-style: italic;">:debounce</span> 0.4 any))

  <span style="color: #403D2E; font-style: italic;">:init</span>
  (aero-leader-def
    <span style="color: #8B887D; font-style: italic;">"/"</span> 'consult-line
    <span style="color: #8B887D; font-style: italic;">"bb"</span> 'consult-buffer
    <span style="color: #8B887D; font-style: italic;">"jo"</span> 'consult-outline
    <span style="color: #8B887D; font-style: italic;">"ji"</span> 'consult-imenu
    <span style="color: #8B887D; font-style: italic;">"je"</span> 'consult-flymake
    <span style="color: #8B887D; font-style: italic;">"ja"</span> 'consult-org-agenda
    <span style="color: #8B887D; font-style: italic;">"jh"</span> 'consult-org-heading
    <span style="color: #8B887D; font-style: italic;">"p/"</span> 'consult-ripgrep
    <span style="color: #8B887D; font-style: italic;">"Et"</span> 'consult-theme
    <span style="color: #8B887D; font-style: italic;">"j'"</span> 'consult-mark)

  <span style="color: #403D2E; font-style: italic;">:config</span>
  (add-hook 'eshell-mode-hook (<span style="color: #737063; font-weight: bold;">lambda</span> () (<span style="color: #737063; font-weight: bold;">setq</span> outline-regexp eshell-prompt-regexp)))

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">consult--orderless-regexp-compiler</span> (input type <span style="color: #387780; font-style: italic;">&amp;rest</span> _config)
    (<span style="color: #737063; font-weight: bold;">setq</span> input (cdr (orderless-compile input)))
    (cons
     (mapcar (<span style="color: #737063; font-weight: bold;">lambda</span> (r) (consult--convert-regexp r type)) input)
     (<span style="color: #737063; font-weight: bold;">lambda</span> (str) (orderless--highlight input t str))))
  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">consult--with-orderless</span> (<span style="color: #387780; font-style: italic;">&amp;rest</span> args)
    <span style="color: #96a7a9; font-weight: bold;">"Use Orderless to compile the regexp for consult-ripgrep."</span>
    (<span style="color: #737063; font-weight: bold;">minibuffer-with-setup-hook</span>
        (<span style="color: #737063; font-weight: bold;">lambda</span> ()
          (<span style="color: #737063; font-weight: bold;">setq-local</span> consult--regexp-compiler #'consult--orderless-regexp-compiler))
      (apply args)))
  (advice-add #'consult-ripgrep <span style="color: #403D2E; font-style: italic;">:around</span> #'consult--with-orderless)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Allow =n= and =N= to continue the search after =consult-line= exits. Note that this only supports the first search term when using orderless syntax.</span>
  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/consult-line-isearch-history</span> (<span style="color: #387780; font-style: italic;">&amp;rest</span> _)
    <span style="color: #96a7a9; font-weight: bold;">"Add latest `</span><span style="color: #655370; font-weight: bold;">consult-line</span><span style="color: #96a7a9; font-weight: bold;">' search pattern to the isearch history."</span>
    (<span style="color: #737063; font-weight: bold;">when</span> (<span style="color: #737063; font-weight: bold;">and</span> (<span style="color: #737063; font-weight: bold;">bound-and-true-p</span> evil-mode)
               (eq evil-search-module 'isearch)
               consult--line-history)
      (<span style="color: #737063; font-weight: bold;">let*</span> ((pattern (car consult--line-history))
             (pattern (car (split-string pattern)))
             (regexp (<span style="color: #737063; font-weight: bold;">if</span> (string-prefix-p <span style="color: #8B887D; font-style: italic;">"\\_"</span> pattern)
                         (substring pattern 2)
                       pattern)))
        (add-to-history 'regexp-search-ring regexp)
        (<span style="color: #737063; font-weight: bold;">setq</span> evil-ex-search-direction 'forward))))
  (advice-add #'consult-line <span style="color: #403D2E; font-style: italic;">:after</span> #'aero/consult-line-isearch-history)

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">crm-indicator</span> (args)
    <span style="color: #96a7a9; font-weight: bold;">"Add prompt indicator to `</span><span style="color: #655370; font-weight: bold;">completing-read-multiple</span><span style="color: #96a7a9; font-weight: bold;">'.</span>
<span style="color: #96a7a9; font-weight: bold;">  We display [CRM&lt;separator&gt;], e.g., [CRM,] if the separator is a comma."</span>
    (cons (format <span style="color: #8B887D; font-style: italic;">"[CRM%s] %s"</span>
                  (replace-regexp-in-string
                   <span style="color: #8B887D; font-style: italic;">"\\`\\[</span><span style="color: #655370; font-weight: bold; font-style: italic;">.*?</span><span style="color: #8B887D; font-style: italic;">]\\*</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">\\[</span><span style="color: #655370; font-weight: bold; font-style: italic;">.*?</span><span style="color: #8B887D; font-style: italic;">]\\*\\'"</span> <span style="color: #8B887D; font-style: italic;">""</span>
                   crm-separator)
                  (car args))
          (cdr args)))
  (advice-add #'completing-read-multiple <span style="color: #403D2E; font-style: italic;">:filter-args</span> #'crm-indicator))

</pre>
</div>
</div>
</div>
<div id="outline-container-org47f481d" class="outline-4">
<h4 id="org47f481d">Amx</h4>
<div class="outline-text-4" id="text-org47f481d">
<p>
Enhances <code>execute-extended-command</code> by showing recently used commands and keyboard shortcuts.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! amx <span style="color: #8B887D; font-style: italic;">"DarwinAwardWinner/amx"</span>
  <span style="color: #403D2E; font-style: italic;">:defer</span> 1
  <span style="color: #403D2E; font-style: italic;">:init</span> (amx-mode 1))
</pre>
</div>
</div>
</div>
<div id="outline-container-org1bada67" class="outline-4">
<h4 id="org1bada67">Yasnippet</h4>
<div class="outline-text-4" id="text-org1bada67">
<p>
Yasnippet provides a powerful templating system for inserting boilerplate code.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! yasnippet <span style="color: #8B887D; font-style: italic;">"joaotavora/yasnippet"</span>
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (yas-installed-snippets-dir aero-snippets-dir)
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (yas-global-mode 1))
</pre>
</div>
</div>
<ul class="org-ul">
<li><a id="org377152c"></a>Consult-yasnippet<br />
<div class="outline-text-5" id="text-org377152c">
<p>
Plug yasnipet into consult for a better interface to snippets
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! consult-yasnippet <span style="color: #8B887D; font-style: italic;">"mohkale/consult-yasnippet"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (consult yasnippet)
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (aero-leader-def
    <span style="color: #8B887D; font-style: italic;">"y"</span> 'consult-yasnippet))
</pre>
</div>
</div>
</li>
</ul>
</div>
<div id="outline-container-org442084c" class="outline-4">
<h4 id="org442084c">Recentf (builtin)</h4>
<div class="outline-text-4" id="text-org442084c">
<p>
Recentf provides a list of recently opened files, and is honestly one of the main ways I open buffers.
</p>

<p>
Doesn't seem like indent activates properly for me without an intervention into the save list. Here we move it to a known cache file and set up an auto-save every 5 minutes.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! recentf <span style="color: #403D2E; font-style: italic;">:builtin</span>
  <span style="color: #403D2E; font-style: italic;">:defer</span> 1
  <span style="color: #403D2E; font-style: italic;">:defines</span> (recentf-mode)

  <span style="color: #403D2E; font-style: italic;">:preface</span>
  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/recentf-save-list-quiet</span> ()
    <span style="color: #96a7a9; font-weight: bold;">"Wrapper for `</span><span style="color: #655370; font-weight: bold;">recentf-save-list</span><span style="color: #96a7a9; font-weight: bold;">' with no message."</span>
    (<span style="color: #737063; font-weight: bold;">let</span> ((inhibit-message t))
      (recentf-save-list)))

  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (recentf-save-file (expand-file-name <span style="color: #8B887D; font-style: italic;">".recentf"</span> user-emacs-directory))
  (recentf-max-saved-items 500)

  <span style="color: #403D2E; font-style: italic;">:config</span>
  (recentf-mode 1)
  (run-at-time 60 (* 5 60) #'aero/recentf-save-list-quiet))
</pre>
</div>
</div>
</div>
<div id="outline-container-orge1eebd8" class="outline-4">
<h4 id="orge1eebd8">All-the-icons</h4>
<div class="outline-text-4" id="text-orge1eebd8">
<p>
Support for icon insertion, and used as a lib in other packages
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! all-the-icons (<span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"domtronn/all-the-icons.el"</span> <span style="color: #403D2E; font-style: italic;">:files</span> (<span style="color: #403D2E; font-style: italic;">:defaults</span> <span style="color: #8B887D; font-style: italic;">"data"</span>))
  <span style="color: #403D2E; font-style: italic;">:after</span> (general)
  <span style="color: #403D2E; font-style: italic;">:defer</span> 1
  <span style="color: #403D2E; font-style: italic;">:when</span> (display-graphic-p)
  <span style="color: #403D2E; font-style: italic;">:config</span> (aero-leader-def <span style="color: #8B887D; font-style: italic;">"qi"</span> 'all-the-icons-insert))
</pre>
</div>
</div>
</div>
<div id="outline-container-org4c78ed6" class="outline-4">
<h4 id="org4c78ed6">Avy</h4>
<div class="outline-text-4" id="text-org4c78ed6">
<p>
Utility for visual navgation
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! avy <span style="color: #8B887D; font-style: italic;">"abo-abo/avy"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (general)
  <span style="color: #403D2E; font-style: italic;">:init</span>
  (general-define-key
   <span style="color: #403D2E; font-style: italic;">:states</span> '(normal visual)
   <span style="color: #403D2E; font-style: italic;">:prefix</span> <span style="color: #8B887D; font-style: italic;">"SPC"</span>
   <span style="color: #8B887D; font-style: italic;">"jl"</span> '(avy-goto-line <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"jump to line"</span>)
   <span style="color: #8B887D; font-style: italic;">"jc"</span> '(avy-goto-char <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"jump to char"</span>)
   <span style="color: #8B887D; font-style: italic;">"jj"</span> '(avy-goto-char <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"jump to char"</span>)
   <span style="color: #8B887D; font-style: italic;">"jw"</span> '(avy-goto-word-1 <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"jump to word"</span>)))
</pre>
</div>
</div>
<ul class="org-ul">
<li><a id="org0f360ae"></a>Ace-link<br />
<div class="outline-text-5" id="text-org0f360ae">
<p>
Jump to links in eww with Avy
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! ace-link <span style="color: #8B887D; font-style: italic;">"abo-abo/ace-link"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (avy eww)
  <span style="color: #403D2E; font-style: italic;">:functions</span> (ace-link-setup-default)
  <span style="color: #403D2E; font-style: italic;">:config</span> (ace-link-setup-default))
</pre>
</div>
</div>
</li>
</ul>
</div>
<div id="outline-container-orgab456d2" class="outline-4">
<h4 id="orgab456d2">Smartscan</h4>
<div class="outline-text-4" id="text-orgab456d2">
<p>
Gives us the <code>M-n</code> and <code>M-p</code> symbol-following ability
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! smartscan <span style="color: #8B887D; font-style: italic;">"mickeynp/smart-scan"</span>
  <span style="color: #403D2E; font-style: italic;">:hook</span> ((prog-mode org-mode) . smartscan-mode)
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (advice-add 'smartscan-symbol-go-forward <span style="color: #403D2E; font-style: italic;">:around</span> #'aero/advice-disable-subword)
  (advice-add 'smartscan-symbol-go-backward <span style="color: #403D2E; font-style: italic;">:around</span> #'aero/advice-disable-subword))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgda4d708" class="outline-4">
<h4 id="orgda4d708">Undo-tree</h4>
<div class="outline-text-4" id="text-orgda4d708">
<p>
Provides a visual representation of the undo history.
</p>

<p>
By default, auto-saves to the local directory, but that's annoying, so we move it to the cache directory. Also enable timestamps and diffs in the visualizer.
</p>

<p>
<code>undo-in-region</code> is disabled entirely because it's buggy enough that it will drop your undo history in some situations without warning.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! undo-tree <span style="color: #8B887D; font-style: italic;">"apchamberlain/undo-tree.el"</span>
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (undo-tree-auto-save-history nil)
  (undo-tree-history-directory-alist
   `((<span style="color: #8B887D; font-style: italic;">".*"</span> . ,(expand-file-name <span style="color: #8B887D; font-style: italic;">"undo-tree/"</span> aero-cache-dir))))
  (undo-tree-visualizer-timestamps t)
  (undo-tree-visualizer-diff t)
  (undo-tree-enable-undo-in-region nil)

  <span style="color: #403D2E; font-style: italic;">:config</span>
  (global-undo-tree-mode +1)
  (add-hook 'evil-local-mode-hook 'turn-on-undo-tree-mode))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc9b5cb1" class="outline-4">
<h4 id="orgc9b5cb1">Winner</h4>
<div class="outline-text-4" id="text-orgc9b5cb1">
<p>
Provides a way to undo/redo window configurations.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! winner <span style="color: #403D2E; font-style: italic;">:builtin</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (general)
  <span style="color: #403D2E; font-style: italic;">:defines</span> winner-boring-buffers
  <span style="color: #403D2E; font-style: italic;">:config</span>
  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">list of buffers that winner-undo won't restore</span>
  (<span style="color: #737063; font-weight: bold;">setq</span> winner-boring-buffers
        '(<span style="color: #8B887D; font-style: italic;">"*Completions*"</span>
          <span style="color: #8B887D; font-style: italic;">"*Compile-Log*"</span>
          <span style="color: #8B887D; font-style: italic;">"*inferior-lisp*"</span>
          <span style="color: #8B887D; font-style: italic;">"*Fuzzy Completions*"</span>
          <span style="color: #8B887D; font-style: italic;">"*Apropos*"</span>
          <span style="color: #8B887D; font-style: italic;">"*Help*"</span>
          <span style="color: #8B887D; font-style: italic;">"*cvs*"</span>
          <span style="color: #8B887D; font-style: italic;">"*Buffer List*"</span>
          <span style="color: #8B887D; font-style: italic;">"*Ibuffer*"</span>
          <span style="color: #8B887D; font-style: italic;">"*esh command on file*"</span>))
  (winner-mode 1)
  (aero-leader-def
    <span style="color: #8B887D; font-style: italic;">"wu"</span> 'winner-undo
    <span style="color: #8B887D; font-style: italic;">"wU"</span> 'winner-redo))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orge836184" class="outline-3">
<h3 id="orge836184">Winum</h3>
<div class="outline-text-3" id="text-orge836184">
<p>
Jump to windows by number. 1 is the upper-left-most
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! winum <span style="color: #8B887D; font-style: italic;">"deb0ch/emacs-winum"</span>
  <span style="color: #403D2E; font-style: italic;">:defer</span> 5
  <span style="color: #403D2E; font-style: italic;">:after</span> (general which-key)
  <span style="color: #403D2E; font-style: italic;">:init</span>
  (winum-mode)
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (aero-leader-def
    <span style="color: #8B887D; font-style: italic;">"1"</span> '(winum-select-window-1 <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"window-1"</span>)
    <span style="color: #8B887D; font-style: italic;">"2"</span> '(winum-select-window-2 <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"window-2"</span>)
    <span style="color: #8B887D; font-style: italic;">"3"</span> '(winum-select-window-3 <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"window-3"</span>)
    <span style="color: #8B887D; font-style: italic;">"4"</span> '(winum-select-window-4 <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"window-4"</span>)
    <span style="color: #8B887D; font-style: italic;">"5"</span> '(winum-select-window-5 <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"window-5"</span>)
    <span style="color: #8B887D; font-style: italic;">"6"</span> '(winum-select-window-6 <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"window-6"</span>)
    <span style="color: #8B887D; font-style: italic;">"7"</span> '(winum-select-window-7 <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"window-7"</span>)
    <span style="color: #8B887D; font-style: italic;">"8"</span> '(winum-select-window-8 <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"window-8"</span>)
    <span style="color: #8B887D; font-style: italic;">"9"</span> '(winum-select-window-9 <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"window-9"</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org893239f" class="outline-3">
<h3 id="org893239f">Company completions</h3>
<div class="outline-text-3" id="text-org893239f">
<p>
I can't believe this isn't built-in. Company provides a completion system that's more powerful than the default.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! company
  (<span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"company-mode/company-mode"</span>
   <span style="color: #403D2E; font-style: italic;">:files</span> (<span style="color: #403D2E; font-style: italic;">:defaults</span> <span style="color: #8B887D; font-style: italic;">"icons"</span> (<span style="color: #8B887D; font-style: italic;">"images/small"</span> <span style="color: #8B887D; font-style: italic;">"doc/images/small/*.png"</span>)))
  <span style="color: #403D2E; font-style: italic;">:after</span> (evil)
  <span style="color: #403D2E; font-style: italic;">:hook</span> ((prog-mode . company-mode)
         (company-mode-hook . evil-normalize-keymaps))
  <span style="color: #403D2E; font-style: italic;">:init</span>
  (<span style="color: #737063; font-weight: bold;">setq</span> company-idle-delay 0.2
        company-selection-wrap-around t
        company-minimum-prefix-length 2
        company-dabbrev-downcase nil
        company-tooltip-limit 15
        company-tooltip-margin 2
        company-require-match nil
        company-show-numbers t
        company-tooltip-align-annotations t
        company-dabbrev-other-buffers t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">only look in open buffers with same major mode</span>
        company-global-modes '(not
                               erc-mode message-mode help-mode gud-mode vterm-mode))
  <span style="color: #403D2E; font-style: italic;">:config</span>
  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Wait until it's defined, then disable preview after point</span>
  (<span style="color: #737063; font-weight: bold;">setq</span> company-frontends (delq 'company-preview-if-just-one-frontend company-frontends)))
</pre>
</div>
</div>
<div id="outline-container-org93593c7" class="outline-4">
<h4 id="org93593c7">Company-prescient</h4>
<div class="outline-text-4" id="text-org93593c7">
<p>
Moves commonly-used completions to the top, and provides a better sorting algorithm.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! company-prescient
  (<span style="color: #403D2E; font-style: italic;">:host</span> github
   <span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"radian-software/prescient.el"</span>
   <span style="color: #403D2E; font-style: italic;">:files</span> (<span style="color: #8B887D; font-style: italic;">"company-prescient.el"</span>))
  <span style="color: #403D2E; font-style: italic;">:after</span> (company)
  <span style="color: #403D2E; font-style: italic;">:hook</span> (company-mode . company-prescient-mode)
  <span style="color: #403D2E; font-style: italic;">:custom</span> (prescient-save-file (expand-file-name <span style="color: #8B887D; font-style: italic;">"prescient-save.el"</span> aero-cache-dir))
  <span style="color: #403D2E; font-style: italic;">:config</span> (prescient-persist-mode +1))
</pre>
</div>
</div>
</div>
<div id="outline-container-org05dfc79" class="outline-4">
<h4 id="org05dfc79">Company-box</h4>
<div class="outline-text-4" id="text-org05dfc79">
<p>
Provides a better popup interface for company
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! company-box
  (<span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"sebastiencs/company-box"</span> <span style="color: #403D2E; font-style: italic;">:files</span> (<span style="color: #403D2E; font-style: italic;">:defaults</span> <span style="color: #8B887D; font-style: italic;">"images"</span>))
  <span style="color: #403D2E; font-style: italic;">:hook</span> (company-mode . company-box-mode))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org0505c0a" class="outline-3">
<h3 id="org0505c0a">Tramp</h3>
<div class="outline-text-3" id="text-org0505c0a">
<p>
Tramp provides a way to edit files on remote servers. This was a way of life in a previous job, but I haven't touched it in several years. I'm keeping it around just in case, frozen in time. The <code>:defer t</code> ensures it's not loaded until it's needed.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! tramp <span style="color: #403D2E; font-style: italic;">:builtin</span>
  <span style="color: #403D2E; font-style: italic;">:defer</span> t
  <span style="color: #403D2E; font-style: italic;">:functions</span> tramp-cleanup-all-connection
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (tramp-auto-save-directory
   (expand-file-name <span style="color: #8B887D; font-style: italic;">"tramp/autosave"</span> aero-cache-dir))
  (tramp-persistency-file-name
   (expand-file-name <span style="color: #8B887D; font-style: italic;">"tramp/persistency"</span> aero-cache-dir))
  (tramp-use-ssh-controlmaster-options nil)  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">use system settings instead</span>
  (tramp-default-method <span style="color: #8B887D; font-style: italic;">"rsync"</span>)
  (tramp-terminal-type <span style="color: #8B887D; font-style: italic;">"tramp"</span>))
</pre>
</div>
</div>
</div>
<div id="outline-container-orge414098" class="outline-3">
<h3 id="orge414098">Dired</h3>
<div class="outline-text-3" id="text-orge414098">
<p>
This is a file manager in Emacs. I really struggle to use it, but I'm trying to reach for it more often with the help of Casual
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! dired <span style="color: #403D2E; font-style: italic;">:builtin</span>
  <span style="color: #403D2E; font-style: italic;">:hook</span> ((dired-mode . hl-line-mode)
         (dired-mode . dired-async-mode))
  <span style="color: #403D2E; font-style: italic;">:bind</span> (<span style="color: #403D2E; font-style: italic;">:map</span> dired-mode-map
         (<span style="color: #8B887D; font-style: italic;">"M-n"</span> . #'dired-next-dirline)
         (<span style="color: #8B887D; font-style: italic;">"M-p"</span> . #'dired-prev-dirline)
         (<span style="color: #8B887D; font-style: italic;">"TAB"</span> . #'dired-next-subdir)))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf140039" class="outline-3">
<h3 id="orgf140039">Language server</h3>
<div class="outline-text-3" id="text-orgf140039">
</div>
<div id="outline-container-orgf6734c7" class="outline-4">
<h4 id="orgf6734c7">Eglot</h4>
<div class="outline-text-4" id="text-orgf6734c7">
<p>
The introduction of the language server has been a game-changer. It provides a consistent interface for code completion, linting, and refactoring across quite a few languages. I've tried LSP-mode, but it's too slow and heavy for my taste. Eglot is built-in and lightweight.
</p>

<p>
Using <code>:hook</code> we ensure it's enabled for particular languages, rather than trying to enable in every buffer.
</p>

<p>
Set <code>eglot-confirm-server-initiated-edits</code> to nil to stop an infuriating default behavior that confirms editing a file immediately after explicitly initiating editing the file.
</p>

<p>
Event logging is disabled to provide a slight performance boost, with no real downside.
</p>

<p>
Document highlighting is disabled because most language servers are pretty slow at it. We use <code>highlight-thing</code> instead.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! eglot <span style="color: #403D2E; font-style: italic;">:builtin</span>
  <span style="color: #403D2E; font-style: italic;">:hook</span> ((python-mode
          python-ts-mode
          clojure-mode
          typescript-mode
          typescript-ts-mode
          js-mode
          js-ts-mode)
         . eglot-ensure)
  <span style="color: #403D2E; font-style: italic;">:after</span> (general project)

  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (eglot-confirm-server-initiated-edits nil)
  (eglot-autoshutdown t)
  (eglot-events-buffer-size 0)
  (eglot-send-changes-idle-time 0.75)
  (eglot-ignored-server-capabilities '(<span style="color: #403D2E; font-style: italic;">:documentHighlightProvider</span>))

  <span style="color: #403D2E; font-style: italic;">:config</span>
  (<span style="color: #737063; font-weight: bold;">setq-default</span> eglot-workspace-configuration
                '(<span style="color: #403D2E; font-style: italic;">:pylsp</span> (<span style="color: #403D2E; font-style: italic;">:plugins</span> (<span style="color: #403D2E; font-style: italic;">:pycodestyle</span> (<span style="color: #403D2E; font-style: italic;">:enabled</span> <span style="color: #403D2E; font-style: italic;">:json-false</span>)
                                                            <span style="color: #403D2E; font-style: italic;">:pyls_mypy</span> (<span style="color: #403D2E; font-style: italic;">:enabled</span> t <span style="color: #403D2E; font-style: italic;">:live_mode</span> <span style="color: #403D2E; font-style: italic;">:json-false</span>)
                                                            <span style="color: #403D2E; font-style: italic;">:pyls_black</span> (<span style="color: #403D2E; font-style: italic;">:enabled</span> t)
                                                            <span style="color: #403D2E; font-style: italic;">:pyls_isort</span> (<span style="color: #403D2E; font-style: italic;">:enabled</span> t)))))
  (aero-leader-def
    <span style="color: #8B887D; font-style: italic;">"la"</span> 'eglot-code-actions
    <span style="color: #8B887D; font-style: italic;">"lf"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"find"</span>)
    <span style="color: #8B887D; font-style: italic;">"lfr"</span> 'xref-find-references
    <span style="color: #8B887D; font-style: italic;">"lfd"</span> 'eglot-find-declaration
    <span style="color: #8B887D; font-style: italic;">"lfi"</span> 'eglot-find-implementation
    <span style="color: #8B887D; font-style: italic;">"lft"</span> 'eglot-find-typeDefinition
    <span style="color: #8B887D; font-style: italic;">"lr"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"refactor"</span>)
    <span style="color: #8B887D; font-style: italic;">"lrr"</span> 'eglot-rename
    <span style="color: #8B887D; font-style: italic;">"lrf"</span> 'eglot-format
    <span style="color: #8B887D; font-style: italic;">"lro"</span> 'eglot-code-action-organize-imports))
</pre>
</div>
</div>
<ul class="org-ul">
<li><a id="org6167d64"></a>Eglot-booster<br />
<div class="outline-text-5" id="text-org6167d64">
<p>
Optimizations to Eglot, using emacs-lsp-booster under the hood. emacs-lsp-booster must have been installed already (its a Rust binary), which can be done with <code>make install-deps</code> or the more specific <code>make lsp-booster</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! eglot-booster <span style="color: #8B887D; font-style: italic;">"jdtsmith/eglot-booster"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> eglot
  <span style="color: #403D2E; font-style: italic;">:config</span> (eglot-booster-mode))
</pre>
</div>
</div>
</li>
<li><a id="orgf6c97da"></a>Eglot-signature-eldoc-talkative<br />
<div class="outline-text-5" id="text-orgf6c97da">
<p>
Make eglot send more info to eldoc, including parameter and function documentation
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! eglot-signature-eldoc-talkative
  (<span style="color: #403D2E; font-style: italic;">:host</span> codeberg <span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"mekeor/eglot-signature-eldoc-talkative"</span> <span style="color: #403D2E; font-style: italic;">:branch</span> <span style="color: #8B887D; font-style: italic;">"default"</span>)
  <span style="color: #403D2E; font-style: italic;">:after</span> (eglot)
  <span style="color: #403D2E; font-style: italic;">:config</span> (advice-add #'eglot-signature-eldoc-function <span style="color: #403D2E; font-style: italic;">:override</span> #'eglot-signature-eldoc-talkative))
</pre>
</div>
</div>
</li>
</ul>
</div>
<div id="outline-container-orged02e29" class="outline-4">
<h4 id="orged02e29">Eldoc-box</h4>
<div class="outline-text-4" id="text-orged02e29">
<p>
Puts eldoc in a child frame instead of the echo area. It's set up so that it only shows up when you want it to, rather than clobbering the minibuffer or showing on top of other code.
</p>

<p>
Includes a function to ensure we fix the documentation strategy to show all of the available eldoc information when we want it. This way Flymake errors don't just get clobbered by docstrings.
</p>

<p>
The configuration leaves single-line docs in the minibuffer, and shows multi-line docs in the child frame only when requested. Since we always show when the user requests it, max height and width are not important.
</p>


<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! eldoc-box <span style="color: #8B887D; font-style: italic;">"casouri/eldoc-box"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> general

  <span style="color: #403D2E; font-style: italic;">:preface</span>
  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/eldoc-set-documentation-strategy</span> ()
    (<span style="color: #737063; font-weight: bold;">setq-local</span> eldoc-documentation-strategy #'eldoc-documentation-compose))

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/eldoc-box-help-at-point</span> ()
    <span style="color: #96a7a9; font-weight: bold;">"Display full eldoc at point on command"</span>
    (<span style="color: #737063; font-weight: bold;">interactive</span>)
    (<span style="color: #737063; font-weight: bold;">let</span> ((eldoc-echo-area-use-multiline-p t))
      (call-interactively #'eldoc-box-help-at-point)))

  <span style="color: #403D2E; font-style: italic;">:hook</span> (eglot-managed-mode . aero/eldoc-set-documentation-strategy)

  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (eldoc-idle-delay 0.5)
  (eldoc-box-only-multi-line nil)
  (eldoc-echo-area-use-multiline-p nil)
  (eldoc-box-max-pixel-height 99999)
  (eldoc-box-max-pixel-width 99999)

  <span style="color: #403D2E; font-style: italic;">:init</span>
  (aero-leader-def <span style="color: #8B887D; font-style: italic;">"i"</span> 'aero/eldoc-box-help-at-point)

  <span style="color: #403D2E; font-style: italic;">:config</span>
  (add-hook 'eldoc-box-buffer-setup-hook #'eldoc-box-prettify-ts-errors 0 t))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org9170ee8" class="outline-3">
<h3 id="org9170ee8">System-specific setup</h3>
<div class="outline-text-3" id="text-org9170ee8">
<p>
Mac needs some extra hand-holding to connect the kill-ring to the system clipboard. Linux just needs the functionality enabled.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">  (<span style="color: #737063; font-weight: bold;">when</span> (system-is-mac)
(<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">aero/pbcopier-program</span> (executable-find <span style="color: #8B887D; font-style: italic;">"pbcopy"</span>)
  <span style="color: #96a7a9; font-weight: bold;">"Name of Pbcopy program tool."</span>)
(<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">aero/pbcopier-last-selected-text-clipboard</span> nil
  <span style="color: #96a7a9; font-weight: bold;">"The value of the CLIPBOARD X selection from pbcopy."</span>)
(<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">aero/pbcopier-last-selected-text-primary</span> nil
  <span style="color: #96a7a9; font-weight: bold;">"The value of the PRIMARY X selection from pbcopy."</span>)

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/pbcopier-set-selection</span> (type data)
  <span style="color: #96a7a9; font-weight: bold;">"TYPE is a symbol: primary, secondary and clipboard.</span>
<span style="color: #96a7a9; font-weight: bold;">See `</span><span style="color: #655370; font-weight: bold;">x-set-selection</span><span style="color: #96a7a9; font-weight: bold;">'."</span>
  (<span style="color: #737063; font-weight: bold;">when</span> aero/pbcopier-program
    (<span style="color: #737063; font-weight: bold;">let*</span> ((process-connection-type nil)
           (proc (start-process <span style="color: #8B887D; font-style: italic;">"pbcopy"</span> nil <span style="color: #8B887D; font-style: italic;">"pbcopy"</span>
                                <span style="color: #8B887D; font-style: italic;">"-selection"</span> (symbol-name type))))
      (process-send-string proc data)
      (process-send-eof proc))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/pbcopier-select-text</span> (text)
  <span style="color: #96a7a9; font-weight: bold;">"See `</span><span style="color: #655370; font-weight: bold;">x-select-text</span><span style="color: #96a7a9; font-weight: bold;">'."</span>
  (aero/pbcopier-set-selection 'primary text)
  (<span style="color: #737063; font-weight: bold;">setq</span> aero/pbcopier-last-selected-text-primary text)
  (aero/pbcopier-set-selection 'clipboard text)
  (<span style="color: #737063; font-weight: bold;">setq</span> aero/pbcopier-last-selected-text-clipboard text))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/pbcopier-selection-value</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"See `</span><span style="color: #655370; font-weight: bold;">x-cut-buffer-or-selection-value</span><span style="color: #96a7a9; font-weight: bold;">'."</span>
  (<span style="color: #737063; font-weight: bold;">when</span> aero/pbcopier-program
    (<span style="color: #737063; font-weight: bold;">let</span> (clip-text primary-text)
      (<span style="color: #737063; font-weight: bold;">let</span> ((tramp-mode nil)
            (default-directory <span style="color: #8B887D; font-style: italic;">"~"</span>))
        (<span style="color: #737063; font-weight: bold;">setq</span> clip-text (shell-command-to-string <span style="color: #8B887D; font-style: italic;">"pbpaste"</span>)))
      (<span style="color: #737063; font-weight: bold;">setq</span> clip-text
            (<span style="color: #737063; font-weight: bold;">cond</span> <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">check clipboard selection</span>
             ((<span style="color: #737063; font-weight: bold;">or</span> (not clip-text) (string= clip-text <span style="color: #8B887D; font-style: italic;">""</span>))
              (<span style="color: #737063; font-weight: bold;">setq</span> aero/pbcopier-last-selected-text-primary nil))
             ((eq      clip-text aero/pbcopier-last-selected-text-clipboard) nil)
             ((string= clip-text aero/pbcopier-last-selected-text-clipboard)
              <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Record the newer string,</span>
              <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">so subsequent calls can use the `</span><span style="color: #655370; background-color: #ecf3ec; font-weight: bold; font-style: italic;">eq</span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">' test.</span>
              (<span style="color: #737063; font-weight: bold;">setq</span> aero/pbcopier-last-selected-text-clipboard clip-text)
              nil)
             (t (<span style="color: #737063; font-weight: bold;">setq</span> aero/pbcopier-last-selected-text-clipboard clip-text))))
      (<span style="color: #737063; font-weight: bold;">let</span> ((tramp-mode nil)
            (default-directory <span style="color: #8B887D; font-style: italic;">"~"</span>))
        (<span style="color: #737063; font-weight: bold;">setq</span> primary-text (shell-command-to-string <span style="color: #8B887D; font-style: italic;">"pbpaste"</span>)))
      (<span style="color: #737063; font-weight: bold;">setq</span> primary-text
            (<span style="color: #737063; font-weight: bold;">cond</span> <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">check primary selection</span>
             ((<span style="color: #737063; font-weight: bold;">or</span> (not primary-text) (string= primary-text <span style="color: #8B887D; font-style: italic;">""</span>))
              (<span style="color: #737063; font-weight: bold;">setq</span> aero/pbcopier-last-selected-text-primary nil))
             ((eq      primary-text aero/pbcopier-last-selected-text-primary) nil)
             ((string= primary-text aero/pbcopier-last-selected-text-primary)
              <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Record the newer string,</span>
              <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">so subsequent calls can use the `</span><span style="color: #655370; background-color: #ecf3ec; font-weight: bold; font-style: italic;">eq</span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">' test.</span>
              (<span style="color: #737063; font-weight: bold;">setq</span> aero/pbcopier-last-selected-text-primary primary-text)
              nil)
             (t (<span style="color: #737063; font-weight: bold;">setq</span> aero/pbcopier-last-selected-text-primary primary-text))))
      (<span style="color: #737063; font-weight: bold;">or</span> clip-text primary-text))))

    (<span style="color: #737063; font-weight: bold;">declare-function</span> aero/pbcopier-select-text <span style="color: #8B887D; font-style: italic;">"aero-pbcopier.el"</span>)
    (<span style="color: #737063; font-weight: bold;">declare-function</span> aero/pbcopier-selection-value <span style="color: #8B887D; font-style: italic;">"aero-pbcopier.el"</span>)
    (<span style="color: #737063; font-weight: bold;">setq</span> interprogram-cut-function #'aero/pbcopier-select-text)
    (<span style="color: #737063; font-weight: bold;">setq</span> interprogram-paste-function #'aero/pbcopier-selection-value)

    (<span style="color: #737063; font-weight: bold;">setq-default</span> ns-use-native-fullscreen nil)
    (<span style="color: #737063; font-weight: bold;">if</span> (executable-find <span style="color: #8B887D; font-style: italic;">"gls"</span>)
        (<span style="color: #737063; font-weight: bold;">progn</span>
          (<span style="color: #737063; font-weight: bold;">setq</span> insert-directory-program <span style="color: #8B887D; font-style: italic;">"gls"</span>)
          (<span style="color: #737063; font-weight: bold;">setq</span> dired-listing-switches <span style="color: #8B887D; font-style: italic;">"-lFaGh1v --group-directories-first"</span>))
      (<span style="color: #737063; font-weight: bold;">setq</span> dired-listing-switches <span style="color: #8B887D; font-style: italic;">"-ahlF"</span>)))
</pre>
</div>

<p>
Linux only needs some functionality enabled.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span style="color: #737063; font-weight: bold;">when</span> (system-is-linux)
  (<span style="color: #737063; font-weight: bold;">setq</span> select-enable-clipboard t
        interprogram-paste-function #'gui-selection-value
        x-gtk-use-system-tooltips t
        dired-listing-switches <span style="color: #8B887D; font-style: italic;">"-lFaGh1v --group-directories-first"</span>))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd6ccda5" class="outline-3">
<h3 id="orgd6ccda5">Editor setup</h3>
<div class="outline-text-3" id="text-orgd6ccda5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! editorconfig <span style="color: #8B887D; font-style: italic;">"editorconfig/editorconfig-emacs"</span>
  <span style="color: #403D2E; font-style: italic;">:defer</span> 1
  <span style="color: #403D2E; font-style: italic;">:functions</span> (editorconfig-mode)
  <span style="color: #403D2E; font-style: italic;">:config</span> (editorconfig-mode +1))

<span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">detects when the buffer matches what's on disk and marks it unmodified. If, for example, you</span>
<span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">visit a file, change something, then undo the change, this package ensures the buffer doesn't</span>
<span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">think its still modified.</span>
(package! unmodified-buffer <span style="color: #8B887D; font-style: italic;">"arthurcgusmao/unmodified-buffer"</span>
  <span style="color: #403D2E; font-style: italic;">:defer</span> 1
  <span style="color: #403D2E; font-style: italic;">:hook</span> ((prog-mode text-mode) . unmodified-buffer-mode))

<span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Use `</span><span style="color: #655370; background-color: #ecf3ec; font-weight: bold; font-style: italic;">so-long-revert</span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">' in a buffer to get back to what it would otherwise have loaded as.</span>
(package! so-long <span style="color: #403D2E; font-style: italic;">:builtin</span>
  <span style="color: #403D2E; font-style: italic;">:config</span> (global-so-long-mode +1))

(package! savehist <span style="color: #403D2E; font-style: italic;">:builtin</span>
  <span style="color: #403D2E; font-style: italic;">:init</span> (savehist-mode)
  <span style="color: #403D2E; font-style: italic;">:custom</span> (savehist-file (expand-file-name <span style="color: #8B887D; font-style: italic;">"history"</span> aero-cache-dir)))

<span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Improved version of help buffers</span>
(package! helpful <span style="color: #8B887D; font-style: italic;">"Wilfred/helpful"</span>
  <span style="color: #403D2E; font-style: italic;">:commands</span> (helpful-function
             helpful-variable
             helpful-macro
             helpful-key
             helpful-callable)
  <span style="color: #403D2E; font-style: italic;">:after</span> (evil general)
  <span style="color: #403D2E; font-style: italic;">:init</span>

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">HACK `</span><span style="color: #655370; background-color: #ecf3ec; font-weight: bold; font-style: italic;">help-fns--autoloaded-p</span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">'s signature changed on Emacs 29. This</span>
  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">suppresses the error until it is addressed upstream. Basically we just</span>
  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">override the function to ignore the second argument.</span>
  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">TODO trying this out without the hack, Jan 27, 2025. If you're reading this and thinking wow</span>
  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">that was a long time ago, rip it out</span>
  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">(unless (version&lt; emacs-version "29")</span>
  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;;   </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">(advice-add #'help-fns--autoloaded-p :around</span>
  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;;               </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">(lambda (fn sym &amp;rest args)</span>
  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;;                 </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">(apply fn (list sym)))))</span>

  (general-define-key
   <span style="color: #403D2E; font-style: italic;">:states</span> 'normal
   <span style="color: #403D2E; font-style: italic;">:prefix</span> <span style="color: #8B887D; font-style: italic;">"SPC"</span>
   <span style="color: #8B887D; font-style: italic;">"hdf"</span> 'helpful-function
   <span style="color: #8B887D; font-style: italic;">"hda"</span> 'helpful-symbol
   <span style="color: #8B887D; font-style: italic;">"hdv"</span> 'helpful-variable
   <span style="color: #8B887D; font-style: italic;">"hdm"</span> 'helpful-macro
   <span style="color: #8B887D; font-style: italic;">"hdk"</span> 'helpful-key
   <span style="color: #8B887D; font-style: italic;">"hdc"</span> 'helpful-callable)

  <span style="color: #403D2E; font-style: italic;">:config</span>
  (evil-define-key 'normal helpful-mode-map
    <span style="color: #8B887D; font-style: italic;">"q"</span> 'kill-current-buffer
    <span style="color: #8B887D; font-style: italic;">"?"</span> 'describe-mode))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org1a0f0c8" class="outline-2">
<h2 id="org1a0f0c8">UI</h2>
<div class="outline-text-2" id="text-org1a0f0c8">
</div>
<div id="outline-container-orgc6f265f" class="outline-3">
<h3 id="orgc6f265f">Aero modeline</h3>
<div class="outline-text-3" id="text-orgc6f265f">
<p>
My custom modeline. Exceptionally loosely based on Doom's modeline, but the code diverged many years ago.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defgroup</span> <span style="color: #387780; font-style: italic;">aero/modeline</span> nil
  <span style="color: #96a7a9; font-weight: bold;">"A minimal mode-line with useful information."</span>
  <span style="color: #403D2E; font-style: italic;">:group</span> 'mode-line)

(<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">aero/modeline--bar-active</span> nil)
(<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">aero/modeline-bar--inactive</span> nil)

(<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">aero/modeline-height</span> 30)
(<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">aero/modeline-bar-width</span> 5)

(<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">aero/modeline--default-mode-line</span> mode-line-format
  <span style="color: #96a7a9; font-weight: bold;">"Store the default mode-line format so it's not lost."</span>)

(<span style="color: #737063; font-weight: bold;">defvar-local</span> <span style="color: #5C7B52;">aero/modeline-hide--old-format</span> nil
  <span style="color: #96a7a9; font-weight: bold;">"Storage for the old `</span><span style="color: #655370; font-weight: bold;">mode-line-format</span><span style="color: #96a7a9; font-weight: bold;">', so it can be restored when</span>
<span style="color: #96a7a9; font-weight: bold;">`</span><span style="color: #655370; font-weight: bold;">aero/modeline-hide-mode</span><span style="color: #96a7a9; font-weight: bold;">' is disabled."</span>)

<span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Ensure major-mode or theme changes can't overwrite this</span>
(put 'aero/modeline-hide--old-format 'permanent-local t)

(<span style="color: #737063; font-weight: bold;">defface</span> <span style="color: #5C7B52;">aero/modeline-status-grayed-out</span> '((t (<span style="color: #403D2E; font-style: italic;">:inherit</span> (font-lock-doc-face) <span style="color: #403D2E; font-style: italic;">:slant</span> italic)))
  <span style="color: #96a7a9; font-weight: bold;">"Face used for neutral or inactive status indicators in the mode-line."</span>
  <span style="color: #403D2E; font-style: italic;">:group</span> 'aero/modeline)

(<span style="color: #737063; font-weight: bold;">defface</span> <span style="color: #5C7B52;">aero/modeline-status-info</span> '((t (<span style="color: #403D2E; font-style: italic;">:inherit</span> (font-lock-keyword-face) <span style="color: #403D2E; font-style: italic;">:slant</span> italic)))
  <span style="color: #96a7a9; font-weight: bold;">"Face used for generic status indicators in the mode-line."</span>
  <span style="color: #403D2E; font-style: italic;">:group</span> 'aero/modeline)

(<span style="color: #737063; font-weight: bold;">defface</span> <span style="color: #5C7B52;">aero/modeline-status-success</span> '((t (<span style="color: #403D2E; font-style: italic;">:inherit</span> (success) <span style="color: #403D2E; font-style: italic;">:slant</span> italic)))
  <span style="color: #96a7a9; font-weight: bold;">"Face used for success status indicators in the mode-line."</span>
  <span style="color: #403D2E; font-style: italic;">:group</span> 'aero/modeline)

(<span style="color: #737063; font-weight: bold;">defface</span> <span style="color: #5C7B52;">aero/modeline-status-warning</span> '((t (<span style="color: #403D2E; font-style: italic;">:inherit</span> (warning) <span style="color: #403D2E; font-style: italic;">:slant</span> italic)))
  <span style="color: #96a7a9; font-weight: bold;">"Face for warning status indicators in the mode-line."</span>
  <span style="color: #403D2E; font-style: italic;">:group</span> 'aero/modeline)

(<span style="color: #737063; font-weight: bold;">defface</span> <span style="color: #5C7B52;">aero/modeline-status-error</span> '((t (<span style="color: #403D2E; font-style: italic;">:inherit</span> (<span style="color: #d7af00; font-weight: bold;">error</span>) <span style="color: #403D2E; font-style: italic;">:slant</span> italic)))
  <span style="color: #96a7a9; font-weight: bold;">"Face for error stauts indicators in the mode-line."</span>
  <span style="color: #403D2E; font-style: italic;">:group</span> 'aero/modeline)

(<span style="color: #737063; font-weight: bold;">defface</span> <span style="color: #5C7B52;">aero/modeline-unimportant</span> '((t (<span style="color: #403D2E; font-style: italic;">:inherit</span> (font-lock-doc-face))))
  <span style="color: #96a7a9; font-weight: bold;">"Face used for less important mode-line elements."</span>
  <span style="color: #403D2E; font-style: italic;">:group</span> 'aero/modeline)

(<span style="color: #737063; font-weight: bold;">defface</span> <span style="color: #5C7B52;">aero/modeline-modified</span> '((t (<span style="color: #403D2E; font-style: italic;">:inherit</span> (<span style="color: #d7af00; font-weight: bold;">error</span>))))
  <span style="color: #96a7a9; font-weight: bold;">"Face used for the '</span><span style="color: #655370; font-weight: bold;">modified</span><span style="color: #96a7a9; font-weight: bold;">' indicator symbol in the mode-line."</span>
  <span style="color: #403D2E; font-style: italic;">:group</span> 'aero/modeline)

(<span style="color: #737063; font-weight: bold;">defface</span> <span style="color: #5C7B52;">aero/modeline-not-modified</span> '((t (<span style="color: #403D2E; font-style: italic;">:inherit</span> (success))))
  <span style="color: #96a7a9; font-weight: bold;">"Face used for the 'not modified' indicator symbol in the mode-line."</span>
  <span style="color: #403D2E; font-style: italic;">:group</span> 'aero/modeline)

(<span style="color: #737063; font-weight: bold;">defface</span> <span style="color: #5C7B52;">aero/modeline-read-only</span> '((t (<span style="color: #403D2E; font-style: italic;">:inherit</span> (warning))))
  <span style="color: #96a7a9; font-weight: bold;">"Face used for the 'buffer read-only' indicator symbol in the mode-line."</span>
  <span style="color: #403D2E; font-style: italic;">:group</span> 'aero/modeline)

(<span style="color: #737063; font-weight: bold;">defface</span> <span style="color: #5C7B52;">aero/modeline-remote</span> '((t (<span style="color: #403D2E; font-style: italic;">:inherit</span> (font-lock-keyword-face <span style="color: #403D2E; font-style: italic;">:weight</span> bold))))
  <span style="color: #96a7a9; font-weight: bold;">"Face used for the 'not modified' indicator symbol in the mode-line."</span>
  <span style="color: #403D2E; font-style: italic;">:group</span> 'aero/modeline)

(<span style="color: #737063; font-weight: bold;">defface</span> <span style="color: #5C7B52;">aero/modeline-evil-normal</span> '((t (<span style="color: #403D2E; font-style: italic;">:inherit</span> (font-lock-keyword-face))))
  <span style="color: #96a7a9; font-weight: bold;">"Face used for Normal Evil state message."</span>
  <span style="color: #403D2E; font-style: italic;">:group</span> 'aero/modeline)
(<span style="color: #737063; font-weight: bold;">defface</span> <span style="color: #5C7B52;">aero/modeline-evil-insert</span> '((t (<span style="color: #403D2E; font-style: italic;">:inherit</span> (font-lock-keyword-face))))
  <span style="color: #96a7a9; font-weight: bold;">"Face used for Insert Evil state message."</span>
  <span style="color: #403D2E; font-style: italic;">:group</span> 'aero/modeline)
(<span style="color: #737063; font-weight: bold;">defface</span> <span style="color: #5C7B52;">aero/modeline-evil-visual</span> '((t (<span style="color: #403D2E; font-style: italic;">:inherit</span> (font-lock-keyword-face))))
  <span style="color: #96a7a9; font-weight: bold;">"Face used for Visual Evil state message."</span>
  <span style="color: #403D2E; font-style: italic;">:group</span> 'aero/modeline)
(<span style="color: #737063; font-weight: bold;">defface</span> <span style="color: #5C7B52;">aero/modeline-evil-operator</span> '((t (<span style="color: #403D2E; font-style: italic;">:inherit</span> (font-lock-keyword-face))))
  <span style="color: #96a7a9; font-weight: bold;">"Face used for Visual Evil state message."</span>
  <span style="color: #403D2E; font-style: italic;">:group</span> 'aero/modeline)
(<span style="color: #737063; font-weight: bold;">defface</span> <span style="color: #5C7B52;">aero/modeline-evil-motion</span> '((t (<span style="color: #403D2E; font-style: italic;">:inherit</span> (font-lock-keyword-face))))
  <span style="color: #96a7a9; font-weight: bold;">"Face used for Visual Evil state message."</span>
  <span style="color: #403D2E; font-style: italic;">:group</span> 'aero/modeline)
(<span style="color: #737063; font-weight: bold;">defface</span> <span style="color: #5C7B52;">aero/modeline-evil-replace</span> '((t (<span style="color: #403D2E; font-style: italic;">:inherit</span> (font-lock-keyword-face))))
  <span style="color: #96a7a9; font-weight: bold;">"Face used for Replace Evil state message."</span>
  <span style="color: #403D2E; font-style: italic;">:group</span> 'aero/modeline)
(<span style="color: #737063; font-weight: bold;">defface</span> <span style="color: #5C7B52;">aero/modeline-evil-emacs</span> '((t (<span style="color: #403D2E; font-style: italic;">:inherit</span> (font-lock-keyword-face))))
  <span style="color: #96a7a9; font-weight: bold;">"Face used for Emacs Evil state message."</span>
  <span style="color: #403D2E; font-style: italic;">:group</span> 'aero/modeline)

(<span style="color: #737063; font-weight: bold;">defface</span> <span style="color: #5C7B52;">aero/modeline-major-mode-active</span> '((t (<span style="color: #403D2E; font-style: italic;">:inherit</span> mode-line-buffer-id)))
  <span style="color: #96a7a9; font-weight: bold;">"Face used for major mode."</span>
  <span style="color: #403D2E; font-style: italic;">:group</span> 'aero/modeline)

(<span style="color: #737063; font-weight: bold;">defface</span> <span style="color: #5C7B52;">aero/modeline-git-branch</span> '((t (<span style="color: #403D2E; font-style: italic;">:slant</span> italic <span style="color: #403D2E; font-style: italic;">:bold</span> t)))
  <span style="color: #96a7a9; font-weight: bold;">"Used for Git branch name."</span>
  <span style="color: #403D2E; font-style: italic;">:group</span> 'aero/modeline)

(<span style="color: #737063; font-weight: bold;">defface</span> <span style="color: #5C7B52;">aero/modeline-bar</span> '((t (<span style="color: #403D2E; font-style: italic;">:background</span> unspecified)))
  <span style="color: #96a7a9; font-weight: bold;">"Style of the bar on the modeline."</span>
  <span style="color: #403D2E; font-style: italic;">:group</span> 'aero/modeline)
(<span style="color: #737063; font-weight: bold;">defface</span> <span style="color: #5C7B52;">aero/modeline-bar-inactive</span> '((t (<span style="color: #403D2E; font-style: italic;">:background</span> unspecified)))
  <span style="color: #96a7a9; font-weight: bold;">"Style of the bar on the inactive modeline."</span>
  <span style="color: #403D2E; font-style: italic;">:group</span> 'aero/modeline)

<span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">TODO could this be memoized?</span>
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero-info-line-format</span> (left right)
  <span style="color: #96a7a9; font-weight: bold;">"Return a string of `</span><span style="color: #655370; font-weight: bold;">window-width</span><span style="color: #96a7a9; font-weight: bold;">' length containing LEFT and RIGHT, aligned</span>
<span style="color: #96a7a9; font-weight: bold;">respectively."</span>
  (<span style="color: #737063; font-weight: bold;">let</span> ((reserve (length right)))
    (concat left <span style="color: #8B887D; font-style: italic;">" "</span> (propertize
                      <span style="color: #8B887D; font-style: italic;">" "</span> 'display
                      `((space <span style="color: #403D2E; font-style: italic;">:align-to</span>
                          (- (+ right right-fringe right-margin)
                             ,(+ reserve (<span style="color: #737063; font-weight: bold;">if</span> (display-graphic-p) 1 2))))))
            right)))

(<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">aero/modeline--active-window</span> nil)
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/modeline--get-active-window</span> (<span style="color: #387780; font-style: italic;">&amp;optional</span> frame)
  <span style="color: #96a7a9; font-weight: bold;">"Get the current window, but exclude child windows."</span>
  (<span style="color: #737063; font-weight: bold;">if</span> (<span style="color: #737063; font-weight: bold;">and</span> (fboundp 'frame-parent) (frame-parent frame))
      (frame-selected-window (frame-parent frame))
    (frame-selected-window frame)))
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/modeline--set-selected-window</span> (<span style="color: #387780; font-style: italic;">&amp;rest</span> _)
  <span style="color: #96a7a9; font-weight: bold;">"Set `</span><span style="color: #655370; font-weight: bold;">aero/modeline--active-window</span><span style="color: #96a7a9; font-weight: bold;">' to the correct window."</span>
  (<span style="color: #737063; font-weight: bold;">let</span> ((win (aero/modeline--get-active-window)))
    (<span style="color: #737063; font-weight: bold;">setq</span> aero/modeline--active-window
          (<span style="color: #737063; font-weight: bold;">if</span> (minibuffer-window-active-p win)
              (minibuffer-selected-window)
            win))))
(add-hook 'pre-redisplay-functions #'aero/modeline--set-selected-window)
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/modeline--active-p</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Return whether mode-line is active."</span>
  (<span style="color: #737063; font-weight: bold;">and</span> aero/modeline--active-window
       (eq (aero/modeline--get-active-window) aero/modeline--active-window)))

<span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Segments</span>

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/modeline-segment-evil-state</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Display current evil state. Requires function `</span><span style="color: #655370; font-weight: bold;">evil-mode</span><span style="color: #96a7a9; font-weight: bold;">'."</span>
  (<span style="color: #737063; font-weight: bold;">when</span> (<span style="color: #737063; font-weight: bold;">require</span> '<span style="color: #655370; font-weight: bold;">evil</span> nil 'noerror)
    (<span style="color: #737063; font-weight: bold;">declare-function</span> evil-state-property <span style="color: #8B887D; font-style: italic;">"evil"</span>)
    (<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">evil-state</span>)
    (<span style="color: #737063; font-weight: bold;">let</span> ((state (evil-state-property evil-state <span style="color: #403D2E; font-style: italic;">:tag</span> t)))
      (<span style="color: #737063; font-weight: bold;">cond</span>
       ((functionp state) (propertize (funcall state) 'face 'aero/modeline-evil-visual))
       ((string= state <span style="color: #8B887D; font-style: italic;">" &lt;N&gt; "</span>) (propertize state 'face 'aero/modeline-evil-normal))
       ((string= state <span style="color: #8B887D; font-style: italic;">" &lt;I&gt; "</span>) (propertize state 'face 'aero/modeline-evil-insert))
       ((string= state <span style="color: #8B887D; font-style: italic;">" &lt;R&gt; "</span>) (propertize state 'face 'aero/modeline-evil-replace))
       ((string= state <span style="color: #8B887D; font-style: italic;">" &lt;O&gt; "</span>) (propertize state 'face 'aero/modeline-evil-operator))
       ((string= state <span style="color: #8B887D; font-style: italic;">" &lt;M&gt; "</span>) (propertize state 'face 'aero/modeline-evil-motion))
       ((string= state <span style="color: #8B887D; font-style: italic;">" &lt;E&gt; "</span>) (propertize state 'face 'aero/modeline-evil-emacs))
       (t state)))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/modeline-segment-modified</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Displays a color-coded buffer modification indicator in the mode-line."</span>
  (<span style="color: #737063; font-weight: bold;">cond</span>
   ((<span style="color: #737063; font-weight: bold;">and</span> buffer-read-only (buffer-file-name))  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">read-only</span>
    (propertize <span style="color: #8B887D; font-style: italic;">"&#9215;"</span> 'face `(<span style="color: #403D2E; font-style: italic;">:inherit</span> aero/modeline-read-only <span style="color: #403D2E; font-style: italic;">:height</span> 0.6)))
   ((string-match-p <span style="color: #8B887D; font-style: italic;">"\\*.*\\*"</span> (buffer-name))  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">special buffer</span>
    (propertize <span style="color: #8B887D; font-style: italic;">"&#1009;"</span> 'face `(<span style="color: #403D2E; font-style: italic;">:inherit</span> aero/modeline-read-only <span style="color: #403D2E; font-style: italic;">:height</span> 0.6)))
   ((buffer-modified-p)  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">modified</span>
    (propertize <span style="color: #8B887D; font-style: italic;">"&#9998;"</span> 'face `(<span style="color: #403D2E; font-style: italic;">:inherit</span> aero/modeline-modified <span style="color: #403D2E; font-style: italic;">:height</span> 0.65)))
   (t  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">not modified</span>
    (propertize <span style="color: #8B887D; font-style: italic;">"&#10003;"</span> 'face `(<span style="color: #403D2E; font-style: italic;">:inherit</span> aero/modeline-not-modified <span style="color: #403D2E; font-style: italic;">:height</span> 0.6)))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/modeline-segment-git-state</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Displays the current branch and status from Git.</span>

<span style="color: #96a7a9; font-weight: bold;">Only Git is supported because I'm not an animal."</span>
  (<span style="color: #737063; font-weight: bold;">when</span> (<span style="color: #737063; font-weight: bold;">and</span> vc-mode buffer-file-name)
    (<span style="color: #737063; font-weight: bold;">let</span> ((state (vc-state (file-local-name buffer-file-name)))
          (str (<span style="color: #737063; font-weight: bold;">if</span> vc-display-status
                   (substring vc-mode 5)
                 <span style="color: #8B887D; font-style: italic;">""</span>)))
      (concat
       (propertize
        (<span style="color: #737063; font-weight: bold;">let</span> ((max 12))
          (<span style="color: #737063; font-weight: bold;">if</span> (&gt; (length str) max)
              (concat (substring str 0 (- max 3)) <span style="color: #8B887D; font-style: italic;">"&#8230;"</span>) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">substring 3 less than length limit</span>
            str))
        'mouse-face 'mode-line-highlight
        'face 'aero/modeline-git-branch)
       <span style="color: #8B887D; font-style: italic;">" "</span>))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/modeline-segment-remote</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Displays a symbol if buffer is remote"</span>
  (<span style="color: #737063; font-weight: bold;">when-let*</span> ((filename (buffer-file-name))
              (host (file-remote-p filename 'host)))
    (concat <span style="color: #8B887D; font-style: italic;">" @"</span> (propertize host 'face 'aero/modeline-remote) <span style="color: #8B887D; font-style: italic;">" "</span>)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/modeline-segment-buffer-name</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Displays the name and size of the current buffer in the mode-line."</span>
  (concat (propertize <span style="color: #8B887D; font-style: italic;">"%b"</span> 'face 'mode-line-buffer-id) <span style="color: #8B887D; font-style: italic;">" "</span>))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/modeline-segment-size-and-position</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Displays the current cursor position in the mode-line."</span>
  (concat <span style="color: #8B887D; font-style: italic;">"(%I) %l:%C %o%%"</span>
          (<span style="color: #737063; font-weight: bold;">when</span> (use-region-p)
            (concat
             <span style="color: #8B887D; font-style: italic;">"  ("</span> (number-to-string (count-lines (point) (mark)))
             <span style="color: #8B887D; font-style: italic;">":"</span> (number-to-string (abs (- (point) (mark))))
             <span style="color: #8B887D; font-style: italic;">")"</span>))
          <span style="color: #8B887D; font-style: italic;">"  "</span>))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/modeline-segment-process</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Displays the current value of `</span><span style="color: #655370; font-weight: bold;">mode-line-process</span><span style="color: #96a7a9; font-weight: bold;">' in the mode-line."</span>
  (<span style="color: #737063; font-weight: bold;">when</span> mode-line-process
    (list mode-line-process <span style="color: #8B887D; font-style: italic;">"  "</span>)))

(<span style="color: #737063; font-weight: bold;">declare-function</span> flymake--mode-line-counter <span style="color: #8B887D; font-style: italic;">"flymake"</span>)
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/modeline-segment-flymake</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Displays information about current flymake status."</span>
  (<span style="color: #737063; font-weight: bold;">when</span> (<span style="color: #737063; font-weight: bold;">bound-and-true-p</span> flymake-mode)
    (list (flymake--mode-line-counter <span style="color: #403D2E; font-style: italic;">:error</span>) <span style="color: #8B887D; font-style: italic;">" "</span>)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/modeline-segment-lsp</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Displays information about LSP status."</span>
  (<span style="color: #737063; font-weight: bold;">cond</span>
   ((<span style="color: #737063; font-weight: bold;">bound-and-true-p</span> lsp-mode)
    (list (propertize <span style="color: #8B887D; font-style: italic;">"&#61573;"</span>
                      'help-echo
                      (string-join
                       (mapcar (<span style="color: #737063; font-weight: bold;">lambda</span> (w)
                                 (format <span style="color: #8B887D; font-style: italic;">"[%s]\n"</span> (lsp--workspace-print w)))
                               (lsp-workspaces))))
          <span style="color: #8B887D; font-style: italic;">"  "</span>))

   ((<span style="color: #737063; font-weight: bold;">and</span> (fboundp 'eglot-managed-p) (eglot-managed-p))
    (list <span style="color: #8B887D; font-style: italic;">"&#61573;"</span> <span style="color: #8B887D; font-style: italic;">"  "</span>))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/modeline-segment-major-mode</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Displays the current major mode in the mode-line."</span>
  (format <span style="color: #8B887D; font-style: italic;">" %s "</span> (format-mode-line mode-name)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/modeline-create-bar-image</span> (face width height)
  <span style="color: #96a7a9; font-weight: bold;">"Create the bar image.</span>
<span style="color: #96a7a9; font-weight: bold;">Use FACE1 for the bar, FACE2 for the background.</span>
<span style="color: #96a7a9; font-weight: bold;">WIDTH and HEIGHT are the image size in pixels."</span>
  (<span style="color: #737063; font-weight: bold;">when</span> (<span style="color: #737063; font-weight: bold;">and</span> (display-graphic-p)
             (image-type-available-p 'pbm))
    (propertize
     <span style="color: #8B887D; font-style: italic;">" "</span> 'display
     (<span style="color: #737063; font-weight: bold;">let</span> ((color (<span style="color: #737063; font-weight: bold;">or</span> (face-background face nil t) <span style="color: #8B887D; font-style: italic;">"None"</span>)))
       (<span style="color: #737063; font-weight: bold;">ignore-errors</span>
         (create-image
          (concat (format <span style="color: #8B887D; font-style: italic;">"P1\n%i %i\n"</span> width height)
                  (make-string (* width height) ?1)
                  <span style="color: #8B887D; font-style: italic;">"\n"</span>)
          'pbm t <span style="color: #403D2E; font-style: italic;">:foreground</span> color <span style="color: #403D2E; font-style: italic;">:ascent</span> 'center))))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/modeline-segment-bar</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"The bar, also determines modeline height (in GUI)."</span>
  (<span style="color: #737063; font-weight: bold;">let</span> ((width aero/modeline-bar-width)
        (height aero/modeline-height))
    (<span style="color: #737063; font-weight: bold;">if</span> (aero/modeline--active-p)
        (aero/modeline-create-bar-image 'aero/modeline-bar width height)
      (aero/modeline-create-bar-image 'aero/modeline-bar-inactive width height))))

&#12;
<span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Activation function</span>

<span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;;;</span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">###</span><span style="color: #d7af00; background-color: #ecf3ec; font-weight: bold; font-style: italic;">autoload</span>
(<span style="color: #737063; font-weight: bold;">define-minor-mode</span> <span style="color: #83684C; font-weight: bold;">aero/modeline-mode</span>
  <span style="color: #96a7a9; font-weight: bold;">"Toggle aero/modeline on or off."</span>
  <span style="color: #403D2E; font-style: italic;">:group</span> 'aero/modeline
  <span style="color: #403D2E; font-style: italic;">:global</span> t
  <span style="color: #403D2E; font-style: italic;">:lighter</span> nil
  (<span style="color: #737063; font-weight: bold;">progn</span>
    <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Set the new mode-line-format</span>
    (<span style="color: #737063; font-weight: bold;">setq-default</span> mode-line-format
                  '((<span style="color: #403D2E; font-style: italic;">:eval</span>
                     (aero-info-line-format
                      <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Left</span>
                      (format-mode-line
                       '((<span style="color: #403D2E; font-style: italic;">:eval</span> (aero/modeline-segment-bar))
                         (<span style="color: #403D2E; font-style: italic;">:eval</span> (aero/modeline-segment-evil-state))
                         <span style="color: #8B887D; font-style: italic;">" "</span> (<span style="color: #403D2E; font-style: italic;">:eval</span> (aero/modeline-segment-modified)) <span style="color: #8B887D; font-style: italic;">" "</span>
                         (<span style="color: #403D2E; font-style: italic;">:eval</span> (aero/modeline-segment-buffer-name))
                         (<span style="color: #403D2E; font-style: italic;">:eval</span> (aero/modeline-segment-size-and-position))))

                      <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Right</span>
                      (format-mode-line
                       '((<span style="color: #403D2E; font-style: italic;">:eval</span> (aero/modeline-segment-process))
                         (<span style="color: #403D2E; font-style: italic;">:eval</span> (aero/modeline-segment-lsp))
                         (<span style="color: #403D2E; font-style: italic;">:eval</span> (aero/modeline-segment-flymake))
                         (<span style="color: #403D2E; font-style: italic;">:eval</span> (aero/modeline-segment-git-state))
                         (<span style="color: #403D2E; font-style: italic;">:eval</span> (aero/modeline-segment-remote))
                         (<span style="color: #403D2E; font-style: italic;">:eval</span> (aero/modeline-segment-major-mode))))))))))

(<span style="color: #737063; font-weight: bold;">define-globalized-minor-mode</span> <span style="color: #83684C; font-weight: bold;">aero/modeline-global-mode</span> aero/modeline-mode
  (<span style="color: #737063; font-weight: bold;">lambda</span> () (aero/modeline-mode 1)))

(<span style="color: #737063; font-weight: bold;">define-minor-mode</span> <span style="color: #83684C; font-weight: bold;">aero/modeline-hide-mode</span>
  <span style="color: #96a7a9; font-weight: bold;">"Minor mode to hide the mode-line in the current buffer."</span>
  <span style="color: #403D2E; font-style: italic;">:init-value</span> nil
  <span style="color: #403D2E; font-style: italic;">:global</span> nil
  (<span style="color: #737063; font-weight: bold;">if</span> aero/modeline-hide-mode
      (<span style="color: #737063; font-weight: bold;">progn</span>
        (add-hook 'after-change-major-mode-hook #'aero/modeline-hide-mode nil t)
        (<span style="color: #737063; font-weight: bold;">unless</span> aero/modeline-hide--old-format
          (<span style="color: #737063; font-weight: bold;">setq</span> aero/modeline-hide--old-format mode-line-format))
        (<span style="color: #737063; font-weight: bold;">setq</span> mode-line-format nil))
    (remove-hook 'after-change-major-mode-hook #'aero/modeline-hide-mode t)
    (<span style="color: #737063; font-weight: bold;">setq</span> mode-line-format aero/modeline-hide--old-format
          aero/modeline-hide--old-format nil))
  (<span style="color: #737063; font-weight: bold;">when</span> (called-interactively-p 'any)
    (redraw-display)))
</pre>
</div>

<p>
And now we actually turn it on everywhere. Except we hide it in eshell for a more sleek interface.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(aero/modeline-global-mode +1)
(add-hook 'eshell-mode-hook 'aero/modeline-hide-mode)
</pre>
</div>
</div>
</div>
<div id="outline-container-org5b42013" class="outline-3">
<h3 id="org5b42013">Theme (Aero theme)</h3>
<div class="outline-text-3" id="text-org5b42013">
<p>
My custom theme, stored as a submodule. Also sets the font.
</p>

<p>
Sets the font-height to 140 only for Mac, it seems to scale normally by default in Linux.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! aero-theme <span style="color: #403D2E; font-style: italic;">:local</span> <span style="color: #403D2E; font-style: italic;">:load-path</span> <span style="color: #8B887D; font-style: italic;">"lib/aero-theme"</span>
  <span style="color: #403D2E; font-style: italic;">:init</span>
  (<span style="color: #737063; font-weight: bold;">when</span> (system-is-mac)
    (<span style="color: #737063; font-weight: bold;">setq</span> aero-theme-font-height 140))
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (<span style="color: #737063; font-weight: bold;">setq</span> aero-theme-font <span style="color: #8B887D; font-style: italic;">"JetBrains Mono"</span>)
  (load-theme 'aero t))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc1531b7" class="outline-3">
<h3 id="orgc1531b7">Default frame setup</h3>
<div class="outline-text-3" id="text-orgc1531b7">
<p>
Set up the default frame in an agreeable fashion. The width is based on a buffer that's 106 columns wide, in two columns. The rest has been tweaked over the years to look extra nice on startup.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">setq</span> default-frame-alist
      (append (list '(width  . 212) '(height . 62)
                    '(tool-bar-lines . 0)
                    '(menu-bar-lines . 0)
                    '(internal-border-width . 8)
                    '(left-fringe . 8) '(right-fringe . 8)
                    '(vertical-scroll-bars . nil)
                    '(ns-transparent-titlebar . t))))
(split-window-horizontally)
(<span style="color: #737063; font-weight: bold;">if</span> (fboundp 'fringe-mode) (fringe-mode '8))
(set-frame-parameter (selected-frame) 'internal-border-width 8)
(<span style="color: #737063; font-weight: bold;">when</span> (fboundp 'pixel-scroll-precision-mode)
  (pixel-scroll-precision-mode +1))

(<span style="color: #737063; font-weight: bold;">setq</span> window-divider-default-right-width 1
      window-divider-default-bottom-width 1
      window-divider-default-places 'right-only
      window-divider-mode t)
</pre>
</div>

<p>
Set up window margins
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'window-configuration-change-hook
          (<span style="color: #737063; font-weight: bold;">lambda</span> ()
            (set-window-margins
             (car (get-buffer-window-list (current-buffer) nil t)) 1 1)))
</pre>
</div>

<p>
Make sure new frames use window-divider
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'before-make-frame-hook 'window-divider-mode)
</pre>
</div>
</div>
</div>
<div id="outline-container-org4f9eb48" class="outline-3">
<h3 id="org4f9eb48">General UI</h3>
<div class="outline-text-3" id="text-org4f9eb48">
<p>
Better fringe symbols
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">when</span> (<span style="color: #737063; font-weight: bold;">and</span> (<span style="color: #737063; font-weight: bold;">require</span> '<span style="color: #655370; font-weight: bold;">disp-table</span> nil 'noerror) standard-display-table)
  (set-display-table-slot standard-display-table 'truncation ?&#8230;)
  (set-display-table-slot standard-display-table 'wrap ?&#8617;)
  (set-display-table-slot standard-display-table 'selective-display
                          (string-to-vector <span style="color: #8B887D; font-style: italic;">" &#8230;"</span>)))
</pre>
</div>

<p>
Stop cursor blinking, highlight matching parens, smooth scrolling, and highlight the current line.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(blink-cursor-mode 0)
(show-paren-mode 1)
(pixel-scroll-mode 1)
(global-hl-line-mode +1)

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/suggest-other-faces</span> (func <span style="color: #387780; font-style: italic;">&amp;rest</span> args)
  <span style="color: #96a7a9; font-weight: bold;">"When hl-line-mode is active, suggest a face calculated without it.</span>
<span style="color: #96a7a9; font-weight: bold;">   Credit: Sacha Chua"</span>
  (<span style="color: #737063; font-weight: bold;">if</span> global-hl-line-mode
      (<span style="color: #737063; font-weight: bold;">progn</span>
        (global-hl-line-mode -1)
        (<span style="color: #737063; font-weight: bold;">prog1</span> (apply func args)
          (global-hl-line-mode 1)))
    (apply func args)))
(advice-add #'face-at-point <span style="color: #403D2E; font-style: italic;">:around</span> #'aero/suggest-other-faces)
</pre>
</div>

<p>
Simple rainbow mode to highlight hex colors in code.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/rainbow-mode</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Display colors represented as hex values."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (remove-overlays (point-min) (point-max))
  (<span style="color: #737063; font-weight: bold;">let</span> ((hex-color-regex <span style="color: #8B887D; font-style: italic;">"#[0-9a-fA-F]\\{3,6\\}"</span>))
    (<span style="color: #737063; font-weight: bold;">save-excursion</span>
      (goto-char (point-min))
      (<span style="color: #737063; font-weight: bold;">while</span> (re-search-forward hex-color-regex nil t)
        (<span style="color: #737063; font-weight: bold;">let*</span> ((color (match-string 0))
               (overlay (make-overlay (match-beginning 0) (match-end 0))))
          (<span style="color: #737063; font-weight: bold;">if</span> (string-greaterp color <span style="color: #8B887D; font-style: italic;">"#888888"</span>)
              (overlay-put overlay 'face `(<span style="color: #403D2E; font-style: italic;">:background</span> ,color <span style="color: #403D2E; font-style: italic;">:foreground</span> <span style="color: #8B887D; font-style: italic;">"black"</span>))
            (overlay-put overlay 'face `(<span style="color: #403D2E; font-style: italic;">:background</span> ,color <span style="color: #403D2E; font-style: italic;">:foreground</span> <span style="color: #8B887D; font-style: italic;">"white"</span>))))))))
(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/rainbow-mode-disable</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Remove all hex color overlays in the current buffer."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (remove-overlays (point-min) (point-max)))
(add-hook 'prog-mode-hook #'aero/rainbow-mode)
(add-hook 'org-mode-hook #'aero/rainbow-mode)
(add-hook 'conf-space-mode-hook #'aero/rainbow-mode)
</pre>
</div>

<p>
Makes links in comments clickable
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-goto-address-mode +1)
</pre>
</div>

<p>
Pulse the current line when changing windows. There's whole packages that do this functionality and more, but I only care about switching windows, so there's no need to pull in a whole package.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">dolist</span> (fn '(other-window
              windmove-up
              windmove-down
              windmove-left
              windmove-right
              aero/alternate-buffer
              aero/alternate-window))
  (advice-add fn <span style="color: #403D2E; font-style: italic;">:after</span> #'pulse-line))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb3eacfa" class="outline-3">
<h3 id="orgb3eacfa">Good scroll</h3>
<div class="outline-text-3" id="text-orgb3eacfa">
<p>
Improved pixel-based smooth scrolling. Mostly used when screen sharing, doesn't really do much for normal navigation.
</p>

<p>
Setting <code>good-scroll-avoid-vscroll-reset</code> to nil avoids a bug with evil-mode. <a href="https://github.com/io12/good-scroll.el/issues/16">https://github.com/io12/good-scroll.el/issues/16</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! good-scroll <span style="color: #8B887D; font-style: italic;">"io12/good-scroll.el"</span>
  <span style="color: #403D2E; font-style: italic;">:functions</span> (good-scroll-mode)
  <span style="color: #403D2E; font-style: italic;">:init</span> (<span style="color: #737063; font-weight: bold;">setq</span> good-scroll-avoid-vscroll-reset nil)
  <span style="color: #403D2E; font-style: italic;">:config</span> (good-scroll-mode +1))
</pre>
</div>
</div>
</div>
<div id="outline-container-org935425d" class="outline-3">
<h3 id="org935425d">Formfeeder</h3>
<div class="outline-text-3" id="text-org935425d">
<p>
Displays formfeed characters, which are often used by convention in Elisp
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! formfeeder <span style="color: #8B887D; font-style: italic;">"thornjad/formfeeder"</span>
  <span style="color: #403D2E; font-style: italic;">:defines</span> (formfeeder-line-width)
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (<span style="color: #737063; font-weight: bold;">setq</span> formfeeder-line-width (- fill-column 1))
  (<span style="color: #737063; font-weight: bold;">declare-function</span> global-formfeeder-mode <span style="color: #8B887D; font-style: italic;">"formfeeder.el"</span>)
  (global-formfeeder-mode 1))
</pre>
</div>
</div>
</div>
<div id="outline-container-org3985aad" class="outline-3">
<h3 id="org3985aad">Highlight-thing</h3>
<div class="outline-text-3" id="text-org3985aad">
<p>
Highlight the current thing at point, kind of like what lsp-ui does for some language, but in all buffers and modes.
</p>

<p>
We set <code>highlight-thing-limit-to-region-in-large-buffers</code> so that in large buffers, only look at nearby lines
</p>


<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! highlight-thing (<span style="color: #403D2E; font-style: italic;">:host</span> github <span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"fgeller/highlight-thing.el"</span>)
  <span style="color: #403D2E; font-style: italic;">:hook</span> (prog-mode . highlight-thing-mode)
  <span style="color: #403D2E; font-style: italic;">:commands</span> (highlight-thing-mode)
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (highlight-thing-delay-seconds 0.5)
  (highlight-thing-narrow-region-lines 70)
  (highlight-thing-large-buffer-limit 5000)
  (highlight-thing-limit-to-region-in-large-buffers-p t))
</pre>
</div>
</div>
</div>
<div id="outline-container-org3630000" class="outline-3">
<h3 id="org3630000">Selection highlight</h3>
<div class="outline-text-3" id="text-org3630000">
<p>
Shows all matching selections from region. Very useful for comparing and editing multiple instances of the same thing.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! selection-highlight-mode
  (<span style="color: #403D2E; font-style: italic;">:host</span> github <span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"balloneij/selection-highlight-mode"</span>)
  <span style="color: #403D2E; font-style: italic;">:hook</span> (prog-mode . selection-highlight-mode)
  <span style="color: #403D2E; font-style: italic;">:custom</span> (selection-highlight-mode-min-length 3))
</pre>
</div>
</div>
</div>
<div id="outline-container-org9df4139" class="outline-3">
<h3 id="org9df4139">Todo-light</h3>
<div class="outline-text-3" id="text-org9df4139">
<p>
Highlight todo and similar words
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! todo-light <span style="color: #8B887D; font-style: italic;">"thornjad/todo-light"</span>
  <span style="color: #403D2E; font-style: italic;">:init</span> (global-todo-light-mode +1))
</pre>
</div>
</div>
</div>
<div id="outline-container-org3c166bb" class="outline-3">
<h3 id="org3c166bb">Evil-terminal-cursor-changer</h3>
<div class="outline-text-3" id="text-org3c166bb">
<p>
Doesn't do anything for GUI, so don't bother. In TUI, use a line when in insert mode
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">unless</span> (display-graphic-p)
  (package! evil-terminal-cursor-changer
    (<span style="color: #403D2E; font-style: italic;">:host</span> github <span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"7696122/evil-terminal-cursor-changer"</span>)
    <span style="color: #403D2E; font-style: italic;">:after</span> evil
    <span style="color: #403D2E; font-style: italic;">:functions</span> (evil-terminal-cursor-changer-activate)
    <span style="color: #403D2E; font-style: italic;">:config</span> (evil-terminal-cursor-changer-activate)))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org90814de" class="outline-2">
<h2 id="org90814de">Breadcrumbs in the headerline</h2>
<div class="outline-text-2" id="text-org90814de">
<p>
Shows breadcrumbs in the headerline for many modes, showing the "trail" that the current point sits in, such as the hierarchy of headers in org-mode or the class and method in object-oriented languages.
</p>

<p>
Breadcrumbs are disabled for gptel since it uses its own system.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">cl-defun</span> <span style="color: #83684C; font-weight: bold;">aero-breadcrumb--bisect</span> (a x <span style="color: #387780; font-style: italic;">&amp;key</span> (from 0) (to (length a)) key from-end)
  <span style="color: #96a7a9; font-weight: bold;">"Compute index to insert X in sequence A, keeping it sorted.</span>
<span style="color: #96a7a9; font-weight: bold;">If X already in A, the resulting index is the leftmost such</span>
<span style="color: #96a7a9; font-weight: bold;">index, unless FROM-END is t.  KEY is as usual in other CL land."</span>
  (<span style="color: #737063; font-weight: bold;">cl-macrolet</span> ((search (from-end key)
                        `(<span style="color: #737063; font-weight: bold;">cl-loop</span> while (&lt; from to)
                                  for mid = (/ (+ from to) 2)
                                  for p1 = (elt a mid)
                                  for p2 = ,(<span style="color: #737063; font-weight: bold;">if</span> key `(funcall key p1) `p1)
                                  if (,(<span style="color: #737063; font-weight: bold;">if</span> from-end '&lt; '&lt;=) x p2)
                                  do (<span style="color: #737063; font-weight: bold;">setq</span> to mid) else do (<span style="color: #737063; font-weight: bold;">setq</span> from (1+ mid))
                                  finally return from)))
    (<span style="color: #737063; font-weight: bold;">if</span> from-end (<span style="color: #737063; font-weight: bold;">if</span> key (search t key) (search t nil))
      (<span style="color: #737063; font-weight: bold;">if</span> key (search nil key) (search nil nil)))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero-breadcrumb--ipath-rich</span> (index-alist pos)
  <span style="color: #96a7a9; font-weight: bold;">"Compute ipath for rich `</span><span style="color: #655370; font-weight: bold;">imenu--index-alist</span><span style="color: #96a7a9; font-weight: bold;">' structures.</span>
<span style="color: #96a7a9; font-weight: bold;">These structures have a `</span><span style="color: #655370; font-weight: bold;">aero-breadcrumb-region</span><span style="color: #96a7a9; font-weight: bold;">' property on every</span>
<span style="color: #96a7a9; font-weight: bold;">node."</span>
  (<span style="color: #737063; font-weight: bold;">cl-labels</span>
      ((search (nodes <span style="color: #387780; font-style: italic;">&amp;optional</span> ipath)
               (<span style="color: #737063; font-weight: bold;">cl-loop</span>
                for n in nodes
                for reg = (get-text-property 0 'aero-breadcrumb-region (car n))
                when (&lt;= (car reg) pos (cdr reg))
                return (search (cdr n) (cons
                                        (propertize (car n)
                                                    'aero-breadcrumb-siblings nodes
                                                    'aero-breadcrumb-parent (car ipath))
                                        ipath))
                finally (<span style="color: #737063; font-weight: bold;">cl-return</span> ipath))))
    (nreverse (search index-alist))))

(<span style="color: #737063; font-weight: bold;">defvar-local</span> <span style="color: #5C7B52;">aero-breadcrumb--ipath-plain-cache</span> nil
  <span style="color: #96a7a9; font-weight: bold;">"A cache for `</span><span style="color: #655370; font-weight: bold;">aero-breadcrumb--ipath-plain</span><span style="color: #96a7a9; font-weight: bold;">'."</span>)

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero-breadcrumb--ipath-plain</span> (index-alist pos)
  <span style="color: #96a7a9; font-weight: bold;">"Compute ipath for plain `</span><span style="color: #655370; font-weight: bold;">imenu--index-alist</span><span style="color: #96a7a9; font-weight: bold;">' structures.</span>
<span style="color: #96a7a9; font-weight: bold;">These structures don't have a `</span><span style="color: #655370; font-weight: bold;">aero-breadcrumb-region</span><span style="color: #96a7a9; font-weight: bold;">' property on."</span>
  (<span style="color: #737063; font-weight: bold;">cl-labels</span> ((dfs (n <span style="color: #387780; font-style: italic;">&amp;optional</span> ipath siblings)
                   (<span style="color: #737063; font-weight: bold;">setq</span> ipath (cons (car n) ipath))
                   (<span style="color: #737063; font-weight: bold;">if</span> (consp (cdr n))
                       (mapc (<span style="color: #737063; font-weight: bold;">lambda</span> (n2) (dfs n2 ipath (cdr n))) (cdr n))
                     (put-text-property 0 1 'aero-breadcrumb-siblings (cdr siblings) (car ipath))
                     (<span style="color: #737063; font-weight: bold;">setq</span> aero-breadcrumb--ipath-plain-cache
                           (vconcat aero-breadcrumb--ipath-plain-cache
                                    `[,(cons
                                        (<span style="color: #737063; font-weight: bold;">cl-etypecase</span> (cdr n)
                                          (number (cdr n))
                                          (marker (+ (cdr n) 0))
                                          (overlay (overlay-start (cdr n))))
                                        ipath)])))))
    (<span style="color: #737063; font-weight: bold;">unless</span> aero-breadcrumb--ipath-plain-cache
      (mapc (<span style="color: #737063; font-weight: bold;">lambda</span> (i) (dfs i nil index-alist)) index-alist)
      (<span style="color: #737063; font-weight: bold;">setq</span> aero-breadcrumb--ipath-plain-cache (cl-sort aero-breadcrumb--ipath-plain-cache #'&lt; <span style="color: #403D2E; font-style: italic;">:key</span> #'car)))
    (<span style="color: #737063; font-weight: bold;">unless</span> (&lt; pos (car (aref aero-breadcrumb--ipath-plain-cache 0)))
      (<span style="color: #737063; font-weight: bold;">let</span> ((res (aero-breadcrumb--bisect aero-breadcrumb--ipath-plain-cache pos <span style="color: #403D2E; font-style: italic;">:key</span> #'car <span style="color: #403D2E; font-style: italic;">:from-end</span> t)))
        (<span style="color: #737063; font-weight: bold;">unless</span> (zerop res) (reverse (cdr (elt aero-breadcrumb--ipath-plain-cache (1- res)))))))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero-breadcrumb-ipath</span> (index-alist pos)
  <span style="color: #96a7a9; font-weight: bold;">"Get aero-breadcrumb for position POS given INDEX-ALIST."</span>
  (<span style="color: #737063; font-weight: bold;">if</span> (get-text-property 0 'aero-breadcrumb-region (caar index-alist))
      (aero-breadcrumb--ipath-rich index-alist pos)
    (aero-breadcrumb--ipath-plain index-alist pos)))

(<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">aero-breadcrumb-idle-time</span> 1
  <span style="color: #96a7a9; font-weight: bold;">"Control idle time before requesting new aero-breadcrumbs."</span>)

(<span style="color: #737063; font-weight: bold;">defvar-local</span> <span style="color: #5C7B52;">aero-breadcrumb--idle-timer</span> nil
  <span style="color: #96a7a9; font-weight: bold;">"Timer used by `</span><span style="color: #655370; font-weight: bold;">aero-breadcrumb--ipath-alist</span><span style="color: #96a7a9; font-weight: bold;">'."</span>)

(<span style="color: #737063; font-weight: bold;">defvar-local</span> <span style="color: #5C7B52;">aero-breadcrumb--last-update-tick</span> 0
  <span style="color: #96a7a9; font-weight: bold;">"Last time `</span><span style="color: #655370; font-weight: bold;">aero-breadcrumb--ipath-alist</span><span style="color: #96a7a9; font-weight: bold;">' asked for an update."</span>)

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero-breadcrumb--ipath-alist</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Return `</span><span style="color: #655370; font-weight: bold;">imenu--index-alist</span><span style="color: #96a7a9; font-weight: bold;">', maybe arrange for its update."</span>
  (<span style="color: #737063; font-weight: bold;">let</span> ((nochangep (= (buffer-chars-modified-tick) aero-breadcrumb--last-update-tick))
        (buf (current-buffer)))
    (<span style="color: #737063; font-weight: bold;">unless</span> nochangep
      (<span style="color: #737063; font-weight: bold;">setq</span> aero-breadcrumb--last-update-tick (buffer-chars-modified-tick))
      (<span style="color: #737063; font-weight: bold;">when</span> aero-breadcrumb--idle-timer (cancel-timer aero-breadcrumb--idle-timer))
      (<span style="color: #737063; font-weight: bold;">setq</span> aero-breadcrumb--idle-timer
            (run-with-idle-timer
             aero-breadcrumb-idle-time nil
             (<span style="color: #737063; font-weight: bold;">lambda</span> ()
               (<span style="color: #737063; font-weight: bold;">when</span> (buffer-live-p buf)
                 (<span style="color: #737063; font-weight: bold;">with-current-buffer</span> buf
                   (<span style="color: #737063; font-weight: bold;">setq</span> aero-breadcrumb--last-update-tick (buffer-chars-modified-tick))
                   (<span style="color: #737063; font-weight: bold;">let</span> ((non-essential t)
                         (imenu-auto-rescan t))
                     (<span style="color: #737063; font-weight: bold;">ignore-errors</span>
                       (imenu--make-index-alist t))
                     (<span style="color: #737063; font-weight: bold;">setq</span> aero-breadcrumb--ipath-plain-cache nil)
                     <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">no point is taxing the mode-line machinery now</span>
                     <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">if the buffer isn't showing anywhere.</span>
                     (<span style="color: #737063; font-weight: bold;">when</span> (get-buffer-window buf t)
                       (force-mode-line-update t)))))))))
    imenu--index-alist))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero-breadcrumb--length</span> (len)
  <span style="color: #96a7a9; font-weight: bold;">"Interpret LEN using `</span><span style="color: #655370; font-weight: bold;">window-width</span><span style="color: #96a7a9; font-weight: bold;">' and return a number."</span>
  (<span style="color: #737063; font-weight: bold;">cond</span> ((floatp len) (* (window-width) len))
        (t len)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero-breadcrumb--format-ipath-node</span> (p more)
  (propertize p 'face (<span style="color: #737063; font-weight: bold;">if</span> more
                          '(<span style="color: #403D2E; font-style: italic;">:inherit</span> shadow)
                        '(<span style="color: #403D2E; font-style: italic;">:inherit</span> (font-lock-function-name-face shadow)))
              'aero-breadcrumb-dont-shorten (null more)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero-breadcrumb-crumbs</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Describe point inside the Imenu tree of current file."</span>
  (<span style="color: #737063; font-weight: bold;">when-let</span> ((alist (aero-breadcrumb--ipath-alist)))
    (<span style="color: #737063; font-weight: bold;">when</span> (cl-some #'identity alist)
      (aero-breadcrumb--summarize
       (<span style="color: #737063; font-weight: bold;">cl-loop</span>
        for (p . more) on (aero-breadcrumb-ipath alist (point))
        collect (aero-breadcrumb--format-ipath-node p more))
       (aero-breadcrumb--length 0.98)
       (propertize <span style="color: #8B887D; font-style: italic;">" &gt; "</span> 'face '(<span style="color: #403D2E; font-style: italic;">:inherit</span> shadow))))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero-breadcrumb--summarize</span> (crumbs cutoff separator)
  <span style="color: #96a7a9; font-weight: bold;">"Return a string that summarizes CRUMBS, a list of strings.</span>
<span style="color: #96a7a9; font-weight: bold;">\"Summarization\" consists of truncating some CRUMBS to 1</span>
<span style="color: #96a7a9; font-weight: bold;">character.  Rightmost members of CRUMBS are summarized last.</span>
<span style="color: #96a7a9; font-weight: bold;">Members with a `</span><span style="color: #655370; font-weight: bold;">aero-breadcrumb-dont-shorten</span><span style="color: #96a7a9; font-weight: bold;">' are never truncated.</span>
<span style="color: #96a7a9; font-weight: bold;">Aim for a return string that is at most CUTOFF characters long.</span>
<span style="color: #96a7a9; font-weight: bold;">Join the crumbs with SEPARATOR."</span>
  (<span style="color: #737063; font-weight: bold;">let</span> ((rcrumbs
         (<span style="color: #737063; font-weight: bold;">cl-loop</span>
          for available = (- cutoff used)
          for (c . more) on (reverse crumbs)
          for seplen = (<span style="color: #737063; font-weight: bold;">if</span> more (length separator) 0)
          for shorten-p = (<span style="color: #737063; font-weight: bold;">unless</span> (get-text-property 0 'aero-breadcrumb-dont-shorten c)
                            (&gt; (+ (length c) seplen) available))
          for toadd = (<span style="color: #737063; font-weight: bold;">if</span> shorten-p (substring c 0 1) c)
          sum (+ (length toadd) seplen) into used
          collect toadd)))
    (string-join (reverse rcrumbs) separator)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero-breadcrumb--header-line</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Helper for `</span><span style="color: #655370; font-weight: bold;">aero-breadcrumb-headerline-mode</span><span style="color: #96a7a9; font-weight: bold;">'."</span>
  (<span style="color: #737063; font-weight: bold;">let</span> ((x (cl-remove-if #'seq-empty-p (mapcar #'funcall '(aero-breadcrumb-crumbs)))))
    (mapconcat #'identity x (propertize <span style="color: #8B887D; font-style: italic;">" : "</span> 'face '(<span style="color: #403D2E; font-style: italic;">:inherit</span> shadow)))))

(<span style="color: #737063; font-weight: bold;">define-minor-mode</span> <span style="color: #83684C; font-weight: bold;">aero-breadcrumb-local-mode</span>
  <span style="color: #96a7a9; font-weight: bold;">"Header lines with aero-breadcrumbs."</span>
  <span style="color: #403D2E; font-style: italic;">:init-value</span> nil
  (<span style="color: #737063; font-weight: bold;">if</span> aero-breadcrumb-local-mode

      (<span style="color: #737063; font-weight: bold;">setq</span> header-line-format (delete
                                '(<span style="color: #403D2E; font-style: italic;">:eval</span> (aero-breadcrumb--header-line))
                                header-line-format))))
</pre>
</div>

<p>
Now we set up the hooks, but also disable for gptel (which uses markdown-mode in this config).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'prog-mode-hook #'aero-breadcrumb-local-mode)
(add-hook 'markdown-mode-hook #'aero-breadcrumb-local-mode)
(add-hook 'gfm-mode-hook #'aero-breadcrumb-local-mode)
(add-hook 'org-mode-hook #'aero-breadcrumb-local-mode)

(<span style="color: #737063; font-weight: bold;">with-eval-after-load</span> 'gptel
  (add-hook 'gptel-mode-hook (<span style="color: #737063; font-weight: bold;">lambda</span> () (aero-breadcrumb-local-mode -1))))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgefeaef7" class="outline-2">
<h2 id="orgefeaef7">Project management</h2>
<div class="outline-text-2" id="text-orgefeaef7">
<p>
Nearly all my code is organized within projects, and navigated using this built-in package.
</p>

<p>
Note that we can't use <code>:hook</code> for the <code>project-find-functions</code> because <code>project-find-functions</code> doesn't end in "-hook", and we can't use this in <code>:init</code> because it won't be defined yet.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! project <span style="color: #403D2E; font-style: italic;">:builtin</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (general)

  <span style="color: #403D2E; font-style: italic;">:preface</span>
  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/project-root-override</span> (dir)
    <span style="color: #96a7a9; font-weight: bold;">"Find DIR's project root by searching for a '</span><span style="color: #655370; font-weight: bold;">.project.el</span><span style="color: #96a7a9; font-weight: bold;">' file.</span>

<span style="color: #96a7a9; font-weight: bold;">If this file exists, it marks the project root. For convenient compatibility with Projectile, '</span><span style="color: #655370; font-weight: bold;">.projectile</span><span style="color: #96a7a9; font-weight: bold;">' is also considered a project root marker.</span>

<span style="color: #96a7a9; font-weight: bold;">https://jmthornton.net/blog/p/emacs-project-override"</span>
    (<span style="color: #737063; font-weight: bold;">let</span> ((root (<span style="color: #737063; font-weight: bold;">or</span> (locate-dominating-file dir <span style="color: #8B887D; font-style: italic;">".project.el"</span>)
                    (locate-dominating-file dir <span style="color: #8B887D; font-style: italic;">".projectile"</span>)))
          (backend (<span style="color: #737063; font-weight: bold;">ignore-errors</span> (vc-responsible-backend dir))))
      (<span style="color: #737063; font-weight: bold;">when</span> root (<span style="color: #737063; font-weight: bold;">if</span> (version&lt;= emacs-version <span style="color: #8B887D; font-style: italic;">"28"</span>)
                     (cons 'vc root)
                   (list 'vc backend root)))))

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/project-switch-magit</span> ()
    <span style="color: #96a7a9; font-weight: bold;">"Call magit-status on the project being switched to."</span>
    (<span style="color: #737063; font-weight: bold;">interactive</span>)
    (magit-status project-current-directory-override))

  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (project-vc-ignores '(<span style="color: #8B887D; font-style: italic;">"node_modules/"</span> <span style="color: #8B887D; font-style: italic;">"straight/"</span> <span style="color: #8B887D; font-style: italic;">"target/"</span>)) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">globally ignored</span>
  (project-vc-extra-root-markers '(<span style="color: #8B887D; font-style: italic;">".project.el"</span> <span style="color: #8B887D; font-style: italic;">".projectile"</span> <span style="color: #8B887D; font-style: italic;">".git"</span>))
  (project-compilation-buffer-name-function #'project-prefixed-buffer-name)

  <span style="color: #403D2E; font-style: italic;">:config</span>
  (add-hook 'project-find-functions #'aero/project-root-override)
  (<span style="color: #737063; font-weight: bold;">setq</span> project-switch-commands '((project-find-file <span style="color: #8B887D; font-style: italic;">"Find file"</span> <span style="color: #8B887D; font-style: italic;">"f"</span>)
                                  (aero/project-switch-magit <span style="color: #8B887D; font-style: italic;">"Magit status"</span> <span style="color: #8B887D; font-style: italic;">"g"</span>)
                                  (project-eshell <span style="color: #8B887D; font-style: italic;">"Eshell"</span> <span style="color: #8B887D; font-style: italic;">"e"</span>)
                                  (project-compile <span style="color: #8B887D; font-style: italic;">"Compile"</span> <span style="color: #8B887D; font-style: italic;">"c"</span>)
                                  (project-find-dir <span style="color: #8B887D; font-style: italic;">"Find directory"</span> <span style="color: #8B887D; font-style: italic;">"d"</span>)
                                  (project-find-regexp <span style="color: #8B887D; font-style: italic;">"Find regexp"</span> <span style="color: #8B887D; font-style: italic;">"r"</span>)
                                  (project-any-command <span style="color: #8B887D; font-style: italic;">"Any command"</span> <span style="color: #8B887D; font-style: italic;">"a"</span>)))

  (aero-leader-def
    <span style="color: #8B887D; font-style: italic;">"pf"</span> 'project-find-file
    <span style="color: #8B887D; font-style: italic;">"pp"</span> 'project-switch-project
    <span style="color: #8B887D; font-style: italic;">"p:"</span> 'project-shell-command
    <span style="color: #8B887D; font-style: italic;">"p&amp;"</span> 'project-async-shell-command
    <span style="color: #8B887D; font-style: italic;">"p'"</span> 'project-eshell
    <span style="color: #8B887D; font-style: italic;">"p\""</span> 'aero/project-eshell-new
    <span style="color: #8B887D; font-style: italic;">"p`"</span> 'project-shell
    <span style="color: #8B887D; font-style: italic;">"p%"</span> 'project-query-replace-regexp
    <span style="color: #8B887D; font-style: italic;">"cp"</span> 'project-compile))
</pre>
</div>
</div>
</div>
<div id="outline-container-org96d9f7a" class="outline-2">
<h2 id="org96d9f7a">Magit</h2>
<div class="outline-text-2" id="text-org96d9f7a">
<p>
One of the truly great packages in Emacs. I use it for everything git-related.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! magit <span style="color: #403D2E; font-style: italic;">:auto</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (general)
  <span style="color: #403D2E; font-style: italic;">:commands</span> (magit-blame
             magit-commit
             magit-diff-unstaged
             magit-init
             magit-stage-file
             magit-status
             magit-unstage-file
             magit-blame-mode)
  <span style="color: #403D2E; font-style: italic;">:init</span>
  (aero-leader-def
    <span style="color: #8B887D; font-style: italic;">"gs"</span> 'magit-status
    <span style="color: #8B887D; font-style: italic;">"gb"</span> 'magit-blame
    <span style="color: #8B887D; font-style: italic;">"gl"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:which-key</span> <span style="color: #8B887D; font-style: italic;">"log"</span>)
    <span style="color: #8B887D; font-style: italic;">"glb"</span> 'magit-log-buffer-file
    <span style="color: #8B887D; font-style: italic;">"gld"</span> 'magit-log-trace-definition
    <span style="color: #8B887D; font-style: italic;">"gll"</span> 'magit-log-head
    <span style="color: #8B887D; font-style: italic;">"gfS"</span> 'magit-stage-file
    <span style="color: #8B887D; font-style: italic;">"gfU"</span> 'magit-unstage-file
    <span style="color: #8B887D; font-style: italic;">"gm"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:which-key</span> <span style="color: #8B887D; font-style: italic;">"smerge"</span>)
    <span style="color: #8B887D; font-style: italic;">"gmm"</span> 'smerge-start-session
    <span style="color: #8B887D; font-style: italic;">"gmu"</span> 'smerge-keep-upper
    <span style="color: #8B887D; font-style: italic;">"gml"</span> 'smerge-keep-lower
    <span style="color: #8B887D; font-style: italic;">"gmn"</span> 'smerge-next
    <span style="color: #8B887D; font-style: italic;">"gmp"</span> 'smerge-prev
    <span style="color: #8B887D; font-style: italic;">"gma"</span> 'smerge-keep-all
    <span style="color: #8B887D; font-style: italic;">"gmE"</span> 'smerge-ediff)

  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (magit-display-buffer-function #'magit-display-buffer-same-window-except-diff-v1)
  (magit-process-finish-apply-ansi-colors t)
  (magit-buffer-name-format <span style="color: #8B887D; font-style: italic;">"%x%M%v: %t%x"</span>)
  (magit-list-refs-sortby <span style="color: #8B887D; font-style: italic;">"-creatordate"</span>)
  (magit-diff-paint-whitespace-lines 'both)
  (magit-diff-refine-hunk 'all)
  (magit-diff-refine-ignore-whitespace t)
  (git-commit-style-convention-checks '(non-empty-second-line overlong-summary-line))
  (git-commit-summary-max-length 50)
  (git-commit-fill-column 72)

  <span style="color: #403D2E; font-style: italic;">:config</span>
  (add-hook 'with-editor-mode-hook #'evil-insert-state)
  (magit-auto-revert-mode nil)

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/truncate-lines-off</span> () (toggle-truncate-lines -1))
  (add-hook 'magit-status-mode-hook #'aero/truncate-lines-off)

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/magit-switch-to-diff</span> () (other-window 1))
  (advice-add 'magit-diff <span style="color: #403D2E; font-style: italic;">:after</span> #'aero/magit-switch-to-diff)

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/magit-diff-default-branch</span> (<span style="color: #387780; font-style: italic;">&amp;optional</span> args)
    <span style="color: #96a7a9; font-weight: bold;">"Show diff of default branch to working tree."</span>
    (<span style="color: #737063; font-weight: bold;">interactive</span> (list (magit-diff-arguments)))
    (magit-diff-working-tree
     (replace-regexp-in-string <span style="color: #8B887D; font-style: italic;">"refs/remotes/origin/"</span> <span style="color: #8B887D; font-style: italic;">""</span>
                               (magit-git-string <span style="color: #8B887D; font-style: italic;">"symbolic-ref"</span> <span style="color: #8B887D; font-style: italic;">"refs/remotes/origin/HEAD"</span>))
     args))

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/magit--color-buffer</span> (proc <span style="color: #387780; font-style: italic;">&amp;rest</span> args)
    (<span style="color: #737063; font-weight: bold;">interactive</span>)
    (<span style="color: #737063; font-weight: bold;">with-current-buffer</span> (process-buffer proc)
      (read-only-mode -1)
      (ansi-color-apply-on-region (point-min) (point-max))
      (read-only-mode 1)))
  (advice-add 'magit-process-filter <span style="color: #403D2E; font-style: italic;">:after</span> #'aero/magit--color-buffer)

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/fetch-pr</span> ()
    <span style="color: #96a7a9; font-weight: bold;">"Fetch a GH(E) pull request into a new branch prefixed with `</span><span style="color: #655370; font-weight: bold;">pr</span><span style="color: #96a7a9; font-weight: bold;">'."</span>
    (<span style="color: #737063; font-weight: bold;">interactive</span>)
    (<span style="color: #737063; font-weight: bold;">let*</span> ((pr (message-read-from-minibuffer <span style="color: #8B887D; font-style: italic;">"Enter PR number: "</span>))
           (new-branch (format <span style="color: #8B887D; font-style: italic;">"pr%s"</span> pr))
           (fetch-command
            (format <span style="color: #8B887D; font-style: italic;">"git fetch origin pull/%s/head:%s"</span> pr new-branch)))
      (shell-command fetch-command)
      (magit-status)
      (message <span style="color: #8B887D; font-style: italic;">"Checked out PR as %s"</span> new-branch))))
</pre>
</div>
</div>
<div id="outline-container-org0123ebd" class="outline-3">
<h3 id="org0123ebd">git-gutter</h3>
<div class="outline-text-3" id="text-org0123ebd">
<p>
Provides a visual indicator of changes in the gutter. I use it to quickly see what's changed in a file. The backends is set to git by default, and only loads the others if they actually exist on the system, which they never do.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! git-gutter <span style="color: #403D2E; font-style: italic;">:auto</span>
  <span style="color: #403D2E; font-style: italic;">:hook</span> ((prog-mode text-mode conf-mode) . git-gutter-mode)
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (git-gutter:visual-line t)
  (git-gutter:disabled-modes '(so-long-mode
                               image-mode asm-mode
                               doc-view-mode
                               fundamental-mode image-mode pdf-view-mode))
  (git-gutter:update-interval 0.02)
  (git-gutter:handled-backends
   (cons 'git (cl-remove-if-not #'executable-find (list 'hg 'svn 'bzr)
                                <span style="color: #403D2E; font-style: italic;">:key</span> #'symbol-name)))

  <span style="color: #403D2E; font-style: italic;">:config</span>
  (add-hook 'focus-in-hook #'git-gutter:update-all-windows))
</pre>
</div>
</div>
<div id="outline-container-org7cb3909" class="outline-4">
<h4 id="org7cb3909">git-gutter-fringe</h4>
<div class="outline-text-4" id="text-org7cb3909">
<p>
Redefine the fringe bitmap definer to a no-op in GUI, if it's not already bound, otherwise git-gutter-fringe will error. I've never tracked down the real cause, but this makes things work smoothly.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">when</span> (display-graphic-p)
  (<span style="color: #737063; font-weight: bold;">unless</span> (fboundp 'define-fringe-bitmap)
    (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">define-fringe-bitmap</span> (bitmap <span style="color: #387780; font-style: italic;">&amp;rest</span> _)
      <span style="color: #96a7a9; font-weight: bold;">"This is a no-op placeholder function."</span>
      <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Return the symbol, just like the normal function does.</span>
      bitmap))
</pre>
</div>

<p>
The actual package, which moves the git-gutter functionality to the buffer fringe where it doesn't push text around.
</p>

<p>
The fringe bitmaps are a thin bar, expecting the theme to give them suitable coloring. The functionality is disabled in Tramp because it hogs the connection bandwidth.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! git-gutter-fringe <span style="color: #403D2E; font-style: italic;">:auto</span> <span style="color: #403D2E; font-style: italic;">:after</span> (git-gutter)
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (fringes-outside-margins t)

  <span style="color: #403D2E; font-style: italic;">:config</span>
  (define-fringe-bitmap 'git-gutter-fr:added [224]
    nil nil '(center repeated))
  (define-fringe-bitmap 'git-gutter-fr:modified [224]
    nil nil '(center repeated))
  (define-fringe-bitmap 'git-gutter-fr:deleted
    [0 0 0 0 0 0 0 0 0 0 0 0 0 128 192 224 240 248]
    nil nil 'bottom)

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">git-gutter-find-file-hook</span> ()
    (git-gutter-mode
     (<span style="color: #737063; font-weight: bold;">if</span> (file-remote-p (buffer-file-name))
         0
       1)))
  (add-hook 'find-file-hook #'git-gutter-find-file-hook)))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org9b9da89" class="outline-3">
<h3 id="org9b9da89">Ediff</h3>
<div class="outline-text-3" id="text-org9b9da89">
<p>
A decent way to compare diffs. I've set it up to split horizontally and use a plain window setup.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! ediff <span style="color: #403D2E; font-style: italic;">:builtin</span>
  <span style="color: #403D2E; font-style: italic;">:commands</span> (ediff ediff3)
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (ediff-split-window-function #'split-window-horizontally )
  (ediff-window-setup-function #'ediff-setup-windows-plain))
</pre>
</div>
</div>
</div>
<div id="outline-container-org563c434" class="outline-3">
<h3 id="org563c434">Git-link</h3>
<div class="outline-text-3" id="text-org563c434">
<p>
Super simple way to get a link to a file or line in a file on GitHub
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! git-link <span style="color: #403D2E; font-style: italic;">:auto</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (general)
  <span style="color: #403D2E; font-style: italic;">:commands</span> (git-link git-link-commit git-link-homepage)
  <span style="color: #403D2E; font-style: italic;">:init</span> (aero-leader-def <span style="color: #8B887D; font-style: italic;">"gL"</span> 'git-link))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org62e776f" class="outline-2">
<h2 id="org62e776f">Org mode and org agenda</h2>
<div class="outline-text-2" id="text-org62e776f">
<p>
Org is an incredibly powerful tool in Emacs, and I make the most use of it for task management and note-taking.
</p>

<p>
Before the actual package config, let's define some useful functions.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">archive-buffer-closed-tasks</span> ()
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (org-map-entries
   (<span style="color: #737063; font-weight: bold;">lambda</span> ()
     (<span style="color: #737063; font-weight: bold;">when</span> (member (org-get-todo-state) org-done-keywords)
       (org-archive-subtree-default)
       <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">the archive alters the tree, so just go back to the top</span>
       (<span style="color: #737063; font-weight: bold;">setq</span> org-map-continue-from (point-min))))
   nil 'file))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">trim-archive-entries</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Trim entries in the archive file older than 60 days."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">let</span> ((archive-file (expand-file-name aero/thornlog-archive-file)))
    (<span style="color: #737063; font-weight: bold;">when</span> (file-exists-p archive-file)
      (<span style="color: #737063; font-weight: bold;">let</span> ((cutoff-date (time-subtract (current-time) (days-to-time 60))))
        (<span style="color: #737063; font-weight: bold;">with-current-buffer</span> (find-file-noselect archive-file)
          (goto-char (point-min))
          (<span style="color: #737063; font-weight: bold;">while</span> (not (eobp))
            (<span style="color: #737063; font-weight: bold;">when</span> (<span style="color: #737063; font-weight: bold;">and</span> (org-at-heading-p)
                       (<span style="color: #737063; font-weight: bold;">let</span> ((archive-time-str (org-entry-get (point) <span style="color: #8B887D; font-style: italic;">"ARCHIVE_TIME"</span>)))
                         (<span style="color: #737063; font-weight: bold;">and</span> archive-time-str
                              (time-less-p (org-read-date nil t archive-time-str) cutoff-date))))
              (org-cut-subtree)
              (org-back-to-heading t)
              (outline-previous-heading))
            (outline-next-heading)))
        (save-buffer)))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/org-archive-cleanup</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Archive closed tasks and trim archive entries."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (archive-buffer-closed-tasks)
  (trim-archive-entries))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/org-collapse-entry-if-done</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Collapse the current entry if it is marked as DONE."</span>
  (<span style="color: #737063; font-weight: bold;">when</span> (member org-state '(<span style="color: #8B887D; font-style: italic;">"DONE"</span>))
    (hide-subtree)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/org-expand-entry-if-todo</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Expand the current entry if it is marked as TODO."</span>
  (<span style="color: #737063; font-weight: bold;">when</span> (member org-state '(<span style="color: #8B887D; font-style: italic;">"TODO"</span>))
    (show-subtree)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">jump-to-org-agenda</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Go to the org agenda. Used on idle timer."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">let</span> ((buf (get-buffer <span style="color: #8B887D; font-style: italic;">"*Org Agenda*"</span>))
        wind)
    (<span style="color: #737063; font-weight: bold;">if</span> buf
        (<span style="color: #737063; font-weight: bold;">if</span> (<span style="color: #737063; font-weight: bold;">setq</span> wind (get-buffer-window buf))
            (select-window wind)
          (<span style="color: #737063; font-weight: bold;">if</span> (called-interactively-p 'any)
              (<span style="color: #737063; font-weight: bold;">progn</span>
                (select-window (display-buffer buf t t))
                (org-fit-window-to-buffer))
            (<span style="color: #737063; font-weight: bold;">with-selected-window</span> (display-buffer buf)
              (org-fit-window-to-buffer))))
      (call-interactively 'org-agenda-list))))
</pre>
</div>

<p>
Reordering is based on <a href="https://ag91.github.io/blog/2022/03/12/org-agenda-keep-the-buffer-order-untouched-after-saving-all-modified-org-buffers/">https://ag91.github.io/blog/2022/03/12/org-agenda-keep-the-buffer-order-untouched-after-saving-all-modified-org-buffers/</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/reorder-buffer-list</span> (new-list)
  (<span style="color: #737063; font-weight: bold;">while</span> new-list
    (bury-buffer (car new-list))
    (<span style="color: #737063; font-weight: bold;">setq</span> new-list (cdr new-list))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/keep-buffer-list-unaltered</span> (orig-fun <span style="color: #387780; font-style: italic;">&amp;rest</span> args)
  (<span style="color: #737063; font-weight: bold;">let</span> ((buffers (buffer-list))
        (result (apply orig-fun args)))
    (aero/reorder-buffer-list buffers)
    result))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">org-schedule-and-refile</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Schedule the current entry and refile it."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (org-schedule t)
  (org-refile))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">org-deadline-and-refile</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Deadline the current entry and refile it."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (org-deadline t)
  (org-refile))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/org-agenda-format-date</span> (date)
  <span style="color: #96a7a9; font-weight: bold;">"Format a DATE string for display in the daily/weekly agenda.</span>
<span style="color: #96a7a9; font-weight: bold;">This function makes sure that dates are aligned for easy reading."</span>
  (<span style="color: #737063; font-weight: bold;">require</span> '<span style="color: #655370; font-weight: bold;">cal-iso</span>)
  (<span style="color: #737063; font-weight: bold;">let*</span> ((dayname (calendar-day-name date))
               (day (cadr date))
               (month (car date))
               (monthname (calendar-month-name month))

         <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">divisor must be float so (/) doesn't do integer division</span>
         (quarter (round (/ (1+ month) 3.0)))

               (year (nth 2 date))
               (iso-week (org-days-to-iso-week
                                (calendar-absolute-from-gregorian date)))
               (day-of-week (calendar-day-of-week date))
               (weekstring (<span style="color: #737063; font-weight: bold;">if</span> (= day-of-week 1)
                                           (format <span style="color: #8B887D; font-style: italic;">" W%02d"</span> iso-week)
                                   <span style="color: #8B887D; font-style: italic;">""</span>)))
    (format <span style="color: #8B887D; font-style: italic;">"%-10s %2d %s %4d%s   (Q%s)"</span>
                  dayname day monthname year weekstring quarter)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/org-deindent-on-return</span> (<span style="color: #387780; font-style: italic;">&amp;rest</span> _)
  <span style="color: #96a7a9; font-weight: bold;">"De-indent the current line if there is only whitespace before the point when pressing ENTER.</span>

<span style="color: #96a7a9; font-weight: bold;">This behavior is IDIOTIC and I cannot suffer to live with this automatic indentation any longer."</span>
  (<span style="color: #737063; font-weight: bold;">when</span> (<span style="color: #737063; font-weight: bold;">and</span> (derived-mode-p 'org-mode)
             (<span style="color: #737063; font-weight: bold;">save-excursion</span>
               (move-beginning-of-line 1)
               (looking-at-p <span style="color: #8B887D; font-style: italic;">"[ \t]*$"</span>)))
    (delete-horizontal-space)))
</pre>
</div>
</div>
<div id="outline-container-orgb344c69" class="outline-3">
<h3 id="orgb344c69">Org package</h3>
<div class="outline-text-3" id="text-orgb344c69">
<p>
Now for the actual package configuration. This is a long one, so I've made a lot of comments within the code block rather than putting everything up here.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! org <span style="color: #403D2E; font-style: italic;">:builtin</span>
  <span style="color: #403D2E; font-style: italic;">:preface</span>

  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (org-hide-leading-stars t)
  (org-pretty-entities t)
  (org-indent-mode-turns-on-hiding-stars nil) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">why would this even exist??</span>
  (org-fontify-quote-and-verse-blocks t)
  (org-insert-heading-respect-content t) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">insert headings after current subtree</span>
  (org-fold-catch-invisible-edits 'smart) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">don't accidentally remove hidden text</span>
  (org-startup-with-inline-images t) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">default to showing images on startup</span>
  (org-startup-indented t)
  (org-log-done 'time) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">log time when item is marked done</span>
  (org-log-into-drawer t) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">put logs in LOGBOOK</span>
  (org-refile-use-outline-path t) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">show path to outline level during refile</span>
  (org-fontify-done-headline t) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">let theme strike out done items</span>
  (org-return-follows-link t) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">follow links with RET</span>

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">always put blank before new headings, but be smart about list items</span>
  (org-blank-before-new-entry '((heading . t) (plain-list-item . auto)))

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">re-scale images to 400px if no with attribute is set (see</span>
  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">https://lists.gnu.org/archive/html/emacs-orgmode/2012-08/msg01402.html)</span>
  (org-image-actual-width '(400))

  (org-capture-templates
   `((<span style="color: #8B887D; font-style: italic;">"t"</span> <span style="color: #8B887D; font-style: italic;">"Deadline/Scheduled Task"</span> entry
      (file+headline
       ,(expand-file-name <span style="color: #8B887D; font-style: italic;">"todo.org"</span> aero/roam-path)
       <span style="color: #8B887D; font-style: italic;">"Tasks"</span>)
      <span style="color: #8B887D; font-style: italic;">"* TODO [#C] %?\nSCHEDULED: %t\n:PROPERTIES:\n:CREATED: %U\n:END:\n\n"</span>
      <span style="color: #403D2E; font-style: italic;">:empty-lines</span> 1)
     (<span style="color: #8B887D; font-style: italic;">"p"</span> <span style="color: #8B887D; font-style: italic;">"Ticket (PR)"</span> entry
      (file+headline
       ,(expand-file-name <span style="color: #8B887D; font-style: italic;">"todo.org"</span> aero/roam-path)
       <span style="color: #8B887D; font-style: italic;">"Tasks"</span>)
      <span style="color: #8B887D; font-style: italic;">"* TICKET [#C] %?\nSCHEDULED: %t\n:PROPERTIES:\n:CREATED: %U\n:END:\n"</span>
      <span style="color: #403D2E; font-style: italic;">:empty-lines</span> 1)
     (<span style="color: #8B887D; font-style: italic;">"r"</span> <span style="color: #8B887D; font-style: italic;">"Review (PR or tech design)"</span> entry
      (file+headline
       ,(expand-file-name <span style="color: #8B887D; font-style: italic;">"todo.org"</span> aero/roam-path)
       <span style="color: #8B887D; font-style: italic;">"Tasks"</span>)
      <span style="color: #8B887D; font-style: italic;">"* REVIEW [#B] %? :review:\nSCHEDULED: %t DEADLINE: %t\n:PROPERTIES:\n:CREATED: %U\n:END:\nLink: "</span>
      <span style="color: #403D2E; font-style: italic;">:empty-lines</span> 1)
     (<span style="color: #8B887D; font-style: italic;">"s"</span> <span style="color: #8B887D; font-style: italic;">"School inbox item"</span> entry
      (file+headline
       ,(expand-file-name <span style="color: #8B887D; font-style: italic;">"school_todo.org"</span> aero/roam-path)
       <span style="color: #8B887D; font-style: italic;">"Tasks"</span>)
      <span style="color: #8B887D; font-style: italic;">"* TODO [#C] %?\nSCHEDULED: %t\n:PROPERTIES:\n:CREATED: %U\n:END:\n\n"</span>
      <span style="color: #403D2E; font-style: italic;">:empty-lines</span> 1)
     (<span style="color: #8B887D; font-style: italic;">"n"</span> <span style="color: #8B887D; font-style: italic;">"Note"</span> entry
      (file+headline
       ,(expand-file-name <span style="color: #8B887D; font-style: italic;">"notes_inbox.org"</span> aero/roam-path)
       <span style="color: #8B887D; font-style: italic;">"Notes"</span>)
      <span style="color: #8B887D; font-style: italic;">"* %?\n:PROPERTIES:\n:CREATED: %U\n:END:\n"</span>
      <span style="color: #403D2E; font-style: italic;">:jump-to-captured</span> t
      <span style="color: #403D2E; font-style: italic;">:empty-lines</span> 1)
     (<span style="color: #8B887D; font-style: italic;">"e"</span> <span style="color: #8B887D; font-style: italic;">"Experimentation idea"</span> entry
      (file+headline
       ,(expand-file-name <span style="color: #8B887D; font-style: italic;">"todo.org"</span> aero/roam-path)
       <span style="color: #8B887D; font-style: italic;">"Experimentation"</span>)
      <span style="color: #8B887D; font-style: italic;">"* TODO %?\n:PROPERTIES:\n:CREATED: %U\n:END:\n\n"</span>
      <span style="color: #403D2E; font-style: italic;">:empty-lines</span> 1)
     (<span style="color: #8B887D; font-style: italic;">"R"</span> <span style="color: #8B887D; font-style: italic;">"Reading"</span> entry
      (file+headline
       ,(expand-file-name <span style="color: #8B887D; font-style: italic;">"todo.org"</span> aero/roam-path)
       <span style="color: #8B887D; font-style: italic;">"Reading"</span>)
      <span style="color: #8B887D; font-style: italic;">"* TODO [#E] %?\nSCHEDULED: %t\n:PROPERTIES:\n:CREATED: %U\n:END:\n"</span>
      <span style="color: #403D2E; font-style: italic;">:empty-lines</span> 1)
     (<span style="color: #8B887D; font-style: italic;">"s"</span> <span style="color: #8B887D; font-style: italic;">"Time sink"</span> entry
      (file+headline
       ,(expand-file-name <span style="color: #8B887D; font-style: italic;">"20250123102747-time_sinks_at_dd.org"</span> aero/roam-path)
       <span style="color: #8B887D; font-style: italic;">"Time sinks"</span>)
      <span style="color: #8B887D; font-style: italic;">"* %?\n:PROPERTIES:\n:CREATED: %U\n:END:\n"</span>
      <span style="color: #403D2E; font-style: italic;">:empty-lines</span> 1)
     (<span style="color: #8B887D; font-style: italic;">"m"</span> <span style="color: #8B887D; font-style: italic;">"Mistake"</span> entry
      (file+headline
       ,(expand-file-name <span style="color: #8B887D; font-style: italic;">"20250123103552-mistakes_to_learn_from_at_dd.org"</span> aero/roam-path)
       <span style="color: #8B887D; font-style: italic;">"Mistakes"</span>)
      <span style="color: #8B887D; font-style: italic;">"* %?\n:PROPERTIES:\n:CREATED: %U\n:END:\n"</span>
      <span style="color: #403D2E; font-style: italic;">:empty-lines</span> 1)))

  (org-todo-keywords
   '((sequence <span style="color: #8B887D; font-style: italic;">"TODO(t)"</span> <span style="color: #8B887D; font-style: italic;">"WAITING(w!)"</span> <span style="color: #8B887D; font-style: italic;">"BLOCKED(b!)"</span> <span style="color: #8B887D; font-style: italic;">"BACKLOG(l!)"</span> <span style="color: #8B887D; font-style: italic;">"|"</span> <span style="color: #8B887D; font-style: italic;">"DONE(d!)"</span> <span style="color: #8B887D; font-style: italic;">"REMOVED(k)"</span>)
     (sequence <span style="color: #8B887D; font-style: italic;">"TICKET(T)"</span> <span style="color: #8B887D; font-style: italic;">"PR(p!)"</span> <span style="color: #8B887D; font-style: italic;">"|"</span> <span style="color: #8B887D; font-style: italic;">"DONE(d!)"</span> <span style="color: #8B887D; font-style: italic;">"CLOSED(x)"</span>)
     (sequence <span style="color: #8B887D; font-style: italic;">"REVIEW(r)"</span> <span style="color: #8B887D; font-style: italic;">"WAITING(w!)"</span> <span style="color: #8B887D; font-style: italic;">"BLOCKED(b!)"</span> <span style="color: #8B887D; font-style: italic;">"|"</span> <span style="color: #8B887D; font-style: italic;">"DONE(d!)"</span> <span style="color: #8B887D; font-style: italic;">"CLOSED(x)"</span>)))

  (org-use-fast-todo-selection 'expert) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">don't fuck up the window layout</span>
  (org-default-notes-file (expand-file-name <span style="color: #8B887D; font-style: italic;">"notes_inbox.org"</span> aero/roam-path))
  (org-priority-faces '((?A . error)
                        (?B . warning)
                        (?C . success)
                        (?D . org-priority)
                        (?E . org-priority)))
  (org-priority-highest ?A)
  (org-priority-lowest ?E) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">default is C</span>
  (org-reverse-note-order nil) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">put notes at the end of the entry, instead of the top</span>
  (org-archive-location (concat aero/thornlog-archive-file <span style="color: #8B887D; font-style: italic;">"::* From %s"</span>))

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">don't consider empty lines between entries to be part of the entry</span>
  (org-cycle-separator-lines -2)

  (org-link-frame-setup '((vm . vm-visit-folder-other-frame)
                          (vm-imap . vm-visit-imap-folder-other-frame)
                          (gnus . org-gnus-no-new-news)
                          (file . find-file)
                          (wl . wl-other-frame)))

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Agenda</span>
  (org-agenda-span 1) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">days to show at a time</span>
  (org-agenda-start-day nil) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">day to start at</span>
  (org-agenda-start-on-weekday nil) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">start week on current day</span>
  (org-agenda-format-date #'aero/org-agenda-format-date)
  (org-agenda-prefix-format '((agenda . <span style="color: #8B887D; font-style: italic;">" %i %?-12t% s"</span>)
                              (todo . <span style="color: #8B887D; font-style: italic;">" %i %-12:c"</span>)
                              (tags . <span style="color: #8B887D; font-style: italic;">" %i %-12:c"</span>)
                              (search . <span style="color: #8B887D; font-style: italic;">" %i %-12:c"</span>)))

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">all agenda files</span>
  (org-agenda-files `(,(expand-file-name <span style="color: #8B887D; font-style: italic;">"todo.org"</span> aero/roam-path)
                      ,(expand-file-name <span style="color: #8B887D; font-style: italic;">"log.org"</span> aero/roam-path)
                      ,(expand-file-name <span style="color: #8B887D; font-style: italic;">"ritual.org"</span> aero/roam-path)
                      ,(expand-file-name <span style="color: #8B887D; font-style: italic;">"holidays.org"</span> aero/roam-path)
                      ,(expand-file-name <span style="color: #8B887D; font-style: italic;">"notes_inbox.org"</span> aero/roam-path)))

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">holidays I don't want to display</span>
  (holiday-bahai-holidays nil)
  (holiday-hebrew-holidays nil)
  (holiday-islamic-holidays nil)
  (holiday-christian-holidays nil)
  (holiday-oriental-holidays nil)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">local holidays</span>
  (holiday-local-holidays '((holiday-fixed 3 14 <span style="color: #8B887D; font-style: italic;">"Pi Day"</span>)
                            (holiday-fixed 10 23 <span style="color: #8B887D; font-style: italic;">"Mole Day"</span>)
                            (holiday-fixed 11 23 <span style="color: #8B887D; font-style: italic;">"Fibonacci Day"</span>)
                            (holiday-fixed 12 23 <span style="color: #8B887D; font-style: italic;">"Festivus"</span>)
                            (holiday-fixed 9 19 <span style="color: #8B887D; font-style: italic;">"Talk Like a Pirate Day"</span>)
                            (holiday-fixed 10 9 <span style="color: #8B887D; font-style: italic;">"Leif Erikson Day"</span>)
                            (holiday-fixed 5 4 <span style="color: #8B887D; font-style: italic;">"Star Wars Day"</span>)
                            (holiday-fixed 6 28 <span style="color: #8B887D; font-style: italic;">"Tau Day"</span>)

                            (holiday-fixed 2 27 <span style="color: #8B887D; font-style: italic;">"Hangover (first day)"</span>)
                            (holiday-fixed 2 28 <span style="color: #8B887D; font-style: italic;">"Hangover (second day)"</span>)
                            (holiday-fixed 2 29 <span style="color: #8B887D; font-style: italic;">"Hangover (third day)"</span>)
                            (holiday-fixed 3 1 <span style="color: #8B887D; font-style: italic;">"Hangover (fourth day)"</span>)
                            (holiday-fixed 3 2 <span style="color: #8B887D; font-style: italic;">"Hangover (fifth day)"</span>)
                            (holiday-fixed 3 3 <span style="color: #8B887D; font-style: italic;">"Hangover (sixth day)"</span>)
                            (holiday-fixed 3 4 <span style="color: #8B887D; font-style: italic;">"Hangover (seventh day)"</span>)
                            (holiday-fixed 3 5 <span style="color: #8B887D; font-style: italic;">"Hangover (eighth day)"</span>)
                            (holiday-fixed 3 6 <span style="color: #8B887D; font-style: italic;">"The Day of the Dude"</span>)))

  (org-agenda-log-mode-items nil) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">don't show closed nor clocked items</span>
  (org-agenda-tags-column -70) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">shift tags over</span>
  (org-agenda-sticky nil) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">don't bury on close buffer</span>
  (org-agenda-use-tag-inheritance t)
  (org-agenda-show-log t)
  (org-agenda-skip-deadline-if-done t)
  (org-agenda-skip-deadline-prewarning-if-scheduled 'pre-scheduled)
  (org-agenda-skip-scheduled-if-done t)
  (org-agenda-skip-scheduled-if-deadline-is-shown t) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">don't duplicate deadline &amp; scheduled</span>
  (org-agenda-skip-timestamp-if-done t)
  (org-agenda-skip-timestamp-if-deadline-is-shown t)
  (org-agenda-window-setup 'current-window) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">stop agenda opening a new window</span>
  (org-agenda-skip-unavailable-files t)
  (org-agenda-show-future-repeats nil) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">don't show repeating tasks on future agenda dates</span>
  (org-agenda-custom-commands
   `((<span style="color: #8B887D; font-style: italic;">"n"</span> <span style="color: #8B887D; font-style: italic;">"Agenda and all TODOs"</span> ((agenda <span style="color: #8B887D; font-style: italic;">""</span>) (alltodo <span style="color: #8B887D; font-style: italic;">""</span>)))
     (<span style="color: #8B887D; font-style: italic;">"s"</span> <span style="color: #8B887D; font-style: italic;">"School items"</span> agenda <span style="color: #8B887D; font-style: italic;">""</span>
      ((org-agenda-files '(,(expand-file-name <span style="color: #8B887D; font-style: italic;">"school_todo.org"</span> aero/roam-path)))))
     (<span style="color: #8B887D; font-style: italic;">"e"</span> <span style="color: #8B887D; font-style: italic;">"Experimentation tag"</span> tags <span style="color: #8B887D; font-style: italic;">"experimentation"</span>)))

  <span style="color: #403D2E; font-style: italic;">:init</span>
  (aero-leader-def
    <span style="color: #8B887D; font-style: italic;">"oa"</span> '(aero/org-agenda-list <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"agenda"</span>)
    <span style="color: #8B887D; font-style: italic;">"oc"</span> '(aero/org-class-agenda-list <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"class agenda"</span>)
    <span style="color: #8B887D; font-style: italic;">"oA"</span> '(org-agenda <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"agenda menu"</span>)
    <span style="color: #8B887D; font-style: italic;">"os"</span> 'org-schedule
    <span style="color: #8B887D; font-style: italic;">"od"</span> 'org-deadline
    <span style="color: #8B887D; font-style: italic;">"oj"</span> 'org-clock-goto
    <span style="color: #8B887D; font-style: italic;">"ot"</span> 'aero/org-set-tags
    <span style="color: #8B887D; font-style: italic;">"ol"</span> 'org-store-link
    <span style="color: #8B887D; font-style: italic;">"oT"</span> '(org-tags-view <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"list tags"</span>)
    <span style="color: #8B887D; font-style: italic;">"vo"</span> 'org-capture)

  <span style="color: #403D2E; font-style: italic;">:config</span>
  (aero-mode-leader-def
    <span style="color: #403D2E; font-style: italic;">:keymaps</span> 'org-mode-map
    <span style="color: #8B887D; font-style: italic;">"t"</span> 'org-todo
    <span style="color: #8B887D; font-style: italic;">"f"</span> 'org-forward-heading-same-level
    <span style="color: #8B887D; font-style: italic;">"F"</span> 'org-backward-heading-same-level
    <span style="color: #8B887D; font-style: italic;">"w"</span> 'org-open-at-point
    <span style="color: #8B887D; font-style: italic;">"p"</span> 'org-priority
    <span style="color: #8B887D; font-style: italic;">"r"</span> 'org-refile
    <span style="color: #8B887D; font-style: italic;">"s"</span> 'org-set-property
    <span style="color: #8B887D; font-style: italic;">"i"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"insert"</span>)
    <span style="color: #8B887D; font-style: italic;">"il"</span> '(org-insert-link <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"link"</span>)
    <span style="color: #8B887D; font-style: italic;">"it"</span> 'org-time-stamp
    <span style="color: #8B887D; font-style: italic;">"ii"</span> 'org-insert-structure-template
    <span style="color: #8B887D; font-style: italic;">"id"</span> '(org-insert-drawer <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"drawer"</span>)
    <span style="color: #8B887D; font-style: italic;">"im"</span> 'insert-meeting-task
    <span style="color: #8B887D; font-style: italic;">"is"</span> 'insert-class-task
    <span style="color: #8B887D; font-style: italic;">"A"</span> 'aero/org-archive-cleanup
    <span style="color: #8B887D; font-style: italic;">"c"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"clock / cell"</span>)
    <span style="color: #8B887D; font-style: italic;">"cc"</span> '(org-babel-execute-src-block <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"exec cell"</span>)
    <span style="color: #8B887D; font-style: italic;">"ci"</span> 'org-clock-in
    <span style="color: #8B887D; font-style: italic;">"co"</span> 'org-clock-out
    <span style="color: #8B887D; font-style: italic;">"ck"</span> 'org-clock-cancel
    <span style="color: #8B887D; font-style: italic;">"cs"</span> 'org-clock-display
    <span style="color: #8B887D; font-style: italic;">"ce"</span> 'org-set-effort
    <span style="color: #8B887D; font-style: italic;">"cE"</span> 'org-clock-modify-effort-estimate)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">keep org-save-all from messing up buffer list</span>
  (advice-add 'org-save-all-org-buffers <span style="color: #403D2E; font-style: italic;">:around</span> #'aero/keep-buffer-list-unaltered)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">org tries to take this binding back, so wrest control back once more</span>
  (define-key org-mode-map (kbd <span style="color: #8B887D; font-style: italic;">"M-h"</span>) #'windmove-left)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Collapse entries when they are marked as done, and expand when reopened</span>
  (add-hook 'org-after-todo-state-change-hook #'aero/org-collapse-entry-if-done)
  (add-hook 'org-after-todo-state-change-hook #'aero/org-expand-entry-if-todo)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Get rid of the idiotic indentation after pressing enter</span>
  (advice-add 'org-return <span style="color: #403D2E; font-style: italic;">:after</span> #'aero/org-deindent-on-return)
  (<span style="color: #737063; font-weight: bold;">with-eval-after-load</span> 'evil
    (advice-add 'evil-org-open-below <span style="color: #403D2E; font-style: italic;">:after</span> #'aero/org-deindent-on-return))

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Also save after state change</span>
  (add-hook 'org-after-todo-state-change-hook #'org-save-all-org-buffers)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">start with all levels collapsed</span>
  (add-hook 'org-mode-hook #'org-hide-block-all)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Save org files when using clock</span>
  (add-hook 'org-clock-in-hook #'org-save-all-org-buffers)
  (add-hook 'org-clock-out-hook #'org-save-all-org-buffers)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Force org-capture to not open new windows</span>
  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/org-capture-place-template-dont-delete-windows</span> (oldfun <span style="color: #387780; font-style: italic;">&amp;rest</span> args)
    (<span style="color: #737063; font-weight: bold;">cl-letf</span> (((symbol-function 'delete-other-windows) 'ignore))
      (apply oldfun args)))
  (<span style="color: #737063; font-weight: bold;">with-eval-after-load</span> <span style="color: #8B887D; font-style: italic;">"org-capture"</span>
    (advice-add 'org-capture-place-template
                <span style="color: #403D2E; font-style: italic;">:around</span> #'aero/org-capture-place-template-dont-delete-windows))

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">set up stuff for clock persistence</span>
  (org-clock-persistence-insinuate)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Show agenda when Emacs is idle for 10 minutes, from</span>
  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">https://sachachua.com/dotemacs/index.html#idle-timer</span>
  (run-with-idle-timer 600 t 'jump-to-org-agenda))
</pre>
</div>
</div>
</div>
<div id="outline-container-org71774ce" class="outline-3">
<h3 id="org71774ce">Org-appear</h3>
<div class="outline-text-3" id="text-org71774ce">
<p>
Show formatting markers when point is near
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! org-appear <span style="color: #8B887D; font-style: italic;">"awth13/org-appear"</span>
  <span style="color: #403D2E; font-style: italic;">:custom</span> (org-hide-emphasis-markers t)
  <span style="color: #403D2E; font-style: italic;">:hook</span> (org-mode . org-appear-mode))
</pre>
</div>
</div>
</div>
<div id="outline-container-org25f2e2b" class="outline-3">
<h3 id="org25f2e2b">Org-modern</h3>
<div class="outline-text-3" id="text-org25f2e2b">
<p>
Some trivial UI improvements for org files. Uses the "replace" set of stars for headings.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! org-modern <span style="color: #8B887D; font-style: italic;">"minad/org-modern"</span>
  <span style="color: #403D2E; font-style: italic;">:hook</span> ((org-mode . org-modern-mode)
         (org-agenda-finalize-hook . org-modern-agenda))
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (org-modern-star 'replace))
</pre>
</div>
</div>
</div>
<div id="outline-container-org40a627f" class="outline-3">
<h3 id="org40a627f">Evil-org-mode</h3>
<div class="outline-text-3" id="text-org40a627f">
<p>
Use evil in org, particularly in org-agenda. Also unblocks using aero-leader chords. See <a href="https://github.com/Somelauw/evil-org-mode">https://github.com/Somelauw/evil-org-mode</a> for a list of available commands.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! evil-org-mode <span style="color: #8B887D; font-style: italic;">"Somelauw/evil-org-mode"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (evil org org-super-agenda)
  <span style="color: #403D2E; font-style: italic;">:preface</span>
  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/evil-org-agenda-mode</span> ()
    <span style="color: #96a7a9; font-weight: bold;">"Shim in org-agenda evil mode."</span>
    (<span style="color: #737063; font-weight: bold;">require</span> '<span style="color: #655370; font-weight: bold;">evil-org-agenda</span>)
    (evil-org-agenda-set-keys))

  <span style="color: #403D2E; font-style: italic;">:hook</span> ((org-mode . evil-org-mode)
         (org-agenda-mode . aero/evil-org-agenda-mode)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org20d59c8" class="outline-3">
<h3 id="org20d59c8">Org-fancy-priorities</h3>
<div class="outline-text-3" id="text-org20d59c8">
<p>
Custom display of org priorities
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! org-fancy-priorities <span style="color: #8B887D; font-style: italic;">"harrybournis/org-fancy-priorities"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (org)
  <span style="color: #403D2E; font-style: italic;">:hook</span> (org-mode . org-fancy-priorities-mode)
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (org-fancy-priorities-list '(<span style="color: #8B887D; font-style: italic;">"!!"</span> <span style="color: #8B887D; font-style: italic;">"&#8593;"</span> <span style="color: #8B887D; font-style: italic;">"&#183;"</span> <span style="color: #8B887D; font-style: italic;">"&#8595;"</span> <span style="color: #8B887D; font-style: italic;">"_"</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-orga0f58bd" class="outline-3">
<h3 id="orga0f58bd">Org-super-agenda</h3>
<div class="outline-text-3" id="text-orga0f58bd">
<p>
The workhorse of my task management. This package allows me to group tasks in the agenda in a way that makes sense to me.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! org-super-agenda <span style="color: #8B887D; font-style: italic;">"alphapapa/org-super-agenda"</span>
  <span style="color: #403D2E; font-style: italic;">:preface</span>
  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/org-super-agenda-without-keymap</span> ()
    <span style="color: #96a7a9; font-weight: bold;">"Stops super-agenda from overriding evil-org bindings."</span>
    (org-super-agenda-mode)
    (<span style="color: #737063; font-weight: bold;">setq</span> org-super-agenda-header-map (make-sparse-keymap)))

  <span style="color: #403D2E; font-style: italic;">:hook</span> ((org-agenda-after-show . recenter)
         (org-agenda-mode . aero/org-super-agenda-without-keymap))

  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (org-super-agenda-groups
   '((<span style="color: #403D2E; font-style: italic;">:name</span> <span style="color: #8B887D; font-style: italic;">"Daily Routine"</span> <span style="color: #403D2E; font-style: italic;">:and</span> (<span style="color: #403D2E; font-style: italic;">:tag</span> <span style="color: #8B887D; font-style: italic;">"ritual"</span> <span style="color: #403D2E; font-style: italic;">:not</span> (<span style="color: #403D2E; font-style: italic;">:time-grid</span> t)))
     (<span style="color: #403D2E; font-style: italic;">:name</span> <span style="color: #8B887D; font-style: italic;">"Holidays"</span> <span style="color: #403D2E; font-style: italic;">:tag</span> <span style="color: #8B887D; font-style: italic;">"holiday"</span> <span style="color: #403D2E; font-style: italic;">:category</span> (<span style="color: #8B887D; font-style: italic;">"Holiday"</span> <span style="color: #8B887D; font-style: italic;">"Anniversaries"</span>))
     (<span style="color: #403D2E; font-style: italic;">:name</span> <span style="color: #8B887D; font-style: italic;">"Outstanding meetings"</span> <span style="color: #403D2E; font-style: italic;">:and</span> (<span style="color: #403D2E; font-style: italic;">:scheduled</span> past <span style="color: #403D2E; font-style: italic;">:tag</span> <span style="color: #8B887D; font-style: italic;">"meeting"</span>))
     (<span style="color: #403D2E; font-style: italic;">:time-grid</span> t)
     (<span style="color: #403D2E; font-style: italic;">:name</span> <span style="color: #8B887D; font-style: italic;">"Reviews to do"</span> <span style="color: #403D2E; font-style: italic;">:and</span> (<span style="color: #403D2E; font-style: italic;">:tag</span> <span style="color: #8B887D; font-style: italic;">"review"</span>
                                  <span style="color: #403D2E; font-style: italic;">:todo</span> <span style="color: #8B887D; font-style: italic;">"REVIEW"</span>
                                  <span style="color: #403D2E; font-style: italic;">:not</span> (<span style="color: #403D2E; font-style: italic;">:todo</span> (<span style="color: #8B887D; font-style: italic;">"WAITING"</span> <span style="color: #8B887D; font-style: italic;">"BLOCKED"</span> <span style="color: #8B887D; font-style: italic;">"BACKLOG"</span>))))
     (<span style="color: #403D2E; font-style: italic;">:name</span> <span style="color: #8B887D; font-style: italic;">"Support"</span> <span style="color: #403D2E; font-style: italic;">:tag</span> <span style="color: #8B887D; font-style: italic;">"support"</span>)
     (<span style="color: #403D2E; font-style: italic;">:name</span> <span style="color: #8B887D; font-style: italic;">"Waiting/blocked"</span> <span style="color: #403D2E; font-style: italic;">:todo</span> (<span style="color: #8B887D; font-style: italic;">"WAITING"</span> <span style="color: #8B887D; font-style: italic;">"BLOCKED"</span>))
     (<span style="color: #403D2E; font-style: italic;">:name</span> <span style="color: #8B887D; font-style: italic;">"Past due"</span> <span style="color: #403D2E; font-style: italic;">:and</span> (<span style="color: #403D2E; font-style: italic;">:deadline</span> past <span style="color: #403D2E; font-style: italic;">:not</span> (<span style="color: #403D2E; font-style: italic;">:todo</span> (<span style="color: #8B887D; font-style: italic;">"WAITING"</span> <span style="color: #8B887D; font-style: italic;">"BLOCKED"</span>))))
     (<span style="color: #403D2E; font-style: italic;">:name</span> <span style="color: #8B887D; font-style: italic;">"Due today"</span> <span style="color: #403D2E; font-style: italic;">:and</span> (<span style="color: #403D2E; font-style: italic;">:deadline</span> today <span style="color: #403D2E; font-style: italic;">:not</span> (<span style="color: #403D2E; font-style: italic;">:todo</span> (<span style="color: #8B887D; font-style: italic;">"WAITING"</span> <span style="color: #8B887D; font-style: italic;">"BLOCKED"</span>))))
     (<span style="color: #403D2E; font-style: italic;">:name</span> <span style="color: #8B887D; font-style: italic;">"Prioritized"</span> <span style="color: #403D2E; font-style: italic;">:not</span> (<span style="color: #403D2E; font-style: italic;">:todo</span> (<span style="color: #8B887D; font-style: italic;">"WAITING"</span> <span style="color: #8B887D; font-style: italic;">"BLOCKED"</span> <span style="color: #8B887D; font-style: italic;">"BACKLOG"</span>)
                                <span style="color: #403D2E; font-style: italic;">:tag</span> <span style="color: #8B887D; font-style: italic;">"holiday"</span>
                                <span style="color: #403D2E; font-style: italic;">:category</span> (<span style="color: #8B887D; font-style: italic;">"Holiday"</span> <span style="color: #8B887D; font-style: italic;">"Anniversaries"</span>)))
     (<span style="color: #403D2E; font-style: italic;">:name</span> <span style="color: #8B887D; font-style: italic;">"Backlog"</span> <span style="color: #403D2E; font-style: italic;">:todo</span> <span style="color: #8B887D; font-style: italic;">"BACKLOG"</span>)))

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">add space between dates by adding space after the final group</span>
  (org-super-agenda-final-group-separator <span style="color: #8B887D; font-style: italic;">"\n"</span>))
</pre>
</div>
</div>
</div>
<div id="outline-container-org726bbd9" class="outline-3">
<h3 id="org726bbd9">Org-download</h3>
<div class="outline-text-3" id="text-org726bbd9">
<p>
Allow drag-and-drop of images from browser, finder, etc.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! org-download <span style="color: #8B887D; font-style: italic;">"abo-abo/org-download"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (org general)
  <span style="color: #403D2E; font-style: italic;">:custom</span> (org-download-method 'directory)
  <span style="color: #403D2E; font-style: italic;">:init</span>
  (aero-mode-leader-def
    <span style="color: #403D2E; font-style: italic;">:keymaps</span> 'org-mode-map
    <span style="color: #8B887D; font-style: italic;">"ic"</span> '(org-download-clipboard <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"insert image from clipboard"</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org80c0ddf" class="outline-3">
<h3 id="org80c0ddf">Functions for the org agenda</h3>
<div class="outline-text-3" id="text-org80c0ddf">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/org-agenda-list</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"`</span><span style="color: #655370; font-weight: bold;">org-agenda</span><span style="color: #96a7a9; font-weight: bold;">', skipping command menu to list."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (org-agenda nil <span style="color: #8B887D; font-style: italic;">"a"</span>))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/org-class-agenda-list</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"`</span><span style="color: #655370; font-weight: bold;">org-agenda</span><span style="color: #96a7a9; font-weight: bold;">', skipping command menu to list."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (org-agenda nil <span style="color: #8B887D; font-style: italic;">"s"</span>))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/org-agenda-todo</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"`</span><span style="color: #655370; font-weight: bold;">org-agenda</span><span style="color: #96a7a9; font-weight: bold;">', skipping command menu to todos."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (org-agenda nil <span style="color: #8B887D; font-style: italic;">"t"</span>))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/org-agenda-new</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Create a new task at the current agenda item."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (org-agenda-switch-to)
  (org-capture 0))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">org-agenda-list-closed-on-last-workday</span> ()
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">let*</span> ((org-agenda-files (list (buffer-file-name)
                                 (expand-file-name <span style="color: #8B887D; font-style: italic;">"archive/archive.org"</span> aero/thornlog-path)
                                 (expand-file-name <span style="color: #8B887D; font-style: italic;">"log.org"</span> aero/roam-path)))
         (today (current-time))
         (weekday (format-time-string <span style="color: #8B887D; font-style: italic;">"%u"</span> today))
         (days-back (<span style="color: #737063; font-weight: bold;">if</span> (string= weekday <span style="color: #8B887D; font-style: italic;">"1"</span>) 3 1)) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">If today is Monday (1), go back 3 days to Friday</span>
         (specific-day (format-time-string <span style="color: #8B887D; font-style: italic;">"%Y-%m-%d"</span> (time-subtract today (days-to-time days-back))))
         (org-agenda-log-mode-items '(closed))
         (org-agenda-skip-deadline-if-done nil)
         (org-agenda-skip-scheduled-if-done nil)
         (org-agenda-skipp-timestamp-if-done nil)
         (org-super-agenda-groups '((<span style="color: #403D2E; font-style: italic;">:time-grid</span> t))))
    (org-agenda-list nil specific-day 'day)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">insert-todays-timestamp-at-entry-end</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Insert today's timestamp at the end of the current org entry."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">save-excursion</span>
    (org-back-to-heading t)
    (end-of-line)
    (insert <span style="color: #8B887D; font-style: italic;">" "</span>)
    (org-insert-time-stamp (current-time) nil)))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdd3c55d" class="outline-3">
<h3 id="orgdd3c55d">Org-roam</h3>
<div class="outline-text-3" id="text-orgdd3c55d">
<p>
A fantastic note-taking system, used for building a second brain.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! org-roam (<span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"org-roam/org-roam"</span> <span style="color: #403D2E; font-style: italic;">:files</span> (<span style="color: #403D2E; font-style: italic;">:defaults</span> <span style="color: #8B887D; font-style: italic;">"extensions/*"</span>))
  <span style="color: #403D2E; font-style: italic;">:defer</span> 1
  <span style="color: #403D2E; font-style: italic;">:after</span> (general org)

  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (org-roam-directory (expand-file-name <span style="color: #8B887D; font-style: italic;">"roam"</span> aero/thornlog-path))
  (org-roam-mode-sections
   (list #'org-roam-backlinks-section
         #'org-roam-reflinks-section
         #'org-roam-unlinked-references-section))

  (org-id-locations-file (expand-file-name <span style="color: #8B887D; font-style: italic;">".org-id-locations"</span> aero-cache-dir))

  (org-roam-capture-templates
   '((<span style="color: #8B887D; font-style: italic;">"d"</span> <span style="color: #8B887D; font-style: italic;">"default"</span> plain <span style="color: #8B887D; font-style: italic;">"%?"</span>
      <span style="color: #403D2E; font-style: italic;">:target</span> (file+head <span style="color: #8B887D; font-style: italic;">"%&lt;%Y%m%d%H%M%S&gt;-${slug}.org"</span> <span style="color: #8B887D; font-style: italic;">"#+title: ${title}\n"</span>)
      <span style="color: #403D2E; font-style: italic;">:immediate-finish</span> t  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">skip capture buffer, just open the file</span>
      <span style="color: #403D2E; font-style: italic;">:unnarrowed</span> t)))

  (org-roam-node-display-template
   (concat <span style="color: #8B887D; font-style: italic;">"${title} "</span> (propertize <span style="color: #8B887D; font-style: italic;">"${tags}"</span> 'face 'org-tag)))

  <span style="color: #403D2E; font-style: italic;">:config</span>
  (org-roam-db-autosync-mode)

  (aero-leader-def
    <span style="color: #8B887D; font-style: italic;">"vf"</span> 'org-roam-node-find
    <span style="color: #8B887D; font-style: italic;">"vF"</span> 'org-roam-capture
    <span style="color: #8B887D; font-style: italic;">"vi"</span> 'org-roam-node-insert
    <span style="color: #8B887D; font-style: italic;">"vc"</span> '(org-id-get-create <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"create org ID for node"</span>)
    <span style="color: #8B887D; font-style: italic;">"va"</span> 'org-roam-alias-add
    <span style="color: #8B887D; font-style: italic;">"vr"</span> 'org-roam-refile))
</pre>
</div>
</div>
<div id="outline-container-orged3b9d9" class="outline-4">
<h4 id="orged3b9d9">Thornlog</h4>
<div class="outline-text-4" id="text-orged3b9d9">
<p>
This is a personal logging and note taking system, based on org-roam. It's evolved drastically over the years, from a bespoke system to a more generic org-roam setup. The functions here are for managing the thornlog system.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/thornlog-log</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Personal persistent log."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (org-roam-node-visit (org-roam-node-from-title-or-alias <span style="color: #8B887D; font-style: italic;">"Work Log"</span>)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/thornlog-todo</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Personal todo list."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (org-roam-node-visit (org-roam-node-from-title-or-alias <span style="color: #8B887D; font-style: italic;">"Work Todo: Triaged Tasks and Inbox"</span>)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/thornlog-clean-save</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Automates the git commit in thornlog."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">let*</span> ((default-directory aero/thornlog-path)
         (timestamp (format-time-string <span style="color: #8B887D; font-style: italic;">"%Y-%m-%d %H:%M"</span>)))
    (save-some-buffers t)
    (<span style="color: #737063; font-weight: bold;">let</span> ((todo-file (expand-file-name <span style="color: #8B887D; font-style: italic;">"todo.org"</span> aero/roam-path)))
      (<span style="color: #737063; font-weight: bold;">when</span> (file-exists-p todo-file)
        (<span style="color: #737063; font-weight: bold;">with-current-buffer</span> (find-file-noselect todo-file)
          (aero/org-archive-cleanup)
          (save-some-buffers t))))
    (shell-command <span style="color: #8B887D; font-style: italic;">"git fetch origin"</span>)
    (<span style="color: #737063; font-weight: bold;">if</span> (not (zerop (shell-command <span style="color: #8B887D; font-style: italic;">"git rev-list --count @{u}.."</span>)))
        (<span style="color: #d7af00; font-weight: bold;">user-error</span> <span style="color: #8B887D; font-style: italic;">"Remote has changes, manual commit required"</span>)
      (<span style="color: #737063; font-weight: bold;">progn</span>
        (shell-command <span style="color: #8B887D; font-style: italic;">"git add -A"</span>)
        (shell-command (format <span style="color: #8B887D; font-style: italic;">"git commit -m '</span><span style="color: #655370; font-weight: bold; font-style: italic;">%s</span><span style="color: #8B887D; font-style: italic;">'"</span> timestamp))
        (<span style="color: #737063; font-weight: bold;">if</span> (not (zerop (shell-command <span style="color: #8B887D; font-style: italic;">"git push origin"</span>)))
            (<span style="color: #d7af00; font-weight: bold;">user-error</span> <span style="color: #8B887D; font-style: italic;">"Git push failed, manual inspection required"</span>)
          (message <span style="color: #8B887D; font-style: italic;">"Done with Thornlog commit and push"</span>))))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">insert-meeting-task</span> ()
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">let*</span> ((meeting-name (read-string <span style="color: #8B887D; font-style: italic;">"Meeting Name: "</span>))
         (meeting-time (read-string <span style="color: #8B887D; font-style: italic;">"Meeting Time (optional): "</span>))
         (today (format-time-string <span style="color: #8B887D; font-style: italic;">"%Y-%m-%d"</span>))
         (scheduled-string (<span style="color: #737063; font-weight: bold;">if</span> (not (string= meeting-time <span style="color: #8B887D; font-style: italic;">""</span>))
                               (format <span style="color: #8B887D; font-style: italic;">"&lt;%s %s&gt;"</span> today meeting-time)
                             (format <span style="color: #8B887D; font-style: italic;">"&lt;%s&gt;"</span> today)))
         (task-string (format <span style="color: #8B887D; font-style: italic;">"*** MEETING %s  :meeting:\nSCHEDULED: %s"</span>
                              meeting-name scheduled-string)))
    (goto-char (point-max))
    (re-search-backward <span style="color: #8B887D; font-style: italic;">"^\\*+ Meetings"</span> nil t)
    (org-end-of-subtree)
    (insert <span style="color: #8B887D; font-style: italic;">"\n\n"</span> task-string)))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/org-add-file-tag</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Prompts for a tag with completion from all org-roam tags and adds it to the file's tags, placing it after the #+title: line if it exists."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">let*</span> ((case-fold-search t)
         (all-tags-query <span style="color: #8B887D; font-style: italic;">"SELECT DISTINCT tag FROM tags"</span>)
         (all-tags-result (org-roam-db-query all-tags-query))
         (all-tags (mapcar #'car all-tags-result))
         (tag (completing-read <span style="color: #8B887D; font-style: italic;">"Tag: "</span> all-tags)))
    (<span style="color: #737063; font-weight: bold;">save-excursion</span>
      (goto-char (point-min))
      (<span style="color: #737063; font-weight: bold;">if</span> (re-search-forward <span style="color: #8B887D; font-style: italic;">"^#\\+filetags: </span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">(</span><span style="color: #8B887D; font-style: italic;">.*</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">)</span><span style="color: #8B887D; font-style: italic;">$"</span> nil t)
          (<span style="color: #737063; font-weight: bold;">let</span> ((existing-tags (match-string-no-properties 1)))
            (beginning-of-line)
            (delete-region (point) (line-end-position))
            (insert (format <span style="color: #8B887D; font-style: italic;">"#+filetags: %s%s:"</span> existing-tags tag)))
        <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">No existing tags, search for title line to place new tags after</span>
        (goto-char (point-min))
        (<span style="color: #737063; font-weight: bold;">if</span> (re-search-forward <span style="color: #8B887D; font-style: italic;">"^#\\+title:.*$"</span> nil t)
            (<span style="color: #737063; font-weight: bold;">progn</span>
              (end-of-line)
              (insert (format <span style="color: #8B887D; font-style: italic;">"\n#+filetags: :%s:"</span> tag)))
          (goto-char (point-min))
          (insert (format <span style="color: #8B887D; font-style: italic;">"#+filetags: :%s:\n"</span> tag)))))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/org-set-tags</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Set tag on current entry or file."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">if</span> (org-before-first-heading-p)
      (aero/org-add-file-tag)
    (org-set-tags-command)))

</pre>
</div>
</div>
</div>
<div id="outline-container-org0e78da3" class="outline-4">
<h4 id="org0e78da3">Update and created timestamps in Org-roam</h4>
<div class="outline-text-4" id="text-org0e78da3">
<p>
This section appears as a blog post at <a href="https://jmthornton.net/blog/p/org-roam-created-modified-dates">https://jmthornton.net/blog/p/org-roam-created-modified-dates</a>
</p>


<p>
It's useful to know when an org-roam node was created and when it's updated, so I automatically add a <code>:created:</code> property when visiting a node if it doesn't already exist, and a <code>:modified:</code> property when saving a node. This way, I can see when a note was created and when it was last modified. Note that the <code>:created:</code> property parses the timestamp from the filename and relies on Org-roam's default naming scheme. If you use a different naming scheme, you'll need to modify the <code>org-roam-extract-timestamp-from-filepath</code> function to match your scheme.
</p>
</div>
<ul class="org-ul">
<li><a id="orgbbd69dd"></a>Automated creation date<br />
<div class="outline-text-5" id="text-orgbbd69dd">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/org-roam-insert-created-property</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Insert a :created: property for a new Org-roam node if it doesn't already have one."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">when</span> (org-roam-file-p)
    (<span style="color: #737063; font-weight: bold;">unless</span> (org-entry-get (point-min) <span style="color: #8B887D; font-style: italic;">"created"</span> t)
      (<span style="color: #737063; font-weight: bold;">let</span> ((creation-time (aero/org-roam-extract-timestamp-from-filepath
                            (buffer-file-name))))
        (<span style="color: #737063; font-weight: bold;">when</span> creation-time
          (<span style="color: #737063; font-weight: bold;">save-excursion</span>
            (goto-char (point-min))
            (org-set-property <span style="color: #8B887D; font-style: italic;">"created"</span> creation-time)))))))
</pre>
</div>
</div>
</li>
<li><a id="orgfb6c48d"></a>Extract timestamp from filename<br />
<div class="outline-text-5" id="text-orgfb6c48d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/org-roam-extract-timestamp-from-filepath</span> (filepath)
  <span style="color: #96a7a9; font-weight: bold;">"Extract timestamp from the Org-roam FILEPATH assuming it follows the default naming scheme."</span>
  (<span style="color: #737063; font-weight: bold;">let</span> ((filename (file-name-nondirectory filepath)))
    (<span style="color: #737063; font-weight: bold;">when</span> (string-match <span style="color: #8B887D; font-style: italic;">"</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">(</span><span style="color: #8B887D; font-style: italic;">[0-9]\\{</span><span style="color: #5C7B52; font-style: italic;">8\\</span><span style="color: #8B887D; font-style: italic;">}</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">)</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">(</span><span style="color: #8B887D; font-style: italic;">[0-9]\\{</span><span style="color: #5C7B52; font-style: italic;">4\\</span><span style="color: #8B887D; font-style: italic;">}</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">)</span><span style="color: #8B887D; font-style: italic;">"</span> filename)
      (<span style="color: #737063; font-weight: bold;">let</span> ((year (substring filename (match-beginning 1) (+ (match-beginning 1) 4)))
            (month (substring filename (+ (match-beginning 1) 4) (+ (match-beginning 1) 6)))
            (day (substring filename (+ (match-beginning 1) 6) (+ (match-beginning 1) 8)))
            (hour (substring filename (match-beginning 2) (+ (match-beginning 2) 2)))
            (minute (substring filename (+ (match-beginning 2) 2) (+ (match-beginning 2) 4))))
        (<span style="color: #737063; font-weight: bold;">let</span> ((time-struct (date-to-time (format <span style="color: #8B887D; font-style: italic;">"%s-%s-%sT%s:%s"</span> year month day hour minute))))
          (format-time-string <span style="color: #8B887D; font-style: italic;">"[%Y-%m-%d %a %H:%M]"</span> time-struct))))))
</pre>
</div>
</div>
</li>
<li><a id="orgde8ebe2"></a>Keeping modification dates current<br />
<div class="outline-text-5" id="text-orgde8ebe2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/org-roam-insert-modified-property</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Update the :modified: property for an Org-roam node upon saving."</span>
  (<span style="color: #737063; font-weight: bold;">when</span> (org-roam-file-p)
    (<span style="color: #737063; font-weight: bold;">save-excursion</span>
      (goto-char (point-min))  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Ensure property is applied to the whole file</span>
      (org-set-property <span style="color: #8B887D; font-style: italic;">"modified"</span> (format-time-string <span style="color: #8B887D; font-style: italic;">"[%Y-%m-%d %a %H:%M]"</span>)))))
</pre>
</div>
</div>
</li>
<li><a id="org7b48889"></a>Hooking it up<br />
<div class="outline-text-5" id="text-org7b48889">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'before-save-hook #'aero/org-roam-insert-created-property)
(add-hook 'before-save-hook #'aero/org-roam-insert-modified-property)
</pre>
</div>
</div>
</li>
</ul>
</div>
<div id="outline-container-org9c6b95d" class="outline-4">
<h4 id="org9c6b95d">Consult-org-roam</h4>
<div class="outline-text-4" id="text-org9c6b95d">
<p>
Provides a more powerful interface for searching org-roam nodes using ripgrep
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! consult-org-roam <span style="color: #8B887D; font-style: italic;">"jgru/consult-org-roam"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (org-roam general)
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (consult-org-roam-grep-func #'consult-ripgrep)
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (aero-leader-def
    <span style="color: #8B887D; font-style: italic;">"vb"</span> 'consult-org-roam-backlinks
    <span style="color: #8B887D; font-style: italic;">"vB"</span> 'consult-org-roam-backlinks-recursive
    <span style="color: #8B887D; font-style: italic;">"vl"</span> 'consult-org-roam-forward-links
    <span style="color: #8B887D; font-style: italic;">"v'"</span> 'consult-org-roam-search))
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgaa164b4" class="outline-2">
<h2 id="orgaa164b4">Writing</h2>
<div class="outline-text-2" id="text-orgaa164b4">
</div>
<div id="outline-container-org011863c" class="outline-3">
<h3 id="org011863c">Writegood</h3>
<div class="outline-text-3" id="text-org011863c">
<p>
Mark passive voice, duplicate words and weasel words
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! writegood-mode (<span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"bnbeckwith/writegood-mode"</span>)
  <span style="color: #403D2E; font-style: italic;">:hook</span> ((text-mode) . writegood-mode))
</pre>
</div>
</div>
</div>
<div id="outline-container-org87d164d" class="outline-3">
<h3 id="org87d164d">Eprime</h3>
<div class="outline-text-3" id="text-org87d164d">
<p>
Mark E′ violations
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! eprime-mode (<span style="color: #403D2E; font-style: italic;">:host</span> gitlab <span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"thornjad/eprime-mode"</span> <span style="color: #403D2E; font-style: italic;">:branch</span> <span style="color: #8B887D; font-style: italic;">"main"</span>)
  <span style="color: #403D2E; font-style: italic;">:after</span> (general)
  <span style="color: #403D2E; font-style: italic;">:commands</span> (eprime-check-buffer eprime-mode)
  <span style="color: #403D2E; font-style: italic;">:init</span>
  (aero-leader-def
    <span style="color: #8B887D; font-style: italic;">"tp"</span> 'eprime-check-buffer
    <span style="color: #8B887D; font-style: italic;">"tP"</span> 'eprime-mode))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org22c3022" class="outline-2">
<h2 id="org22c3022">Applications</h2>
<div class="outline-text-2" id="text-org22c3022">
</div>
<div id="outline-container-orgeed07e5" class="outline-3">
<h3 id="orgeed07e5">Pomp (pomodoro)</h3>
<div class="outline-text-3" id="text-orgeed07e5">
<p>
My pomodoro package
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! pomp (<span style="color: #403D2E; font-style: italic;">:host</span> gitlab <span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"thornjad/pomp"</span>)
  <span style="color: #403D2E; font-style: italic;">:after</span> (general evil)
  <span style="color: #403D2E; font-style: italic;">:commands</span> (pomp)
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (pomp-pomodoro-length 55)
  (pomp-short-break-length 10)
  (pomp-long-break-length 15)
  <span style="color: #403D2E; font-style: italic;">:init</span>
  (aero-leader-def <span style="color: #8B887D; font-style: italic;">"ap"</span> 'pomp))
</pre>
</div>
</div>
</div>
<div id="outline-container-org187d1c4" class="outline-3">
<h3 id="org187d1c4">Restclient (HTTP requests)</h3>
<div class="outline-text-3" id="text-org187d1c4">
<p>
A simple way to make HTTP requests from within Emacs
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! restclient <span style="color: #403D2E; font-style: italic;">:auto</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (general)
  <span style="color: #403D2E; font-style: italic;">:commands</span> (restclient-mode)
  <span style="color: #403D2E; font-style: italic;">:mode</span> (<span style="color: #8B887D; font-style: italic;">"\\.http\\'"</span> . restclient-mode)
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (<span style="color: #737063; font-weight: bold;">require</span> '<span style="color: #655370; font-weight: bold;">general</span>)
  (aero-mode-leader-def
    <span style="color: #403D2E; font-style: italic;">:keymaps</span> 'restclient-mode-map
    <span style="color: #8B887D; font-style: italic;">"RET"</span> '(restclient-http-send-current-stay-in-window <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"Run query at point"</span>)
    <span style="color: #8B887D; font-style: italic;">"c"</span> '(restclient-http-send-current <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"Run query at point and focus"</span>)
    <span style="color: #8B887D; font-style: italic;">"r"</span> '(restclient-http-send-current-raw <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"Run query, no pretty print"</span>)
    <span style="color: #8B887D; font-style: italic;">"n"</span> 'restclient-jump-next
    <span style="color: #8B887D; font-style: italic;">"p"</span> 'restclient-jump-prev
    <span style="color: #8B887D; font-style: italic;">"."</span> 'restclient-mark-current
    <span style="color: #8B887D; font-style: italic;">"y"</span> 'restclient-copy-curl-command))
</pre>
</div>
</div>
</div>
<div id="outline-container-org244f9d9" class="outline-3">
<h3 id="org244f9d9">ESUP</h3>
<div class="outline-text-3" id="text-org244f9d9">
<p>
Emacs startup profiler.
</p>

<p>
The override of <code>esup-read-results</code> works around a bug where esup tries to profile cl-lib and fails by doing some nil checking.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! esup <span style="color: #8B887D; font-style: italic;">"jschaf/esup"</span>
  <span style="color: #403D2E; font-style: italic;">:commands</span> (esup)
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">esup-read-results</span> ()
    <span style="color: #96a7a9; font-weight: bold;">"Read all `</span><span style="color: #655370; font-weight: bold;">esup-result</span><span style="color: #96a7a9; font-weight: bold;">' objects from `</span><span style="color: #655370; font-weight: bold;">esup-incoming-results-buffer</span><span style="color: #96a7a9; font-weight: bold;">'.</span>

<span style="color: #96a7a9; font-weight: bold;">HACKED by Aero to add nil checking."</span>
    (<span style="color: #737063; font-weight: bold;">let</span> (results sep-end-point)
      (<span style="color: #737063; font-weight: bold;">with-current-buffer</span> (get-buffer esup-incoming-results-buffer)
        (goto-char esup-last-result-start-point)
        (message <span style="color: #8B887D; font-style: italic;">"at %s"</span> esup-last-result-start-point)
        (<span style="color: #737063; font-weight: bold;">unless</span> (eobp)
          (<span style="color: #737063; font-weight: bold;">while</span> (<span style="color: #737063; font-weight: bold;">setq</span> sep-end-point (esup-next-separator-end-point))
            (<span style="color: #737063; font-weight: bold;">when-let</span> ((result (car (esup-read-result (point)))))
              (<span style="color: #737063; font-weight: bold;">push</span> result results))
            (<span style="color: #737063; font-weight: bold;">setq</span> esup-last-result-start-point sep-end-point)
            (goto-char esup-last-result-start-point))))
      (nreverse results))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org555881e" class="outline-3">
<h3 id="org555881e">Virtual-comment</h3>
<div class="outline-text-3" id="text-org555881e">
<p>
An underrated package for temporary comments, really useful for debugging. The package doesn't define its own faces, using a variable instead, so we have to declare it.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! virtual-comment <span style="color: #8B887D; font-style: italic;">"thanhvg/emacs-virtual-comment"</span>
  <span style="color: #403D2E; font-style: italic;">:hook</span> ((virtual-comment-make-mode . evil-insert-state))
  <span style="color: #403D2E; font-style: italic;">:after</span> (general evil)
  <span style="color: #403D2E; font-style: italic;">:commands</span> (virtual-comment-make
             virtual-comment-next
             virtual-comment-previous
             virtual-comment-delete
             virtual-comment-paste
             virtual-comment-show)
  <span style="color: #403D2E; font-style: italic;">:custom</span> (virtual-comment-face 'virtual-comment-face)
  <span style="color: #403D2E; font-style: italic;">:init</span>
  (<span style="color: #737063; font-weight: bold;">defface</span> <span style="color: #5C7B52;">virtual-comment-face</span>
    '((t <span style="color: #403D2E; font-style: italic;">:inherit</span> highlight))
    <span style="color: #96a7a9; font-weight: bold;">"Face for virtual comments"</span>
    <span style="color: #403D2E; font-style: italic;">:group</span> 'virtual-comment)
  (aero-leader-def
    <span style="color: #8B887D; font-style: italic;">"v"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"virtual comment"</span>)
    <span style="color: #8B887D; font-style: italic;">"vv"</span> 'virtual-comment-make
    <span style="color: #8B887D; font-style: italic;">"vn"</span> 'virtual-comment-next
    <span style="color: #8B887D; font-style: italic;">"vp"</span> 'virtual-comment-previous
    <span style="color: #8B887D; font-style: italic;">"vk"</span> 'virtual-comment-delete
    <span style="color: #8B887D; font-style: italic;">"vP"</span> 'virtual-comment-paste
    <span style="color: #8B887D; font-style: italic;">"vs"</span> 'virtual-comment-show))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org60efdd0" class="outline-2">
<h2 id="org60efdd0">Prog modes</h2>
<div class="outline-text-2" id="text-org60efdd0">
</div>
<div id="outline-container-org0ee629e" class="outline-3">
<h3 id="org0ee629e">Auto-mode settings</h3>
<div class="outline-text-3" id="text-org0ee629e">
<p>
Set up some auto-mode settings for various file types. Files without extensions are assumed to be text files.
</p>

<p>
For some reason, makefile-mode doesn't always activate for Makefiles, so we add it here.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'auto-mode-alist '(<span style="color: #8B887D; font-style: italic;">"/[</span><span style="color: #8B887D; font-style: italic;">^</span><span style="color: #8B887D; font-style: italic;">./]*\\'"</span> . text-mode))
(add-to-list 'auto-mode-alist '(<span style="color: #8B887D; font-style: italic;">"</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">(</span><span style="color: #8B887D; font-style: italic;">README</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">readme</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">)</span><span style="color: #8B887D; font-style: italic;">\\'"</span> . text-mode))
(add-to-list 'auto-mode-alist '(<span style="color: #8B887D; font-style: italic;">"/\\.dir-locals\\.el\\'"</span> . emacs-lisp-mode))
(add-to-list 'auto-mode-alist '(<span style="color: #8B887D; font-style: italic;">"/Cask\\'"</span> . emacs-lisp-mode))
(add-to-list 'auto-mode-alist '(<span style="color: #8B887D; font-style: italic;">"Makefile"</span> . makefile-mode))
</pre>
</div>
</div>
</div>
<div id="outline-container-org22fa5ac" class="outline-3">
<h3 id="org22fa5ac">C Language</h3>
<div class="outline-text-3" id="text-org22fa5ac">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! cc-mode <span style="color: #403D2E; font-style: italic;">:builtin</span>
  <span style="color: #403D2E; font-style: italic;">:mode</span> ((<span style="color: #8B887D; font-style: italic;">"\\.c\\'"</span> . c-mode)
         (<span style="color: #8B887D; font-style: italic;">"\\.h\\'"</span> . c-mode)
         (<span style="color: #8B887D; font-style: italic;">"\\.cpp\\'"</span> . cpp-mode)
         (<span style="color: #8B887D; font-style: italic;">"\\.hpp\\'"</span> . cpp-mode))
  <span style="color: #403D2E; font-style: italic;">:preface</span>
  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/c-mode-common-hook</span> ()
    <span style="color: #96a7a9; font-weight: bold;">"Hook to run in all C modes"</span>
    (set (make-local-variable 'parens-require-spaces) nil))
  <span style="color: #403D2E; font-style: italic;">:hook</span> (c-mode-common . aero/c-mode-common-hook))
</pre>
</div>
</div>
</div>
<div id="outline-container-org0493a3e" class="outline-3">
<h3 id="org0493a3e">Sh-script</h3>
<div class="outline-text-3" id="text-org0493a3e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! sh-script <span style="color: #403D2E; font-style: italic;">:builtin</span> <span style="color: #403D2E; font-style: italic;">:defer</span> t
  <span style="color: #403D2E; font-style: italic;">:mode</span> (<span style="color: #8B887D; font-style: italic;">"\\.</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">(</span><span style="color: #8B887D; font-style: italic;">sh</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">bash</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">zsh</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">zsh-theme</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">)</span><span style="color: #8B887D; font-style: italic;">\\'"</span> . sh-mode)
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">indent-paragraph</span> ()
    (<span style="color: #737063; font-weight: bold;">interactive</span>)
    (<span style="color: #737063; font-weight: bold;">save-excursion</span>
      (mark-paragraph) (indent-region (region-beginning) (region-end)))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org5b0f5f6" class="outline-3">
<h3 id="org5b0f5f6">Markdown</h3>
<div class="outline-text-3" id="text-org5b0f5f6">
<p>
We make an alteration to <code>markdown-mode-syntax-table</code> to teach it that quotes mean strings, regardless of what the mode's developer believes. We also ensure that checkboxes are not expanded by smartparens.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! markdown-mode <span style="color: #8B887D; font-style: italic;">"jrblevin/markdown-mode"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (general smartparens)
  <span style="color: #403D2E; font-style: italic;">:mode</span> ((<span style="color: #8B887D; font-style: italic;">"\\.md\\'"</span> . gfm-mode)
         (<span style="color: #8B887D; font-style: italic;">"\\.markdown\\'"</span> . gfm-mode)
         (<span style="color: #8B887D; font-style: italic;">"github\\.com.*\\.txt\\'"</span> . gfm-mode))
  <span style="color: #403D2E; font-style: italic;">:hook</span> (markdown-mode . flyspell-mode)

  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (markdown-mode-syntax-table (make-syntax-table text-mode-syntax-table))
  (markdown-header-scaling t)
  (markdown-display-remote-images t)
  (markdown-header-scaling-values '(1.3 1.2 1.1 1.0 1.0 1.0))
  (markdown-enable-wiki-links t)
  (markdown-italic-underscore t)
  (markdown-make-gfm-checkboxes-buttons t)
  (markdown-gfm-additional-languages '(<span style="color: #8B887D; font-style: italic;">"sh"</span>))
  (markdown-fontify-code-blocks-natively t)

  <span style="color: #403D2E; font-style: italic;">:config</span>
  (sp-local-pair 'gfm-mode <span style="color: #8B887D; font-style: italic;">"- [ "</span> <span style="color: #8B887D; font-style: italic;">"]"</span>))
</pre>
</div>
</div>
<div id="outline-container-org90c80e7" class="outline-4">
<h4 id="org90c80e7">Markdown-toc</h4>
<div class="outline-text-4" id="text-org90c80e7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! markdown-toc (<span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"ardumont/markdown-toc"</span>)
  <span style="color: #403D2E; font-style: italic;">:commands</span> (markdown-toc-generate-toc markdown-toc-refresh-toc))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org17f220c" class="outline-3">
<h3 id="org17f220c">Yaml</h3>
<div class="outline-text-3" id="text-org17f220c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! yaml-mode (<span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"yoshiki/yaml-mode"</span>)
  <span style="color: #403D2E; font-style: italic;">:mode</span> <span style="color: #8B887D; font-style: italic;">"\\.ya?ml\\'"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgef4fc0b" class="outline-3">
<h3 id="orgef4fc0b">Ocaml (Tuareg)</h3>
<div class="outline-text-3" id="text-orgef4fc0b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! tuareg <span style="color: #403D2E; font-style: italic;">:auto</span> <span style="color: #403D2E; font-style: italic;">:mode</span> (<span style="color: #8B887D; font-style: italic;">"\\.mli?\\'"</span> . tuareg-mode))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgfcff0f7" class="outline-3">
<h3 id="orgfcff0f7">Web mode (HTML, CSS, JS)</h3>
<div class="outline-text-3" id="text-orgfcff0f7">
<p>
If we have tree-sitter, prefer tsx-ts-mode (which will also load eglot)
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! web-mode <span style="color: #8B887D; font-style: italic;">"fxbois/web-mode"</span>
  <span style="color: #403D2E; font-style: italic;">:mode</span> <span style="color: #8B887D; font-style: italic;">"\\.</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">(</span><span style="color: #8B887D; font-style: italic;">jsp</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">tpl</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">php</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">xml</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">html?</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">erb</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">svg</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">jsx</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">s?css</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">)</span><span style="color: #8B887D; font-style: italic;">\\'"</span>
  <span style="color: #403D2E; font-style: italic;">:custom</span> (web-mode-enable-engine-detection t)
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (<span style="color: #737063; font-weight: bold;">unless</span> (treesitterp) (add-to-list 'auto-mode-alist '(<span style="color: #8B887D; font-style: italic;">"\\.tsx\\'"</span> . web-mode))))
</pre>
</div>
</div>
<div id="outline-container-org218f177" class="outline-4">
<h4 id="org218f177">Emmet</h4>
<div class="outline-text-4" id="text-org218f177">
<p>
Provides emmet expansion in web-mode
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! emmet-mode <span style="color: #403D2E; font-style: italic;">:auto</span>
  <span style="color: #403D2E; font-style: italic;">:hook</span> ((web-mode html-mode css-mode scss-mode js-mode) . emmet-mode)
  <span style="color: #403D2E; font-style: italic;">:init</span> (<span style="color: #737063; font-weight: bold;">setq</span> emmet-self-closing-tag-style <span style="color: #8B887D; font-style: italic;">" /"</span>)
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (add-hook 'js-mode-hook (<span style="color: #737063; font-weight: bold;">lambda</span> () (<span style="color: #737063; font-weight: bold;">setq</span> emmet-expand-jsx-className? t))))
</pre>
</div>

<p>
Ensure we expand className in JSX
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">eval-when-compile</span> (<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">emmet-expand-jsx-className?</span>))
(add-hook 'js-mode-hook (<span style="color: #737063; font-weight: bold;">lambda</span> () (<span style="color: #737063; font-weight: bold;">setq</span> emmet-expand-jsx-className? t)))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org8ba8226" class="outline-3">
<h3 id="org8ba8226">Jest</h3>
<div class="outline-text-3" id="text-org8ba8226">
<p>
My own package for running Jest tests from within Emacs. Based loosely on the functionality in VS Code
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! jest <span style="color: #8B887D; font-style: italic;">"thornjad/emacs-jest"</span>
  <span style="color: #403D2E; font-style: italic;">:commands</span> (jest jest-file jest-test)
  <span style="color: #403D2E; font-style: italic;">:after</span> (general))
</pre>
</div>
</div>
</div>
<div id="outline-container-org14eeacc" class="outline-3">
<h3 id="org14eeacc">SQL</h3>
<div class="outline-text-3" id="text-org14eeacc">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! sql <span style="color: #403D2E; font-style: italic;">:builtin</span>
  <span style="color: #403D2E; font-style: italic;">:defer</span> t
  <span style="color: #403D2E; font-style: italic;">:after</span> (general)
  <span style="color: #403D2E; font-style: italic;">:commands</span> (sql-connect)
  <span style="color: #403D2E; font-style: italic;">:init</span>
  (aero-leader-def
    <span style="color: #8B887D; font-style: italic;">"Sc"</span> 'sql-connect)

  <span style="color: #403D2E; font-style: italic;">:config</span>
  (<span style="color: #737063; font-weight: bold;">setq</span> sql-sqlite-program <span style="color: #8B887D; font-style: italic;">"sqlite3"</span>)

  (aero-mode-leader-def
    <span style="color: #403D2E; font-style: italic;">:keymaps</span> 'sql-mode-map
    <span style="color: #8B887D; font-style: italic;">"b"</span> 'sql-send-buffer
    <span style="color: #8B887D; font-style: italic;">"B"</span> 'aero/sql-send-buffer-and-focus
    <span style="color: #8B887D; font-style: italic;">"r"</span> 'sql-send-region
    <span style="color: #8B887D; font-style: italic;">"R"</span> 'aero/sql-send-region-and-focus
    <span style="color: #8B887D; font-style: italic;">"p"</span> 'sql-send-paragraph
    <span style="color: #8B887D; font-style: italic;">"P"</span> 'aero/sql-send-paragraph-and-focus
    <span style="color: #8B887D; font-style: italic;">"s"</span> 'sql-send-string
    <span style="color: #8B887D; font-style: italic;">"S"</span> 'aero/sql-send-string-and-focus)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">for sql comint</span>
  (add-to-list 'same-window-buffer-names <span style="color: #8B887D; font-style: italic;">"*SQL: *"</span>)
  (add-hook 'sql-interactive-mode-hook #'evil-insert-state)

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/sql-send-string-and-focus</span> ()
    <span style="color: #96a7a9; font-weight: bold;">"Send a string to SQLi and switch to SQLi in `insert state'."</span>
    (<span style="color: #737063; font-weight: bold;">interactive</span>)
    (<span style="color: #737063; font-weight: bold;">let</span> ((sql-pop-to-buffer-after-send-region t))
      (call-interactively 'sql-send-string)
      (evil-insert-state)))

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/sql-send-buffer-and-focus</span> ()
    <span style="color: #96a7a9; font-weight: bold;">"Send the buffer to SQLi and switch to SQLi in `insert state'."</span>
    (<span style="color: #737063; font-weight: bold;">interactive</span>)
    (<span style="color: #737063; font-weight: bold;">let</span> ((sql-pop-to-buffer-after-send-region t))
      (sql-send-buffer)
      (evil-insert-state)))

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/sql-send-paragraph-and-focus</span> ()
    <span style="color: #96a7a9; font-weight: bold;">"Send the paragraph to SQLi and switch to SQLi in `insert state'."</span>
    (<span style="color: #737063; font-weight: bold;">interactive</span>)
    (<span style="color: #737063; font-weight: bold;">let</span> ((sql-pop-to-buffer-after-send-region t))
      (sql-send-paragraph)
      (evil-insert-state)))

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/sql-send-region-and-focus</span> (start end)
    <span style="color: #96a7a9; font-weight: bold;">"Send region to SQLi and switch to SQLi in `insert state'."</span>
    (<span style="color: #737063; font-weight: bold;">interactive</span> <span style="color: #8B887D; font-style: italic;">"r"</span>)
    (<span style="color: #737063; font-weight: bold;">let</span> ((sql-pop-to-buffer-after-send-region t))
      (sql-send-region start end)
      (evil-insert-state)))

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">my-sql-save-history-hook</span> ()
    (<span style="color: #737063; font-weight: bold;">let</span> ((lval 'sql-input-ring-file-name)
          (rval 'sql-product))
      (<span style="color: #737063; font-weight: bold;">if</span> (symbol-value rval)
          (<span style="color: #737063; font-weight: bold;">let</span> ((filename
                 (concat <span style="color: #8B887D; font-style: italic;">"~/.emacs.d/sql/"</span>
                         (symbol-name (symbol-value rval))
                         <span style="color: #8B887D; font-style: italic;">"-history.sql"</span>)))
            (set (make-local-variable lval) filename))
        (<span style="color: #d7af00; font-weight: bold;">error</span>
         (format <span style="color: #8B887D; font-style: italic;">"SQL history will not be saved because %s is nil"</span>
                 (symbol-name rval))))))
  (add-hook 'sql-interactive-mode-hook 'my-sql-save-history-hook))
</pre>
</div>
</div>
</div>
<div id="outline-container-org110c5d8" class="outline-3">
<h3 id="org110c5d8">Lisp editing environment</h3>
<div class="outline-text-3" id="text-org110c5d8">
</div>
<div id="outline-container-orgacf0807" class="outline-4">
<h4 id="orgacf0807">Common Lisp</h4>
<div class="outline-text-4" id="text-orgacf0807">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! common-lisp-mode <span style="color: #403D2E; font-style: italic;">:builtin</span>
  <span style="color: #403D2E; font-style: italic;">:mode</span> <span style="color: #8B887D; font-style: italic;">"</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">(</span><span style="color: #8B887D; font-style: italic;">Lakefile|\\.</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">(</span><span style="color: #8B887D; font-style: italic;">cl|lisp</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">)</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">)</span><span style="color: #8B887D; font-style: italic;">\\'"</span>)
</pre>
</div>
</div>
<ul class="org-ul">
<li><a id="org6d59b5f"></a>Slime<br />
<div class="outline-text-5" id="text-org6d59b5f">
<p>
A powerful Common Lisp environment. We load SBCL faster by using a preset socket and POSIX shit. Note that this requires some setup in the SBCL REPL:
</p>

<div class="org-src-container">
<pre class="src src-common-lisp">(mapc 'require '(sb-bsd-sockets sb-posix sb-introspect sb-cltl2 asdf))
(save-lisp-and-die <span style="color: #8B887D; font-style: italic;">"sbcl.core-for-slime"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! slime <span style="color: #403D2E; font-style: italic;">:auto</span>
  <span style="color: #403D2E; font-style: italic;">:commands</span> slime
  <span style="color: #403D2E; font-style: italic;">:init</span>
  (<span style="color: #737063; font-weight: bold;">setq-default</span>
   inferior-lisp-program <span style="color: #8B887D; font-style: italic;">"ecl"</span>
   slime-contribs '(slime-fancy))
  (<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">slime-lisp-implementations</span>)
  (<span style="color: #737063; font-weight: bold;">setq</span> slime-lisp-implementations
        '((sbcl (<span style="color: #8B887D; font-style: italic;">"sbcl"</span> <span style="color: #8B887D; font-style: italic;">"--core"</span> <span style="color: #8B887D; font-style: italic;">"sbcl.core-for-slime"</span>))
          (ecl (<span style="color: #8B887D; font-style: italic;">"ecl"</span>)))))
</pre>
</div>
</div>
</li>
</ul>
</div>
<div id="outline-container-orgbd0144d" class="outline-4">
<h4 id="orgbd0144d">Redefine the Lisp indent function</h4>
<div class="outline-text-4" id="text-orgbd0144d">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">redefined to turn this:</span>
<span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">(:foo bar</span>
<span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;;       </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">:spam ham)</span>
<span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">into this:</span>
<span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">(:foo bar</span>
<span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;;  </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">:spam ham)</span>
(eval-after-load <span style="color: #8B887D; font-style: italic;">"lisp-mode"</span>
  '(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">lisp-indent-function</span> (indent-point state)
     <span style="color: #96a7a9; font-weight: bold;">"This function is the normal value of the variable `</span><span style="color: #655370; font-weight: bold;">lisp-indent-function</span><span style="color: #96a7a9; font-weight: bold;">'.</span>
<span style="color: #96a7a9; font-weight: bold;">  The function `</span><span style="color: #655370; font-weight: bold;">calculate-lisp-indent</span><span style="color: #96a7a9; font-weight: bold;">' calls this to determine if the arguments of</span>
<span style="color: #96a7a9; font-weight: bold;">  a Lisp function call should be indented specially. INDENT-POINT is the position</span>
<span style="color: #96a7a9; font-weight: bold;">  at which the line being indented begins. Point is located at the point to indent</span>
<span style="color: #96a7a9; font-weight: bold;">  under (for default indentation); STATE is the `</span><span style="color: #655370; font-weight: bold;">parse-partial-sexp</span><span style="color: #96a7a9; font-weight: bold;">' state for</span>
<span style="color: #96a7a9; font-weight: bold;">  that position. If the current line is in a call to a Lisp function that has a</span>
<span style="color: #96a7a9; font-weight: bold;">  non-nil property `</span><span style="color: #655370; font-weight: bold;">lisp-indent-function</span><span style="color: #96a7a9; font-weight: bold;">' (or the deprecated `</span><span style="color: #655370; font-weight: bold;">lisp-indent-hook</span><span style="color: #96a7a9; font-weight: bold;">'),</span>
<span style="color: #96a7a9; font-weight: bold;">  it specifies how to indent. The property value can be:</span>

<span style="color: #96a7a9; font-weight: bold;">  - `</span><span style="color: #655370; font-weight: bold;">defun</span><span style="color: #96a7a9; font-weight: bold;">', meaning indent `</span><span style="color: #655370; font-weight: bold;">defun</span><span style="color: #96a7a9; font-weight: bold;">'-style </span><span style="color: #d7af00; font-weight: bold;">\</span><span style="color: #96a7a9; font-weight: bold;">(this is also the case if there is no</span>
<span style="color: #96a7a9; font-weight: bold;">    property and the function has a name that begins with \"def\", and three or</span>
<span style="color: #96a7a9; font-weight: bold;">    more arguments);</span>

<span style="color: #96a7a9; font-weight: bold;">  - an integer N, meaning indent the first N arguments specially (like ordinary</span>
<span style="color: #96a7a9; font-weight: bold;">    function arguments), and then indent any further arguments like a body;</span>

<span style="color: #96a7a9; font-weight: bold;">  - a function to call that returns the indentation (or nil).</span>
<span style="color: #96a7a9; font-weight: bold;">    `</span><span style="color: #655370; font-weight: bold;">lisp-indent-function</span><span style="color: #96a7a9; font-weight: bold;">' calls this function with the same two arguments that it</span>
<span style="color: #96a7a9; font-weight: bold;">    itself received.</span>

<span style="color: #96a7a9; font-weight: bold;">  This function returns either the indentation to use, or nil if the Lisp function</span>
<span style="color: #96a7a9; font-weight: bold;">  does not specify a special indentation."</span>
     (<span style="color: #737063; font-weight: bold;">let</span> ((normal-indent (current-column))
           (orig-point (point)))
       (goto-char (1+ (elt state 1)))
       (<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">calculate-lisp-indent-last-sexp</span>)
       (parse-partial-sexp (point) calculate-lisp-indent-last-sexp 0 t)
       (<span style="color: #737063; font-weight: bold;">cond</span>
        <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">car of form doesn't seem to be a symbol, or is a keyword</span>
        ((<span style="color: #737063; font-weight: bold;">and</span> (elt state 2)
              (<span style="color: #737063; font-weight: bold;">or</span> (not (looking-at <span style="color: #8B887D; font-style: italic;">"\\sw</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">\\s_"</span>))
                  (looking-at <span style="color: #8B887D; font-style: italic;">":"</span>)))
         (<span style="color: #737063; font-weight: bold;">if</span> (not (&gt; (<span style="color: #737063; font-weight: bold;">save-excursion</span> (forward-line 1) (point))
                     calculate-lisp-indent-last-sexp))
             (<span style="color: #737063; font-weight: bold;">progn</span> (goto-char calculate-lisp-indent-last-sexp)
                    (beginning-of-line)
                    (parse-partial-sexp (point)
                                        calculate-lisp-indent-last-sexp 0 t)))
         <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Indent under the list or under the first sexp on the same line as</span>
         <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">calculate-lisp-indent-last-sexp. Note that first thing on that line</span>
         <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">has to be complete sexp since we are inside the innermost containing</span>
         <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">sexp.</span>
         (backward-prefix-chars)
         (current-column))
        ((<span style="color: #737063; font-weight: bold;">and</span> (<span style="color: #737063; font-weight: bold;">save-excursion</span>
                (goto-char indent-point)
                (skip-syntax-forward <span style="color: #8B887D; font-style: italic;">" "</span>)
                (not (looking-at <span style="color: #8B887D; font-style: italic;">":"</span>)))
              (<span style="color: #737063; font-weight: bold;">save-excursion</span>
                (goto-char orig-point)
                (looking-at <span style="color: #8B887D; font-style: italic;">":"</span>)))
         (<span style="color: #737063; font-weight: bold;">save-excursion</span>
           (goto-char (+ 2 (elt state 1)))
           (current-column)))
        (t
         (<span style="color: #737063; font-weight: bold;">let</span> ((function (buffer-substring (point)
                                           (<span style="color: #737063; font-weight: bold;">progn</span> (forward-sexp 1) (point))))
               method)
           (<span style="color: #737063; font-weight: bold;">setq</span> method (<span style="color: #737063; font-weight: bold;">or</span> (function-get (intern-soft function)
                                          'lisp-indent-function)
                            (get (intern-soft function) 'lisp-indent-hook)))
           (<span style="color: #737063; font-weight: bold;">cond</span> ((<span style="color: #737063; font-weight: bold;">or</span> (eq method 'defun)
                      (<span style="color: #737063; font-weight: bold;">and</span> (null method)
                           (&gt; (length function) 3)
                           (string-match <span style="color: #8B887D; font-style: italic;">"\\`def"</span> function)))
                  (lisp-indent-defform state indent-point))
                 ((integerp method)
                  (lisp-indent-specform method state
                                        indent-point normal-indent))
                 (method
                  (funcall method indent-point state)))))))))

(add-hook 'emacs-lisp-mode-hook (<span style="color: #737063; font-weight: bold;">lambda</span> () (<span style="color: #737063; font-weight: bold;">setq-local</span> indent-tabs-mode nil)))
(add-hook 'common-lisp-mode-hook (<span style="color: #737063; font-weight: bold;">lambda</span> () (<span style="color: #737063; font-weight: bold;">setq-local</span> indent-tabs-mode nil)))
(add-hook 'lisp-mode-hook (<span style="color: #737063; font-weight: bold;">lambda</span> () (<span style="color: #737063; font-weight: bold;">setq-local</span> indent-tabs-mode nil)))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org3395732" class="outline-3">
<h3 id="org3395732">Clojure</h3>
<div class="outline-text-3" id="text-org3395732">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! clojure-mode <span style="color: #403D2E; font-style: italic;">:auto</span> <span style="color: #403D2E; font-style: italic;">:mode</span> <span style="color: #8B887D; font-style: italic;">"\\.</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">(</span><span style="color: #8B887D; font-style: italic;">cljs?</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">cljs.*</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">edn</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">boot</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">)</span><span style="color: #8B887D; font-style: italic;">\\'"</span>)
</pre>
</div>
</div>
<div id="outline-container-orgb80dd1c" class="outline-4">
<h4 id="orgb80dd1c">Cider</h4>
<div class="outline-text-4" id="text-orgb80dd1c">
<p>
A Clojure development environment
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! cider <span style="color: #403D2E; font-style: italic;">:auto</span>
  <span style="color: #403D2E; font-style: italic;">:hook</span> (clojure-mode . cider-mode)
  <span style="color: #403D2E; font-style: italic;">:after</span> (clojure-mode general)
  <span style="color: #403D2E; font-style: italic;">:commands</span> (cider
             cider-jack-in)
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (cider-show-error-buffer t)
  (cider-repl-history-file (expand-file-name <span style="color: #8B887D; font-style: italic;">"cider-history"</span> aero-cache-dir))
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (aero-mode-leader-def
    <span style="color: #403D2E; font-style: italic;">:keymaps</span> '(clojure-mode-map cider-mode-map)
    <span style="color: #8B887D; font-style: italic;">"c"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"cider"</span>)
    <span style="color: #8B887D; font-style: italic;">"c RET"</span> 'cider-run

    <span style="color: #8B887D; font-style: italic;">"c'"</span> 'cider-switch-to-repl-buffer
    <span style="color: #8B887D; font-style: italic;">"c,"</span> 'cider-pop-back
    <span style="color: #8B887D; font-style: italic;">"cQ"</span> 'cider-quit
    <span style="color: #8B887D; font-style: italic;">"cl"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"load"</span>)
    <span style="color: #8B887D; font-style: italic;">"clb"</span> 'cider-load-buffer
    <span style="color: #8B887D; font-style: italic;">"clf"</span> 'cider-load-file
    <span style="color: #8B887D; font-style: italic;">"cld"</span> '(cider-load-all-files <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"load directory"</span>)
    <span style="color: #8B887D; font-style: italic;">"cR"</span> 'cider-ns-refresh
    <span style="color: #8B887D; font-style: italic;">"ch"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"help"</span>)
    <span style="color: #8B887D; font-style: italic;">"chd"</span> 'cider-doc
    <span style="color: #8B887D; font-style: italic;">"chj"</span> 'cider-javadoc
    <span style="color: #8B887D; font-style: italic;">"chc"</span> 'cider-clojuredocs
    <span style="color: #8B887D; font-style: italic;">"chC"</span> 'cider-clojuredocs-web
    <span style="color: #8B887D; font-style: italic;">"cha"</span> 'cider-apropos
    <span style="color: #8B887D; font-style: italic;">"chD"</span> 'cider-apropos-documentation
    <span style="color: #8B887D; font-style: italic;">"ct"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"test"</span>)
    <span style="color: #8B887D; font-style: italic;">"ctt"</span> 'cider-test-run-test
    <span style="color: #8B887D; font-style: italic;">"ctr"</span> 'cider-test-rerun-test
    <span style="color: #8B887D; font-style: italic;">"ctn"</span> 'cider-test-run-ns-tests
    <span style="color: #8B887D; font-style: italic;">"ctp"</span> 'cider-test-run-project-tests
    <span style="color: #8B887D; font-style: italic;">"ctf"</span> 'cider-test-rerun-failed-tests
    <span style="color: #8B887D; font-style: italic;">"ctp"</span> 'cider-test-show-report
    <span style="color: #8B887D; font-style: italic;">"cb"</span> 'cider-load-buffer-and-switch-to-repl-buffer
    <span style="color: #8B887D; font-style: italic;">"cd"</span> 'cider-eval-defun-at-point
    <span style="color: #8B887D; font-style: italic;">"cs"</span> 'cider-eval-sexp-at-point
    <span style="color: #8B887D; font-style: italic;">"cr"</span> 'cider-eval-region
    <span style="color: #8B887D; font-style: italic;">"cm"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"macro expand"</span>)
    <span style="color: #8B887D; font-style: italic;">"cmm"</span> 'cider-macroexpand-1
    <span style="color: #8B887D; font-style: italic;">"cma"</span> 'cider-macroexpand-all
    <span style="color: #8B887D; font-style: italic;">"cN"</span> 'cider-eval-ns-form
    <span style="color: #8B887D; font-style: italic;">"ce"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"echo"</span>)
    <span style="color: #8B887D; font-style: italic;">"cee"</span> '(cider-eval-last-sexp <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"echo last sexp"</span>)
    <span style="color: #8B887D; font-style: italic;">"cer"</span> '(cider-eval-last-sexp-to-repl <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"eval last sexp to repl"</span>)
    <span style="color: #8B887D; font-style: italic;">"cep"</span> '(cider-pprint-eval-last-sexp <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"pprint last sexp"</span>)))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgcd8ea82" class="outline-3">
<h3 id="orgcd8ea82">Emacs Lisp</h3>
<div class="outline-text-3" id="text-orgcd8ea82">
</div>
<div id="outline-container-orgc05eca8" class="outline-4">
<h4 id="orgc05eca8">Package-lint</h4>
<div class="outline-text-4" id="text-orgc05eca8">
<p>
Linting for Emacs packages
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! package-lint <span style="color: #8B887D; font-style: italic;">"purcell/package-lint"</span>
  <span style="color: #403D2E; font-style: italic;">:commands</span> (package-lint-current-buffer))
</pre>
</div>
</div>
</div>
<div id="outline-container-org9382893" class="outline-4">
<h4 id="org9382893">Elisp-autofmt</h4>
<div class="outline-text-4" id="text-org9382893">
<p>
Automatically format elisp code
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! elisp-autofmt <span style="color: #403D2E; font-style: italic;">:auto</span>
  <span style="color: #403D2E; font-style: italic;">:commands</span> (elisp-autofmt-buffer
             elisp-autofmt-region)
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (elisp-autofmt-cache-directory
   (expand-file-name <span style="color: #8B887D; font-style: italic;">"elisp-autofmt-cache"</span> aero-cache-dir)))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgff4dfff" class="outline-4">
<h4 id="orgff4dfff">El2md</h4>
<div class="outline-text-4" id="text-orgff4dfff">
<p>
Convert elisp files to markdown Readme files
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! el2md (<span style="color: #403D2E; font-style: italic;">:host</span> gitlab <span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"thornjad/el2md"</span>)
  <span style="color: #403D2E; font-style: italic;">:after</span> (general)
  <span style="color: #403D2E; font-style: italic;">:commands</span> (el2md-write-readme
             el2md-view-buffer
             el2md-write-file)
  <span style="color: #403D2E; font-style: italic;">:init</span>
  (aero-mode-leader-def
    <span style="color: #403D2E; font-style: italic;">:keymaps</span> 'emacs-lisp-mode-map
    <span style="color: #8B887D; font-style: italic;">"m"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"el2md"</span>)
    <span style="color: #8B887D; font-style: italic;">"mr"</span> 'el2md-write-readme
    <span style="color: #8B887D; font-style: italic;">"mv"</span> 'el2md-view-buffer
    <span style="color: #8B887D; font-style: italic;">"mw"</span> 'el2md-write-file))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org0ee3bb9" class="outline-3">
<h3 id="org0ee3bb9">Python</h3>
<div class="outline-text-3" id="text-org0ee3bb9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! python-mode <span style="color: #403D2E; font-style: italic;">:auto</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (general)
  <span style="color: #403D2E; font-style: italic;">:mode</span> <span style="color: #8B887D; font-style: italic;">"\\.py\\'"</span>
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (python-indent-guess-indent-offset t)
  (python-indent-guess-indent-offset-verbose nil)
  <span style="color: #403D2E; font-style: italic;">:init</span>
  (<span style="color: #737063; font-weight: bold;">setq-default</span> python-shell-interpreter <span style="color: #8B887D; font-style: italic;">"python3"</span>)
  (<span style="color: #737063; font-weight: bold;">setq-default</span> python-indent-offset 4)

  <span style="color: #403D2E; font-style: italic;">:config</span>
  (<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">python-mode-initialized</span> nil))
</pre>
</div>
</div>
<div id="outline-container-orgc02526c" class="outline-4">
<h4 id="orgc02526c">Elpy</h4>
<div class="outline-text-4" id="text-orgc02526c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! elpy (<span style="color: #403D2E; font-style: italic;">:host</span> github <span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"jorgenschaefer/elpy"</span>)
  <span style="color: #403D2E; font-style: italic;">:hook</span> ((python-mode ein-mode) . elpy-mode)
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (elpy-rpc-virtualenv-path 'default)
  (elpy-rpc-python-command <span style="color: #8B887D; font-style: italic;">"python3"</span>)
  (py-return-key #'py-newline-and-indent)

  <span style="color: #403D2E; font-style: italic;">:config</span>
  (elpy-enable)
  (aero-mode-leader-def
    <span style="color: #403D2E; font-style: italic;">:keymaps</span> 'elpy-mode-map
    <span style="color: #8B887D; font-style: italic;">"p"</span> 'run-python
    <span style="color: #8B887D; font-style: italic;">"'"</span> 'elpy-shell-switch-to-shell
    <span style="color: #8B887D; font-style: italic;">"s"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"shell send"</span>)
    <span style="color: #8B887D; font-style: italic;">"ss"</span> '(elpy-shell-send-region-or-buffer)
    <span style="color: #8B887D; font-style: italic;">"sS"</span> '(elpy-shell-send-region-or-buffer-and-go)
    <span style="color: #8B887D; font-style: italic;">"sd"</span> '(elpy-shell-send-defun)
    <span style="color: #8B887D; font-style: italic;">"sD"</span> '(elpy-shell-send-defun-and-go)
    <span style="color: #8B887D; font-style: italic;">"sb"</span> '(elpy-shell-send-buffer)
    <span style="color: #8B887D; font-style: italic;">"sB"</span> '(elpy-shell-send-buffer-and-go)
    <span style="color: #8B887D; font-style: italic;">"sc"</span> '(elpy-shell-send-defclass)
    <span style="color: #8B887D; font-style: italic;">"sC"</span> '(elpy-shell-send-defclass-and-go)))
</pre>
</div>
</div>
</div>
<div id="outline-container-orge6d462d" class="outline-4">
<h4 id="orge6d462d">Flymake-mypy</h4>
<div class="outline-text-4" id="text-orge6d462d">
<p>
Some type checking via Flymake. Must be added after eglot so eglot doesn't clobber it.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! flymake-mypy <span style="color: #8B887D; font-style: italic;">"com4/flymake-mypy"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (eglot flymake)
  <span style="color: #403D2E; font-style: italic;">:init</span>
  (add-hook 'eglot-managed-mode-hook
            (<span style="color: #737063; font-weight: bold;">lambda</span> ()
              (<span style="color: #737063; font-weight: bold;">when</span> (derived-mode-p 'python-base-mode)
                (flymake-mypy-enable)))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org1d63dc7" class="outline-4">
<h4 id="org1d63dc7">Flymake-ruff</h4>
<div class="outline-text-4" id="text-org1d63dc7">
<p>
Some type checking via Flymake. Must be added after eglot so eglot doesn't clobber it.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! flymake-ruff <span style="color: #8B887D; font-style: italic;">"erickgnavar/flymake-ruff"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (eglot flymake)
  <span style="color: #403D2E; font-style: italic;">:functions</span> (flymake-ruff-load)
  <span style="color: #403D2E; font-style: italic;">:init</span>
  (<span style="color: #737063; font-weight: bold;">with-eval-after-load</span> 'eglot
    (add-hook 'eglot-managed-mode-hook
              (<span style="color: #737063; font-weight: bold;">lambda</span> ()
                (<span style="color: #737063; font-weight: bold;">when</span> (derived-mode-p 'python-base-mode)
                  (<span style="color: #737063; font-weight: bold;">setq</span> python-flymake-command '(<span style="color: #8B887D; font-style: italic;">"ruff"</span> <span style="color: #8B887D; font-style: italic;">"--quiet"</span> <span style="color: #8B887D; font-style: italic;">"--stdin-filename=stdin"</span> <span style="color: #8B887D; font-style: italic;">"-"</span>))
                  (flymake-ruff-load))))))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org5bca374" class="outline-3">
<h3 id="org5bca374">Rust</h3>
<div class="outline-text-3" id="text-org5bca374">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! rust-mode <span style="color: #403D2E; font-style: italic;">:auto</span>
  <span style="color: #403D2E; font-style: italic;">:mode</span> <span style="color: #8B887D; font-style: italic;">"\\.rs\\'"</span>
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (setenv <span style="color: #8B887D; font-style: italic;">"PATH"</span> (concat <span style="color: #8B887D; font-style: italic;">"~/.cargo/bin:"</span> (getenv <span style="color: #8B887D; font-style: italic;">"PATH"</span>)))
  (<span style="color: #737063; font-weight: bold;">require</span> '<span style="color: #655370; font-weight: bold;">company</span>)
  (<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">company-tooltip-align-annotations</span>)
  (<span style="color: #737063; font-weight: bold;">declare-function</span> company-indent-or-complete-common <span style="color: #8B887D; font-style: italic;">"company"</span>)
  (<span style="color: #737063; font-weight: bold;">setq</span> company-tooltip-align-annotations t)
  (define-key rust-mode-map (kbd <span style="color: #8B887D; font-style: italic;">"TAB"</span>) #'company-indent-or-complete-common)
  (add-hook 'rust-mode-hook
            (<span style="color: #737063; font-weight: bold;">lambda</span> () (<span style="color: #737063; font-weight: bold;">setq</span> indent-tabs-mode t))))
</pre>
</div>
</div>
<div id="outline-container-orge84baa8" class="outline-4">
<h4 id="orge84baa8">Cargo</h4>
<div class="outline-text-4" id="text-orge84baa8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! cargo <span style="color: #403D2E; font-style: italic;">:auto</span>
  <span style="color: #403D2E; font-style: italic;">:commands</span> cargo-minor-mode
  <span style="color: #403D2E; font-style: italic;">:hook</span> (rust-mode . cargo-minor-mode))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org10bd1cd" class="outline-3">
<h3 id="org10bd1cd">TOML</h3>
<div class="outline-text-3" id="text-org10bd1cd">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! toml-mode <span style="color: #403D2E; font-style: italic;">:auto</span>
  <span style="color: #403D2E; font-style: italic;">:mode</span> <span style="color: #8B887D; font-style: italic;">"</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">(</span><span style="color: #8B887D; font-style: italic;">\\.toml</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">Cargo\\.lock</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">)</span><span style="color: #8B887D; font-style: italic;">\\'"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org0d590a1" class="outline-3">
<h3 id="org0d590a1">Docker</h3>
<div class="outline-text-3" id="text-org0d590a1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! docker-compose-mode <span style="color: #403D2E; font-style: italic;">:auto</span> <span style="color: #403D2E; font-style: italic;">:mode</span> <span style="color: #8B887D; font-style: italic;">"docker-compose.*</span><span style="color: #d7af00; font-weight: bold; font-style: italic;">\</span><span style="color: #8B887D; font-style: italic;">.yml\\'"</span>)
(package! dockerfile-mode <span style="color: #403D2E; font-style: italic;">:auto</span> <span style="color: #403D2E; font-style: italic;">:mode</span> <span style="color: #8B887D; font-style: italic;">"Dockerfile[a-zA-Z.-]*\\'"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org3243d65" class="outline-3">
<h3 id="org3243d65">Lua</h3>
<div class="outline-text-3" id="text-org3243d65">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! lua-mode <span style="color: #403D2E; font-style: italic;">:auto</span> <span style="color: #403D2E; font-style: italic;">:mode</span> <span style="color: #8B887D; font-style: italic;">"\\.lua\\'"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdb7166b" class="outline-3">
<h3 id="orgdb7166b">AppleScript</h3>
<div class="outline-text-3" id="text-orgdb7166b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! applescript-mode <span style="color: #403D2E; font-style: italic;">:auto</span> <span style="color: #403D2E; font-style: italic;">:mode</span> <span style="color: #8B887D; font-style: italic;">"\\.applescript\\'"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-orga1f6f8e" class="outline-3">
<h3 id="orga1f6f8e">Nhexl</h3>
<div class="outline-text-3" id="text-orga1f6f8e">
<p>
Provides a hexl-mode with a better interface, for viewing and editing binary files.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! nhexl-mode <span style="color: #403D2E; font-style: italic;">:auto</span> <span style="color: #403D2E; font-style: italic;">:defer</span> t)
</pre>
</div>
</div>
</div>
<div id="outline-container-org9c50586" class="outline-3">
<h3 id="org9c50586">Terraform</h3>
<div class="outline-text-3" id="text-org9c50586">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! terraform-mode <span style="color: #403D2E; font-style: italic;">:auto</span> <span style="color: #403D2E; font-style: italic;">:mode</span> <span style="color: #8B887D; font-style: italic;">"\\.tf\\'"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org18ca632" class="outline-3">
<h3 id="org18ca632">GraphQL</h3>
<div class="outline-text-3" id="text-org18ca632">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! graphql-mode <span style="color: #403D2E; font-style: italic;">:auto</span> <span style="color: #403D2E; font-style: italic;">:mode</span> <span style="color: #8B887D; font-style: italic;">"\\.graphql\\'"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org80c8e6a" class="outline-3">
<h3 id="org80c8e6a">Groovy</h3>
<div class="outline-text-3" id="text-org80c8e6a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! groovy-mode <span style="color: #403D2E; font-style: italic;">:auto</span> <span style="color: #403D2E; font-style: italic;">:mode</span> <span style="color: #8B887D; font-style: italic;">"</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">(</span><span style="color: #8B887D; font-style: italic;">\\.groovy\\'</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">Jenkinsfile</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">)</span><span style="color: #8B887D; font-style: italic;">"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org2d57fcb" class="outline-3">
<h3 id="org2d57fcb">CSV</h3>
<div class="outline-text-3" id="text-org2d57fcb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! csv-mode <span style="color: #403D2E; font-style: italic;">:auto</span> <span style="color: #403D2E; font-style: italic;">:mode</span> <span style="color: #8B887D; font-style: italic;">"\\.csv\\'"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org0df5e52" class="outline-3">
<h3 id="org0df5e52">Orson (WIP)</h3>
<div class="outline-text-3" id="text-org0df5e52">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook
 'orson-mode-hook
 (<span style="color: #737063; font-weight: bold;">lambda</span> ()
   (<span style="color: #737063; font-weight: bold;">setq-local</span> indent-tabs-mode nil)
   (prettify-symbols-mode nil)))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgba0b72e" class="outline-3">
<h3 id="orgba0b72e">Elm</h3>
<div class="outline-text-3" id="text-orgba0b72e">
<p>
This mode should eanble elm-indent-mode by default, but for some reason it stopped doing this on Dec 21, 2022. Probably caused this myself, but the <code>:hook</code> fixes it.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! elm-mode <span style="color: #403D2E; font-style: italic;">:auto</span> <span style="color: #403D2E; font-style: italic;">:hook</span> (elm-mode . elm-indent-mode))
</pre>
</div>
</div>
</div>
<div id="outline-container-org553a216" class="outline-3">
<h3 id="org553a216">TCL</h3>
<div class="outline-text-3" id="text-org553a216">
<p>
The greatest tool command language
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! tcl <span style="color: #403D2E; font-style: italic;">:builtin</span>
  <span style="color: #403D2E; font-style: italic;">:mode</span> (<span style="color: #8B887D; font-style: italic;">"</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">(</span><span style="color: #8B887D; font-style: italic;">\\.tcl</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">\\.test</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">)</span><span style="color: #8B887D; font-style: italic;">\\'"</span> . tcl-mode)
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (tcl-application <span style="color: #8B887D; font-style: italic;">"tclsh"</span>)
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (add-to-list 'tcl-type-alist '(<span style="color: #8B887D; font-style: italic;">"namespace"</span> <span style="color: #8B887D; font-style: italic;">"eval"</span> tcl-expr tcl-commands)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org83cfd20" class="outline-3">
<h3 id="org83cfd20">Rivet</h3>
<div class="outline-text-3" id="text-org83cfd20">
<p>
My own Rivet mode, which is a TCL extension for Apache
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! rivet-mode <span style="color: #8B887D; font-style: italic;">"thornjad/rivet-mode"</span>)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgbdbf1de" class="outline-2">
<h2 id="orgbdbf1de">Parentheses</h2>
<div class="outline-text-2" id="text-orgbdbf1de">
</div>
<div id="outline-container-org9c30b80" class="outline-3">
<h3 id="org9c30b80">Smartparens</h3>
<div class="outline-text-3" id="text-org9c30b80">
<p>
Provides a better way of handling parentheses.
</p>

<p>
My <code>aero/smart-closing-parenthesis</code> is based on a similar function in Spacemacs.
</p>

<p>
We also set up a bunch of paren pairs that aren't default for some reason.
</p>

<p>
Toward the end we set up parens with post-handlers to add an extra newline and indent when hitting RET inside them.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! smartparens <span style="color: #8B887D; font-style: italic;">"Fuco1/smartparens"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (general) <span style="color: #403D2E; font-style: italic;">:defer</span> 5
  <span style="color: #403D2E; font-style: italic;">:functions</span> (show-smartparens-global-mode
              sp-kill-sexp sp-local-pair
              sp-local-pairs sp-pair
              sp-up-sexp)
  <span style="color: #403D2E; font-style: italic;">:after</span> (evil general)
  <span style="color: #403D2E; font-style: italic;">:hook</span> ((after-init . smartparens-global-mode))

  <span style="color: #403D2E; font-style: italic;">:init</span>
  (<span style="color: #737063; font-weight: bold;">setq</span> sp-show-pair-from-inside t)
  (smartparens-global-mode +1)

  <span style="color: #403D2E; font-style: italic;">:config</span>
  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/smart-closing-parenthesis</span> ()
    <span style="color: #96a7a9; font-weight: bold;">"Insert a closing pair delimiter or move point past existing delimiter.</span>

<span style="color: #96a7a9; font-weight: bold;">If the expression at point is already balanced and there is a closing delimiter</span>
<span style="color: #96a7a9; font-weight: bold;">for that expression on the current line, move point forward past the closing</span>
<span style="color: #96a7a9; font-weight: bold;">delimiter. If the expression is balanced but there is no closing delimiter on</span>
<span style="color: #96a7a9; font-weight: bold;">the current line, insert a literal ')' character. If the expression is not</span>
<span style="color: #96a7a9; font-weight: bold;">balanced, insert a closing delimiter for the current expression. This command</span>
<span style="color: #96a7a9; font-weight: bold;">uses Smartparens navigation commands and therefore recognizes pair delimiters</span>
<span style="color: #96a7a9; font-weight: bold;">that have been defined using `</span><span style="color: #655370; font-weight: bold;">sp-pair</span><span style="color: #96a7a9; font-weight: bold;">' or `</span><span style="color: #655370; font-weight: bold;">sp-local-pair</span><span style="color: #96a7a9; font-weight: bold;">'."</span>
    (<span style="color: #737063; font-weight: bold;">interactive</span>)
    (<span style="color: #737063; font-weight: bold;">let*</span> ((sp-navigate-close-if-unbalanced t)
           (current-pos (point))
           (current-line (line-number-at-pos current-pos))
           next-pos next-line)
      (aero/voidvar! sp-navigate-close-if-unbalanced)
      (<span style="color: #737063; font-weight: bold;">save-excursion</span>
        (<span style="color: #737063; font-weight: bold;">let</span> ((buffer-undo-list)
              (modified (buffer-modified-p)))
          (<span style="color: #737063; font-weight: bold;">unwind-protect</span>
              (<span style="color: #737063; font-weight: bold;">progn</span>
                (sp-up-sexp)
                (<span style="color: #737063; font-weight: bold;">setq</span> next-pos (point)
                      next-line (line-number-at-pos)))
            (primitive-undo (length buffer-undo-list)
                            buffer-undo-list)
            (set-buffer-modified-p modified))))
      (<span style="color: #737063; font-weight: bold;">cond</span>
       ((<span style="color: #737063; font-weight: bold;">and</span> (= current-line next-line)
             (not (= current-pos next-pos)))
        (sp-up-sexp))
       (t
        (insert-char ?\))))))

  (<span style="color: #737063; font-weight: bold;">require</span> '<span style="color: #655370; font-weight: bold;">smartparens-config</span>)
  (show-smartparens-global-mode t)

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/copy-sexp-as-kill</span> (<span style="color: #387780; font-style: italic;">&amp;optional</span> arg)
    <span style="color: #96a7a9; font-weight: bold;">"Copy the sexp to the kill ring without killing."</span>
    (<span style="color: #737063; font-weight: bold;">interactive</span>)
    (funcall #'sp-kill-sexp arg t))

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/sp-wrap-double-quote</span> () (<span style="color: #737063; font-weight: bold;">interactive</span>) (sp-wrap-with-pair <span style="color: #8B887D; font-style: italic;">"\""</span>))
  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/sp-wrap-single-quote</span> () (<span style="color: #737063; font-weight: bold;">interactive</span>) (sp-wrap-with-pair <span style="color: #8B887D; font-style: italic;">"'"</span>))
  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/sp-wrap-backtick</span> () (<span style="color: #737063; font-weight: bold;">interactive</span>) (sp-wrap-with-pair <span style="color: #8B887D; font-style: italic;">"`"</span>))
  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/sp-wrap-angle</span> () (<span style="color: #737063; font-weight: bold;">interactive</span>) (sp-wrap-with-pair <span style="color: #8B887D; font-style: italic;">"&lt;"</span>))

  (general-define-key
   <span style="color: #403D2E; font-style: italic;">:states</span> '(normal visual)
   <span style="color: #403D2E; font-style: italic;">:prefix</span> <span style="color: #8B887D; font-style: italic;">"SPC"</span>
   <span style="color: #8B887D; font-style: italic;">"s^"</span> '(sp-beginning-of-sexp <span style="color: #403D2E; font-style: italic;">:which-key</span> <span style="color: #8B887D; font-style: italic;">"beginning of sexp"</span>)
   <span style="color: #8B887D; font-style: italic;">"s$"</span> '(sp-end-of-sexp <span style="color: #403D2E; font-style: italic;">:which-key</span> <span style="color: #8B887D; font-style: italic;">"end of sexp"</span>)
   <span style="color: #8B887D; font-style: italic;">"sh"</span> '(sp-backward-sexp <span style="color: #403D2E; font-style: italic;">:which-key</span> <span style="color: #8B887D; font-style: italic;">"back"</span>)
   <span style="color: #8B887D; font-style: italic;">"sl"</span> '(sp-forward-sexp <span style="color: #403D2E; font-style: italic;">:which-key</span> <span style="color: #8B887D; font-style: italic;">"forward"</span>)
   <span style="color: #8B887D; font-style: italic;">"sw"</span> '(<span style="color: #403D2E; font-style: italic;">:ignore</span> t <span style="color: #403D2E; font-style: italic;">:which-key</span> <span style="color: #8B887D; font-style: italic;">"wrap"</span>)
   <span style="color: #8B887D; font-style: italic;">"sw("</span> 'sp-wrap-round
   <span style="color: #8B887D; font-style: italic;">"sw{"</span> 'sp-wrap-curly
   <span style="color: #8B887D; font-style: italic;">"sw["</span> 'sp-wrap-square
   <span style="color: #8B887D; font-style: italic;">"sw&lt;"</span> 'aero/sp-wrap-angle
   <span style="color: #8B887D; font-style: italic;">"sw\""</span> '(aero/sp-wrap-double-quote <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"wrap double quote"</span>)
   <span style="color: #8B887D; font-style: italic;">"sw'"</span> '(aero/sp-wrap-single-quote <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"wrap single quote"</span>)
   <span style="color: #8B887D; font-style: italic;">"sw`"</span> '(aero/sp-wrap-backtick <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"wrap backtick"</span>)
   <span style="color: #8B887D; font-style: italic;">"swr"</span> 'sp-rewrap-sexp
   <span style="color: #8B887D; font-style: italic;">"su"</span> '(sp-unwrap-sexp <span style="color: #403D2E; font-style: italic;">:which-key</span> <span style="color: #8B887D; font-style: italic;">"unwrap"</span>)
   <span style="color: #8B887D; font-style: italic;">"sk"</span> '(sp-kill-sexp <span style="color: #403D2E; font-style: italic;">:which-key</span> <span style="color: #8B887D; font-style: italic;">"kill"</span>)
   <span style="color: #8B887D; font-style: italic;">"sK"</span> '(aero/copy-sexp-as-kill <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"copy as kill"</span>))

  (sp-local-pair 'web-mode <span style="color: #8B887D; font-style: italic;">"&lt;?"</span> <span style="color: #8B887D; font-style: italic;">"?&gt;"</span>)
  (sp-local-pair 'web-mode <span style="color: #8B887D; font-style: italic;">"{"</span> <span style="color: #8B887D; font-style: italic;">"}"</span>)
  (sp-local-pair 'web-mode <span style="color: #8B887D; font-style: italic;">"{ "</span> <span style="color: #8B887D; font-style: italic;">" }"</span>)
  (sp-local-pair 'web-mode <span style="color: #8B887D; font-style: italic;">"{%"</span> <span style="color: #8B887D; font-style: italic;">"%}"</span>)
  (sp-local-pair 'web-mode <span style="color: #8B887D; font-style: italic;">"{% "</span> <span style="color: #8B887D; font-style: italic;">" %}"</span>)
  (sp-local-pair 'web-mode <span style="color: #8B887D; font-style: italic;">"{{ "</span> <span style="color: #8B887D; font-style: italic;">" }}"</span>)
  (sp-local-pair 'web-mode <span style="color: #8B887D; font-style: italic;">"`"</span> <span style="color: #8B887D; font-style: italic;">"`"</span>)
  (sp-local-pair 'org-mode <span style="color: #8B887D; font-style: italic;">"$"</span> <span style="color: #8B887D; font-style: italic;">"$"</span>)
  (sp-local-pair 'org-mode <span style="color: #8B887D; font-style: italic;">"="</span> <span style="color: #8B887D; font-style: italic;">"="</span>)
  (sp-local-pair 'org-mode <span style="color: #8B887D; font-style: italic;">"/"</span> <span style="color: #8B887D; font-style: italic;">"/"</span> <span style="color: #403D2E; font-style: italic;">:trigger-wrap</span> <span style="color: #8B887D; font-style: italic;">"/"</span> )
  (sp-local-pair 'markdown-mode <span style="color: #8B887D; font-style: italic;">"```"</span> <span style="color: #8B887D; font-style: italic;">"```"</span> <span style="color: #403D2E; font-style: italic;">:post-handlers</span> '(<span style="color: #403D2E; font-style: italic;">:add</span> (<span style="color: #8B887D; font-style: italic;">"||\n[i]"</span> <span style="color: #8B887D; font-style: italic;">"RET"</span>)))

  (sp-pair <span style="color: #8B887D; font-style: italic;">"{"</span> <span style="color: #8B887D; font-style: italic;">"}"</span> <span style="color: #403D2E; font-style: italic;">:post-handlers</span> '(<span style="color: #403D2E; font-style: italic;">:add</span> (<span style="color: #8B887D; font-style: italic;">"||\n[i]"</span> <span style="color: #8B887D; font-style: italic;">"RET"</span>)))
  (sp-pair <span style="color: #8B887D; font-style: italic;">"["</span> <span style="color: #8B887D; font-style: italic;">"]"</span> <span style="color: #403D2E; font-style: italic;">:post-handlers</span> '(<span style="color: #403D2E; font-style: italic;">:add</span> (<span style="color: #8B887D; font-style: italic;">"||\n[i]"</span> <span style="color: #8B887D; font-style: italic;">"RET"</span>)))
  (sp-pair <span style="color: #8B887D; font-style: italic;">"("</span> <span style="color: #8B887D; font-style: italic;">")"</span> <span style="color: #403D2E; font-style: italic;">:post-handlers</span> '(<span style="color: #403D2E; font-style: italic;">:add</span> (<span style="color: #8B887D; font-style: italic;">"||\n[i]"</span> <span style="color: #8B887D; font-style: italic;">"RET"</span>)))

  (define-key evil-insert-state-map <span style="color: #8B887D; font-style: italic;">")"</span> 'aero/smart-closing-parenthesis))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdadae27" class="outline-3">
<h3 id="orgdadae27">Rainbow delimiters</h3>
<div class="outline-text-3" id="text-orgdadae27">
<p>
Colorize parens to make it easier to see where they start and end.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! rainbow-delimiters <span style="color: #8B887D; font-style: italic;">"Fanael/rainbow-delimiters"</span>
  <span style="color: #403D2E; font-style: italic;">:hook</span> ((prog-mode . rainbow-delimiters-mode)))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org84c4deb" class="outline-2">
<h2 id="org84c4deb">Flymake &amp; Flyspell</h2>
<div class="outline-text-2" id="text-org84c4deb">
</div>
<div id="outline-container-orgd90e76a" class="outline-3">
<h3 id="orgd90e76a">Flymake</h3>
<div class="outline-text-3" id="text-orgd90e76a">
<p>
Diagnostics, errors, warnings, etc. This is a faster version of Flycheck.
</p>

<p>
For fringe indicators, left is the default, but since git-gutter also uses left we need to make sure it still makes the same choice. If they conflict, one of them wins and it works out fine.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! flymake <span style="color: #403D2E; font-style: italic;">:builtin</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (general)
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (flymake-fringe-indicator-position 'left-fringe)
  (flymake-wrap-around t)
  (flymake-no-changes-timeout 0.6)

  <span style="color: #403D2E; font-style: italic;">:config</span>
  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Buffer diagnostics in bottom window</span>
  (add-to-list 'display-buffer-alist
               '(<span style="color: #8B887D; font-style: italic;">"\\*Flymake diagnostics for.*"</span>
                 (display-buffer-reuse-window display-buffer-in-side-window)
                 (side . bottom)
                 (window-height . 23)))

  (aero-leader-def
    <span style="color: #8B887D; font-style: italic;">"en"</span> 'flymake-goto-next-error
    <span style="color: #8B887D; font-style: italic;">"ep"</span> 'flymake-goto-prev-error
    <span style="color: #8B887D; font-style: italic;">"eb"</span> 'flymake-show-buffer-diagnostics))
</pre>
</div>
</div>
<div id="outline-container-org9ad57c6" class="outline-4">
<h4 id="org9ad57c6">Flymake-diagnostic-at-point</h4>
<div class="outline-text-4" id="text-org9ad57c6">
<p>
Makes flymake diagnostics appear in a popup
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! flymake-diagnostic-at-point (<span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"meqif/flymake-diagnostic-at-point"</span>)
  <span style="color: #403D2E; font-style: italic;">:after</span> flymake
  <span style="color: #403D2E; font-style: italic;">:hook</span> (flymake-mode . flymake-diagnostic-at-point-mode))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf54088b" class="outline-4">
<h4 id="orgf54088b">Flymake-eslint</h4>
<div class="outline-text-4" id="text-orgf54088b">
<p>
Flymake for ESLint. Must be added after eglot so eglot doesn't clobber it.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! flymake-eslint <span style="color: #8B887D; font-style: italic;">"orzechowskid/flymake-eslint"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (eglot)
  <span style="color: #403D2E; font-style: italic;">:init</span>
  (add-hook 'eglot-managed-mode-hook
            (<span style="color: #737063; font-weight: bold;">lambda</span> ()
              (<span style="color: #737063; font-weight: bold;">when</span> (<span style="color: #737063; font-weight: bold;">and</span> (derived-mode-p '(typescript-mode typescript-ts-mode js-mode web-mode))
                         (not (derived-mode-p 'json-mode))
                         (executable-find <span style="color: #8B887D; font-style: italic;">"eslint"</span>))
                (flymake-eslint-enable)))))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org549f8a1" class="outline-3">
<h3 id="org549f8a1">Flyspell</h3>
<div class="outline-text-3" id="text-org549f8a1">
<p>
Spell checking, using a custom dictionary. Skips code blocks in org-mode.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! flyspell <span style="color: #403D2E; font-style: italic;">:builtin</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (general)
  <span style="color: #403D2E; font-style: italic;">:hook</span> ((prog-mode . flyspell-prog-mode)
         (text-mode . flyspell-mode))
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">aero-etc-dir</span>)
  (<span style="color: #737063; font-weight: bold;">setq</span>
   flyspell-issue-message-flag nil
   ispell-personal-dictionary (expand-file-name <span style="color: #8B887D; font-style: italic;">"ispell/personal_dictionary.aws"</span> aero/thornlog-path)
   flyspell-sort-corrections nil)

  (add-to-list 'ispell-skip-region-alist '(<span style="color: #8B887D; font-style: italic;">"#\\+BEGIN_SRC"</span> . <span style="color: #8B887D; font-style: italic;">"#\\+END_SRC"</span>))
  (add-to-list 'ispell-skip-region-alist '(<span style="color: #8B887D; font-style: italic;">"#\\+BEGIN_EXAMPLE"</span> . <span style="color: #8B887D; font-style: italic;">"#\\+END_EXAMPLE"</span>))

  (aero-leader-def
    <span style="color: #8B887D; font-style: italic;">"psP"</span> 'flyspell-prog-mode
    <span style="color: #8B887D; font-style: italic;">"psN"</span> 'flyspell-goto-next-error
    <span style="color: #8B887D; font-style: italic;">"psw"</span> 'flyspell-word
    <span style="color: #8B887D; font-style: italic;">"psb"</span> 'flyspell-buffer
    <span style="color: #8B887D; font-style: italic;">"psr"</span> 'flyspell-region))
</pre>
</div>
</div>
<div id="outline-container-org20e95fe" class="outline-4">
<h4 id="org20e95fe">Flyspell-lazy</h4>
<div class="outline-text-4" id="text-org20e95fe">
<p>
Lazy flyspell mode, which only checks words when they're idle.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! flyspell-lazy (<span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"rolandwalker/flyspell-lazy"</span>)
  <span style="color: #403D2E; font-style: italic;">:hook</span> ((flyspell-mode . flyspell-lazy-mode)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org12e8b6a" class="outline-4">
<h4 id="org12e8b6a">Flyspell-correct</h4>
<div class="outline-text-4" id="text-org12e8b6a">
<p>
A better interface for correcting spelling
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! flyspell-correct <span style="color: #8B887D; font-style: italic;">"d12frosted/flyspell-correct"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (general flyspell)
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (aero-leader-def
    <span style="color: #8B887D; font-style: italic;">"psc"</span> 'flyspell-correct-wrapper
    <span style="color: #8B887D; font-style: italic;">"psC"</span> 'flyspell-correct-at-point
    <span style="color: #8B887D; font-style: italic;">"psp"</span> 'flyspell-correct-previous
    <span style="color: #8B887D; font-style: italic;">"psn"</span> 'flyspell-correct-next))
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org84863ed" class="outline-2">
<h2 id="org84863ed">Formatting (Apheleia)</h2>
<div class="outline-text-2" id="text-org84863ed">
<p>
It's hard to remember what this package is called, which is a marker of a bad name. However, it's good code, handling auto-formatting on save.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! apheleia
  (<span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"radian-software/apheleia"</span>
   <span style="color: #403D2E; font-style: italic;">:files</span> (<span style="color: #403D2E; font-style: italic;">:defaults</span> (<span style="color: #8B887D; font-style: italic;">"scripts"</span> <span style="color: #8B887D; font-style: italic;">"scripts/formatters"</span>)))
  <span style="color: #403D2E; font-style: italic;">:after</span> general
  <span style="color: #403D2E; font-style: italic;">:init</span> (apheleia-global-mode +1)
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (<span style="color: #737063; font-weight: bold;">dolist</span> (cmd `((elm-format . (npx <span style="color: #8B887D; font-style: italic;">"elm-format"</span> <span style="color: #8B887D; font-style: italic;">"--yes"</span> <span style="color: #8B887D; font-style: italic;">"--stdin"</span>))
                 (cljfmt . (<span style="color: #8B887D; font-style: italic;">"lein"</span> <span style="color: #8B887D; font-style: italic;">"cljfmt"</span> <span style="color: #8B887D; font-style: italic;">"fix"</span> filepath))))
    (add-to-list 'apheleia-formatters cmd))

  (add-to-list 'apheleia-mode-alist '(clojure-mode . cljfmt))

  (aero-leader-def
    <span style="color: #8B887D; font-style: italic;">"bI"</span> 'apheleia-format-buffer))
</pre>
</div>
</div>
</div>
<div id="outline-container-org10f916c" class="outline-2">
<h2 id="org10f916c">Debugging with Dape</h2>
<div class="outline-text-2" id="text-org10f916c">
<p>
Package for the debug adapter protocol. See <a href="https://github.com/svaante/dape">https://github.com/svaante/dape</a> for setup instructions, there's a fair bit of manual system setup required to actually use this.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! dape <span style="color: #8B887D; font-style: italic;">"svaante/dape"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (general project eglot)
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (dape-buffer-window-arrangement 'right)
  (dape-adapter-dir (expand-file-name <span style="color: #8B887D; font-style: italic;">"debug-adapters/"</span> user-emacs-directory))
  (dape-inlay-hints t)
  <span style="color: #403D2E; font-style: italic;">:config</span>
  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Save buffers on startup, useful for interpreted languages</span>
  (add-hook 'dape-on-start-hooks (<span style="color: #737063; font-weight: bold;">lambda</span> () (save-some-buffers t t)))

  (<span style="color: #737063; font-weight: bold;">setq</span> dape-configs-port 4711)

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/install-vscode-js-debug</span> ()
    <span style="color: #96a7a9; font-weight: bold;">"Run installation procedure to install JS debugging support"</span>
    (<span style="color: #737063; font-weight: bold;">interactive</span>)
    (<span style="color: #737063; font-weight: bold;">let</span> ((vscode-js-debug-dir (expand-file-name <span style="color: #8B887D; font-style: italic;">"js-debug"</span> dape-adapter-dir)))
      (mkdir vscode-js-debug-dir t)
      (<span style="color: #737063; font-weight: bold;">let</span> ((default-directory (expand-file-name vscode-js-debug-dir)))
        (vc-git-clone <span style="color: #8B887D; font-style: italic;">"https://github.com/microsoft/vscode-js-debug.git"</span> <span style="color: #8B887D; font-style: italic;">"."</span> nil)
        (message <span style="color: #8B887D; font-style: italic;">"git repository created"</span>)
        (call-process <span style="color: #8B887D; font-style: italic;">"npm"</span> nil <span style="color: #8B887D; font-style: italic;">"*aero-install*"</span> t <span style="color: #8B887D; font-style: italic;">"install"</span>)
        (message <span style="color: #8B887D; font-style: italic;">"npm dependencies installed"</span>)
        (call-process <span style="color: #8B887D; font-style: italic;">"npx"</span> nil <span style="color: #8B887D; font-style: italic;">"*aero-install*"</span> t <span style="color: #8B887D; font-style: italic;">"gulp"</span> <span style="color: #8B887D; font-style: italic;">"dapDebugServer"</span>)
        (message <span style="color: #8B887D; font-style: italic;">"vscode-js-debug installed"</span>))))

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Set up JS</span>
  (add-to-list 'dape-configs
               `(js-debug-node
                 modes (js-mode js-ts-mode typescript-mode typescript-ts-mode)
                 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Command to start the debug adapter</span>
                 command <span style="color: #8B887D; font-style: italic;">"node"</span>
                 command-cwd ,(concat dape-adapter-dir <span style="color: #8B887D; font-style: italic;">"js-debug"</span>)
                 command-args (<span style="color: #8B887D; font-style: italic;">"src/dapDebugServer.js"</span> ,(format <span style="color: #8B887D; font-style: italic;">"%d"</span> dape-configs-port))
                 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Port that Emacs will connect to the debug adapter</span>
                 port ,dape-configs-port
                 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Debug configuration</span>
                 <span style="color: #403D2E; font-style: italic;">:type</span> <span style="color: #8B887D; font-style: italic;">"pwa-node"</span>
                 <span style="color: #403D2E; font-style: italic;">:request</span> <span style="color: #8B887D; font-style: italic;">"attach"</span>
                 <span style="color: #403D2E; font-style: italic;">:name</span> <span style="color: #8B887D; font-style: italic;">"Attach to Jest Test"</span>
                 <span style="color: #403D2E; font-style: italic;">:address</span> <span style="color: #8B887D; font-style: italic;">"localhost"</span>
                 <span style="color: #403D2E; font-style: italic;">:port</span> 9229 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Node.js debug port (from --inspect-brk)</span>
                 <span style="color: #403D2E; font-style: italic;">:localRoot</span> dape-cwd-fn
                 <span style="color: #403D2E; font-style: italic;">:remoteRoot</span> nil
                 <span style="color: #403D2E; font-style: italic;">:skipFiles</span> [<span style="color: #8B887D; font-style: italic;">"&lt;node_internals&gt;/**"</span> <span style="color: #8B887D; font-style: italic;">"**/node_modules/**"</span>]
                 <span style="color: #403D2E; font-style: italic;">:resolveSourceMapLocations</span> [<span style="color: #8B887D; font-style: italic;">"!**/node_modules/**"</span> <span style="color: #8B887D; font-style: italic;">"**/*"</span>]
                 <span style="color: #403D2E; font-style: italic;">:suppressSourceMapWarning</span> t
                 )))
</pre>
</div>
</div>
</div>
<div id="outline-container-org999b8e8" class="outline-2">
<h2 id="org999b8e8">Whitespace and indentation</h2>
<div class="outline-text-2" id="text-org999b8e8">
<p>
WS-Butler removes trailing whitespace, but only in modes where it's not important. This is a good default, but we need to exempt some modes where whitespace is important.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! ws-butler <span style="color: #403D2E; font-style: italic;">:auto</span>
  <span style="color: #403D2E; font-style: italic;">:functions</span> (ws-butler-global-mode)
  <span style="color: #403D2E; font-style: italic;">:init</span> (ws-butler-global-mode)
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (ws-butler-global-exempt-modes '(special-mode comint-mode term-mode eshell-mode)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org7b927cc" class="outline-2">
<h2 id="org7b927cc">EWW: the Emacs Web Wowser</h2>
<div class="outline-text-2" id="text-org7b927cc">
<p>
A basic builtin browser. Very lightweight. Uses shr, which is a simple HTML renderer.
</p>

<p>
First some helper functions for shr that make it render block-level elements as paragraphs, set the buffer title, and set up some interactive functions.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defmacro</span> <span style="color: #83684C; font-weight: bold;">shr-display-block</span> (tag)
  <span style="color: #96a7a9; font-weight: bold;">"Register TAG a paragraph (in CSS parlance \"display:block;\").</span>

<span style="color: #96a7a9; font-weight: bold;">See https://developer.mozilla.org/en-US/docs/Glossary/Block-level_content"</span>
  (<span style="color: #737063; font-weight: bold;">let</span> ((fname
         (intern (format <span style="color: #8B887D; font-style: italic;">"shr-tag-%s"</span> tag)))
        (docstring
         (format <span style="color: #8B887D; font-style: italic;">"Render \"%s\" tag as paragraph."</span> tag)))
    `(<span style="color: #737063; font-weight: bold;">defun</span> ,fname (dom)
       ,docstring
       (shr-ensure-paragraph)
       (shr-generic dom)
       (shr-ensure-paragraph))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/set-eww-buffer-title</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Rename eww mode buffer so the title of the page is displayed, making</span>
<span style="color: #96a7a9; font-weight: bold;">     fake-tabbed-browsing easier"</span>
  (<span style="color: #737063; font-weight: bold;">let</span> ((title (plist-get eww-data <span style="color: #403D2E; font-style: italic;">:title</span>)))
    (<span style="color: #737063; font-weight: bold;">when</span> (eq major-mode 'eww-mode)
      (<span style="color: #737063; font-weight: bold;">if</span> title
          (rename-buffer (concat <span style="color: #8B887D; font-style: italic;">"eww - "</span> title) t)
        (rename-buffer <span style="color: #8B887D; font-style: italic;">"eww"</span> t)))))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/wiki-news</span> () (<span style="color: #737063; font-weight: bold;">interactive</span>)
       (eww-browse-url <span style="color: #8B887D; font-style: italic;">"https://en.wikipedia.org/wiki/Portal:Current_events"</span>))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/xwidgets-search-ddg</span> (<span style="color: #387780; font-style: italic;">&amp;optional</span> term)
  (<span style="color: #737063; font-weight: bold;">interactive</span> <span style="color: #8B887D; font-style: italic;">"sSearch DuckDuckGo: "</span>)
  (xwidget-webkit-browse-url (format <span style="color: #8B887D; font-style: italic;">"https://duckduckgo.com/?q=%s"</span> (<span style="color: #737063; font-weight: bold;">or</span> term <span style="color: #8B887D; font-style: italic;">""</span>)) t))

(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/ace-link-eww-new-buffer</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Call `</span><span style="color: #655370; font-weight: bold;">ace-link-eww</span><span style="color: #96a7a9; font-weight: bold;">' but open in a new buffer.</span>

<span style="color: #96a7a9; font-weight: bold;">This simply calls `</span><span style="color: #655370; font-weight: bold;">ace-link-eww</span><span style="color: #96a7a9; font-weight: bold;">' with a fake double prefix, which is equivalent to the list containing 16."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (ace-link-eww '(16)))
</pre>
</div>

<p>
Then the actual EWW config. We open almost everything from Emacs into EWW, except a few sites that are so JS-heavy that they don't work at all.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! eww <span style="color: #403D2E; font-style: italic;">:builtin</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (general evil ace-link)
  <span style="color: #403D2E; font-style: italic;">:commands</span> (eww eww-browse-url eww-search-words browse-url-at-point)
  <span style="color: #403D2E; font-style: italic;">:hook</span> ((eww-mode . visual-line-mode)
         (eww-after-render . aero/set-eww-buffer-title))

  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (browse-url-browser-function
   '((<span style="color: #8B887D; font-style: italic;">".*google.*maps.*"</span> . browse-url-generic)
     (<span style="color: #8B887D; font-style: italic;">"docs.google.com"</span> . browse-url-generic)
     (<span style="color: #8B887D; font-style: italic;">"*.atlassian.com"</span> . browse-url-generic)
     (<span style="color: #8B887D; font-style: italic;">"*.atlassian.net"</span> . browse-url-generic)
     (<span style="color: #8B887D; font-style: italic;">"github.com"</span> . browse-url-generic)
     (<span style="color: #8B887D; font-style: italic;">"gitlab.com"</span> . browse-url-generic)
     (<span style="color: #8B887D; font-style: italic;">"melpa.org"</span> . browse-url-generic)
     (<span style="color: #8B887D; font-style: italic;">"zoom.us"</span> . browse-url-generic)
     (<span style="color: #8B887D; font-style: italic;">"t.co"</span> . browse-url-generic)
     (<span style="color: #8B887D; font-style: italic;">"twitter.com"</span> . browse-url-generic)
     (<span style="color: #8B887D; font-style: italic;">"youtube.com"</span> . browse-url-generic)
     (<span style="color: #8B887D; font-style: italic;">"*.reddit.com"</span> . browse-url-generic)
     (<span style="color: #8B887D; font-style: italic;">"."</span> . eww-browse-url)))

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">MacOS needs its hand held to find the binary</span>
  (browse-url-generic-program (<span style="color: #737063; font-weight: bold;">if</span> (system-is-mac)
                                  <span style="color: #8B887D; font-style: italic;">"/Applications/Firefox Developer Edition.app/Contents/MacOS/firefox"</span>
                                <span style="color: #8B887D; font-style: italic;">"firefox"</span>))

  (eww-search-prefix <span style="color: #8B887D; font-style: italic;">"https://lite.duckduckgo.com/lite?q="</span>)
  (shr-max-width 90)
  (shr-indentation 2)
  (url-privacy-level 'high) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">don't send email nor last location</span>

  <span style="color: #403D2E; font-style: italic;">:init</span>
  (aero-leader-def <span style="color: #8B887D; font-style: italic;">"wbn"</span> '(aero/wiki-news <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"wikipedia news"</span>))

  <span style="color: #403D2E; font-style: italic;">:config</span>
  (evil-define-key 'normal eww-mode-map
    <span style="color: #8B887D; font-style: italic;">"SPC SPC"</span> 'execute-extended-command
    <span style="color: #8B887D; font-style: italic;">"?"</span> 'describe-mode
    <span style="color: #8B887D; font-style: italic;">"^"</span> 'eww-up-url
    <span style="color: #8B887D; font-style: italic;">"u"</span> 'eww-up-url
    <span style="color: #8B887D; font-style: italic;">"U"</span> 'eww-top-url
    (kbd <span style="color: #8B887D; font-style: italic;">"&lt;backspace&gt;"</span>) 'eww-back-url
    <span style="color: #8B887D; font-style: italic;">"H"</span> 'eww-back-url
    <span style="color: #8B887D; font-style: italic;">"L"</span> 'eww-forward-url
    <span style="color: #8B887D; font-style: italic;">"&amp;"</span> 'eww-browse-with-external-browser
    <span style="color: #8B887D; font-style: italic;">"D"</span> 'eww-download
    <span style="color: #8B887D; font-style: italic;">"o"</span> 'eww
    <span style="color: #8B887D; font-style: italic;">"O"</span> 'eww-open-in-new-buffer
    <span style="color: #8B887D; font-style: italic;">"p"</span> 'pocket-reader-eww-add-link
    <span style="color: #8B887D; font-style: italic;">"P"</span> 'aero/pocket-add-current-url
    <span style="color: #8B887D; font-style: italic;">"f"</span> 'ace-link-eww
    <span style="color: #8B887D; font-style: italic;">"F"</span> 'aero/ace-link-eww-new-buffer
    <span style="color: #8B887D; font-style: italic;">"m"</span> 'eww-add-bookmark
    <span style="color: #8B887D; font-style: italic;">"R"</span> 'eww-readable
    <span style="color: #8B887D; font-style: italic;">"r"</span> 'eww-reload
    <span style="color: #8B887D; font-style: italic;">"gr"</span> 'eww-reload
    <span style="color: #8B887D; font-style: italic;">"J"</span> 'eww-buffer-show-next
    <span style="color: #8B887D; font-style: italic;">"K"</span> 'eww-buffer-show-previous
    <span style="color: #8B887D; font-style: italic;">"T"</span> 'eww-open-in-new-buffer
    <span style="color: #8B887D; font-style: italic;">"W"</span> 'eww-copy-page-url
    <span style="color: #8B887D; font-style: italic;">"q"</span> 'kill-current-buffer
    <span style="color: #8B887D; font-style: italic;">"Q"</span> 'quit-window
    <span style="color: #8B887D; font-style: italic;">"go"</span> 'eww
    <span style="color: #8B887D; font-style: italic;">"gf"</span> 'eww-view-source
    <span style="color: #8B887D; font-style: italic;">"gc"</span> 'url-cookie-list
    <span style="color: #8B887D; font-style: italic;">"gh"</span> 'eww-list-histories
    <span style="color: #8B887D; font-style: italic;">"gb"</span> 'eww-list-buffers
    <span style="color: #8B887D; font-style: italic;">"gt"</span> 'eww-list-buffers)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">viewing history</span>
  (evil-set-initial-state 'eww-history-mode 'normal)
  (evil-define-key 'normal eww-history-mode-map
    (kbd <span style="color: #8B887D; font-style: italic;">"RET"</span>) 'eww-history-browse
    <span style="color: #8B887D; font-style: italic;">"q"</span> 'quit-window)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">viewing buffers</span>
  (evil-set-initial-state 'eww-buffers-mode 'normal)
  (evil-define-key 'normal eww-buffers-mode-map
    <span style="color: #8B887D; font-style: italic;">"D"</span> 'eww-buffer-kill
    (kbd <span style="color: #8B887D; font-style: italic;">"RET"</span>) 'eww-buffer-select
    <span style="color: #8B887D; font-style: italic;">"q"</span> 'quit-window)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Handle display block elements</span>
  (shr-display-block <span style="color: #8B887D; font-style: italic;">"article"</span>)
  (shr-display-block <span style="color: #8B887D; font-style: italic;">"aside"</span>)
  (shr-display-block <span style="color: #8B887D; font-style: italic;">"footer"</span>)
  (shr-display-block <span style="color: #8B887D; font-style: italic;">"header"</span>)
  (shr-display-block <span style="color: #8B887D; font-style: italic;">"nav"</span>)
  (shr-display-block <span style="color: #8B887D; font-style: italic;">"section"</span>)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">bookmarks</span>
  (evil-set-initial-state 'eww-bookmark-mode 'normal)
  (evil-define-key 'normal eww-bookmark-mode-map
    <span style="color: #8B887D; font-style: italic;">"D"</span> 'eww-bookmark-kill
    <span style="color: #8B887D; font-style: italic;">"P"</span> 'eww-bookmark-yank
    (kbd <span style="color: #8B887D; font-style: italic;">"RET"</span>) 'eww-bookmark-browse
    <span style="color: #8B887D; font-style: italic;">"q"</span> 'quit-window))
</pre>
</div>
</div>
<div id="outline-container-orgee0276f" class="outline-3">
<h3 id="orgee0276f">Shrface</h3>
<div class="outline-text-3" id="text-orgee0276f">
<p>
Adds some org-like features to EWW
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! shrface (<span style="color: #403D2E; font-style: italic;">:host</span> github <span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"chenyanming/shrface"</span>)
  <span style="color: #403D2E; font-style: italic;">:defer</span> t
  <span style="color: #403D2E; font-style: italic;">:after</span> (eww)
  <span style="color: #403D2E; font-style: italic;">:hook</span> (eww-after-render . shrface-mode)
  <span style="color: #403D2E; font-style: italic;">:custom</span> (shrface-href-versatile t)
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (shrface-basic)
  (shrface-trial)
  (shrface-default-keybindings))
</pre>
</div>
</div>
</div>
<div id="outline-container-org15053d5" class="outline-3">
<h3 id="org15053d5">Shr-tag-pre-highlight</h3>
<div class="outline-text-3" id="text-org15053d5">
<p>
Syntax highlighting for HTML pre tags
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! shr-tag-pre-highlight <span style="color: #8B887D; font-style: italic;">"xuchunyang/shr-tag-pre-highlight.el"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (shr)
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (add-to-list 'shr-external-rendering-functions '(pre . shr-tag-pre-highlight)))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org0223c8e" class="outline-2">
<h2 id="org0223c8e">Devdocs</h2>
<div class="outline-text-2" id="text-org0223c8e">
<p>
An interface for semi-offline documentation.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! devdocs <span style="color: #8B887D; font-style: italic;">"astoff/devdocs.el"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (general)
  <span style="color: #403D2E; font-style: italic;">:commands</span> (devdocs-lookup)
  <span style="color: #403D2E; font-style: italic;">:custom</span> (devdocs-data-dir (expand-file-name <span style="color: #8B887D; font-style: italic;">"devdocs"</span> aero-cache-dir))
  <span style="color: #403D2E; font-style: italic;">:init</span>
  (aero-leader-def <span style="color: #8B887D; font-style: italic;">"hD"</span> 'devdocs-lookup)
  (add-hook 'python-mode-hook (<span style="color: #737063; font-weight: bold;">lambda</span> () (<span style="color: #737063; font-weight: bold;">setq-local</span> devdocs-current-docs '(<span style="color: #8B887D; font-style: italic;">"python~3.12"</span>))))
  (add-hook 'python-ts-mode-hook (<span style="color: #737063; font-weight: bold;">lambda</span> () (<span style="color: #737063; font-weight: bold;">setq-local</span> devdocs-current-docs '(<span style="color: #8B887D; font-style: italic;">"python~3.12"</span>))))
  (add-hook 'typescript-mode-hook (<span style="color: #737063; font-weight: bold;">lambda</span> ()
                                    (<span style="color: #737063; font-weight: bold;">setq-local</span> devdocs-current-docs
                                                '(<span style="color: #8B887D; font-style: italic;">"typescript"</span> <span style="color: #8B887D; font-style: italic;">"rxjs"</span> <span style="color: #8B887D; font-style: italic;">"angular"</span> <span style="color: #8B887D; font-style: italic;">"javascript"</span>))))
  (add-hook 'ng2-ts-mode-hook (<span style="color: #737063; font-weight: bold;">lambda</span> ()
                                (<span style="color: #737063; font-weight: bold;">setq-local</span> devdocs-current-docs
                                            '(<span style="color: #8B887D; font-style: italic;">"typescript"</span> <span style="color: #8B887D; font-style: italic;">"angular"</span> <span style="color: #8B887D; font-style: italic;">"rxjs"</span> <span style="color: #8B887D; font-style: italic;">"javascript"</span> <span style="color: #8B887D; font-style: italic;">"html"</span>))))
  (add-hook 'web-mode-hook (<span style="color: #737063; font-weight: bold;">lambda</span> ()
                             (<span style="color: #737063; font-weight: bold;">setq-local</span> devdocs-current-docs
                                         '(<span style="color: #8B887D; font-style: italic;">"angular"</span> <span style="color: #8B887D; font-style: italic;">"rxjs"</span> <span style="color: #8B887D; font-style: italic;">"javascript"</span> <span style="color: #8B887D; font-style: italic;">"html"</span>))))
  (add-hook 'clojure-mode-hook (<span style="color: #737063; font-weight: bold;">lambda</span> ()
                                 (<span style="color: #737063; font-weight: bold;">setq-local</span> devdocs-current-docs
                                             '(<span style="color: #8B887D; font-style: italic;">"clojure~1.11"</span>)))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org5db0f1e" class="outline-2">
<h2 id="org5db0f1e">Elfeed</h2>
<div class="outline-text-2" id="text-org5db0f1e">
<p>
Simple RSS reader
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! elfeed <span style="color: #8B887D; font-style: italic;">"skeeto/elfeed"</span>
  <span style="color: #403D2E; font-style: italic;">:commands</span> (elfeed elfeed-db-compact)
  <span style="color: #403D2E; font-style: italic;">:after</span> (general evil)
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (elfeed-search-title-max-width 120)
  (elfeed-db-directory aero/thornlog-elfeed-directory)
  (elfeed-search-filter <span style="color: #8B887D; font-style: italic;">"+unread"</span>)
  (elfeed-sort-order 'ascending)
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (evil-set-initial-state 'elfeed-search-mode 'normal)
  (evil-set-initial-state 'elfeed-show-mode 'normal))
</pre>
</div>
</div>
<div id="outline-container-org5a52502" class="outline-3">
<h3 id="org5a52502">Elfeed-org</h3>
<div class="outline-text-3" id="text-org5a52502">
<p>
Allows managing feeds in an org file
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero-elfeed-org</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Set `</span><span style="color: #655370; font-weight: bold;">elfeed-feeds</span><span style="color: #96a7a9; font-weight: bold;">' from the org file."</span>
  (<span style="color: #737063; font-weight: bold;">interactive</span>)
  (<span style="color: #737063; font-weight: bold;">require</span> '<span style="color: #655370; font-weight: bold;">org-element</span>)
  (<span style="color: #737063; font-weight: bold;">setq</span> elfeed-feeds
        (<span style="color: #737063; font-weight: bold;">with-temp-buffer</span>
          (insert-file-contents aero/thornlog-elfeed-org-file)
          (org-mode)
          (<span style="color: #737063; font-weight: bold;">let</span> (links)
            (org-element-map (org-element-parse-buffer) 'link
              (<span style="color: #737063; font-weight: bold;">lambda</span> (element)
                (<span style="color: #737063; font-weight: bold;">let</span> ((raw-link (org-element-property <span style="color: #403D2E; font-style: italic;">:raw-link</span> element))
                      tags)

                  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Traverse up the tree to collect tags from parent headlines</span>
                  (<span style="color: #737063; font-weight: bold;">while</span> (<span style="color: #737063; font-weight: bold;">setq</span> element (org-element-property <span style="color: #403D2E; font-style: italic;">:parent</span> element))
                    (<span style="color: #737063; font-weight: bold;">when</span> (eq (org-element-type element) 'headline)
                      (<span style="color: #737063; font-weight: bold;">let</span> ((headline-tags (org-element-property <span style="color: #403D2E; font-style: italic;">:tags</span> element)))
                        (<span style="color: #737063; font-weight: bold;">when</span> headline-tags
                          (<span style="color: #737063; font-weight: bold;">setq</span> tags (append tags (mapcar 'intern headline-tags)))))))
                  (<span style="color: #737063; font-weight: bold;">when-let</span> ((feed-title (org-entry-get element <span style="color: #8B887D; font-style: italic;">"feed_title"</span>)))
                    (<span style="color: #737063; font-weight: bold;">setf</span> (elfeed-meta (elfeed-db-get-feed raw-link) <span style="color: #403D2E; font-style: italic;">:title</span>) feed-title))
                  (<span style="color: #737063; font-weight: bold;">push</span> (<span style="color: #737063; font-weight: bold;">if</span> tags (cons raw-link tags) raw-link) links))))
            links)))
  (elfeed-log 'info <span style="color: #8B887D; font-style: italic;">"aero-elfeed-org loaded %i feeds"</span> (length elfeed-feeds)))

<span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Run once now</span>
(aero-elfeed-org)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org36bf286" class="outline-2">
<h2 id="org36bf286">AI</h2>
<div class="outline-text-2" id="text-org36bf286">
</div>
<div id="outline-container-orgad599e2" class="outline-3">
<h3 id="orgad599e2">Gptel</h3>
<div class="outline-text-3" id="text-orgad599e2">
<p>
Generic interface to a variety of LLMs.
</p>

<p>
We do register Claude as a valid backend, but it's not a default because I've found it to hallucinate a lot more than GPT (as of 2024).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! gptel <span style="color: #8B887D; font-style: italic;">"karthink/gptel"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (general)
  <span style="color: #403D2E; font-style: italic;">:commands</span> (gptel gptel-send gptel-menu)
  <span style="color: #403D2E; font-style: italic;">:custom</span>
  (gptel-api-key openai-api-key)
  (gptel-model 'o1) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">default model when starting a buffer</span>
  (gptel-use-header-line t)
  (gptel-display-buffer-action '(pop-to-buffer-same-window)) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">chat in same window</span>
  (gptel-prompt-prefix-alist '((markdown-mode . <span style="color: #8B887D; font-style: italic;">"&#12;\n### "</span>)
                               (org-mode . <span style="color: #8B887D; font-style: italic;">"-----\n*** "</span>)
                               (text-mode . <span style="color: #8B887D; font-style: italic;">"------\n### "</span>)))
  (gptel-response-prefix-alist '((markdown-mode . <span style="color: #8B887D; font-style: italic;">"&#12;\n"</span>)
                                 (org-mode . <span style="color: #8B887D; font-style: italic;">"-----\n"</span>)
                                 (text-mode . <span style="color: #8B887D; font-style: italic;">"------\n"</span>)))
  (gptel-directives
   '((default
       . <span style="color: #8B887D; font-style: italic;">"You are a large language model living in Emacs and a helpful, competent assistant. You do not have feelings and you do not apologize for anything. The user is a senior software engineer with limited time; you treat the user's time as precious, but you are not afraid to ask for clarification when needed. Respond concisely and cite sources for factual claims. NEVER explain code unless asked to do so, the explanation is a waste of time unless you are instructed to provide it. Do not add explanations or descriptions unless asked. Use Github-flavored Markdown for code snippets. When using Python, assume the user is using version 3.9 or newer. When using Typescript, assume the user is using version 4.8 or newer. When using SQL, use lowercase keywords. Do no use LaTeX."</span>)
     (programming
      . <span style="color: #8B887D; font-style: italic;">"You are a large language model and a careful, competent programmer. Provide code and only code as output without any additional text, prompt or note."</span>)
     (writing . <span style="color: #8B887D; font-style: italic;">"You are a large language model and a writing assistant. Respond concisely."</span>)
     (chat . <span style="color: #8B887D; font-style: italic;">"You are a large language model and a conversation partner. Respond concisely."</span>)))

  <span style="color: #403D2E; font-style: italic;">:init</span>
  (aero-leader-def
    <span style="color: #8B887D; font-style: italic;">"aic"</span> 'gptel
    <span style="color: #8B887D; font-style: italic;">"ais"</span> '(gptel-send <span style="color: #403D2E; font-style: italic;">:wk</span> <span style="color: #8B887D; font-style: italic;">"send region or buffer to point"</span>)
    <span style="color: #8B887D; font-style: italic;">"aim"</span> 'gptel-menu)

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/gptel-send-buffer</span> ()
    <span style="color: #96a7a9; font-weight: bold;">"If in gptel buffer, goto end and call gptel-send."</span>
    (<span style="color: #737063; font-weight: bold;">interactive</span>)
    (<span style="color: #737063; font-weight: bold;">when</span> gptel-mode
      (<span style="color: #737063; font-weight: bold;">save-excursion</span>
        (goto-char (point-max))
        (call-interactively 'gptel-send))))

  (general-define-key
   <span style="color: #403D2E; font-style: italic;">:keymaps</span> 'gptel-mode-map
   (kbd <span style="color: #8B887D; font-style: italic;">"C-&lt;return&gt;"</span>) 'aero/gptel-send-buffer)

  <span style="color: #403D2E; font-style: italic;">:config</span>
  (<span style="color: #737063; font-weight: bold;">when</span> (<span style="color: #737063; font-weight: bold;">and</span> (boundp 'anthropic-api-key) anthropic-api-key)
    (gptel-make-anthropic <span style="color: #8B887D; font-style: italic;">"Claude"</span> <span style="color: #403D2E; font-style: italic;">:stream</span> t <span style="color: #403D2E; font-style: italic;">:key</span> anthropic-api-key)))
</pre>
</div>
</div>
<div id="outline-container-org96c45a8" class="outline-4">
<h4 id="org96c45a8">Gptel-quick</h4>
<div class="outline-text-4" id="text-org96c45a8">
<p>
Quickly look up LLM responses at point or in a region. Uses posframe if it's installed.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! gptel-quick <span style="color: #8B887D; font-style: italic;">"karthink/gptel-quick"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (general)
  <span style="color: #403D2E; font-style: italic;">:commands</span> (gptel-quick)
  <span style="color: #403D2E; font-style: italic;">:init</span>
  (aero-leader-def <span style="color: #8B887D; font-style: italic;">"aiq"</span> 'gptel-quick))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgeddb3dc" class="outline-3">
<h3 id="orgeddb3dc">Copilot</h3>
<div class="outline-text-3" id="text-orgeddb3dc">
<p>
A connection with Microsoft GitHub Copilot. Works best with company-box, so we consider it a requirement. The idle delay is longer than default so it doesn't mess with typing.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! copilot (<span style="color: #403D2E; font-style: italic;">:host</span> github <span style="color: #403D2E; font-style: italic;">:repo</span> <span style="color: #8B887D; font-style: italic;">"zerolfx/copilot.el"</span> <span style="color: #403D2E; font-style: italic;">:files</span> (<span style="color: #8B887D; font-style: italic;">"dist"</span> <span style="color: #8B887D; font-style: italic;">"*.el"</span>))
  <span style="color: #403D2E; font-style: italic;">:after</span> (company-box general)
  <span style="color: #403D2E; font-style: italic;">:hook</span> ((prog-mode org-mode) . copilot-mode)
  <span style="color: #403D2E; font-style: italic;">:custom</span> (copilot-idle-delay 0.2)
  <span style="color: #403D2E; font-style: italic;">:bind</span> (<span style="color: #403D2E; font-style: italic;">:map</span> copilot-mode-map
         (<span style="color: #8B887D; font-style: italic;">"C-&lt;tab&gt;"</span> . copilot-accept-completion)
         (<span style="color: #8B887D; font-style: italic;">"C-c C-i"</span> . copilot-accept-completion)
         (<span style="color: #8B887D; font-style: italic;">"C-c C-n"</span> . copilot-next-completion)
         (<span style="color: #8B887D; font-style: italic;">"C-c C-p"</span> . copilot-previous-completion)))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org5edb2f3" class="outline-2">
<h2 id="org5edb2f3">Shell</h2>
<div class="outline-text-2" id="text-org5edb2f3">
</div>
<div id="outline-container-org18f38e4" class="outline-3">
<h3 id="org18f38e4">Xterm-color</h3>
<div class="outline-text-3" id="text-org18f38e4">
<p>
Colorize shell output
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! xterm-color <span style="color: #403D2E; font-style: italic;">:auto</span>
  <span style="color: #403D2E; font-style: italic;">:commands</span> (xterm-color-filter)
  <span style="color: #403D2E; font-style: italic;">:init</span>
  (<span style="color: #737063; font-weight: bold;">setq</span> compilation-environment '(<span style="color: #8B887D; font-style: italic;">"TERM=xterm-256color"</span>))
  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">aero/advice-compilation-filter</span> (f proc string)
    (funcall f proc (xterm-color-filter string)))
  (advice-add 'compilation-filter <span style="color: #403D2E; font-style: italic;">:around</span> #'aero/advice-compilation-filter))
</pre>
</div>
</div>
</div>
<div id="outline-container-org4faf5b9" class="outline-3">
<h3 id="org4faf5b9">Eshell</h3>
<div class="outline-text-3" id="text-org4faf5b9">
<p>
Realistically this is my main shell. It does try to override some important bindings by default, so we undo that.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! eshell <span style="color: #403D2E; font-style: italic;">:builtin</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (general evil)
  <span style="color: #403D2E; font-style: italic;">:commands</span> eshell
  <span style="color: #403D2E; font-style: italic;">:defines</span> (evil-move-cursor-back
            eshell-save-history-on-exit
            eshell-history-size
            eshell-glob-case-insensitive
            eshell-ls-initial-args
            eshell-cmpl-dir-ignore
            eshell-visual-commands
            eshell-visual-subcommands)
  <span style="color: #403D2E; font-style: italic;">:functions</span> (eshell-previous-input
              eshell-next-input)
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (define-key eshell-mode-map (kbd <span style="color: #8B887D; font-style: italic;">"M-h"</span>) #'windmove-left)
  (define-key eshell-mode-map (kbd <span style="color: #8B887D; font-style: italic;">"M-l"</span>) #'windmove-right)
  (define-key eshell-mode-map (kbd <span style="color: #8B887D; font-style: italic;">"M-p"</span>) #'eshell-previous-input)
  (define-key eshell-mode-map (kbd <span style="color: #8B887D; font-style: italic;">"M-n"</span>) #'eshell-next-input)
  (define-key eshell-mode-map (kbd <span style="color: #8B887D; font-style: italic;">"M-r"</span>) #'consult-history)

  (<span style="color: #737063; font-weight: bold;">setq</span>
   eshell-save-history-on-exit t
   eshell-buffer-maximum-lines 12000
   eshell-glob-case-insensitive t
   eshell-aliases-file (expand-file-name <span style="color: #8B887D; font-style: italic;">"eshell-alias"</span> aero-etc-dir)
   eshell-history-size 350
   eshell-ls-initial-args <span style="color: #8B887D; font-style: italic;">"-lah"</span>
   eshell-cmpl-dir-ignore <span style="color: #8B887D; font-style: italic;">"\\`</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">(</span><span style="color: #8B887D; font-style: italic;">\\.\\.?</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">CVS</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">\\.svn</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">\\.git</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">)</span><span style="color: #8B887D; font-style: italic;">/\\'"</span>
   eshell-visual-commands '(<span style="color: #8B887D; font-style: italic;">"vi"</span> <span style="color: #8B887D; font-style: italic;">"screen"</span> <span style="color: #8B887D; font-style: italic;">"top"</span> <span style="color: #8B887D; font-style: italic;">"less"</span> <span style="color: #8B887D; font-style: italic;">"more"</span> <span style="color: #8B887D; font-style: italic;">"lynx"</span>
                            <span style="color: #8B887D; font-style: italic;">"ncftp"</span> <span style="color: #8B887D; font-style: italic;">"pine"</span> <span style="color: #8B887D; font-style: italic;">"tin"</span> <span style="color: #8B887D; font-style: italic;">"trn"</span> <span style="color: #8B887D; font-style: italic;">"elm"</span> <span style="color: #8B887D; font-style: italic;">"vim"</span>
                            <span style="color: #8B887D; font-style: italic;">"nmtui"</span> <span style="color: #8B887D; font-style: italic;">"alsamixer"</span> <span style="color: #8B887D; font-style: italic;">"htop"</span> <span style="color: #8B887D; font-style: italic;">"el"</span> <span style="color: #8B887D; font-style: italic;">"elinks"</span>
                            <span style="color: #8B887D; font-style: italic;">"ssh"</span> <span style="color: #8B887D; font-style: italic;">"nethack"</span> <span style="color: #8B887D; font-style: italic;">"dtop"</span> <span style="color: #8B887D; font-style: italic;">"dstat"</span> <span style="color: #8B887D; font-style: italic;">"docker-compose"</span>)
   eshell-visual-subcommands '((<span style="color: #8B887D; font-style: italic;">"git"</span> <span style="color: #8B887D; font-style: italic;">"log"</span> <span style="color: #8B887D; font-style: italic;">"diff"</span> <span style="color: #8B887D; font-style: italic;">"show"</span>))
   eshell-cmpl-cycle-completions nil <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">tab cycles the completion list</span>
   eshell-buffer-maximum-lines 12000 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">auto truncate after 12k lines</span>
   eshell-history-size 500 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">history size</span>
   eshell-buffer-shorthand t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">buffer shorthand -&gt; echo foo &gt; #'buffer</span>
   eshell-plain-echo-behavior t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">treat '</span><span style="color: #655370; background-color: #ecf3ec; font-weight: bold; font-style: italic;">echo</span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">' like shell echo</span>
   eshell-banner-message '(format <span style="color: #8B887D; font-style: italic;">"%s %s\n"</span>
                                  (propertize (format <span style="color: #8B887D; font-style: italic;">" %s "</span> (string-trim (buffer-name)))
                                              'face 'mode-line-highlight)
                                  (propertize (current-time-string)
                                              'face 'font-lock-keyword-face))
   eshell-scroll-to-bottom-on-input 'all
   eshell-kill-processes-on-exit t
   eshell-hist-ignoredups t
   eshell-error-if-no-glob t  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">mimics zsh behavior</span>
   completion-ignore-case t)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Enable autopairing in eshell</span>
  (add-hook 'eshell-mode-hook #'smartparens-mode)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Try to load in PATH</span>
  (<span style="color: #737063; font-weight: bold;">let</span> ((default-directory (expand-file-name <span style="color: #8B887D; font-style: italic;">"~"</span>)))
    (<span style="color: #737063; font-weight: bold;">setq</span> eshell-path-env (getenv <span style="color: #8B887D; font-style: italic;">"PATH"</span>)))

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">doesn't handle less too well</span>
  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">(setenv "PAGER" "cat")</span>
  (setenv <span style="color: #8B887D; font-style: italic;">"PAGER"</span> <span style="color: #8B887D; font-style: italic;">"bat"</span>)
  (setenv <span style="color: #8B887D; font-style: italic;">"TERM"</span> <span style="color: #8B887D; font-style: italic;">"xterm-256color"</span>)

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Remove hscroll-margin in shells, otherwise you get jumpiness when the</span>
  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">cursor comes close to the left/right edges of the window.</span>
  (add-hook 'eshell-mode-hook
            (<span style="color: #737063; font-weight: bold;">lambda</span> () (<span style="color: #737063; font-weight: bold;">setq-local</span> hscroll-margin 0
                                   evil-move-cursor-back nil)))

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Use tab to cycle completions</span>
  (add-hook 'eshell-mode-hook (<span style="color: #737063; font-weight: bold;">lambda</span> () (<span style="color: #737063; font-weight: bold;">setq-local</span> pcomplete-cycle-completions nil)))

  (<span style="color: #737063; font-weight: bold;">defalias</span> '<span style="color: #83684C; font-weight: bold;">eshell/emacs</span> 'find-file)

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">eshell/e</span> (pattern)
    (<span style="color: #737063; font-weight: bold;">if</span> (stringp pattern)
        (find-file pattern)
      (mapc #'find-file (mapcar #'expand-file-name pattern))))

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">eshell/rmdanglingdockers</span> ()
    (<span style="color: #737063; font-weight: bold;">let</span> ((dangling-images (shell-command-to-string <span style="color: #8B887D; font-style: italic;">"docker images -f \"dangling=true\" -q"</span>)))
      (<span style="color: #737063; font-weight: bold;">if</span> (string-empty-p dangling-images)
          (message <span style="color: #8B887D; font-style: italic;">"No dangling images found."</span>)
        (eshell-command (concat <span style="color: #8B887D; font-style: italic;">"docker rmi "</span> dangling-images)))))

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">eshell/dockerkillorphans</span> ()
    (<span style="color: #737063; font-weight: bold;">let</span> ((orphan-volumes (shell-command-to-string <span style="color: #8B887D; font-style: italic;">"docker volume ls -qf dangling=true"</span>)))
      (<span style="color: #737063; font-weight: bold;">if</span> (string-empty-p orphan-volumes)
          (message <span style="color: #8B887D; font-style: italic;">"No orphan volumes found."</span>)
        (eshell-command (concat <span style="color: #8B887D; font-style: italic;">"docker volume rm "</span> orphan-volumes)))))

  (<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">eshell/dockercleanup</span> ()
    (eshell/dockerkillorphans)
    (eshell/rmdanglingdockers))

  <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">So the history vars are defined</span>
  (<span style="color: #737063; font-weight: bold;">require</span> '<span style="color: #655370; font-weight: bold;">em-hist</span>)
  (<span style="color: #737063; font-weight: bold;">when</span> (boundp 'eshell-save-history-on-exit)
    <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Don't ask, just save</span>
    (<span style="color: #737063; font-weight: bold;">setq</span> eshell-save-history-on-exit t))

  (eval-after-load 'esh-opt
    '(progn
       (<span style="color: #737063; font-weight: bold;">require</span> '<span style="color: #655370; font-weight: bold;">em-cmpl</span>)
       (<span style="color: #737063; font-weight: bold;">require</span> '<span style="color: #655370; font-weight: bold;">em-prompt</span>)
       (<span style="color: #737063; font-weight: bold;">require</span> '<span style="color: #655370; font-weight: bold;">em-term</span>))))
</pre>
</div>
</div>
<div id="outline-container-org6ffb228" class="outline-4">
<h4 id="org6ffb228">Eshell-prompt-extras</h4>
<div class="outline-text-4" id="text-org6ffb228">
<p>
Adds a more informative prompt to eshell
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! eshell-prompt-extras <span style="color: #8B887D; font-style: italic;">"zwild/eshell-prompt-extras"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> (eshell)
  <span style="color: #403D2E; font-style: italic;">:config</span>
  (<span style="color: #737063; font-weight: bold;">with-eval-after-load</span> <span style="color: #8B887D; font-style: italic;">"esh-opt"</span>
    (autoload 'epe-theme-multiline-with-status <span style="color: #8B887D; font-style: italic;">"eshell-prompt-extras"</span>)
    (<span style="color: #737063; font-weight: bold;">setq</span> eshell-highlight-prompt nil
          eshell-prompt-function 'epe-theme-multiline-with-status)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org71c61c5" class="outline-4">
<h4 id="org71c61c5">Eshell-syntax-highlighting</h4>
<div class="outline-text-4" id="text-org71c61c5">
<p>
Syntax highlighting in eshell
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! eshell-syntax-highlighting <span style="color: #8B887D; font-style: italic;">"akreisher/eshell-syntax-highlighting"</span>
  <span style="color: #403D2E; font-style: italic;">:after</span> eshell-mode
  <span style="color: #403D2E; font-style: italic;">:hook</span> (eshell-mode . eshell-syntax-highlighting-mode))
</pre>
</div>
</div>
</div>
<div id="outline-container-org12ac71d" class="outline-4">
<h4 id="org12ac71d">Capf-autosuggest</h4>
<div class="outline-text-4" id="text-org12ac71d">
<p>
Provides overlay suggestions in eshell. Use M-f to insert the next suggested word
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package! capf-autosuggest <span style="color: #8B887D; font-style: italic;">"emacs-straight/capf-autosuggest"</span>
  <span style="color: #403D2E; font-style: italic;">:hook</span> (eshell-mode . capf-autosuggest-mode))
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org0014582" class="outline-2">
<h2 id="org0014582">Yarn-lock derived mode</h2>
<div class="outline-text-2" id="text-org0014582">
<p>
Rather than loading in a whole package, creating a derived mode for Yarn Locks is so simple that I just do it here.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">yarn-lock-mode-syntax-table</span>
  (<span style="color: #737063; font-weight: bold;">let</span> ((syntable (make-syntax-table)))
    (modify-syntax-entry ?# <span style="color: #8B887D; font-style: italic;">"&lt;"</span> syntable)
    (modify-syntax-entry ?\n <span style="color: #8B887D; font-style: italic;">"&gt;"</span> syntable)
    (modify-syntax-entry ?\" <span style="color: #8B887D; font-style: italic;">"\""</span> syntable)
    syntable))

(<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">yarn-lock-mode-package-re</span> <span style="color: #8B887D; font-style: italic;">"</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">(</span><span style="color: #8B887D; font-style: italic;">^</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">|</span><span style="color: #8B887D; font-style: italic;">,\\s-</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">)</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">(</span><span style="color: #8B887D; font-style: italic;">[a-zA-Z-_0-9]+</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">)</span><span style="color: #8B887D; font-style: italic;">@"</span>)
(<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">yarn-lock-mode-dependencies-re</span> <span style="color: #8B887D; font-style: italic;">"\\s-\\{4,\\}</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">(</span><span style="color: #8B887D; font-style: italic;">[a-zA-Z-_0-9]+</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">)</span><span style="color: #8B887D; font-style: italic;">\\s-"</span>)
(<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">yarn-lock-mode-attributes-re</span>
  (regexp-opt '(<span style="color: #8B887D; font-style: italic;">"version"</span> <span style="color: #8B887D; font-style: italic;">"resolved"</span> <span style="color: #8B887D; font-style: italic;">"dependencies"</span> <span style="color: #8B887D; font-style: italic;">"integrity"</span>)))
(<span style="color: #737063; font-weight: bold;">defvar</span> <span style="color: #5C7B52;">yarn-lock-mode-font-lock-defaults</span>
  `((,yarn-lock-mode-attributes-re . '((t <span style="color: #403D2E; font-style: italic;">:inherit</span> font-lock-builtin-face)))
    (,yarn-lock-mode-package-re . (2 '((t <span style="color: #403D2E; font-style: italic;">:inherit</span> bold)) t)) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Direct deps</span>
    (,yarn-lock-mode-dependencies-re . (1 '((t <span style="color: #403D2E; font-style: italic;">:inherit</span> bold)) t)) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Dep of another dep (nested)</span>
    ))
(<span style="color: #737063; font-weight: bold;">define-derived-mode</span> <span style="color: #83684C; font-weight: bold;">yarn-lock-mode</span> text-mode <span style="color: #8B887D; font-style: italic;">"Yarn Lock"</span>
  <span style="color: #96a7a9; font-weight: bold;">"Simple mode for yarn.lock."</span>
  <span style="color: #403D2E; font-style: italic;">:syntax-table</span> yarn-lock-mode-syntax-table
  (<span style="color: #737063; font-weight: bold;">setq</span> font-lock-defaults '(yarn-lock-mode-font-lock-defaults)
        buffer-read-only t))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcf9b317" class="outline-2">
<h2 id="orgcf9b317">General variable configuration</h2>
<div class="outline-text-2" id="text-orgcf9b317">
<p>
This is loaded toward the end so that it overrides other packages. This solves some occasional issues where a mode overrides indenting, for example.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">setq-default</span>
 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">general</span>
 ring-bell-function 'ignore <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">supprime cette putain de cloche.</span>
 use-dialog-box nil <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">use minibuffer to ask questions instead</span>
 use-short-answers t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">y-or-n instead of yes-or-no</span>
 sentence-end-double-space nil <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">the world will not go to shit today</span>
 default-fill-column 100 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">i am mortal, not Arthur Whitney</span>
 fill-column 100
 help-window-select t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">focus help window when opened</span>
 help-clean-buttons t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">remove quotes from buttons (why isn't this the default)</span>
 kill-ring-max 5000 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">truncate kill ring after 5000 entries</span>
 mark-ring-max 5000 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">truncate mark ring after 5000 entries</span>
 kill-do-not-save-duplicates t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">don't add duplicate strings to kill-ring</span>
 apropos-do-all t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">apropos is apropos</span>
 global-display-line-numbers-mode nil <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">fuck line numbers</span>
 gnutls-min-prime-bits 4096 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">256 est absurde</span>
 confirm-kill-emacs 'yes-or-no-p <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">too easy to kill when looking for alt file</span>
 switch-to-buffer-preserve-window-point t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">try to preserve point position in closed buffers</span>
 next-error-message-highlight t
 line-move-visual t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">move lines by display, not reality</span>
 make-pointer-invisible t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">le curseur est une chienne</span>
 auto-revert-interval 10 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">wait just a little longer (default is 5)</span>
 pop-up-windows nil <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">make new window for pop-ups</span>
 window-sides-slots '(0 1 1 1) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">side-window slots (left top right bottom)</span>
 shared-game-score-directory (expand-file-name <span style="color: #8B887D; font-style: italic;">"game-scores/"</span> aero-etc-dir)
 idle-update-delay 0.5 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">default is 0.5</span>
 bidi-paragraph-direction 'left-to-right <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">no need to check</span>
 bidi-inhibit-bpa t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">don't look for bidi paren balancing</span>
 create-lockfiles nil <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">tries to solve a non-existent problem and causes trouble doing it</span>
 jit-lock-defer-time 0 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">wait to fontify until input ends, but no longer</span>
 ns-use-srgb-colorspace nil <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">REVIEW what is this?</span>
 show-paren-context-when-offscreen t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">for some langs, show context in echo area</span>
 mail-user-agent nil <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">disable email click opening mail message; error instead</span>
 context-menu-mode t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">enable context menu when clicked, should be default</span>
 isearch-forward t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">ensures evil repeats searches in the correct direction</span>
 debugger-stack-frame-as-list t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">more readable Elisp stack traces</span>
 enable-recursive-minibuffers t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">allow minibuffer commands in the minibuffer</span>

 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Do not allow the cursor in the minibuffer prompt</span>
 minibuffer-prompt-properties '(read-only t cursor-intangible t face minibuffer-prompt)

 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Emacs should just have code that automatically sets this threshold according to some function</span>
 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">involving a constant, the current date, and Moore's Law.</span>
 large-file-warning-threshold 500000000

 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Defaults:</span>
 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">'("gnutls-cli --insecure -p %p %h"</span>
 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;;   </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">"gnutls-cli --insecure -p %p %h --protocols ssl3"</span>
 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;;   </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">"openssl s_client -connect %h:%p -no_ssl2 -ign_eof")</span>
 tls-program '(<span style="color: #8B887D; font-style: italic;">"gnutls-cli -p %p %h"</span>
               <span style="color: #8B887D; font-style: italic;">"openssl s_client -connect %h:%p -no_ssl2 -no_ssl3 -ign_eof"</span>)

 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Scrolling</span>
 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Emacs spends too much effort recentering the screen if you scroll the</span>
 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">cursor more than N lines past window edges (where N is the settings of</span>
 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">`</span><span style="color: #655370; background-color: #ecf3ec; font-weight: bold; font-style: italic;">scroll-conservatively</span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">'). This is especially slow in larger files</span>
 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">during large-scale scrolling commands. If kept over 100, the window is</span>
 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">never automatically re-centered.</span>
 scroll-conservatively 101
 scroll-margin 3 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">keep 3 lines at top and bottom of buffer when scrolling</span>
 scroll-preserve-screen-position t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">see variable documentation; this is the modern expectation</span>
 mouse-wheel-scroll-amount '(3 ((shift) . 1)) <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">make scroll wheel scroll more at a time</span>
 pixel-resolution-fine-flag 1 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">use pixel scrolling</span>
 hscroll-margin 5 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">like scroll-margin but horizontal</span>
 hscroll-step 1 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">on horizontal scroll, scroll by one column at a time</span>
 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Reduce cursor lag by a tiny bit by not auto-adjusting `</span><span style="color: #655370; background-color: #ecf3ec; font-weight: bold; font-style: italic;">window-vscroll</span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">'</span>
 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">for tall lines. Thanks to Sacha Chua for the time saved!</span>
 auto-window-vscroll nil
 mouse-wheel-progressive-speed nil <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">don't accelerate TODO may not want this?</span>
 comint-scroll-to-bottom-on-input t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">insert at bottom</span>
 comint-scroll-to-bottom-on-output nil <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">don't scroll on output by default</span>
 comint-input-ignoredups t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">ignore duplicate inputs in history</span>
 comint-prompt-read-only nil <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">breaks shell-command sometimes</span>

 compilation-scroll-output t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">scroll with compilation output</span>
 compilation-max-output-line-length nil <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">don't collapse long lines in compilation</span>

 eww-search-prefix <span style="color: #8B887D; font-style: italic;">"https://lite.duckduckgo.com/lite?q="</span> <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">eww search DuckDuckGo</span>
 dictionary-server <span style="color: #8B887D; font-style: italic;">"dict.org"</span> <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">skip trying to search localhost</span>

 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">simple frame title; I find the default distracting</span>
 frame-title-format '(<span style="color: #8B887D; font-style: italic;">"Emacs &#8212; "</span>
                      (<span style="color: #403D2E; font-style: italic;">:eval</span> (<span style="color: #737063; font-weight: bold;">if</span> (buffer-file-name)
                                 (abbreviate-file-name (buffer-file-name))
                               <span style="color: #8B887D; font-style: italic;">"%b"</span>))
                      (<span style="color: #403D2E; font-style: italic;">:eval</span> (<span style="color: #737063; font-weight: bold;">when</span> (<span style="color: #737063; font-weight: bold;">and</span> (buffer-modified-p) (not buffer-read-only))
                               <span style="color: #8B887D; font-style: italic;">" &#8226;"</span>)))
 ns-use-proxy-icon nil <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">remove icon from frame title in NS</span>

 initial-scratch-message (concat <span style="color: #8B887D; font-style: italic;">";; Welcome to GNU Emacs v"</span> emacs-version
                                 <span style="color: #8B887D; font-style: italic;">"."</span> (number-to-string emacs-build-number)
                                 <span style="color: #8B887D; font-style: italic;">"\n;;\n"</span>
                                 <span style="color: #8B887D; font-style: italic;">";; Go placidly amid the noise and haste,\n"</span>
                                 <span style="color: #8B887D; font-style: italic;">";; and remember what peace there may be in silence.\n"</span>
                                 <span style="color: #8B887D; font-style: italic;">";;\n"</span>
                                 <span style="color: #8B887D; font-style: italic;">";; Booted in "</span> (emacs-init-time <span style="color: #8B887D; font-style: italic;">"%.3f seconds"</span>)
                                 (format <span style="color: #8B887D; font-style: italic;">" with %d garbage collections"</span> gcs-done)
                                 (<span style="color: #737063; font-weight: bold;">when</span> (boundp 'straight--profile-cache)
                                   (format <span style="color: #8B887D; font-style: italic;">"\n;; Initialized %d packages"</span>
                                           (+ (hash-table-size straight--profile-cache)
                                              (<span style="color: #737063; font-weight: bold;">if</span> (<span style="color: #737063; font-weight: bold;">bound-and-true-p</span> package-alist)
                                                  (length package-activated-list)
                                                0))))
                                 <span style="color: #8B887D; font-style: italic;">"\n\n"</span>)

 use-package-verbose nil <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">ignore verbose output from use-package</span>

 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Save backups to system temp (somewhere in /var on MacOS)</span>
 backup-directory-alist `((<span style="color: #8B887D; font-style: italic;">".*"</span> . ,temporary-file-directory))
 auto-save-file-name-transforms `((<span style="color: #8B887D; font-style: italic;">".*"</span> ,temporary-file-directory t))
 backup-by-copying t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">don't clobber symlinks, our file is what we want</span>
 kept-new-versions 6 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">how many backups to keep</span>
 kept-old-versions 2 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">keep first two versions forever</span>
 delete-old-versions t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">delete backups older than `</span><span style="color: #655370; background-color: #ecf3ec; font-weight: bold; font-style: italic;">kept-new-versions</span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">' except `</span><span style="color: #655370; background-color: #ecf3ec; font-weight: bold; font-style: italic;">kept-old-versions</span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">'</span>
 version-control t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">use version numbers in backup files</span>

 git-commit-fill-column 72 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">best length in my opinion</span>
 auto-save-file-name-transforms '((<span style="color: #8B887D; font-style: italic;">".*"</span> <span style="color: #8B887D; font-style: italic;">"~/.config/emacs/auto-save-list/"</span> t))
 save-interprogram-paste-before-kill t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">see variable documentation</span>
 diff-switches <span style="color: #8B887D; font-style: italic;">"-u"</span> <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">unified diff by default</span>

 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">files</span>
 confirm-nonexistent-file-or-buffer nil <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">don't ask to create a buffer</span>
 require-final-newline t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">add newline to end of files if there isn't one</span>
 load-prefer-newer t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">load the newer of equivalent el, elc, eln</span>
 completion-ignore-case t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">ignorer la capitalisation</span>
 read-file-name-completion-ignore-case t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">ignorer la capitalisation des fichiers</span>
 delete-auto-save-files t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">auto-delete auto-save auto-files automatically</span>
 vc-follow-symlinks t <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">don't ask to follow symlinks</span>

 world-clock-list '((<span style="color: #8B887D; font-style: italic;">"America/New_York"</span> <span style="color: #8B887D; font-style: italic;">"Home"</span>)
                    (<span style="color: #8B887D; font-style: italic;">"America/Los_Angeles"</span> <span style="color: #8B887D; font-style: italic;">"San Francisco"</span>)
                    (<span style="color: #8B887D; font-style: italic;">"Europe/Warsaw"</span> <span style="color: #8B887D; font-style: italic;">"Poland"</span>)
                    (<span style="color: #8B887D; font-style: italic;">"Europe/Amsterdam"</span> <span style="color: #8B887D; font-style: italic;">"Netherlands"</span>)
                    (<span style="color: #8B887D; font-style: italic;">"Europe/London"</span> <span style="color: #8B887D; font-style: italic;">"London"</span>)
                    (<span style="color: #8B887D; font-style: italic;">"America/Chicago"</span> <span style="color: #8B887D; font-style: italic;">"Texas"</span>)
                    (<span style="color: #8B887D; font-style: italic;">"America/Denver"</span> <span style="color: #8B887D; font-style: italic;">"Utah"</span>)
                    (<span style="color: #8B887D; font-style: italic;">"America/Denver"</span> <span style="color: #8B887D; font-style: italic;">"Colorado"</span>)
                    (<span style="color: #8B887D; font-style: italic;">"Pacific/Auckland"</span> <span style="color: #8B887D; font-style: italic;">"New Zealand"</span>)
                    (<span style="color: #8B887D; font-style: italic;">"Australia/Sydney"</span> <span style="color: #8B887D; font-style: italic;">"Sydney"</span>))

 world-clock-time-format <span style="color: #8B887D; font-style: italic;">"%R %Z (%z) %a %d %b "</span>

 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">xref</span>
 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">Use separate xref history for each window, allowing independent code navigation</span>
 xref-history-storage #'xref-window-local-history

 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">;; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">indentation</span>
 indent-tabs-mode nil
 tab-width 2
 c-basic-offset 2
 cperl-indent-level 2
 css-indent-offset 2
 evil-shift-width 2
 js-indent-level 2
 js-switch-indent-offset 2
 js-syntactic-mode-name nil <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">just use normal mode name</span>
 js2-basic-offset 2
 typescript-indent-level 2
 python-indent-offset 4 <span style="color: #829293; background-color: #ecf3ec; font-style: italic;">; </span><span style="color: #829293; background-color: #ecf3ec; font-style: italic;">2 would be too much of a hassle</span>
 rust-indent-offset 4
 sgml-basic-offset 2
 sh-basic-offset 2
 tcl-indent-level 2
 tcl-tab-always-indent t
 lua-indent-level 2
 groovy-indent-offset 2
 web-mode-attr-indent-offset 2
 web-mode-code-indent-offset 2
 web-mode-css-indent-offset 2
 web-mode-markup-indent-offset 2
 tab-stop-list (number-sequence 2 200 2))
</pre>
</div>

<p>
Ensure language is setup, it's kind of crazy that this is necessary after all these years.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(setenv <span style="color: #8B887D; font-style: italic;">"LANG"</span> <span style="color: #8B887D; font-style: italic;">"en_US.UTF-8"</span>)
(setenv <span style="color: #8B887D; font-style: italic;">"LC_ALL"</span> <span style="color: #8B887D; font-style: italic;">"en_US.UTF-8"</span>)
</pre>
</div>

<p>
Underscores delineate words.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(modify-syntax-entry ?_ <span style="color: #8B887D; font-style: italic;">"w"</span>)
</pre>
</div>

<p>
Ensure case statements indent properly.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">with-eval-after-load</span> 'prog-mode
  (c-set-offset 'case-label '++))
</pre>
</div>

<p>
Show trailing whitespace in prog modes
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'prog-mode-hook (<span style="color: #737063; font-weight: bold;">lambda</span> () (<span style="color: #737063; font-weight: bold;">setq</span> show-trailing-whitespace t)))
</pre>
</div>

<p>
Enable narrow to region without asking
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(put 'narrow-to-region 'disabled nil)
</pre>
</div>

<p>
Prevent savehist from hogging the CPU
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">setq</span> history-length 100)
(put 'minibuffer-history 'history-length 50)
(put 'evil-ex-history 'history-length 50)
(put 'kill-ring 'history-length 25)
</pre>
</div>

<p>
Try to get emacsclient to open frames with focus. Doesn't always work, especially in GNOME.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'server-switch-hook (<span style="color: #737063; font-weight: bold;">lambda</span> () (select-frame-set-input-focus (selected-frame))))
</pre>
</div>

<p>
Enable the mouse in TTY, just for scrolling really.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">unless</span> (display-graphic-p)
  (xterm-mouse-mode 1)
  (global-set-key (kbd <span style="color: #8B887D; font-style: italic;">"&lt;mouse-4&gt;"</span>) 'scroll-down-line)
  (global-set-key (kbd <span style="color: #8B887D; font-style: italic;">"&lt;mouse-5&gt;"</span>) 'scroll-up-line))
</pre>
</div>

<p>
Disable idiotic Super keybindings. These are defined in <code>ns-win.el</code>. In my view, Super should be the domain of the OS and nothing in Emacs should ever be bound to it.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-unset-key (kbd <span style="color: #8B887D; font-style: italic;">"s-:"</span>))
(global-unset-key (kbd <span style="color: #8B887D; font-style: italic;">"s-C"</span>))
(global-unset-key (kbd <span style="color: #8B887D; font-style: italic;">"s-D"</span>))
(global-unset-key (kbd <span style="color: #8B887D; font-style: italic;">"s-E"</span>))
(global-unset-key (kbd <span style="color: #8B887D; font-style: italic;">"s-F"</span>))
(global-unset-key (kbd <span style="color: #8B887D; font-style: italic;">"s-d"</span>))
(global-unset-key (kbd <span style="color: #8B887D; font-style: italic;">"s-e"</span>))
(global-unset-key (kbd <span style="color: #8B887D; font-style: italic;">"s-f"</span>))
(global-unset-key (kbd <span style="color: #8B887D; font-style: italic;">"s-g"</span>))
(global-unset-key (kbd <span style="color: #8B887D; font-style: italic;">"s-j"</span>))
(global-unset-key (kbd <span style="color: #8B887D; font-style: italic;">"s-k"</span>))
(global-unset-key (kbd <span style="color: #8B887D; font-style: italic;">"s-l"</span>))
(global-unset-key (kbd <span style="color: #8B887D; font-style: italic;">"s-m"</span>))
(global-unset-key (kbd <span style="color: #8B887D; font-style: italic;">"s-n"</span>))
(global-unset-key (kbd <span style="color: #8B887D; font-style: italic;">"s-o"</span>))
(global-unset-key (kbd <span style="color: #8B887D; font-style: italic;">"s-q"</span>))
(global-unset-key (kbd <span style="color: #8B887D; font-style: italic;">"s-t"</span>))
(global-unset-key (kbd <span style="color: #8B887D; font-style: italic;">"s-u"</span>))
(global-unset-key (kbd <span style="color: #8B887D; font-style: italic;">"s-w"</span>))
</pre>
</div>

<p>
Typing gets rid of the active region.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(delete-selection-mode t)
</pre>
</div>

<p>
Try to save point position between sessions. Doesn't work consistently, but it's not a huge deal.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">setq</span> save-place-file (expand-file-name <span style="color: #8B887D; font-style: italic;">"saveplace"</span> aero-etc-dir))
(save-place-mode 1)
</pre>
</div>

<p>
Ensure buffer names are unique when filenames match. The forward option will expand each duplicate buffer name to include their parent directories as far as necessary to make them unique. Does not apply to renamed buffers.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">require</span> '<span style="color: #655370; font-weight: bold;">uniquify</span>)
(<span style="color: #737063; font-weight: bold;">setq</span> uniquify-buffer-name-style 'forward)
</pre>
</div>

<p>
Basic startup message override.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">defun</span> <span style="color: #83684C; font-weight: bold;">display-startup-echo-area-message</span> ()
  <span style="color: #96a7a9; font-weight: bold;">"Override ridiculous built-in crap."</span>
  (message <span style="color: #8B887D; font-style: italic;">"Aero est pr&#234;t"</span>))
</pre>
</div>

<p>
Put Eshell in bottom side window
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'display-buffer-alist
             '(<span style="color: #8B887D; font-style: italic;">"e?shell\\*</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">(?:</span><span style="color: #8B887D; font-style: italic;">&lt;[[:digit:]]+&gt;</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">\\</span><span style="color: #8B887D; font-weight: bold; font-style: italic;">)</span><span style="color: #8B887D; font-style: italic;">?\\'"</span>
               (display-buffer-reuse-window display-buffer-in-side-window)
               (side . bottom)
               (window-height . 23)))
</pre>
</div>

<p>
If we leave a buffer, set its mark as inactive. Helps prevent accidentally following a mark to another file.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(transient-mark-mode 1)
</pre>
</div>

<p>
Word navigation within camelCase
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-subword-mode 1)
</pre>
</div>

<p>
Don't allow the cursor in the minibuffer
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'minibuffer-setup-hook #'cursor-intangible-mode)
</pre>
</div>

<p>
Make files executable if the first line has a shebang
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'after-save-hook 'executable-make-buffer-file-executable-if-script-p)
</pre>
</div>

<p>
Always always always wrap lines
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-visual-line-mode +1)
</pre>
</div>

<p>
Log warnings but don't pop them up.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">setq</span> warning-minimum-level <span style="color: #403D2E; font-style: italic;">:error</span>)
</pre>
</div>
</div>
<div id="outline-container-orgec63817" class="outline-3">
<h3 id="orgec63817">Disable custom system</h3>
<div class="outline-text-3" id="text-orgec63817">
<p>
I strongly prefer setting up customization with this very config file, so make sure nothing happens if I accidentally customize a variable. This will add the customization line to <code>/dev/null</code> instead of <code>init.el</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #737063; font-weight: bold;">setq-default</span> custom-file <span style="color: #8B887D; font-style: italic;">"/dev/null"</span>)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org751419a" class="outline-2">
<h2 id="org751419a">Idle garbage collection</h2>
<div class="outline-text-2" id="text-org751419a">
<p>
Do garbage collection when I'm not actively doing anything for seven seconds.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(run-with-idle-timer 7 t 'garbage-collect)
</pre>
</div>
</div>
</div>
<div id="outline-container-org355ff21" class="outline-2">
<h2 id="org355ff21">Load local file</h2>
<div class="outline-text-2" id="text-org355ff21">
<p>
Load a local init file if it exists. This is a great place to put secrets and keys, or machine-specific functions such as helpers that rely on proprietary code structure or information.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(load (expand-file-name <span style="color: #8B887D; font-style: italic;">"init.local"</span> user-emacs-directory) t t)
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Jade Michael Thornton &lt;thornjad&gt;</p>
<p class="date">Created: 2025-03-05 Wed 00:45</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
